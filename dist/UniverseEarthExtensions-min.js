var UNIVERSE=UNIVERSE||{};UNIVERSE.EarthExtensions=function(d,e){var b=this;this.enableVisibilityLines=false;this.enableSensorProjections=false;this.enableSensorFootprintProjections=false;var c=false;var a=false;this.lockCameraToWithEarthRotation=false;this.rotationOffsetFromXAxis=0;this.useSunLighting=e?e:true;this.defaultObjects=new UNIVERSE.DefaultObjects(d);this.addEarth=function(f,h){var g=new UNIVERSE.Earth(d,b,f,h);d.addObject(g);d.updateOnce()};this.addMoon=function(g){var f=new UNIVERSE.Moon(d,b,g);d.addObject(f);d.updateOnce()};this.addSun=function(){var f=new UNIVERSE.Sun(d,b);d.addObject(f);d.updateOnce()};this.addSpaceObject=function(h,i){var g,f;d.getObjectFromLibraryById(h.modelId,function(j){g=j;d.getObjectFromLibraryById("default_material",function(k){d.addObject(h.getGraphicsObject(k,g,d,b));d.updateOnce();i()})})};this.addSensorVisibilityLines=function(f,h){if(f.sensors&&f.sensors.length>0){var g=new UNIVERSE.SensorVisibilityLinesController(f,d,b);d.addObject(g);d.updateOnce();h()}};this.addGroundObject=function(g,j){var i,f,h;if(!g.modelId){g.modelId="default_ground_object_geometry";h="default_ground_object_material"}else{h="default_material"}d.getObjectFromLibraryById(g.modelId,function(k){i=k;d.getObjectFromLibraryById(h,function(l){d.addObject(g.getGraphicsObject(l,i,d,b));d.updateOnce();j()})})};this.addGroundTrackPointForObject=function(g,i){var h,f;d.getObjectFromLibraryById("default_ground_object_geometry",function(j){h=j;d.getObjectFromLibraryById("default_ground_track_material",function(k){var l=new UNIVERSE.GroundTrackPoint(g,d,b,k,h);d.addObject(l);d.updateOnce();i()})})};this.addPropogationLineForObject=function(g,i){var h,f;h=new THREE.Geometry();d.getObjectFromLibraryById("default_orbit_line_material",function(j){var k=new UNIVERSE.PropogationLine(g,d,b,j,h);d.addObject(k);d.updateOnce();i()})};this.addSensorProjection=function(f,i){var h=Utilities.eciTo3DCoordinates(i.propagator(undefined,false),b);if(h){var g=UNIVERSE.SensorProjection(f,i,d,b,h);d.addObject(g);d.updateOnce()}};this.addSensorProjections=function(g,h){if(g.sensors.length>0){for(var f=g.sensors.length-1;f>=0;f--){this.addSensorProjection(g.sensors[f],g)}h()}};this.addSensorFootprintProjections=function(g,h){if(g.sensors.length>0){for(var f=0;f<g.sensors.length;f++){this.addSensorFootprintProjection(g.sensors[f],g)}h()}};this.addSensorFootprintProjection=function(g,h){var f=new UNIVERSE.SensorFootprintProjection(g,h,d,b);d.addObject(f);d.updateOnce()};this.addClosestGroundObjectTracingLine=function(f){var h;var g=new UNIVERSE.GraphicsObject(f.id+"_controlLine",f.objectName,undefined,function(i){var k=Utilities.eciTo3DCoordinates(f.propagator(undefined,false),b);var j=b.findClosestGroundObject(k);if(j!==undefined&&j.id!=h){b.removeLineBetweenObjects(f.id,h);h=j.id;b.addLineBetweenObjects(f.id,h)}},function(){});d.addObject(g);d.updateOnce()};this.addLineBetweenObjects=function(j,h,f,i){var g=new UNIVERSE.LineBetweenObjects(j,h,d,b,f,i);d.addObject(g)};this.removeLineBetweenObjects=function(i,g,h){var f="_to_";if(h){f=h}d.removeObject(i+f+g)};this.removeAllLinesBetweenObjects=function(){var f=d.getGraphicsObjects();for(var g in f){if(g.indexOf("_to_")>-1){d.removeObject(g)}}};this.findClosestGroundObject=function(f){if(f){var g=new THREE.Vector3(f.x,f.y,f.z);g.multiplyScalar(Constants.radiusEarth/g.length());return b.findClosestObject({x:g.x,y:g.y,z:g.z})}return undefined};this.findClosestObject=function(g){var h=d.getGraphicsObjects();var n;var l;var k=new THREE.Vector3(g.x,g.y,g.z);for(var j in h){if(h[j].currentLocation){var f=new THREE.Vector3(h[j].currentLocation.x,h[j].currentLocation.y,h[j].currentLocation.z);var m=f.distanceTo(k);if(n===undefined||m<n){l=h[j];n=m}}}return l};this.showAllOrbitLines=function(h){var f=d.getGraphicsObjects();a=h;for(var g in f){if(f[g].id.indexOf("_propogation")!=-1){d.showObject(f[g].id,h)}}};this.showOrbitLineForObject=function(f,g){d.showObject(g+"_propogation",f)};this.showModelForId=function(f,g){d.showObject(g,f)};this.showAllGroundTracks=function(h){var f=d.getGraphicsObjects();c=h;for(var g in f){if(f[g].id.indexOf("_groundPoint")!=-1){d.showObject(f[g].id,h)}}};this.showGroundTrackForId=function(f,g){d.showObject(g+"_groundPoint",f)};this.showAllSensorProjections=function(h){var f=d.getGraphicsObjects();this.enableSensorProjections=h;for(var g in f){if(f[g].id.indexOf("_sensorProjection")!=-1){d.showObject(f[g].id,h)}}};this.showSensorProjectionForId=function(g,j){var h=d.getGraphicsObjects();for(var f in h){if(f.indexOf(j+"_sensorProjection")>-1){d.showObject(f,g)}}};this.showAllSensorFootprintProjections=function(h){var f=d.getGraphicsObjects();this.enableSensorFootprintProjections=h;for(var g in f){if(f[g].id.indexOf("_footprint")!=-1){d.showObject(f[g].id,h)}}};this.showSensorFootprintProjectionsForId=function(h,j){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf(j)!=-1&&f[g].id.indexOf("_footprint")!=-1){d.showObject(f[g].id,h)}}};this.showSensorVisibilityLinesForId=function(h,j){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf(j+"_visibility_")!=-1){d.showObject(f[g].id,h)}}};this.showAllSensorVisibilityLines=function(h){var f=d.getGraphicsObjects();this.enableVisibilityLines=h;for(var g in f){if(f[g].id.indexOf("_visibility_")!=-1){d.showObject(f[g].id,h)}}};this.showAllLinesBetweenObjects=function(h){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf("_to_")!=-1){d.showObject(f[g].id,h)}}};this.showLineBetweenObjectsForId=function(h,j){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf(j+"_to_")!=-1||f[g].id.indexOf("_to_"+j)!=-1){d.showObject(f[g].id,h)}}};this.lockCameraPositionRelativeToEarth=function(f){this.lockCameraToWithEarthRotation=f};this.setSunLighting=function(f){b.useSunLighting=f;d.showObject("earth",!f);d.showObject("earth_day",f);d.showObject("earth_night",f)};this.removeAllExceptEarthAndMoon=function(){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id!="earth"&&f[g].id!="moon"&&f[g].id!="sun"){d.removeObject(f[g].id)}}};this.setup=function(){this.removeAllExceptEarthAndMoon();d.setup()}};UNIVERSE.DefaultObjects=function(a){a.setObjectInLibrary("default_ground_object_geometry",new THREE.SphereGeometry(200,20,10));a.setObjectInLibrary("default_ground_object_material",new THREE.MeshLambertMaterial({color:13369344}));a.setObjectInLibrary("default_ground_track_material",new THREE.MeshBasicMaterial({color:13369344,transparent:true,opacity:0.4,blending:THREE.AdditiveBlending}));a.setObjectInLibrary("default_orbit_line_material",new THREE.LineBasicMaterial({color:10027008,opacity:1}));a.setObjectInLibrary("default_ground_object_tracing_line_material",new THREE.LineBasicMaterial({color:39168,opacity:1}));this.sensorColors={colorList:["0xff0000","0x00cc00","0x0066ff","0x9900cc","0xffff00","0xff6666","0xebebeb","0xffaa00"],iterator:-1,nextColor:function(){this.iterator=(this.iterator+1)%this.colorList.length;return this.colorList[this.iterator]}}};UNIVERSE.Earth=function(h,f,d,l){var k=40,j=30;var n=new THREE.SphereGeometry(Constants.radiusEarth,k,j);var o=THREE.ImageUtils.loadTexture(d);var e=THREE.ImageUtils.loadTexture(l);var p=new THREE.MeshBasicMaterial({color:16777215,overdraw:true,map:e,blending:THREE.AdditiveBlending});var g=new THREE.Mesh(n,p);var c=new THREE.MeshPhongMaterial({map:o,color:16777215,transparent:true,blending:THREE.AdditiveBlending});var b=new THREE.Mesh(n,c);var i=new THREE.MeshBasicMaterial({color:16777215,overdraw:true,map:o,blending:THREE.AdditiveBlending});var a=new THREE.Mesh(n,i);var r=CoordinateConversionTools.convertTimeToGMST(h.getCurrentUniverseTime());var m=new UNIVERSE.GraphicsObject("earth","earth",{x:0,y:0,z:0},function(s){var t=MathTools.toRadians(CoordinateConversionTools.convertTimeToGMST(h.getCurrentUniverseTime()));if(f.lockCameraToWithEarthRotation){f.rotationOffsetFromXAxis+=(t-r);if(f.rotationOffsetFromXAxis>(2*Math.PI)){f.rotationOffsetFromXAxis-=(2*Math.PI)}}else{b.rotation.y=t-f.rotationOffsetFromXAxis;g.rotation.y=t-f.rotationOffsetFromXAxis;a.rotation.y=t-f.rotationOffsetFromXAxis}r=t},function(){h.draw(this.id+"_day",b,false);h.draw(this.id+"_night",g,false);h.draw(this.id,a,false);f.setSunLighting(f.useSunLighting)});return m};var UNIVERSE=UNIVERSE||{};UNIVERSE.EllipseSensorShape=function(b,a,c){this.shapeName=b;this.semiMajorAngle=a;this.semiMinorAngle=c;this.getSemiMajorAngle=function(){return this.semiMajorAngle};this.setSemiMajorAngle=function(d){this.semiMajorAngle=d};this.getSemiMinorAngle=function(){return this.semiMinorAngle};this.setSemiMinorAngle=function(d){this.semiMinorAngle=d};this.getAngularExtentOfSensorAtSpecifiedAzimuth=function(g){if((this.semiMajorAngle===0)&&(this.semiMinorAngle===0)){return 0}else{var e=MathTools.toRadians(this.semiMajorAngle);var d=MathTools.toRadians(this.semiMinorAngle);var h=Math.cos(MathTools.toRadians(g));var f=Math.sin(MathTools.toRadians(g));return MathTools.toDegrees(e*d/Math.sqrt((d*h)*(d*h)+(e*f)*(e*f)))}};this.canSensorSeePointAtAzEl=function(f,g){var e=false;var d=this.getAngularExtentOfSensorAtSpecifiedAzimuth(f);if(d>g){e=true}return e}};var UNIVERSE=UNIVERSE||{};UNIVERSE.GroundObject=function(d,c,b,a){if(!d){return undefined}this.id=d;this.objectName=c||d;this.propagator=a;this.modelId=b};UNIVERSE.GroundObject.prototype={constructor:UNIVERSE.GroundObject,set:function(d,c,a,b){this.id=d;this.objectName=c||d;this.propagator=a;this.modelId=b;return this},getGraphicsObject:function(b,f,g,e){f.applyMatrix(new THREE.Matrix4().setRotationFromEuler(new THREE.Vector3(Math.PI/2,Math.PI,0)));var c=new THREE.Mesh(f,b);var a=this;var d=new UNIVERSE.GraphicsObject(this.id,this.objectName,undefined,function(j){var k=a.propagator();var i=Utilities.eciTo3DCoordinates(k,e);c.position.set(i.x,i.y,i.z);this.currentLocation=k;var h=new THREE.Vector3(i.x,i.y,i.z);h.multiplyScalar(1.4);c.lookAt(h)},function(){g.draw(a.id,c,true)});return d}};var UNIVERSE=UNIVERSE||{};UNIVERSE.GroundTrackPoint=function(b,g,e,d,f){var a=new THREE.Mesh(f,d);var c=new UNIVERSE.GraphicsObject(b.id+"_groundPoint",b.objectName,undefined,function(j){var i=b.propagator(undefined,false);var k=Utilities.eciTo3DCoordinates(i,e);if(k){var h=new THREE.Vector3(k.x,k.y,k.z);h.multiplyScalar(Constants.radiusEarth/h.length());a.position.copy(h)}this.currentLocation=i},function(){g.draw(this.id,a,true)});return c};var UNIVERSE=UNIVERSE||{};UNIVERSE.LineBetweenObjects=function(a,k,g,e,d,o){var c,m;if(!d){d=39168}m=new THREE.LineBasicMaterial({color:d,opacity:1});var l=g.getGraphicsObjectById(a);var j=g.getGraphicsObjectById(k);if(l==undefined||j==undefined){return undefined}var b=Utilities.eciTo3DCoordinates(l.currentLocation,e);var i=Utilities.eciTo3DCoordinates(j.currentLocation,e);if(b==undefined||i==undefined){return undefined}c=new THREE.Geometry();c.vertices.push(new THREE.Vertex(new THREE.Vector3(b.x,b.y,b.z)));c.vertices.push(new THREE.Vertex(new THREE.Vector3(i.x,i.y,i.z)));var n=new THREE.Line(c,m);var h="_to_";if(o){h=o}var f=new UNIVERSE.GraphicsObject(a+h+k,undefined,undefined,function(p){var s=g.getGraphicsObjectById(a);var r=g.getGraphicsObjectById(k);if(s==undefined||r==undefined){return}var u=Utilities.eciTo3DCoordinates(s.currentLocation,e);var t=Utilities.eciTo3DCoordinates(r.currentLocation,e);if(!(u==undefined||t==undefined)){c.vertices[0].position={x:u.x,y:u.y,z:u.z};c.vertices[1].position={x:t.x,y:t.y,z:t.z};c.__dirtyVertices=true}},function(){g.draw(this.id,n,false)});return f};UNIVERSE.Moon=function(h,g,k){var l=40,b=30;var e=1737.1;var j=new THREE.SphereGeometry(e,l,b);var i=THREE.ImageUtils.loadTexture(k);var c=new THREE.MeshPhongMaterial({map:i,color:16777215,transparent:true,blending:THREE.AdditiveBlending});var d=new THREE.Mesh(j,c);var m=new THREE.MeshBasicMaterial({color:16777215,overdraw:true,map:i,blending:THREE.AdditiveBlending});var f=new THREE.Mesh(j,m);var a=new UNIVERSE.GraphicsObject("moon","moon",undefined,function(n){var r=new Date(h.getCurrentUniverseTime());var p=CoordinateConversionTools.getMoonPositionECIAtCurrentTime(r);var o=Utilities.eciTo3DCoordinates({x:p.x,y:p.y,z:p.z},g);d.position={x:o.x,y:o.y,z:o.z};f.position={x:o.x,y:o.y,z:o.z};this.currentLocation=p},function(){h.draw(this.id+"_day",d,false);h.draw(this.id,f,false);g.setSunLighting(g.useSunLighting)});return a};var UNIVERSE=UNIVERSE||{};UNIVERSE.PropogationLine=function(d,k,g,l,n){var a=new Date(k.getCurrentUniverseTime());var m=1440;var c=[];for(var f=0;f<m;f+=5){var o=d.propagator(a,false);c.push(o);var h=Utilities.eciTo3DCoordinates(o,g);if(h){var b=new THREE.Vector3(h.x,h.y,h.z);n.vertices.push(new THREE.Vertex(b))}a.setMinutes(a.getMinutes()+5)}var e=new THREE.Line(n,l);var i=new UNIVERSE.GraphicsObject(d.id+"_propogation",d.objectName,undefined,function(j){if(g.lockCameraToWithEarthRotation){var s=c.length;for(var p=0;p<s;p++){var r=Utilities.eciTo3DCoordinates(c[p],g);if(r&&e.geometry.vertices[p]){e.geometry.vertices[p].position={x:r.x,y:r.y,z:r.z}}}e.geometry.__dirtyVertices=true}},function(){k.draw(this.id,e,false)});return i};var UNIVERSE=UNIVERSE||{};UNIVERSE.RectangleSensorShape=function(b,c,a){this.shapeName=b;this.width=c;this.height=a;this.getHeight=function(){return this.height};this.setHeight=function(d){this.height=d};this.getWidth=function(){return this.width};this.setWidth=function(d){this.width=d};this.getAngularExtentOfSensorAtSpecifiedAzimuth=function(i){if((this.height===0)&&(this.width===0)){return 0}else{var f=MathTools.toDegrees(Math.atan(this.height/this.width));var j=180-f;var d=180+f;var h=360-f;if(i<0){i+=360}var g=Math.abs(this.width/(2*Math.cos(MathTools.toRadians(i))));var e=Math.abs(this.height/(2*Math.sin(MathTools.toRadians(i))));if(i<f){return g}else{if(i<j){return e}else{if(i<d){return g}else{if(i<h){return e}else{return g}}}}}};this.canSensorSeePointAtAzEl=function(f,g){var e=false;var d=this.getAngularExtentOfSensorAtSpecifiedAzimuth(f);if(d>g){e=true}return e}};UNIVERSE.Sensor=function(b,a){this.name=b;this.shape=a;this.quaternionFromRSWToSensor=new Quaternion();this.rotationRadians=MathTools.toRadians(180);this.rotationAxis={x:0,y:0,z:1};this.quaternionFromRSWToSensor.setW(Math.cos(this.rotationRadians/2));this.quaternionFromRSWToSensor.setX(Math.sin(this.rotationRadians/2)*this.rotationAxis.x);this.quaternionFromRSWToSensor.setY(Math.sin(this.rotationRadians/2)*this.rotationAxis.y);this.quaternionFromRSWToSensor.setZ(Math.sin(this.rotationRadians/2)*this.rotationAxis.z);this.rotateSensorAboutRadialVector=function(f){if(f&&f!==0){var e=new Quaternion();var c=MathTools.toRadians(f);var d={x:1,y:0,z:0};e.setW(Math.cos(c/2));e.setX(Math.sin(c/2)*d.x);e.setY(Math.sin(c/2)*d.y);e.setZ(Math.sin(c/2)*d.z);this.quaternionFromRSWToSensor=QuaternionMath.multiplyQuaternions(e,this.quaternionFromRSWToSensor)}};this.rotateSensorAboutAlongTrackVector=function(f){if(f&&f!==0){var e=new Quaternion();var c=MathTools.toRadians(f);var d={x:0,y:1,z:0};e.setW(Math.cos(c/2));e.setX(Math.sin(c/2)*d.x);e.setY(Math.sin(c/2)*d.y);e.setZ(Math.sin(c/2)*d.z);this.quaternionFromRSWToSensor=QuaternionMath.multiplyQuaternions(e,this.quaternionFromRSWToSensor)}};this.rotateSensorAboutCrossTrackVector=function(f){if(f&&f!==0){var e=new Quaternion();var c=MathTools.toRadians(f);var d={x:0,y:0,z:1};e.setW(Math.cos(c/2));e.setX(Math.sin(c/2)*d.x);e.setY(Math.sin(c/2)*d.y);e.setZ(Math.sin(c/2)*d.z);this.quaternionFromRSWToSensor=QuaternionMath.multiplyQuaternions(e,this.quaternionFromRSWToSensor)}};this.getSensorQuaternionRSW=function(){return this.quaternionFromRSWToSensor};this.setSensorQuaternionRSW=function(c){this.quaternionFromRSWToSensor=c};this.getName=function(){return this.name};this.setName=function(c){this.name=c};this.getShape=function(){return this.shape};this.setShape=function(c){this.shape=c};this.determineTargetAzElRelativeToSensor=function(H,l){var f=H.getEci();var z=new THREE.Vector3(l.x-f.getX(),l.y-f.getY(),l.z-f.getZ());var y=new THREE.Vector3(f.getX(),f.getY(),f.getZ());var n=new THREE.Vector3(f.getVX(),f.getVY(),f.getVZ());var h=y.length();var j=new THREE.Vector3();j.cross(y,n);var p=new THREE.Vector3();p.copy(y);p.divideScalar(h);var m=new THREE.Vector3();m.copy(j);m.divideScalar(j.length());var t=new THREE.Vector3();t.cross(m,y);var G=z.dot(p);var F=z.dot(t);var A=z.dot(m);var B=new THREE.Vector3(G/p.length(),F/t.length(),A/m.length());var o=QuaternionMath.applyQuaternionRotation(this.quaternionFromRSWToSensor,B);var D=new THREE.Vector3(1,0,0);var K=new THREE.Vector3(1,-Math.tan(MathTools.toRadians(this.shape.getAngularExtentOfSensorAtSpecifiedAzimuth(0))),0);var E=new THREE.Vector3(1,0,Math.tan(MathTools.toRadians(this.shape.getAngularExtentOfSensorAtSpecifiedAzimuth(90))));var N=MathTools.toRadians(MathTools.angleBetweenTwoVectorsVector(D,K));var M=MathTools.toRadians(MathTools.angleBetweenTwoVectorsVector(D,o));var L=MathTools.toRadians(MathTools.angleBetweenTwoVectorsVector(K,o));var J=MathTools.toRadians(MathTools.angleBetweenTwoVectorsVector(E,o));var I=MathTools.toRadians(MathTools.angleBetweenTwoVectorsVector(E,D));var i=0.5*(N+M+L);var u=2*Math.asin(Math.sqrt((Math.sin(Math.abs(i-N))*Math.sin(Math.abs(i-M))/(Math.sin(N)*Math.sin(M)))));var k=MathTools.toDegrees(u);var g=MathTools.toDegrees(M);if(J>M&&J>I){k=360-k}return{az:k,el:g}};this.checkToSeeIfEarthObscuresLineBetweenSatelliteAndTargetSphericalEarth=function(n,i){var e=false;var g=Constants.radiusEarth;var l=n.getEci();var f=new THREE.Vector3(l.getX()/g,l.getY()/g,l.getZ()/g);var d=new THREE.Vector3(i.getX()/g,i.getY()/g,i.getZ()/g);var m=f.length();var k=d.length();var c=0.5;var j=0;if(m<1||k<1){e=false}else{var h=f.dot(d);c=(m*m-h)/(m*m+k*k-2*h);if(c<0||c>1){e=true}else{j=(1-c)*m*m+h*c;if(j>=1){e=true}}}return !e};this.checkToSeeIfEarthObscuresLineBetweenSatelliteAndTargetOblateEarth=function(n,i){var e=false;var g=Constants.radiusEarth;var l=n.getEci();var f=new THREE.Vector3(l.getX()/g,l.getY()/g,l.getZ()/g);var d=new THREE.Vector3(i.getX()/g,i.getY()/g,i.getZ()/g);var m=f.length();var k=d.length();var c=0.5;var j=0;var h=f.dot(d);c=(m*m-h)/(m*m+k*k-2*h);if(c<0||c>1){e=true}else{j=(1-c)*m*m+h*c;if(j>=1){e=true}}return !e};this.checkSensorVisibilityOfTargetPoint=function(d,e){var f=this.determineTargetAzElRelativeToSensor(d,e);var c=this.shape.canSensorSeePointAtAzEl(f.az,f.el);var g=this.checkToSeeIfEarthObscuresLineBetweenSatelliteAndTargetOblateEarth(d,e);if(g){return false}else{if(c===true&&g===false){return true}else{return false}}};this.buildPointsToDefineSensorShapeInECI=function(o,m){var s=[];var c=360/o;for(var h=0;h<o;h++){var p=h*c;var d=MathTools.toRadians(this.shape.getAngularExtentOfSensorAtSpecifiedAzimuth(p));var f=new THREE.Vector3(1,d*Math.cos(MathTools.toRadians(p)),d*Math.sin(MathTools.toRadians(p)));var n=f.length();f=f.divideScalar(n);f=QuaternionMath.applyQuaternionRotation(this.quaternionFromRSWToSensor,f);var r=new UNIVERSE.RSWCoordinates(f.x,f.y,f.z);var k=m.getEci();var l=k.getX();var j=k.getY();var e=k.getZ();var g=CoordinateConversionTools.convertRSWToECI(m,r);s[h]=new THREE.Vector3(l+g.getX(),j+g.getY(),e+g.getZ())}return s};this.findProjectionPoints=function(n,C,H){var g=C.getEci();var u=new THREE.Vector3(g.x,g.y,g.z);var h=new THREE.Vector3(-u.x,-u.y,-u.z);var w=[];var M=n.length;for(var F=0;F<M;F++){var t=new THREE.Vector3(n[F].x-u.x,n[F].y-u.y,n[F].z-u.z);var D=u.length();var N=D+H;var p=t;var L=h;var l=100;var y=Constants.radiusEarth+l;var B=p.dot(L);var E=L.dot(L);var f=B*B-E+y*y;if(f>=0){var v=Math.sqrt(B*B-E+y*y);var G=B+v;var e=B-v;var d=new THREE.Vector3(t.x*e+u.x,t.y*e+u.y,t.z*e+u.z);if(d.x){w.push(d)}}else{var A=new THREE.Vector3();A.copy(t);A.multiplyScalar(N);var O=new THREE.Vector3();O.copy(h);O.divideScalar(D);var K=Math.acos(t.dot(O));var z=D*Math.sin(K);var o=z/Math.atan(K);var m=o/N;var k=new THREE.Vector3((A.x)*m+u.x,(A.y)*m+u.y,(A.z)*m+u.z);var J=k.length();var j=(Constants.radiusEarth+l)/J;var s=new THREE.Vector3();s.copy(k);s.multiplyScalar(j);w.push(s)}}return w}};var UNIVERSE=UNIVERSE||{};UNIVERSE.SensorFootprintProjection=function(b,e,i,g,d){var m=new THREE.LineBasicMaterial({color:Utilities.get_random_color(),opacity:0.5,linewidth:3});var c=new THREE.Geometry();var l=b.buildPointsToDefineSensorShapeInECI(40,e);var k=b.findProjectionPoints(l,e,1000);for(var f=0;f<k.length;f++){var a=new THREE.Vector3(-k[f].x,k[f].z,k[f].y);c.vertices.push(new THREE.Vertex(a))}c.vertices.push(new THREE.Vertex(new THREE.Vector3(-k[0].x,k[0].z,k[0].y)));var n=new THREE.Line(c,m);var h=new UNIVERSE.GraphicsObject(e.id+"_footprint_"+b.name,undefined,undefined,function(o){if(g.enableSensorFootprintProjections){var s=this.sensor.buildPointsToDefineSensorShapeInECI(40,e);var t=this.sensor.findProjectionPoints(s,e,1000);for(var j=0;j<t.length;j++){var r=Utilities.eciTo3DCoordinates(t[j],g);n.geometry.vertices[j].position={x:r.x,y:r.y,z:r.z}}var p=Utilities.eciTo3DCoordinates(t[0],g);n.geometry.vertices[t.length].position={x:p.x,y:p.y,z:p.z};n.geometry.__dirtyVertices=true}},function(){i.draw(this.id,n,false)});h.sensor=b;return h};var UNIVERSE=UNIVERSE||{};UNIVERSE.SensorProjection=function(c,f,k,h,e){var b=30;var p=c.buildPointsToDefineSensorShapeInECI(b,f);var n=c.findProjectionPoints(p,f,1000);var a=new Array(n.length);var m=n.length;for(var g=0;g<m;g++){var i=Utilities.eciTo3DCoordinates(n[g],h);a[g]=i}var d=new UNIVERSE.SensorProjectionGeometry(e,a);var o=new THREE.MeshBasicMaterial({color:h.defaultObjects.sensorColors.nextColor(),transparent:true,blending:THREE.AdditiveBlending,opacity:0.15,overdraw:true});var r=new THREE.Mesh(d,o);r.doubleSided=true;var l=new UNIVERSE.GraphicsObject(f.id+"_sensorProjection_"+c.name,f.objectName,undefined,function(s){if(h.enableSensorProjections){var w=Utilities.eciTo3DCoordinates(f.propagator(undefined,false),h);if(w){var u=c.buildPointsToDefineSensorShapeInECI(b,f);var v=c.findProjectionPoints(u,f,1000);a=[];for(var t=0;t<m;t++){var y=Utilities.eciTo3DCoordinates(v[t],h);a[t]=y}r.geometry.recalculateVertices(w,a)}}},function(){k.draw(this.id,r,false)});return l};var UNIVERSE=UNIVERSE||{};UNIVERSE.SensorProjectionGeometry=function(s,l){THREE.Geometry.call(this);var z=1;var n,m,f=[],o=[];l.push(l[0]);var A=l.length-1;var e,g,p,t;var r=0;var w=[];var F=[];for(n=0;n<=A;n++){t=n/A;e=s.x;g=s.y;p=s.z;this.vertices.push(new THREE.Vertex(new THREE.Vector3(e,g,p)));w.push(this.vertices.length-1);F.push(new THREE.UV(t,r))}f.push(w);o.push(F);r=1;w=[];F=[];for(n=0;n<=A;n++){t=n/A;e=l[n].x;g=l[n].y;p=l[n].z;this.vertices.push(new THREE.Vertex(new THREE.Vector3(e,g,p)));w.push(this.vertices.length-1);F.push(new THREE.UV(t,r))}f.push(w);o.push(F);for(m=0;m<z;m++){for(n=0;n<A;n++){var d=f[m][n];var c=f[m+1][n];var b=f[m+1][n+1];var a=f[m][n+1];var k=this.vertices[d].position.clone().setY(0).normalize();var j=this.vertices[c].position.clone().setY(0).normalize();var i=this.vertices[b].position.clone().setY(0).normalize();var h=this.vertices[a].position.clone().setY(0).normalize();var E=o[m][n].clone();var D=o[m+1][n].clone();var C=o[m+1][n+1].clone();var B=o[m][n+1].clone();this.faces.push(new THREE.Face4(d,c,b,a,[k,j,i,h]));this.faceVertexUvs[0].push([E,D,C,B])}}this.computeCentroids();this.computeFaceNormals();this.dynamic=true};UNIVERSE.SensorProjectionGeometry.prototype=new THREE.Geometry();UNIVERSE.SensorProjectionGeometry.prototype.constructor=UNIVERSE.SensorProjectionGeometry;UNIVERSE.SensorProjectionGeometry.prototype.recalculateVertices=function(a,c){c.push(c[0]);this.dynamic=true;var h=c.length;var f=1;var b,g,e,d;for(x=0;x<h;x++){d=x/h;b=a.x;g=a.y;e=a.z;this.vertices[x].position={x:b,y:g,z:e}}for(x=0;x<h;x++){d=x/h;b=c[x].x;g=c[x].y;e=c[x].z;this.vertices[x+h].position={x:b,y:g,z:e}}this.__dirtyVertices=true};var UNIVERSE=UNIVERSE||{};UNIVERSE.SensorVisibilityLinesController=function(a,c,b){var d=new UNIVERSE.GraphicsObject(a.id+"_visibilityLines",a.objectName,undefined,function(r){if(b.enableVisibilityLines){var n=a.sensors.length;var p=c.getGraphicsObjects();var g=new Array();for(var m=0;m<n;m++){var e=a.sensors[m];for(var h in p){var l=p[h];if(l.currentLocation!=undefined&&l.modelName!="earth"&&l.modelName!="moon"&&l.modelName!="sun"&&l.id!=a.id&&l.id.indexOf("_groundPoint")==-1&&l.id.indexOf("_propagation")==-1&&l.id.indexOf("_to_")==-1&&l.id.indexOf("_visibility_")==-1){var o=e.checkSensorVisibilityOfTargetPoint(a,l.currentLocation);if(!g[l.id]){g[l.id]=o}}}}for(var f in g){if(g[f]){if(c.getGraphicsObjectById(a.id+"_visibility_"+f)==undefined){b.addLineBetweenObjects(a.id,f,undefined,"_visibility_")}else{}}else{b.removeLineBetweenObjects(a.id,f,"_visibility_")}}}b.showAllSensorVisibilityLines(b.enableVisibilityLines)},function(){});return d};UNIVERSE.SpaceObject=function(a,f,i,c,e,j,b,h,g,d){if(!a){return undefined}this.id=a;this.objectName=f||a;this.propagator=c;this.modelId=i;this.showPropagationLine=e||false;this.showGroundTrackPoint=j||false;this.sensors=b||undefined;this.currentLocation=h||undefined;this.universe=g||undefined;this.earthExtensions=d||undefined};UNIVERSE.SpaceObject.prototype={constructor:UNIVERSE.SpaceObject,set:function(a,e,c,h,i,j,b,g,f,d){this.id=a;this.objectName=e||a;this.propagator=c;this.modelId=h;this.showPropagationLine=i||false;this.showGroundTrackPoint=j||false;this.sensors=b||undefined;this.currentLocation=g||undefined;this.universe=f||undefined;this.earthExtensions=d||undefined;return this},getEci:function(){return this.currentLocation},getGraphicsObject:function(b,c,f,a){this.universe=f;this.earthExtensions=a;var e=this;c.applyMatrix(new THREE.Matrix4().setRotationFromEuler(new THREE.Vector3(-Math.PI/2,0,0)));var d=new THREE.Mesh(c,b);var g=new UNIVERSE.GraphicsObject(this.id,this.objectName,undefined,function(i){var h=e.propagator();var j=Utilities.eciTo3DCoordinates(h,a);if(j){d.position.set(j.x,j.y,j.z);d.lookAt(new THREE.Vector3(0,0,0));this.currentLocation=h}},function(){e.universe.draw(this.id,d,false);e.earthExtensions.showModelForId(e.showVehicle,this.id)});return g}};UNIVERSE.Sun=function(c,b){var a=new UNIVERSE.GraphicsObject("sun","sun",undefined,function(d){var f=CoordinateConversionTools.getSunPositionECIAtCurrentTime(c.getCurrentUniverseTime());var e=Utilities.eciTo3DCoordinates({x:f.x,y:f.y,z:f.z},b);c.updateLight(e.x,e.y,e.z,1.5);this.currentLocation=f},function(){c.draw(this.id,undefined,false)});return a};var NearCircularPropagator={propagateOrbit:function(c,k,t,d){var I=c.getMeanAnomaly()+c.getMeanMotion()*k;var n=MathTools.toRadians(c.getArgOfPerigee());var D=MathTools.toRadians(c.getRaan());var l=MathTools.toRadians(c.getInclination());var o=c.getEccentricity();var v=Constants.muEarth;I=MathTools.toRadians(I);var b=I*0.95;var C=0.00001;for(var E=0;E<500;E++){var a=I-(b-o*Math.sin(b));if(Math.abs(a)>C){if(a>0){b=b+Math.abs(I-b)/2}else{if(a<0){b=b-Math.abs(I-b)/2}}}else{break}}var H=2*Math.atan(Math.sqrt((1+o)/(1-o))*Math.tan(b/2));var A=c.getSemimajorAxis()*(1-o*o);var u=c.getSemimajorAxis()*(1-o*Math.cos(b));var F=Math.sqrt(v*c.getSemimajorAxis()*(1-o*o));var m=u*(Math.cos(D)*Math.cos(n+H)-Math.sin(D)*Math.sin(n+H)*Math.cos(l));var j=u*(Math.sin(D)*Math.cos(n+H)+Math.cos(D)*Math.sin(n+H)*Math.cos(l));var g=u*Math.sin(l)*Math.sin(n+H);var s=((m*F*o)/(u*A))*Math.sin(H)-(F/u)*(Math.cos(D)*Math.sin(n+H)+Math.sin(D)*Math.cos(n+H)*Math.cos(l));var B=((j*F*o)/(u*A))*Math.sin(H)-(F/u)*(Math.sin(D)*Math.sin(n+H)-Math.cos(D)*Math.cos(n+H)*Math.cos(l));var G=((g*F*o)/(u*A))*Math.sin(H)+(F/u)*(Math.sin(l)*Math.cos(n+H));var e=new UNIVERSE.ECICoordinates();e.setX(m);e.setY(j);e.setZ(g);e.setVX(s);e.setVY(B);e.setVZ(G);e.setAX(0);e.setAY(0);e.setAZ(0);return e}};var OrbitPropagator={propagateOrbit:function(e,c,d,b){var a=CoordinateConversionTools.convertECIToKeplerian(e);if(c===0||isNaN(a.getEccentricity())){return e}else{if(a.getEccentricity()<=0.1){return NearCircularPropagator.propagateOrbit(a,c,d,b)}else{return RungeKuttaFehlbergPropagator.propagateOrbit(e,c,d,b)}}}};var RungeKuttaFehlbergPropagator={rungeKuttaFehlbergIntegrator:function(a,o,r,d){var p=a;var A=[];var c=[];var t=0;var k=1;var y=r;var s=0.02;if(r>s){y=s}var z=d.getTime();k=o/y;var u=1;for(u=1;u<=k;u++){z=z+(y*1000);var w=new Date(z);GST=CoordinateConversionTools.convertTimeToGMST(w);var n=[];var m=[];var l=[];var g=[];var e=[];var b=[];var v=0;for(v=0;v<9;v++){c[v]=p[v]}t=y;A=this.generateStateUpdate(c,t,GST);for(v=0;v<9;v++){n[v]=y*A[v]}for(v=0;v<9;v++){c[v]=p[v]+0.25*n[v]}t=0.25*y;A=this.generateStateUpdate(c,t,GST);for(v=0;v<9;v++){m[v]=y*A[v]}for(v=0;v<9;v++){c[v]=p[v]+(3/32)*n[v]+(9/32)*m[v]}t=0.375*y;A=this.generateStateUpdate(c,t,GST);for(v=0;v<9;v++){l[v]=y*A[v]}for(v=0;v<9;v++){c[v]=p[v]+((1932/2197)*n[v])-((7200/2197)*m[v])+((7296/2197)*l[v])}t=0.9230769230769231*y;A=this.generateStateUpdate(c,t,GST);for(v=0;v<9;v++){g[v]=y*A[v]}for(v=0;v<9;v++){c[v]=p[v]+((439/216)*n[v])-(8*m[v])+((3680/513)*l[v])-((845/4104)*g[v])}t=y;A=this.generateStateUpdate(c,t,GST);for(v=0;v<9;v++){e[v]=y*A[v]}for(v=0;v<9;v++){c[v]=p[v]-((8/27)*n[v])+((2)*m[v])-((3544/2565)*l[v])+((1859/4104)*g[v])-((11/40)*e[v])}t=(0.5)*y;A=this.generateStateUpdate(c,t,GST);for(v=0;v<9;v++){b[v]=y*A[v]}for(v=0;v<9;v++){p[v]=p[v]+((16/135)*n[v])+((6656/12825)*l[v])+((28561/56430)*g[v])-((9/50)*e[v])+((2/55)*b[v])}}return p},generateStateUpdate:function(f,e,d){var a=[];var b=Constants.muEarth;var c=Math.sqrt((f[0]*f[0])+(f[1]*f[1])+(f[2]*f[2]));a[0]=f[3];a[1]=f[4];a[2]=f[5];a[3]=-b*f[0]/(c*c*c);a[4]=-b*f[1]/(c*c*c);a[5]=-b*f[2]/(c*c*c);a[6]=0;a[7]=0;a[8]=0;return a},propagateOrbit:function(g,c,e,b){var f=[];f[0]=g.x;f[1]=g.y;f[2]=g.z;f[3]=g.vx;f[4]=g.vy;f[5]=g.vz;f[6]=g.ax;f[7]=g.ay;f[8]=g.az;var d=this.rungeKuttaFehlbergIntegrator(f,c,e,b);var a=new UNIVERSE.ECICoordinates(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8]);return a}};var Constants={radiusEarth:6378.1363,muEarth:398600.4418,eccEarthSphere:0.081819221456,piOverOneEighty:0.01745329251,oneEightyOverPi:57.295779513};var CoordinateConversionTools={convertCurrentEpochToJulianDate:function(f){var c=0;var e=f.getUTCFullYear();var g=f.getUTCMonth()+1;var b=f.getUTCDate();var a=f.getUTCHours();var h=f.getUTCMinutes();var d=f.getUTCSeconds()+(f.getUTCMilliseconds()/1000);c=367*e-Math.floor((7*(e+Math.floor(((g+9)/12)))/4))+Math.floor((275*g/9))+(b)+1721013.5+((d/60+h)/60+a)/24;return c},convertTimeToGMST:function(d){var c=this.convertCurrentEpochToJulianDate(d);var b=(c-2451545)/36525;var a=67310.54841+(876600*3600+8640184.812866)*b+0.093104*b*b-(0.0000062)*b*b*b;var e=Math.floor(a/86400);a=a-e*86400;a=a/240;if(a<0){a=a+360}return a},convertLLAtoECEF:function(j){var i=MathTools.toRadians(j.getLatitude());var b=MathTools.toRadians(j.getLongitude());var c=Constants.radiusEarth;var m=Constants.eccEarthSphere;var d=Math.sin(i);var g=j.getAltitude();var e=c/Math.sqrt(1-m*m*d*d);var a=c*(1-m*m)/Math.sqrt(1-m*m*d*d);var l=(e+g)*(Math.cos(i)*Math.cos(b));var k=(e+g)*(Math.cos(i)*Math.sin(b));var h=(a+g)*(Math.sin(i));var f=new UNIVERSE.ECEFCoordinates(l,k,h,0,0,0,0,0,0);return f},convertECEFtoLLA:function(a){var j=new UNIVERSE.LLACoordinates();var o=a.getX();var n=a.getY();var m=a.getZ();var k=Constants.eccEarthSphere;var r=Constants.radiusEarth;var w=Math.sqrt((o*o)+(n*n));var i=n/w;var e=o/w;var f=Math.atan(i/e);var l=f;var d=m/w;var v=Math.atan(d);var s=1e-8;var u=0;var g=v;var p=2000;var t;var b;var h=0;while(Math.abs(g-p)>s){p=g;t=Math.sin(p);u=r/Math.sqrt(1-(k*k*t*t));b=(m+u*k*k*t)/w;g=Math.atan(b);h++;if(h>500){g=0;p=0}}if(l<-Math.PI){l=l+2*Math.PI}if(l>Math.PI){l=l-2*Math.PI}j.setLatitude(MathTools.toDegrees(g));j.setLongitude(MathTools.toDegrees(l));j.setAltitude(w/Math.cos(g)-u);return j},convertECItoECEF:function(f,d){var b=new UNIVERSE.ECEFCoordinates();eciPos=[];eciPos[0]=f.getX();eciPos[1]=f.getY();eciPos[2]=f.getZ();var a=MathTools.rot3(d,eciPos);b.setX(a[0]);b.setY(a[1]);b.setZ(a[2]);var c=[];c[0]=f.getVX();c[1]=f.getVY();c[2]=f.getVZ();a=MathTools.rot3(d,c);b.setVX(a[0]);b.setVY(a[1]);b.setVZ(a[2]);var e=[];e[0]=f.getAX();e[1]=f.getAY();e[2]=f.getAZ();a=MathTools.rot3(d,e);b.setAX(a[0]);b.setAY(a[1]);b.setAZ(a[2]);return b},convertECEFtoECI:function(b,d){var f=new UNIVERSE.ECICoordinates();var g=[];g[0]=b.getX();g[1]=b.getY();g[2]=b.getZ();var a=MathTools.rot3(-d,g);f.setX(a[0]);f.setY(a[1]);f.setZ(a[2]);var c=[];c[0]=b.getVX();c[1]=b.getVY();c[2]=b.getVZ();a=MathTools.rot3(-d,c);f.setVX(a[0]);f.setVY(a[1]);f.setVZ(a[2]);var e=[];e[0]=b.getAX();e[1]=b.getAY();e[2]=b.getAZ();a=MathTools.rot3(-d,e);f.setAX(a[0]);f.setAY(a[1]);f.setAZ(a[2]);return f},convertECItoLLA:function(c,b){var a=this.convertECItoECEF(c,b);return this.convertECEFtoLLA(a)},convertLLAtoECI:function(b,c){var a=this.convertLLAtoECEF(b);return this.convertECEFtoECI(a,c)},convertKeplerianToECI:function(d){var t=new UNIVERSE.ECICoordinates();var m=d.getSemimajorAxis();var j=d.getEccentricity();var b=m*(1-j*j);var l=d.getTrueAnomaly();var f=Math.cos(MathTools.toRadians(l));var g=Math.sin(MathTools.toRadians(l));var s=b*f/(1+j*f);var k=b*g/(1+j*f);var h=0;var o=[];o[0]=s;o[1]=k;o[2]=h;var n=[];n=MathTools.rot3(-d.getArgOfPerigee(),o);n=MathTools.rot1(-d.getInclination(),n);n=MathTools.rot3(-d.getRaan(),n);t.setX(n[0]);t.setY(n[1]);t.setZ(n[2]);var i=-Math.sqrt(Constants.muEarth/b)*g;var c=Math.sqrt(Constants.muEarth/b)*(j+f);var r=0;o[0]=i;o[1]=c;o[2]=r;n=MathTools.rot3(-d.getArgOfPerigee(),o);n=MathTools.rot1(-d.getInclination(),n);n=MathTools.rot3(-d.getRaan(),n);t.setVX(n[0]);t.setVY(n[1]);t.setVZ(n[2]);return t},convertECIToKeplerian:function(l){var G=new KeplerianCoordinates();var u=new THREE.Vector3(l.x,l.y,l.z);var o=new THREE.Vector3(l.vx,l.vy,l.vz);var E=new THREE.Vector3();E.cross(u,o);var w=E.length();var d=u.length();var C=o.length();var b=new THREE.Vector3(0,0,1);var z=new THREE.Vector3();z.cross(b,E);var D=C*C-Constants.muEarth/d;var B=u.dot(o);var I=new THREE.Vector3((1/Constants.muEarth)*(D*u.x-B*o.x),(1/Constants.muEarth)*(D*u.y-B*o.y),(1/Constants.muEarth)*(D*u.z-B*o.z));var f=I.length();var F=C*C/2-Constants.muEarth/d;var y=0;var J=0;if(f==1){J=Infinity;y=w*w/Constants.muEarth}else{J=-Constants.muEarth/(2*F);y=J*(1-f*f)}var m=MathTools.toDegrees(Math.acos(E.z/w));var j=MathTools.toDegrees(Math.acos(z.x/z.length()));if(z.y<0){j=360-j}var g=MathTools.toDegrees(Math.acos(z.dot(I)/(z.length()*f)));if(I.z<0){g=360-g}var A=I.dot(u)/(f*d);if(A>1){A=1}var K=MathTools.toDegrees(Math.acos(A));if(o.dot(u)<0){K=360-K}if(isNaN(j)){j=0.00001}if(isNaN(g)){g=0.00001}G.setSemimajorAxis(J);G.setEccentricity(f);G.setTrueAnomaly(K);G.setRaan(j);G.setInclination(m);G.setMeanMotion(MathTools.toDegrees(Math.sqrt(Constants.muEarth/(J*J*J))));G.setArgOfPerigee(g);var s=Math.sin(MathTools.toRadians(K));var i=Math.cos(MathTools.toRadians(K));var t=((s*Math.sqrt(1-f*f))/(1+f*i));var k=((f+i)/(1+f*i));var c=Math.atan2(t,k);var H=c-f*t;H=MathTools.toDegrees(H);G.setMeanAnomaly(H);return G},buildRotationMatrixToConvertECItoRSW:function(e){var f=CoordinateConversionTools.convertECIToKeplerian(e.getEci());var c=f.getTrueAnomaly();var a=f.getArgOfPerigee();var g=f.getInclination();var b=f.getRaan();var h=new Array(3);var d=0;for(d=0;d<3;d++){h[d]=new Array(3)}h=MathTools.buildRotationMatrix3(b);h=MathTools.multiply2dBy2d(MathTools.buildRotationMatrix1(g),h);h=MathTools.multiply2dBy2d(MathTools.buildRotationMatrix3(a),h);h=MathTools.multiply2dBy2d(MathTools.buildRotationMatrix3(c),h);return h},convertTargetECIToSatelliteRSW:function(i,f){var d=new RSWcoordinates();var e=CoordinateConversionTools.convertECIToKeplerian(i.getEci());var a=i.getEci();var g=e.getTrueAnomaly();var j=e.getArgOfPerigee();var b=e.getInclination();var h=e.getRaan();var c=[];c[0]=f.getX()-a.getX();c[1]=f.getY()-a.getY();c[2]=f.getZ()-a.getZ();c=MathTools.rot3(h,c);c=MathTools.rot1(b,c);c=MathTools.rot3(j,c);c=MathTools.rot3(g,c);d.setRadial(c[0]);d.setAlongTrack(c[1]);d.setCrossTrack(c[2]);return d},convertRSWToECI:function(g,d){var j=new UNIVERSE.ECICoordinates();var e=CoordinateConversionTools.convertECIToKeplerian(g.getEci());var f=e.getTrueAnomaly();var i=e.getArgOfPerigee();var b=e.getInclination();var h=e.getRaan();var a=[];a[0]=d.radial;a[1]=d.alongTrack;a[2]=d.crossTrack;var c=[];c=MathTools.rot3(-f,a);c=MathTools.rot3(-i,c);c=MathTools.rot1(-b,c);c=MathTools.rot3(-h,c);j.setX(c[0]);j.setY(c[1]);j.setZ(c[2]);return j},getSunPositionECIAtCurrentTime:function(d){var f=this.convertCurrentEpochToJulianDate(d);var a=(f-2451545)/36525;var b=280.4606184+36000.77005361*a;var g=357.5277233+35999.05034*a;var c=b+1.914666471*Math.sin(MathTools.toRadians(g))+0.019994643*Math.sin(2*MathTools.toRadians(g));var k=1.000140612-0.016708617*Math.cos(MathTools.toRadians(g))-0.000139589*Math.cos(2*MathTools.toRadians(g));var h=23.439291-0.0130042*a;var j=149597870;var i=new UNIVERSE.ECICoordinates();i.setX(k*Math.cos(MathTools.toRadians(c))*j);i.setY(k*Math.cos(MathTools.toRadians(h))*Math.sin(MathTools.toRadians(c))*j);i.setZ(k*Math.sin(MathTools.toRadians(h))*Math.sin(MathTools.toRadians(c))*j);return i},convertCurrentEpochToBarycentricTime:function(d){var f=new Date(d);var a=new Date(f.getTime()-463);var g=new Date(a.getTime()+32000);var c=new Date(g.getTime()+32184);var b=this.convertCurrentEpochToJulianDate(c);var i=(b-2451545)/36525;var h=new Date(c.getTime()+((0.001658*Math.sin(628.3076*i+6.2401))*1000));var j=this.convertCurrentEpochToJulianDate(h);var e=(j-2451545)/36525;return e},getMoonPositionECIAtCurrentTime:function(c){var a=CoordinateConversionTools.convertCurrentEpochToBarycentricTime(c);var b=218.32+481267.8813*a;b+=6.29*Math.sin(MathTools.toRadians(134.9+477198.85*a));b+=-1.27*Math.sin(MathTools.toRadians(259.2-413335.38*a));b+=0.66*Math.sin(MathTools.toRadians(235.7+890534.23*a));b+=0.21*Math.sin(MathTools.toRadians(269.9+954397.7*a));b+=-0.19*Math.sin(MathTools.toRadians(357.5+35999.05*a));b+=-0.11*Math.sin(MathTools.toRadians(186.6+966404.05*a));if(Math.abs(b)>360){b=(b%360)}if(b<0){b+=360}var d=5.13*Math.sin(MathTools.toRadians(93.3+483202.03*a));d+=0.28*Math.sin(MathTools.toRadians(228.2+960400.87*a));d+=-0.28*Math.sin(MathTools.toRadians(318.3+6003.18*a));d+=-0.17*Math.sin(MathTools.toRadians(217.6-407332.2*a));if(Math.abs(d)>360){d=(d%360)}if(d<0){d+=360}var g=0.9508+0.0518*Math.cos(MathTools.toRadians(134.9+477198.85*a));g+=+0.0095*Math.cos(MathTools.toRadians(259.2-413335.38*a));g+=+0.0078*Math.cos(MathTools.toRadians(235.7+890534.23*a));g+=+0.0028*Math.cos(MathTools.toRadians(269.9+954397.7*a));if(Math.abs(g)>360){g=(g%360)}if(g<0){g+=360}var f=23.439291-0.0130042*a;var h=1/Math.sin(MathTools.toRadians(g));h=h*Constants.radiusEarth;f=MathTools.toRadians(f);d=MathTools.toRadians(d);b=MathTools.toRadians(b);moonPosition=new UNIVERSE.ECICoordinates();moonPosition.setX(h*Math.cos(d)*Math.cos(b));moonPosition.setY(h*(Math.cos(f)*Math.cos(d)*Math.sin(b)-Math.sin(f)*Math.sin(d)));moonPosition.setZ(h*(Math.sin(f)*Math.cos(d)*Math.sin(b)+Math.cos(f)*Math.sin(d)));return moonPosition}};var CoordinateFunctionHelper={updateKeplerianAnglesUsingTrueAnomaly:function(c){var a=MathTools.toRadians(trueAnomaly);var d=Math.sin(a)*Math.sqrt(1-c.eccentricity*c.eccentricity)/(1+c.eccentricity*Math.cos(a));var b=(c.eccentricity+Math.cos(a))/(1+c.eccentricity*Math.cos(a));c.eccentricAnomaly=MathTools.toDegrees(Math.atan2(d,b));c.meanAnomaly=MathTools.toDegrees(MathTools.toRadians(c.eccentricAnomaly)-c.eccentricity*d)},setKeplerianTrueAnomaly:function(a,b){a.trueAnomaly=b;updateAnglesUsingTrueAnomaly(a)}};var UNIVERSE=UNIVERSE||{};UNIVERSE.ECEFCoordinates=function(h,f,d,g,c,a,e,b,i){this.x=h?h:0;this.y=f?f:0;this.z=d?d:0;this.vx=g?g:0;this.vy=c?c:0;this.vz=a?a:0;this.ax=e?e:0;this.ay=b?b:0;this.az=i?i:0;this.getX=function(){return this.x};this.setX=function(j){this.x=j};this.getY=function(){return this.y};this.setY=function(j){this.y=j};this.getZ=function(){return this.z};this.setZ=function(j){this.z=j};this.getVX=function(){return this.vx};this.setVX=function(j){this.vx=j};this.getVY=function(){return this.vy};this.setVY=function(j){this.vy=j};this.getVZ=function(){return this.vz};this.setVZ=function(j){this.vz=j};this.getAX=function(){return this.ax};this.setAX=function(j){this.ax=j};this.getAY=function(){return this.ay};this.setAY=function(j){this.ay=j};this.getAZ=function(){return this.az};this.setAZ=function(j){this.az=j}};var UNIVERSE=UNIVERSE||{};UNIVERSE.ECICoordinates=function(h,f,d,g,c,a,e,b,i){this.x=h?h:0;this.y=f?f:0;this.z=d?d:0;this.vx=g?g:0;this.vy=c?c:0;this.vz=a?a:0;this.ax=e?e:0;this.ay=b?b:0;this.az=i?i:0};UNIVERSE.ECICoordinates.prototype={constructor:UNIVERSE.ECICoordinates,getX:function(){return this.x},setX:function(a){this.x=a},getY:function(){return this.y},setY:function(a){this.y=a},getZ:function(){return this.z},setZ:function(a){this.z=a},getVX:function(){return this.vx},setVX:function(a){this.vx=a},getVY:function(){return this.vy},setVY:function(a){this.vy=a},getVZ:function(){return this.vz},setVZ:function(a){this.vz=a},getAX:function(){return this.ax},setAX:function(a){this.ax=a},getAY:function(){return this.ay},setAY:function(a){this.ay=a},getAZ:function(){return this.az},setAZ:function(a){this.az=a}};function KeplerianCoordinates(f,g,d,e,a,b,c,i,h){this.semimajorAxis=f?f:0;this.meanAnomaly=g?g:0;this.eccentricAnomaly=g?g:0;this.trueAnomaly=e?e:0;this.inclination=a?a:0;this.eccentricity=b?b:0;this.raan=c?c:0;this.argOfPerigee=i?i:0;this.meanMotion=h?h:0;this.updateAnglesUsingTrueAnomaly=function(){var j=MathTools.toRadians(this.trueAnomaly);var l=Math.sin(j)*Math.sqrt(1-this.eccentricity*this.eccentricity)/(1+this.eccentricity*Math.cos(j));var k=(this.eccentricity+Math.cos(j))/(1+this.eccentricity*Math.cos(j));this.EccentricAnomaly=MathTools.toDegrees(Math.atan2(l,k));this.MeanAnomaly=MathTools.toDegrees(MathTools.toRadians(this.EccentricAnomaly)-this.eccentricity*l)};this.updateAnglesUsingMeanAnomaly=function(){var k=0.00001;var j=5000;var o=MathTools.toRadians(this.MeanAnomaly);var l=o-this.eccentricity;var n=0;var m=0;while(j>k){n=l+(o-l+this.eccentricity*Math.sin(l))/(1-this.eccentricity*Math.cos(l));j=Math.abs(n-l);m++;if(m>100){break}l=n}this.EccentricAnomaly=MathTools.toDegrees(n);this.TrueAnomaly=MathTools.toDegrees(2*Math.atan(Math.sqrt((1+this.eccentricity)/(1-this.eccentricity))*Math.tan(n/2)))};this.getSemimajorAxis=function(){return this.semimajorAxis};this.getMeanAnomaly=function(){return this.meanAnomaly};this.getEccentricAnomaly=function(){return this.eccentricAnomaly};this.getTrueAnomaly=function(){return this.trueAnomaly};this.getInclination=function(){return this.inclination};this.getEccentricity=function(){return this.eccentricity};this.getRaan=function(){return this.raan};this.getArgOfPerigee=function(){return this.argOfPerigee};this.getMeanMotion=function(){return this.meanMotion};this.setSemimajorAxis=function(j){this.semimajorAxis=j};this.setMeanAnomaly=function(j){this.meanAnomaly=j;this.updateAnglesUsingMeanAnomaly()};this.setEccentricAnomaly=function(j){this.eccentricAnomaly=j};this.setTrueAnomaly=function(j){this.trueAnomaly=j;this.updateAnglesUsingTrueAnomaly()};this.setInclination=function(j){this.inclination=j};this.setEccentricity=function(j){this.eccentricity=j};this.setRaan=function(j){this.raan=j};this.setArgOfPerigee=function(j){this.argOfPerigee=j};this.setMeanMotion=function(j){this.meanMotion=j}}var UNIVERSE=UNIVERSE||{};UNIVERSE.LLACoordinates=function(b,c,a){this.latitude=b?b:0;this.longitude=c?c:0;this.altitude=a?a:0;this.getAltitude=function(){return this.altitude};this.setAltitude=function(d){this.altitude=d};this.getLatitude=function(){return this.latitude};this.setLatitude=function(d){this.latitude=d};this.getLongitude=function(){return this.longitude};this.setLongitude=function(d){this.longitude=d}};var MathTools={angleBetweenTwoVectorsVector:function(a,f){var e=0;var d=a.length();var c=f.length();var b=a.dot(f);e=MathTools.toDegrees(Math.acos(b/(d*c)));if(e>90){e=180-e}return e},rot1:function(b,c){b=MathTools.toRadians(b);var a=[];a[0]=c[0];a[1]=Math.cos(b)*c[1]+Math.sin(b)*c[2];a[2]=-Math.sin(b)*c[1]+Math.cos(b)*c[2];return a},rot2:function(b,c){b=MathTools.toRadians(b);var a=[];a[0]=Math.cos(b)*c[0]-Math.sin(b)*c[2];a[1]=c[1];a[2]=Math.sin(b)*c[0]+Math.cos(b)*c[2];return a},rot3:function(b,c){b=MathTools.toRadians(b);var a=[];a[0]=Math.cos(b)*c[0]+Math.sin(b)*c[1];a[1]=-Math.sin(b)*c[0]+Math.cos(b)*c[1];a[2]=c[2];return a},toRadians:function(a){return a*Constants.piOverOneEighty},toDegrees:function(a){return a*Constants.oneEightyOverPi},buildRotationMatrix1:function(b){b=MathTools.toRadians(b);var a=[];var c=0;for(c=0;c<3;c++){a[c]=[]}a[0][0]=1;a[0][1]=0;a[0][2]=0;a[1][0]=0;a[1][1]=Math.cos(b);a[1][2]=-Math.sin(b);a[2][0]=0;a[2][1]=Math.sin(b);a[2][2]=Math.cos(b);return a},buildRotationMatrix2:function(b){b=MathTools.toRadians(b);var a=[];var c=0;for(c=0;c<3;c++){a[c]=[]}a[0][0]=Math.cos(b);a[0][1]=0;a[0][2]=Math.sin(b);a[1][0]=0;a[1][1]=1;a[1][2]=0;a[2][0]=-Math.sin(b);a[2][1]=0;a[2][2]=Math.cos(b);return a},buildRotationMatrix3:function(b){b=MathTools.toRadians(b);var a=[];var c=0;for(c=0;c<3;c++){a[c]=[]}a[0][0]=Math.cos(b);a[0][1]=-Math.sin(b);a[0][2]=0;a[1][0]=Math.sin(b);a[1][1]=Math.cos(b);a[1][2]=0;a[2][0]=0;a[2][1]=0;a[2][2]=1;return a},ones:function(d){var a=[];var c=0;var b=0;for(c=0;c<d;c++){result[c]=new Array(d)}for(c=0;c<d;c++){for(b=0;b<d;b++){if(c!=b){a[c][b]=0}else{a[c][b]=1}}}return a},zeros:function(d){var a=new Array(d);var c=0;var b=0;for(c=0;c<d;c++){result[c]=new Array(d)}for(c=0;c<d;c++){for(b=0;b<d;b++){a[c][b]=0}}return a},zeros:function(e,d){var a=new Array(e);var c=0;var b=0;for(c=0;c<e;c++){result[c]=new Array(d)}for(c=0;c<e;c++){for(b=0;b<d;b++){a[c][b]=0}}return a},multiply1dBy2d:function(k,f){var a=k.length;var h=f.length;var g=f[0].length;if(a!=h){return null}var e=new Array(g);for(var d=0;d<g;d++){var b=0;for(var c=0;c<a;c++){b=b+k[c]*f[c][d]}e[d]=b}return e},multiply2dBy1d:function(k,h){var g=k.length;var d=k[0].length;var a=h.length;if(d!=a){return null}var f=new Array(g);for(var e=0;e<g;e++){var b=0;for(var c=0;c<a;c++){b=b+k[e][c]*h[c]}f[e]=b}return f},multiplyDoubleBy2d:function(d,a){var g=a.length;var e=a[0].length;var f=new Array(g);var c=0;var b=0;for(c=0;c<g;c++){f[c]=new Array(e)}for(c=0;c<g;c++){for(b=0;b<e;b++){if(a[c][b]===0){f[c][b]=0}else{f[c][b]=d*a[c][b]}}}return f},multiply2dBy2d:function(n,h){var b=n.length;var a=n[0].length;var m=h.length;var l=h[0].length;if(a!=m){return null}var g=new Array(b);var f=0;var e=0;for(f=0;f<b;f++){g[f]=new Array(l)}for(f=0;f<b;f++){for(e=0;e<l;e++){var c=0;var d=0;for(d=0;d<m;d++){c=c+n[f][d]*h[d][e]}g[f][e]=c}}return g},transposeMatrix:function(a){var d=a.length;var b=a[0].length;var f=new Array(b);var e=0;var c=0;for(e=0;e<b;e++){f[e]=new Array(d)}for(e=0;e<d;e++){for(c=0;c<b;c++){f[c][e]=a[e][c]}}return f},add1dTo1d:function(a,f){var b=a.length;var e=f.length;if(b!=e){return null}var d=new Array(b);var c=0;for(c=0;c<b;c++){d[c]=a[c]+f[c]}return d},add2dTo2d:function(k,f){var b=k.length;var a=k[0].length;var h=f.length;var g=f[0].length;if((b!=h)||(a!=g)){return null}var e=new Array(b);var d=0;var c=0;for(d=0;d<b;d++){e[d]=new Array(a)}for(d=0;d<b;d++){for(c=0;c<a;c++){e[d][c]=k[d][c]+f[d][c]}}return e},subtract2dMinus2d:function(k,f){var b=k.length;var a=k[0].length;var h=f.length;var g=f[0].length;if((b!=h)||(a!=g)){return null}var e=new Array(b);var d=0;var c=0;for(d=0;d<b;d++){e[d]=new Array(a)}for(d=0;d<b;d++){for(c=0;c<a;c++){e[d][c]=k[d][c]-f[d][c]}}return e},subtract1dMinus1d:function(a,f){var b=a.length;var e=f.length;if(b!=e){return null}var d=new Array(b);var c=0;for(c=0;c<b;c++){d[c]=a[c]-f[c]}return d}};function Quaternion(a,d,c,b){this.w=a?a:0;this.x=d?d:0;this.y=c?c:0;this.z=b?b:0;this.q=new Array(4);this.updateQ=function(){this.q[0]=this.w;this.q[1]=this.x;this.q[2]=this.y;this.q[3]=this.z};this.getQ=function(){return q};this.setQ=function(e){this.w=e[0];this.x=e[1];this.y=e[2];this.z=e[3];this.q=e};this.getW=function(){return this.w};this.setW=function(e){this.w=e;this.updateQ()};this.getX=function(){return this.x};this.setX=function(e){this.x=e;this.updateQ()};this.getY=function(){return this.y};this.setY=function(e){this.y=e;this.updateQ()};this.getZ=function(){return this.z};this.setZ=function(e){this.z=e;this.updateQ()};this.isZero=function(){for(var e=0;e<4;e++){if(this.q[e]&&this.q[e]!==0){return false}}return true}}var QuaternionMath={multiplyQuaternions:function(h,g){if(h.isZero()){return g}else{if(g.isZero()){return h}else{var f=h.getW();var b=h.getX();var j=h.getY();var d=h.getZ();var e=g.getW();var a=g.getX();var i=g.getY();var c=g.getZ();var k=new Quaternion();k.setW(f*e-b*a-j*i-d*c);k.setX(f*a+b*e+j*c-d*i);k.setY(f*i+j*e+d*a-b*c);k.setZ(f*c+d*e+b*i-j*a);return k}}},applyQuaternionRotation:function(h,c){var j=h.getW();var g=h.getX();var f=h.getY();var e=h.getZ();var b=new Array(3);var d=0;for(d=0;d<3;d++){b[d]=new Array(3)}b[0][0]=2*j*j-1+2*g*g;b[0][1]=2*g*f+2*j*e;b[0][2]=2*g*e-2*j*f;b[1][0]=2*g*f-2*j*e;b[1][1]=2*j*j-1+2*f*f;b[1][2]=2*f*e+2*j*g;b[2][0]=2*g*e+2*j*f;b[2][1]=2*f*e-2*j*g;b[2][2]=2*j*j-1+2*e*e;var a=MathTools.multiply2dBy1d(b,[c.x,c.y,c.z]);return new THREE.Vector3(a[0],a[1],a[2])},getEulerAngles:function(a){var i=a.getW();var g=a.getX();var f=a.getY();var e=a.getZ();var h=Math.atan2((2*(i*g+f*e)),(1-2*(g*g+f*f)));var b=Math.asin(2*(i*f-e*g));var d=Math.atan2((2*(i*e+g*f)),(1-2*(f*f+e*e)));var c=new Array(3);c[0]=MathTools.toDegrees(h);c[1]=MathTools.toDegrees(b);c[2]=MathTools.toDegrees(d);return c},convertRotationMatrixToQuaternion:function(e){var b=new Quaternion();var h=e[0][0];var g=e[0][1];var f=e[0][2];var d=e[1][0];var c=e[1][1];var a=e[1][2];var k=e[2][0];var j=e[2][1];var i=e[2][2];b.setW(0.5*Math.sqrt(1+h-c-i));b.setX((g+d)/(4*b.getW()));b.setY((f+k)/(4*b.getW()));b.setZ((j-a)/(4*b.getW()));return b}};var UNIVERSE=UNIVERSE||{};UNIVERSE.RSWCoordinates=function(a,c,b){this.radial=a?a:0;this.alongTrack=c?c:0;this.crossTrack=b?b:0};var Utilities={get_random_color:function(){var c="0123456789ABCDEF".split("");var a="0x";for(var b=0;b<6;b++){a+=c[Math.round(Math.random()*15)]}return a},eciTo3DCoordinates:function(a,b){if(a==undefined){return undefined}return{x:(a.y)*Math.sin(-b.rotationOffsetFromXAxis)+(-a.x)*Math.cos(-b.rotationOffsetFromXAxis),y:a.z,z:a.y*Math.cos(-b.rotationOffsetFromXAxis)-(-a.x)*Math.sin(-b.rotationOffsetFromXAxis),vx:-a.vx,vy:a.vz,vz:a.vy}},threeDToEciCoordinates:function(a,b){if(a==undefined){return undefined}return{x:(a.y)*Math.sin(b.rotationOffsetFromXAxis)+(-a.x)*Math.cos(b.rotationOffsetFromXAxis),y:a.z,z:a.y*Math.cos(b.rotationOffsetFromXAxis)-(-a.x)*Math.sin(b.rotationOffsetFromXAxis),vx:-a.vx,vy:a.vz,vz:a.vy}}};var UNIVERSE=UNIVERSE||{};UNIVERSE.EarthExtensions=function(d,e){var b=this;this.enableVisibilityLines=false;this.enableSensorProjections=false;this.enableSensorFootprintProjections=false;var c=false;var a=false;this.lockCameraToWithEarthRotation=false;this.rotationOffsetFromXAxis=0;this.useSunLighting=e?e:true;this.defaultObjects=new UNIVERSE.DefaultObjects(d);this.addEarth=function(f,h){var g=new UNIVERSE.Earth(d,b,f,h);d.addObject(g);d.updateOnce()};this.addMoon=function(g){var f=new UNIVERSE.Moon(d,b,g);d.addObject(f);d.updateOnce()};this.addSun=function(){var f=new UNIVERSE.Sun(d,b);d.addObject(f);d.updateOnce()};this.addSpaceObject=function(h,i){var g,f;d.getObjectFromLibraryById(h.modelId,function(j){g=j;d.getObjectFromLibraryById("default_material",function(k){d.addObject(h.getGraphicsObject(k,g,d,b));d.updateOnce();i()})})};this.addSensorVisibilityLines=function(f,h){if(f.sensors&&f.sensors.length>0){var g=new UNIVERSE.SensorVisibilityLinesController(f,d,b);d.addObject(g);d.updateOnce();h()}};this.addGroundObject=function(g,j){var i,f,h;if(!g.modelId){g.modelId="default_ground_object_geometry";h="default_ground_object_material"}else{h="default_material"}d.getObjectFromLibraryById(g.modelId,function(k){i=k;d.getObjectFromLibraryById(h,function(l){d.addObject(g.getGraphicsObject(l,i,d,b));d.updateOnce();j()})})};this.addGroundTrackPointForObject=function(g,i){var h,f;d.getObjectFromLibraryById("default_ground_object_geometry",function(j){h=j;d.getObjectFromLibraryById("default_ground_track_material",function(k){var l=new UNIVERSE.GroundTrackPoint(g,d,b,k,h);d.addObject(l);d.updateOnce();i()})})};this.addPropogationLineForObject=function(g,i){var h,f;h=new THREE.Geometry();d.getObjectFromLibraryById("default_orbit_line_material",function(j){var k=new UNIVERSE.PropogationLine(g,d,b,j,h);d.addObject(k);d.updateOnce();i()})};this.addSensorProjection=function(f,i){var h=Utilities.eciTo3DCoordinates(i.propagator(undefined,false),b);if(h){var g=UNIVERSE.SensorProjection(f,i,d,b,h);d.addObject(g);d.updateOnce()}};this.addSensorProjections=function(g,h){if(g.sensors.length>0){for(var f=g.sensors.length-1;f>=0;f--){this.addSensorProjection(g.sensors[f],g)}h()}};this.addSensorFootprintProjections=function(g,h){if(g.sensors.length>0){for(var f=0;f<g.sensors.length;f++){this.addSensorFootprintProjection(g.sensors[f],g)}h()}};this.addSensorFootprintProjection=function(g,h){var f=new UNIVERSE.SensorFootprintProjection(g,h,d,b);d.addObject(f);d.updateOnce()};this.addClosestGroundObjectTracingLine=function(f){var h;var g=new UNIVERSE.GraphicsObject(f.id+"_controlLine",f.objectName,undefined,function(i){var k=Utilities.eciTo3DCoordinates(f.propagator(undefined,false),b);var j=b.findClosestGroundObject(k);if(j!==undefined&&j.id!=h){b.removeLineBetweenObjects(f.id,h);h=j.id;b.addLineBetweenObjects(f.id,h)}},function(){});d.addObject(g);d.updateOnce()};this.addLineBetweenObjects=function(j,h,f,i){var g=new UNIVERSE.LineBetweenObjects(j,h,d,b,f,i);d.addObject(g)};this.removeLineBetweenObjects=function(i,g,h){var f="_to_";if(h){f=h}d.removeObject(i+f+g)};this.removeAllLinesBetweenObjects=function(){var f=d.getGraphicsObjects();for(var g in f){if(g.indexOf("_to_")>-1){d.removeObject(g)}}};this.findClosestGroundObject=function(f){if(f){var g=new THREE.Vector3(f.x,f.y,f.z);g.multiplyScalar(Constants.radiusEarth/g.length());return b.findClosestObject({x:g.x,y:g.y,z:g.z})}return undefined};this.findClosestObject=function(g){var h=d.getGraphicsObjects();var n;var l;var k=new THREE.Vector3(g.x,g.y,g.z);for(var j in h){if(h[j].currentLocation){var f=new THREE.Vector3(h[j].currentLocation.x,h[j].currentLocation.y,h[j].currentLocation.z);var m=f.distanceTo(k);if(n===undefined||m<n){l=h[j];n=m}}}return l};this.showAllOrbitLines=function(h){var f=d.getGraphicsObjects();a=h;for(var g in f){if(f[g].id.indexOf("_propogation")!=-1){d.showObject(f[g].id,h)}}};this.showOrbitLineForObject=function(f,g){d.showObject(g+"_propogation",f)};this.showModelForId=function(f,g){d.showObject(g,f)};this.showAllGroundTracks=function(h){var f=d.getGraphicsObjects();c=h;for(var g in f){if(f[g].id.indexOf("_groundPoint")!=-1){d.showObject(f[g].id,h)}}};this.showGroundTrackForId=function(f,g){d.showObject(g+"_groundPoint",f)};this.showAllSensorProjections=function(h){var f=d.getGraphicsObjects();this.enableSensorProjections=h;for(var g in f){if(f[g].id.indexOf("_sensorProjection")!=-1){d.showObject(f[g].id,h)}}};this.showSensorProjectionForId=function(g,j){var h=d.getGraphicsObjects();for(var f in h){if(f.indexOf(j+"_sensorProjection")>-1){d.showObject(f,g)}}};this.showAllSensorFootprintProjections=function(h){var f=d.getGraphicsObjects();this.enableSensorFootprintProjections=h;for(var g in f){if(f[g].id.indexOf("_footprint")!=-1){d.showObject(f[g].id,h)}}};this.showSensorFootprintProjectionsForId=function(h,j){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf(j)!=-1&&f[g].id.indexOf("_footprint")!=-1){d.showObject(f[g].id,h)}}};this.showSensorVisibilityLinesForId=function(h,j){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf(j+"_visibility_")!=-1){d.showObject(f[g].id,h)}}};this.showAllSensorVisibilityLines=function(h){var f=d.getGraphicsObjects();this.enableVisibilityLines=h;for(var g in f){if(f[g].id.indexOf("_visibility_")!=-1){d.showObject(f[g].id,h)}}};this.showAllLinesBetweenObjects=function(h){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf("_to_")!=-1){d.showObject(f[g].id,h)}}};this.showLineBetweenObjectsForId=function(h,j){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id.indexOf(j+"_to_")!=-1||f[g].id.indexOf("_to_"+j)!=-1){d.showObject(f[g].id,h)}}};this.lockCameraPositionRelativeToEarth=function(f){this.lockCameraToWithEarthRotation=f};this.setSunLighting=function(f){b.useSunLighting=f;d.showObject("earth",!f);d.showObject("earth_day",f);d.showObject("earth_night",f)};this.removeAllExceptEarthAndMoon=function(){var f=d.getGraphicsObjects();for(var g in f){if(f[g].id!="earth"&&f[g].id!="moon"&&f[g].id!="sun"){d.removeObject(f[g].id)}}};this.setup=function(){this.removeAllExceptEarthAndMoon();d.setup()}};