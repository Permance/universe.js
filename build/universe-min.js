var THREE=THREE||{};if(!self.Int32Array){self.Int32Array=Array,self.Float32Array=Array}THREE.Color=function(c){c!==void 0&&this.setHex(c);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(c){this.r=c.r;this.g=c.g;this.b=c.b;return this},setRGB:function(e,h,f){this.r=e;this.g=h;this.b=f;return this},setHSV:function(f,p,o){var n,k,m;if(o==0){this.r=this.g=this.b=0}else{switch(n=Math.floor(f*6),k=f*6-n,f=o*(1-p),m=o*(1-p*k),p=o*(1-p*(1-k)),n){case 1:this.r=m;this.g=o;this.b=f;break;case 2:this.r=f;this.g=o;this.b=p;break;case 3:this.r=f;this.g=m;this.b=o;break;case 4:this.r=p;this.g=f;this.b=o;break;case 5:this.r=o;this.g=f;this.b=m;break;case 6:case 0:this.r=o,this.g=p,this.b=f}}return this},setHex:function(c){c=Math.floor(c);this.r=(c>>16&255)/255;this.g=(c>>8&255)/255;this.b=(c&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(e,f){this.x=e||0;this.y=f||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,f){this.x=e;this.y=f;return this},copy:function(c){this.x=c.x;this.y=c.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(e){var f=this.x-e.x,e=this.y-e.y;return f*f+e*e},setLength:function(c){return this.normalize().multiplyScalar(c)},equals:function(c){return c.x==this.x&&c.y==this.y}};THREE.Vector3=function(e,h,f){this.x=e||0;this.y=h||0;this.z=f||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,h,f){this.x=e;this.y=h;this.z=f;return this},setX:function(c){this.x=c;return this},setY:function(c){this.y=c;return this},setZ:function(c){this.z=c;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;this.z=e.z+f.z;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;return this},addScalar:function(c){this.x+=c;this.y+=c;this.z+=c;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;this.z=e.z-f.z;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;return this},multiply:function(e,f){this.x=e.x*f.x;this.y=e.y*f.y;this.z=e.z*f.z;return this},multiplySelf:function(c){this.x*=c.x;this.y*=c.y;this.z*=c.z;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;this.z*=c;return this},divideSelf:function(c){this.x/=c.x;this.y/=c.y;this.z/=c.z;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c,this.z/=c):this.set(0,0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.normalize().multiplyScalar(c)},cross:function(e,f){this.x=e.y*f.z-e.z*f.y;this.y=e.z*f.x-e.x*f.z;this.z=e.x*f.y-e.y*f.x;return this},crossSelf:function(c){return this.set(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x)},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(c){return(new THREE.Vector3).sub(this,c).lengthSq()},setPositionFromMatrix:function(c){this.x=c.n14;this.y=c.n24;this.z=c.n34},setRotationFromMatrix:function(e){var f=Math.cos(this.y);this.y=Math.asin(e.n13);Math.abs(f)>0.00001?(this.x=Math.atan2(-e.n23/f,e.n33/f),this.z=Math.atan2(-e.n12/f,e.n11/f)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},isZero:function(){return this.lengthSq()<0.0001}};THREE.Vector4=function(f,m,k,h){this.x=f||0;this.y=m||0;this.z=k||0;this.w=h!==void 0?h:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(f,m,k,h){this.x=f;this.y=m;this.z=k;this.w=h;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w!==void 0?c.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;this.z=e.z+f.z;this.w=e.w+f.w;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;this.z=e.z-f.z;this.w=e.w-f.w;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c,this.z/=c,this.w/=c):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z+this.w*c.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.normalize().multiplyScalar(c)},lerpSelf:function(e,f){this.x+=(e.x-this.x)*f;this.y+=(e.y-this.y)*f;this.z+=(e.z-this.z)*f;this.w+=(e.w-this.w)*f;return this}};THREE.Ray=function(e,f){this.origin=e||new THREE.Vector3;this.direction=f||new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,intersectScene:function(c){return this.intersectObjects(c.objects)},intersectObjects:function(f){var m,k,h=[];m=0;for(k=f.length;m<k;m++){Array.prototype.push.apply(h,this.intersectObject(f[m]))}h.sort(function(e,n){return e.distance-n.distance});return h},intersectObject:function(J){function H(h,o,m){var k;k=m.clone().subSelf(h).dot(o);if(k<=0){return null}h=h.clone().addSelf(o.clone().multiplyScalar(k));return m.distanceTo(h)}function G(k,w,t,p){var p=p.clone().subSelf(w),t=t.clone().subSelf(w),m=k.clone().subSelf(w),k=p.dot(p),w=p.dot(t),p=p.dot(m),o=t.dot(t),t=t.dot(m),m=1/(k*o-w*w),o=(o*p-w*t)*m,k=(k*t-w*p)*m;return o>0&&k>0&&o+k<1}if(J instanceof THREE.Particle){var F=H(this.origin,this.direction,J.matrixWorld.getPosition());if(F==null||F>J.scale.x){return[]}return[{distance:F,point:J.position,face:null,object:J}]}else{if(J instanceof THREE.Mesh){F=H(this.origin,this.direction,J.matrixWorld.getPosition());if(F==null||F>J.geometry.boundingSphere.radius*Math.max(J.scale.x,Math.max(J.scale.y,J.scale.z))){return[]}var B,D,A,z,u,v,n,x,L,K,I=J.geometry,f=I.vertices,M=[],F=0;for(B=I.faces.length;F<B;F++){if(D=I.faces[F],L=this.origin.clone(),K=this.direction.clone(),v=J.matrixWorld,A=v.multiplyVector3(D.centroid.clone()).subSelf(L),x=A.dot(K),!(x<=0)&&(A=v.multiplyVector3(f[D.a].position.clone()),z=v.multiplyVector3(f[D.b].position.clone()),u=v.multiplyVector3(f[D.c].position.clone()),v=D instanceof THREE.Face4?v.multiplyVector3(f[D.d].position.clone()):null,n=J.matrixRotationWorld.multiplyVector3(D.normal.clone()),x=K.dot(n),J.doubleSided||(J.flipSided?x>0:x<0))){if(x=n.dot((new THREE.Vector3).sub(A,L))/x,L=L.addSelf(K.multiplyScalar(x)),D instanceof THREE.Face3){G(L,A,z,u)&&(D={distance:this.origin.distanceTo(L),point:L,face:D,object:J},M.push(D))}else{if(D instanceof THREE.Face4&&(G(L,A,z,v)||G(L,z,u,v))){D={distance:this.origin.distanceTo(L),point:L,face:D,object:J},M.push(D)}}}}M.sort(function(e,h){return e.distance-h.distance});return M}else{return[]}}}};THREE.Rectangle=function(){function f(){p=t-v;n=o-u}var v,u,t,o,p,n,m=!0;this.getX=function(){return v};this.getY=function(){return u};this.getWidth=function(){return p};this.getHeight=function(){return n};this.getLeft=function(){return v};this.getTop=function(){return u};this.getRight=function(){return t};this.getBottom=function(){return o};this.set=function(e,c,k,b){m=!1;v=e;u=c;t=k;o=b;f()};this.addPoint=function(c,b){m?(m=!1,v=c,u=b,t=c,o=b):(v=v<c?v:c,u=u<b?u:b,t=t>c?t:c,o=o>b?o:b);f()};this.add3Points=function(x,e,y,b,k,c){m?(m=!1,v=x<y?x<k?x:k:y<k?y:k,u=e<b?e<c?e:c:b<c?b:c,t=x>y?x>k?x:k:y>k?y:k,o=e>b?e>c?e:c:b>c?b:c):(v=x<y?x<k?x<v?x:v:k<v?k:v:y<k?y<v?y:v:k<v?k:v,u=e<b?e<c?e<u?e:u:c<u?c:u:b<c?b<u?b:u:c<u?c:u,t=x>y?x>k?x>t?x:t:k>t?k:t:y>k?y>t?y:t:k>t?k:t,o=e>b?e>c?e>o?e:o:c>o?c:o:b>c?b>o?b:o:c>o?c:o);f()};this.addRectangle=function(b){m?(m=!1,v=b.getLeft(),u=b.getTop(),t=b.getRight(),o=b.getBottom()):(v=v<b.getLeft()?v:b.getLeft(),u=u<b.getTop()?u:b.getTop(),t=t>b.getRight()?t:b.getRight(),o=o>b.getBottom()?o:b.getBottom());f()};this.inflate=function(b){v-=b;u-=b;t+=b;o+=b;f()};this.minSelf=function(b){v=v>b.getLeft()?v:b.getLeft();u=u>b.getTop()?u:b.getTop();t=t<b.getRight()?t:b.getRight();o=o<b.getBottom()?o:b.getBottom();f()};this.intersects=function(c){return Math.min(t,c.getRight())-Math.max(v,c.getLeft())>=0&&Math.min(o,c.getBottom())-Math.max(u,c.getTop())>=0};this.empty=function(){m=!0;o=t=u=v=0;f()};this.isEmpty=function(){return m}};THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var e,f=this.m;e=f[1];f[1]=f[3];f[3]=e;e=f[2];f[2]=f[6];f[6]=e;e=f[5];f[5]=f[7];f[7]=e;return this},transposeIntoArray:function(e){var f=this.m;e[0]=f[0];e[1]=f[3];e[2]=f[6];e[3]=f[1];e[4]=f[4];e[5]=f[7];e[6]=f[2];e[7]=f[5];e[8]=f[8];return this}};THREE.Matrix4=function(I,G,F,E,B,D,A,z,u,v,n,x,K,J,H,f){this.set(I!==void 0?I:1,G||0,F||0,E||0,B||0,D!==void 0?D:1,A||0,z||0,u||0,v||0,n!==void 0?n:1,x||0,K||0,J||0,H||0,f!==void 0?f:1);this.flat=Array(16);this.m33=new THREE.Matrix3};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(I,G,F,E,B,D,A,z,u,v,n,x,K,J,H,f){this.n11=I;this.n12=G;this.n13=F;this.n14=E;this.n21=B;this.n22=D;this.n23=A;this.n24=z;this.n31=u;this.n32=v;this.n33=n;this.n34=x;this.n41=K;this.n42=J;this.n43=H;this.n44=f;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(c){this.set(c.n11,c.n12,c.n13,c.n14,c.n21,c.n22,c.n23,c.n24,c.n31,c.n32,c.n33,c.n34,c.n41,c.n42,c.n43,c.n44);return this},lookAt:function(f,p,o){var n=THREE.Matrix4.__v1,k=THREE.Matrix4.__v2,m=THREE.Matrix4.__v3;m.sub(f,p).normalize();if(m.length()===0){m.z=1}n.cross(o,m).normalize();n.length()===0&&(m.x+=0.0001,n.cross(o,m).normalize());k.cross(m,n).normalize();this.n11=n.x;this.n12=k.x;this.n13=m.x;this.n21=n.y;this.n22=k.y;this.n23=m.y;this.n31=n.z;this.n32=k.z;this.n33=m.z;return this},multiplyVector3:function(f){var n=f.x,m=f.y,k=f.z,h=1/(this.n41*n+this.n42*m+this.n43*k+this.n44);f.x=(this.n11*n+this.n12*m+this.n13*k+this.n14)*h;f.y=(this.n21*n+this.n22*m+this.n23*k+this.n24)*h;f.z=(this.n31*n+this.n32*m+this.n33*k+this.n34)*h;return f},multiplyVector4:function(f){var n=f.x,m=f.y,k=f.z,h=f.w;f.x=this.n11*n+this.n12*m+this.n13*k+this.n14*h;f.y=this.n21*n+this.n22*m+this.n23*k+this.n24*h;f.z=this.n31*n+this.n32*m+this.n33*k+this.n34*h;f.w=this.n41*n+this.n42*m+this.n43*k+this.n44*h;return f},rotateAxis:function(f){var m=f.x,k=f.y,h=f.z;f.x=m*this.n11+k*this.n12+h*this.n13;f.y=m*this.n21+k*this.n22+h*this.n23;f.z=m*this.n31+k*this.n32+h*this.n33;f.normalize();return f},crossVector:function(e){var f=new THREE.Vector4;f.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w;f.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w;f.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w;f.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1;return f},multiply:function(aj,ai){var ah=aj.n11,ag=aj.n12,ac=aj.n13,ae=aj.n14,aa=aj.n21,Z=aj.n22,V=aj.n23,W=aj.n24,U=aj.n31,X=aj.n32,O=aj.n33,K=aj.n34,I=aj.n41,T=aj.n42,N=aj.n43,P=aj.n44,J=ai.n11,ad=ai.n12,H=ai.n13,u=ai.n14,n=ai.n21,L=ai.n22,Q=ai.n23,F=ai.n24,A=ai.n31,Y=ai.n32,z=ai.n33,v=ai.n34,x=ai.n41,B=ai.n42,af=ai.n43,ab=ai.n44;this.n11=ah*J+ag*n+ac*A+ae*x;this.n12=ah*ad+ag*L+ac*Y+ae*B;this.n13=ah*H+ag*Q+ac*z+ae*af;this.n14=ah*u+ag*F+ac*v+ae*ab;this.n21=aa*J+Z*n+V*A+W*x;this.n22=aa*ad+Z*L+V*Y+W*B;this.n23=aa*H+Z*Q+V*z+W*af;this.n24=aa*u+Z*F+V*v+W*ab;this.n31=U*J+X*n+O*A+K*x;this.n32=U*ad+X*L+O*Y+K*B;this.n33=U*H+X*Q+O*z+K*af;this.n34=U*u+X*F+O*v+K*ab;this.n41=I*J+T*n+N*A+P*x;this.n42=I*ad+T*L+N*Y+P*B;this.n43=I*H+T*Q+N*z+P*af;this.n44=I*u+T*F+N*v+P*ab;return this},multiplyToArray:function(e,h,f){this.multiply(e,h);f[0]=this.n11;f[1]=this.n21;f[2]=this.n31;f[3]=this.n41;f[4]=this.n12;f[5]=this.n22;f[6]=this.n32;f[7]=this.n42;f[8]=this.n13;f[9]=this.n23;f[10]=this.n33;f[11]=this.n43;f[12]=this.n14;f[13]=this.n24;f[14]=this.n34;f[15]=this.n44;return this},multiplySelf:function(c){this.multiply(this,c);return this},multiplyScalar:function(c){this.n11*=c;this.n12*=c;this.n13*=c;this.n14*=c;this.n21*=c;this.n22*=c;this.n23*=c;this.n24*=c;this.n31*=c;this.n32*=c;this.n33*=c;this.n34*=c;this.n41*=c;this.n42*=c;this.n43*=c;this.n44*=c;return this},determinant:function(){var I=this.n11,G=this.n12,F=this.n13,E=this.n14,B=this.n21,D=this.n22,A=this.n23,z=this.n24,u=this.n31,v=this.n32,n=this.n33,x=this.n34,K=this.n41,J=this.n42,H=this.n43,f=this.n44;return E*A*v*K-F*z*v*K-E*D*n*K+G*z*n*K+F*D*x*K-G*A*x*K-E*A*u*J+F*z*u*J+E*B*n*J-I*z*n*J-F*B*x*J+I*A*x*J+E*D*u*H-G*z*u*H-E*B*v*H+I*z*v*H+G*B*x*H-I*D*x*H-F*D*u*f+G*A*u*f+F*B*v*f-I*A*v*f-G*B*n*f+I*D*n*f},transpose:function(){var c;c=this.n21;this.n21=this.n12;this.n12=c;c=this.n31;this.n31=this.n13;this.n13=c;c=this.n32;this.n32=this.n23;this.n23=c;c=this.n41;this.n41=this.n14;this.n14=c;c=this.n42;this.n42=this.n24;this.n24=c;c=this.n43;this.n43=this.n34;this.n43=c;return this},clone:function(){var c=new THREE.Matrix4;c.n11=this.n11;c.n12=this.n12;c.n13=this.n13;c.n14=this.n14;c.n21=this.n21;c.n22=this.n22;c.n23=this.n23;c.n24=this.n24;c.n31=this.n31;c.n32=this.n32;c.n33=this.n33;c.n34=this.n34;c.n41=this.n41;c.n42=this.n42;c.n43=this.n43;c.n44=this.n44;return c},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(c){c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return c},flattenToArrayOffset:function(e,f){e[f]=this.n11;e[f+1]=this.n21;e[f+2]=this.n31;e[f+3]=this.n41;e[f+4]=this.n12;e[f+5]=this.n22;e[f+6]=this.n32;e[f+7]=this.n42;e[f+8]=this.n13;e[f+9]=this.n23;e[f+10]=this.n33;e[f+11]=this.n43;e[f+12]=this.n14;e[f+13]=this.n24;e[f+14]=this.n34;e[f+15]=this.n44;return e},setTranslation:function(e,h,f){this.set(1,0,0,e,0,1,0,h,0,0,1,f,0,0,0,1);return this},setScale:function(e,h,f){this.set(e,0,0,0,0,h,0,0,0,0,f,0,0,0,0,1);return this},setRotationX:function(e){var f=Math.cos(e),e=Math.sin(e);this.set(1,0,0,0,0,f,-e,0,0,e,f,0,0,0,0,1);return this},setRotationY:function(e){var f=Math.cos(e),e=Math.sin(e);this.set(f,0,e,0,0,1,0,0,-e,0,f,0,0,0,0,1);return this},setRotationZ:function(e){var f=Math.cos(e),e=Math.sin(e);this.set(f,-e,0,0,e,f,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(z,y){var x=Math.cos(y),w=Math.sin(y),u=1-x,v=z.x,t=z.y,n=z.z,f=u*v,m=u*t;this.set(f*v+x,f*t-w*n,f*n+w*t,0,f*t+w*n,m*t+x,m*n-w*v,0,f*n-w*t,m*n+w*v,u*n*n+x,0,0,0,0,1);return this},setPosition:function(c){this.n14=c.x;this.n24=c.y;this.n34=c.z;return this},getPosition:function(){if(!this.position){this.position=new THREE.Vector3}this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX){this.columnX=new THREE.Vector3}this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY){this.columnY=new THREE.Vector3}this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ){this.columnZ=new THREE.Vector3}this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(C,B){var A=C.x,z=C.y,x=C.z,y=Math.cos(A),A=Math.sin(A),w=Math.cos(z),z=Math.sin(z),v=Math.cos(x),x=Math.sin(x);switch(B){case"YXZ":var n=w*v,t=w*x,f=z*v,u=z*x;this.n11=n+u*A;this.n12=f*A-t;this.n13=y*z;this.n21=y*x;this.n22=y*v;this.n23=-A;this.n31=t*A-f;this.n32=u+n*A;this.n33=y*w;break;case"ZXY":n=w*v;t=w*x;f=z*v;u=z*x;this.n11=n-u*A;this.n12=-y*x;this.n13=f+t*A;this.n21=t+f*A;this.n22=y*v;this.n23=u-n*A;this.n31=-y*z;this.n32=A;this.n33=y*w;break;case"ZYX":n=y*v;t=y*x;f=A*v;u=A*x;this.n11=w*v;this.n12=f*z-t;this.n13=n*z+u;this.n21=w*x;this.n22=u*z+n;this.n23=t*z-f;this.n31=-z;this.n32=A*w;this.n33=y*w;break;case"YZX":n=y*w;t=y*z;f=A*w;u=A*z;this.n11=w*v;this.n12=u-n*x;this.n13=f*x+t;this.n21=x;this.n22=y*v;this.n23=-A*v;this.n31=-z*v;this.n32=t*x+f;this.n33=n-u*x;break;case"XZY":n=y*w;t=y*z;f=A*w;u=A*z;this.n11=w*v;this.n12=-x;this.n13=z*v;this.n21=n*x+u;this.n22=y*v;this.n23=t*x-f;this.n31=f*x-t;this.n32=A*v;this.n33=u*x+n;break;default:n=y*v,t=y*x,f=A*v,u=A*x,this.n11=w*v,this.n12=-w*x,this.n13=z,this.n21=t+f*z,this.n22=n-u*z,this.n23=-A*w,this.n31=u-n*z,this.n32=f+t*z,this.n33=y*w}return this},setRotationFromQuaternion:function(z){var y=z.x,x=z.y,w=z.z,u=z.w,v=y+y,t=x+x,n=w+w,z=y*v,f=y*t;y*=n;var m=x*t;x*=n;w*=n;v*=u;t*=u;u*=n;this.n11=1-(m+w);this.n12=f-u;this.n13=y+t;this.n21=f+u;this.n22=1-(z+w);this.n23=x-v;this.n31=y-t;this.n32=x+v;this.n33=1-(z+m);return this},scale:function(e){var h=e.x,f=e.y,e=e.z;this.n11*=h;this.n12*=f;this.n13*=e;this.n21*=h;this.n22*=f;this.n23*=e;this.n31*=h;this.n32*=f;this.n33*=e;this.n41*=h;this.n42*=f;this.n43*=e;return this},compose:function(f,n,m){var k=THREE.Matrix4.__m1,h=THREE.Matrix4.__m2;k.identity();k.setRotationFromQuaternion(n);h.setScale(m.x,m.y,m.z);this.multiply(k,h);this.n14=f.x;this.n24=f.y;this.n34=f.z;return this},decompose:function(f,p,o){var n=THREE.Matrix4.__v1,k=THREE.Matrix4.__v2,m=THREE.Matrix4.__v3;n.set(this.n11,this.n21,this.n31);k.set(this.n12,this.n22,this.n32);m.set(this.n13,this.n23,this.n33);f=f instanceof THREE.Vector3?f:new THREE.Vector3;p=p instanceof THREE.Quaternion?p:new THREE.Quaternion;o=o instanceof THREE.Vector3?o:new THREE.Vector3;o.x=n.length();o.y=k.length();o.z=m.length();f.x=this.n14;f.y=this.n24;f.z=this.n34;n=THREE.Matrix4.__m1;n.copy(this);n.n11/=o.x;n.n21/=o.x;n.n31/=o.x;n.n12/=o.y;n.n22/=o.y;n.n32/=o.y;n.n13/=o.z;n.n23/=o.z;n.n33/=o.z;p.setFromRotationMatrix(n);return[f,p,o]},extractPosition:function(c){this.n14=c.n14;this.n24=c.n24;this.n34=c.n34},extractRotation:function(f,n){var m=1/n.x,k=1/n.y,h=1/n.z;this.n11=f.n11*m;this.n21=f.n21*m;this.n31=f.n31*m;this.n12=f.n12*k;this.n22=f.n22*k;this.n32=f.n32*k;this.n13=f.n13*h;this.n23=f.n23*h;this.n33=f.n33*h}};THREE.Matrix4.makeInvert=function(O,N){var M=O.n11,L=O.n12,J=O.n13,K=O.n14,I=O.n21,H=O.n22,B=O.n23,F=O.n24,A=O.n31,G=O.n32,v=O.n33,n=O.n34,f=O.n41,z=O.n42,u=O.n43,x=O.n44;N===void 0&&(N=new THREE.Matrix4);N.n11=B*n*z-F*v*z+F*G*u-H*n*u-B*G*x+H*v*x;N.n12=K*v*z-J*n*z-K*G*u+L*n*u+J*G*x-L*v*x;N.n13=J*F*z-K*B*z+K*H*u-L*F*u-J*H*x+L*B*x;N.n14=K*B*G-J*F*G-K*H*v+L*F*v+J*H*n-L*B*n;N.n21=F*v*f-B*n*f-F*A*u+I*n*u+B*A*x-I*v*x;N.n22=J*n*f-K*v*f+K*A*u-M*n*u-J*A*x+M*v*x;N.n23=K*B*f-J*F*f-K*I*u+M*F*u+J*I*x-M*B*x;N.n24=J*F*A-K*B*A+K*I*v-M*F*v-J*I*n+M*B*n;N.n31=H*n*f-F*G*f+F*A*z-I*n*z-H*A*x+I*G*x;N.n32=K*G*f-L*n*f-K*A*z+M*n*z+L*A*x-M*G*x;N.n33=J*F*f-K*H*f+K*I*z-M*F*z-L*I*x+M*H*x;N.n34=K*H*A-L*F*A-K*I*G+M*F*G+L*I*n-M*H*n;N.n41=B*G*f-H*v*f-B*A*z+I*v*z+H*A*u-I*G*u;N.n42=L*v*f-J*G*f+J*A*z-M*v*z-L*A*u+M*G*u;N.n43=J*H*f-L*B*f-J*I*z+M*B*z+L*I*u-M*H*u;N.n44=L*B*A-J*H*A+J*I*G-M*B*G-L*I*v+M*H*v;N.multiplyScalar(1/O.determinant());return N};THREE.Matrix4.makeInvert3x3=function(C){var B=C.m33,A=B.m,z=C.n33*C.n22-C.n32*C.n23,x=-C.n33*C.n21+C.n31*C.n23,y=C.n32*C.n21-C.n31*C.n22,w=-C.n33*C.n12+C.n32*C.n13,v=C.n33*C.n11-C.n31*C.n13,n=-C.n32*C.n11+C.n31*C.n12,t=C.n23*C.n12-C.n22*C.n13,f=-C.n23*C.n11+C.n21*C.n13,u=C.n22*C.n11-C.n21*C.n12,C=C.n11*z+C.n21*w+C.n31*t;C==0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");C=1/C;A[0]=C*z;A[1]=C*x;A[2]=C*y;A[3]=C*w;A[4]=C*v;A[5]=C*n;A[6]=C*t;A[7]=C*f;A[8]=C*u;return B};THREE.Matrix4.makeFrustum=function(f,t,p,o,m,n){var k;k=new THREE.Matrix4;k.n11=2*m/(t-f);k.n12=0;k.n13=(t+f)/(t-f);k.n14=0;k.n21=0;k.n22=2*m/(o-p);k.n23=(o+p)/(o-p);k.n24=0;k.n31=0;k.n32=0;k.n33=-(n+m)/(n-m);k.n34=-2*n*m/(n-m);k.n41=0;k.n42=0;k.n43=-1;k.n44=0;return k};THREE.Matrix4.makePerspective=function(f,n,m,k){var h,f=m*Math.tan(f*Math.PI/360);h=-f;return THREE.Matrix4.makeFrustum(h*n,f*n,h,f,m,k)};THREE.Matrix4.makeOrtho=function(z,y,x,w,u,v){var t,n,f,m;t=new THREE.Matrix4;n=y-z;f=x-w;m=v-u;t.n11=2/n;t.n12=0;t.n13=0;t.n14=-((y+z)/n);t.n21=0;t.n22=2/f;t.n23=0;t.n24=-((x+w)/f);t.n31=0;t.n32=0;t.n33=-2/m;t.n34=-((v+u)/m);t.n41=0;t.n42=0;t.n43=0;t.n44=1;return t};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Matrix4.__m1=new THREE.Matrix4;THREE.Matrix4.__m2=new THREE.Matrix4;THREE.Object3D=function(){this.name="";this.id=THREE.Object3DCount++;this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new THREE.Vector3};THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(e,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(e))},translateX:function(c){this.translate(c,this._vector.set(1,0,0))},translateY:function(c){this.translate(c,this._vector.set(0,1,0))},translateZ:function(c){this.translate(c,this._vector.set(0,0,1))},lookAt:function(c){this.matrix.lookAt(c,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(e){if(this.children.indexOf(e)===-1){e.parent!==void 0&&e.parent.removeChild(e);e.parent=this;this.children.push(e);for(var f=this;f.parent!==void 0;){f=f.parent}f!==void 0&&f instanceof THREE.Scene&&f.addChildRecurse(e)}},remove:function(e){var h=this,f=this.children.indexOf(e);if(f!==-1){e.parent=void 0;for(this.children.splice(f,1);h.parent!==void 0;){h=h.parent}h!==void 0&&h instanceof THREE.Scene&&h.removeChildRecurse(e)}},getChildByName:function(f,n){var m,k,h;m=0;for(k=this.children.length;m<k;m++){h=this.children[m];if(h.name===f){return h}if(n&&(h=h.getChildByName(f,n),h!==void 0)){return h}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(f,m,k){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||m){f?this.matrixWorld.multiply(f,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale),this.matrixWorldNeedsUpdate=!1,m=!0}for(var f=0,h=this.children.length;f<h;f++){this.children[f].update(this.matrixWorld,m,k)}},addChild:function(c){console.warn("DEPRECATED: Object3D.addChild() is now Object3D.add().");this.add(c)},removeChild:function(c){console.warn("DEPRECATED: Object3D.removeChild() is now Object3D.remove().");this.remove(c)}};THREE.Object3DCount=0;THREE.Projector=function(){function ab(){var c=O[T]=O[T]||new THREE.RenderableVertex;T++;return c}function aa(e,h){return h.z-e.z}function Z(k,C){var y=0,t=1,w=k.z+k.w,p=C.z+C.w,o=-k.z+k.w,m=-C.z+C.w;return w>=0&&p>=0&&o>=0&&m>=0?!0:w<0&&p<0||o<0&&m<0?!1:(w<0?y=Math.max(y,w/(w-p)):p<0&&(t=Math.min(t,w/(w-p))),o<0?y=Math.max(y,o/(o-m)):m<0&&(t=Math.min(t,o/(o-m))),t<y?!1:(k.lerpSelf(C,y),C.lerpSelf(k,1-t),!0))}var Y,V,X=[],U,T,O=[],P,N,Q=[],J,F=[],A,M,I=[],K,B,W=[],z=[],n=[],f=new THREE.Vector4,H=new THREE.Vector4,L=new THREE.Matrix4,x=new THREE.Matrix4,v=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],S=new THREE.Vector4,u=new THREE.Vector4;this.projectVector=function(e,h){L.multiply(h.projectionMatrix,h.matrixWorldInverse);L.multiplyVector3(e);return e};this.unprojectVector=function(e,h){L.multiply(h.matrixWorld,THREE.Matrix4.makeInvert(h.projectionMatrix));L.multiplyVector3(e);return e};this.pickingRay=function(e,k){var h;e.z=-1;h=new THREE.Vector3(e.x,e.y,1);this.unprojectVector(e,k);this.unprojectVector(h,k);h.subSelf(e).normalize();return new THREE.Ray(e,h)};this.projectObjects=function(E,D,y){var C,w;V=z.length=0;C=E.objects;E=0;for(D=C.length;E<D;E++){w=C[E];var h;if(!(h=!w.visible)){if(h=w instanceof THREE.Mesh){if(h=w.frustumCulled){a:{h=void 0;for(var e=w.matrixWorld,t=-w.geometry.boundingSphere.radius*Math.max(w.scale.x,Math.max(w.scale.y,w.scale.z)),c=0;c<6;c++){if(h=v[c].x*e.n14+v[c].y*e.n24+v[c].z*e.n34+v[c].w,h<=t){h=!1;break a}}h=!0}h=!h}}}if(!h){h=X[V]=X[V]||new THREE.RenderableObject,V++,Y=h,f.copy(w.position),L.multiplyVector3(f),Y.object=w,Y.z=f.z,z.push(Y)}}y&&z.sort(aa);return z};this.projectScene=function(ai,ae,ac){var ag=ae.near,D=ae.far,b,m,y,w,G,t,o,p,aj,E,c,af,ah,ad,C,k,R;B=M=J=N=n.length=0;ae.matrixAutoUpdate&&ae.update(void 0,!0);ai.update(void 0,!1,ae);L.multiply(ae.projectionMatrix,ae.matrixWorldInverse);v[0].set(L.n41-L.n11,L.n42-L.n12,L.n43-L.n13,L.n44-L.n14);v[1].set(L.n41+L.n11,L.n42+L.n12,L.n43+L.n13,L.n44+L.n14);v[2].set(L.n41+L.n21,L.n42+L.n22,L.n43+L.n23,L.n44+L.n24);v[3].set(L.n41-L.n21,L.n42-L.n22,L.n43-L.n23,L.n44-L.n24);v[4].set(L.n41-L.n31,L.n42-L.n32,L.n43-L.n33,L.n44-L.n34);v[5].set(L.n41+L.n31,L.n42+L.n32,L.n43+L.n33,L.n44+L.n34);for(b=0;b<6;b++){aj=v[b],aj.divideScalar(Math.sqrt(aj.x*aj.x+aj.y*aj.y+aj.z*aj.z))}aj=this.projectObjects(ai,ae,!0);ai=0;for(b=aj.length;ai<b;ai++){if(E=aj[ai].object,E.visible){if(c=E.matrixWorld,af=E.matrixRotationWorld,ah=E.materials,ad=E.overdraw,T=0,E instanceof THREE.Mesh){C=E.geometry;w=C.vertices;k=C.faces;C=C.faceVertexUvs;m=0;for(y=w.length;m<y;m++){U=ab(),U.positionWorld.copy(w[m].position),c.multiplyVector3(U.positionWorld),U.positionScreen.copy(U.positionWorld),L.multiplyVector4(U.positionScreen),U.positionScreen.x/=U.positionScreen.w,U.positionScreen.y/=U.positionScreen.w,U.visible=U.positionScreen.z>ag&&U.positionScreen.z<D}w=0;for(m=k.length;w<m;w++){y=k[w];if(y instanceof THREE.Face3){if(G=O[y.a],t=O[y.b],o=O[y.c],G.visible&&t.visible&&o.visible&&(E.doubleSided||E.flipSided!=(o.positionScreen.x-G.positionScreen.x)*(t.positionScreen.y-G.positionScreen.y)-(o.positionScreen.y-G.positionScreen.y)*(t.positionScreen.x-G.positionScreen.x)<0)){p=Q[N]=Q[N]||new THREE.RenderableFace3,N++,P=p,P.v1.copy(G),P.v2.copy(t),P.v3.copy(o)}else{continue}}else{if(y instanceof THREE.Face4){if(G=O[y.a],t=O[y.b],o=O[y.c],p=O[y.d],G.visible&&t.visible&&o.visible&&p.visible&&(E.doubleSided||E.flipSided!=((p.positionScreen.x-G.positionScreen.x)*(t.positionScreen.y-G.positionScreen.y)-(p.positionScreen.y-G.positionScreen.y)*(t.positionScreen.x-G.positionScreen.x)<0||(t.positionScreen.x-o.positionScreen.x)*(p.positionScreen.y-o.positionScreen.y)-(t.positionScreen.y-o.positionScreen.y)*(p.positionScreen.x-o.positionScreen.x)<0))){R=F[J]=F[J]||new THREE.RenderableFace4,J++,P=R,P.v1.copy(G),P.v2.copy(t),P.v3.copy(o),P.v4.copy(p)}else{continue}}}P.normalWorld.copy(y.normal);af.multiplyVector3(P.normalWorld);P.centroidWorld.copy(y.centroid);c.multiplyVector3(P.centroidWorld);P.centroidScreen.copy(P.centroidWorld);L.multiplyVector3(P.centroidScreen);o=y.vertexNormals;G=0;for(t=o.length;G<t;G++){p=P.vertexNormalsWorld[G],p.copy(o[G]),af.multiplyVector3(p)}G=0;for(t=C.length;G<t;G++){if(R=C[G][w]){o=0;for(p=R.length;o<p;o++){P.uvs[G][o]=R[o]}}}P.meshMaterials=ah;P.faceMaterials=y.materials;P.overdraw=ad;P.z=P.centroidScreen.z;n.push(P)}}else{if(E instanceof THREE.Line){x.multiply(L,c);w=E.geometry.vertices;G=ab();G.positionScreen.copy(w[0].position);x.multiplyVector4(G.positionScreen);m=1;for(y=w.length;m<y;m++){if(G=ab(),G.positionScreen.copy(w[m].position),x.multiplyVector4(G.positionScreen),t=O[T-2],S.copy(G.positionScreen),u.copy(t.positionScreen),Z(S,u)){S.multiplyScalar(1/S.w),u.multiplyScalar(1/u.w),c=I[M]=I[M]||new THREE.RenderableLine,M++,A=c,A.v1.positionScreen.copy(S),A.v2.positionScreen.copy(u),A.z=Math.max(S.z,u.z),A.materials=E.materials,n.push(A)}}}else{if(E instanceof THREE.Particle&&(H.set(E.matrixWorld.n14,E.matrixWorld.n24,E.matrixWorld.n34,1),L.multiplyVector4(H),H.z/=H.w,H.z>0&&H.z<1)){c=W[B]=W[B]||new THREE.RenderableParticle,B++,K=c,K.x=H.x/H.w,K.y=H.y/H.w,K.z=H.z,K.rotation=E.rotation.z,K.scale.x=E.scale.x*Math.abs(K.x-(H.x+ae.projectionMatrix.n11)/(H.w+ae.projectionMatrix.n14)),K.scale.y=E.scale.y*Math.abs(K.y-(H.y+ae.projectionMatrix.n22)/(H.w+ae.projectionMatrix.n24)),K.materials=E.materials,n.push(K)}}}}}ac&&n.sort(aa);return n}};THREE.Quaternion=function(f,m,k,h){this.set(f||0,m||0,k||0,h!==void 0?h:1)};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(f,m,k,h){this.x=f;this.y=m;this.z=k;this.w=h;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this},setFromEuler:function(f){var v=Math.PI/360,u=f.x*v,t=f.y*v,o=f.z*v,f=Math.cos(t),t=Math.sin(t),v=Math.cos(-o),o=Math.sin(-o),p=Math.cos(u),u=Math.sin(u),n=f*v,m=t*o;this.w=n*p-m*u;this.x=n*u+m*p;this.y=t*v*p+f*o*u;this.z=f*o*p-t*v*u;return this},setFromAxisAngle:function(f,m){var k=m/2,h=Math.sin(k);this.x=f.x*h;this.y=f.y*h;this.z=f.z*h;this.w=Math.cos(k);return this},setFromRotationMatrix:function(e){var f=Math.pow(e.determinant(),1/3);this.w=Math.sqrt(Math.max(0,f+e.n11+e.n22+e.n33))/2;this.x=Math.sqrt(Math.max(0,f+e.n11-e.n22-e.n33))/2;this.y=Math.sqrt(Math.max(0,f-e.n11+e.n22-e.n33))/2;this.z=Math.sqrt(Math.max(0,f-e.n11-e.n22+e.n33))/2;this.x=e.n32-e.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=e.n13-e.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=e.n21-e.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);c==0?this.w=this.z=this.y=this.x=0:(c=1/c,this.x*=c,this.y*=c,this.z*=c,this.w*=c);return this},multiplySelf:function(f){var v=this.x,u=this.y,t=this.z,o=this.w,p=f.x,n=f.y,m=f.z,f=f.w;this.x=v*f+o*p+u*m-t*n;this.y=u*f+o*n+t*p-v*m;this.z=t*f+o*m+v*n-u*p;this.w=o*f-v*p-u*n-t*m;return this},multiply:function(e,f){this.x=e.x*f.w+e.y*f.z-e.z*f.y+e.w*f.x;this.y=-e.x*f.z+e.y*f.w+e.z*f.x+e.w*f.y;this.z=e.x*f.y-e.y*f.x+e.z*f.w+e.w*f.z;this.w=-e.x*f.x-e.y*f.y-e.z*f.z+e.w*f.w;return this},multiplyVector3:function(C,B){B||(B=C);var A=C.x,z=C.y,x=C.z,y=this.x,w=this.y,v=this.z,n=this.w,t=n*A+w*x-v*z,f=n*z+v*A-y*x,u=n*x+y*z-w*A,A=-y*A-w*z-v*x;B.x=t*n+A*-y+f*-v-u*-w;B.y=f*n+A*-w+u*-y-t*-v;B.z=u*n+A*-v+t*-w-f*-y;return B}};THREE.Quaternion.slerp=function(f,t,p,o){var m=f.w*t.w+f.x*t.x+f.y*t.y+f.z*t.z;if(Math.abs(m)>=1){return p.w=f.w,p.x=f.x,p.y=f.y,p.z=f.z,p}var n=Math.acos(m),k=Math.sqrt(1-m*m);if(Math.abs(k)<0.001){return p.w=0.5*(f.w+t.w),p.x=0.5*(f.x+t.x),p.y=0.5*(f.y+t.y),p.z=0.5*(f.z+t.z),p}m=Math.sin((1-o)*n)/k;o=Math.sin(o*n)/k;p.w=f.w*m+t.w*o;p.x=f.x*m+t.x*o;p.y=f.y*m+t.y*o;p.z=f.z*m+t.z*o;return p};THREE.Vertex=function(c){this.position=c||new THREE.Vector3};THREE.Face3=function(f,p,o,n,k,m){this.a=f;this.b=p;this.c=o;this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3;this.vertexNormals=n instanceof Array?n:[];this.color=k instanceof THREE.Color?k:new THREE.Color;this.vertexColors=k instanceof Array?k:[];this.vertexTangents=[];this.materials=m instanceof Array?m:[m];this.centroid=new THREE.Vector3};THREE.Face4=function(f,t,p,o,m,n,k){this.a=f;this.b=t;this.c=p;this.d=o;this.normal=m instanceof THREE.Vector3?m:new THREE.Vector3;this.vertexNormals=m instanceof Array?m:[];this.color=n instanceof THREE.Color?n:new THREE.Color;this.vertexColors=n instanceof Array?n:[];this.vertexTangents=[];this.materials=k instanceof Array?k:[k];this.centroid=new THREE.Vector3};THREE.UV=function(e,f){this.u=e||0;this.v=f||0};THREE.UV.prototype={constructor:THREE.UV,set:function(e,f){this.u=e;this.v=f;return this},copy:function(c){this.u=c.u;this.v=c.v;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(f){var t=new THREE.Matrix4;t.extractRotation(f,new THREE.Vector3(1,1,1));for(var p=0,o=this.vertices.length;p<o;p++){f.multiplyVector3(this.vertices[p].position)}p=0;for(o=this.faces.length;p<o;p++){var m=this.faces[p];t.multiplyVector3(m.normal);for(var n=0,k=m.vertexNormals.length;n<k;n++){t.multiplyVector3(m.vertexNormals[n])}f.multiplyVector3(m.centroid)}},computeCentroids:function(){var e,h,f;e=0;for(h=this.faces.length;e<h;e++){f=this.faces[e],f.centroid.set(0,0,0),f instanceof THREE.Face3?(f.centroid.addSelf(this.vertices[f.a].position),f.centroid.addSelf(this.vertices[f.b].position),f.centroid.addSelf(this.vertices[f.c].position),f.centroid.divideScalar(3)):f instanceof THREE.Face4&&(f.centroid.addSelf(this.vertices[f.a].position),f.centroid.addSelf(this.vertices[f.b].position),f.centroid.addSelf(this.vertices[f.c].position),f.centroid.addSelf(this.vertices[f.d].position),f.centroid.divideScalar(4))}},computeFaceNormals:function(x){var w,v,u,o,t,n,m=new THREE.Vector3,f=new THREE.Vector3;u=0;for(o=this.faces.length;u<o;u++){t=this.faces[u];if(x&&t.vertexNormals.length){m.set(0,0,0);w=0;for(v=t.vertexNormals.length;w<v;w++){m.addSelf(t.vertexNormals[w])}m.divideScalar(3)}else{w=this.vertices[t.a],v=this.vertices[t.b],n=this.vertices[t.c],m.sub(n.position,v.position),f.sub(w.position,v.position),m.crossSelf(f)}m.isZero()||m.normalize();t.normal.copy(m)}},computeVertexNormals:function(){var f,m,k,h;if(this.__tmpVertices==void 0){h=this.__tmpVertices=Array(this.vertices.length);f=0;for(m=this.vertices.length;f<m;f++){h[f]=new THREE.Vector3}f=0;for(m=this.faces.length;f<m;f++){if(k=this.faces[f],k instanceof THREE.Face3){k.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else{if(k instanceof THREE.Face4){k.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}}}else{h=this.__tmpVertices;f=0;for(m=this.vertices.length;f<m;f++){h[f].set(0,0,0)}}f=0;for(m=this.faces.length;f<m;f++){k=this.faces[f],k instanceof THREE.Face3?(h[k.a].addSelf(k.normal),h[k.b].addSelf(k.normal),h[k.c].addSelf(k.normal)):k instanceof THREE.Face4&&(h[k.a].addSelf(k.normal),h[k.b].addSelf(k.normal),h[k.c].addSelf(k.normal),h[k.d].addSelf(k.normal))}f=0;for(m=this.vertices.length;f<m;f++){h[f].normalize()}f=0;for(m=this.faces.length;f<m;f++){k=this.faces[f],k instanceof THREE.Face3?(k.vertexNormals[0].copy(h[k.a]),k.vertexNormals[1].copy(h[k.b]),k.vertexNormals[2].copy(h[k.c])):k instanceof THREE.Face4&&(k.vertexNormals[0].copy(h[k.a]),k.vertexNormals[1].copy(h[k.b]),k.vertexNormals[2].copy(h[k.c]),k.vertexNormals[3].copy(h[k.d]))}},computeTangents:function(){function ai(k,p,y,w,t,o,m){Z=k.vertices[p].position;V=k.vertices[y].position;W=k.vertices[w].position;U=aa[t];X=aa[o];O=aa[m];K=V.x-Z.x;I=W.x-Z.x;T=V.y-Z.y;N=W.y-Z.y;P=V.z-Z.z;J=W.z-Z.z;ac=X.u-U.u;H=O.u-U.u;u=X.v-U.v;n=O.v-U.v;L=1/(ac*n-H*u);Y.set((n*K-u*I)*L,(n*T-u*N)*L,(n*P-u*J)*L);z.set((ac*I-H*K)*L,(ac*N-H*T)*L,(ac*J-H*P)*L);F[p].addSelf(Y);F[y].addSelf(Y);F[w].addSelf(Y);A[p].addSelf(z);A[y].addSelf(z);A[w].addSelf(z)}var ah,ag,af,ab,ad,aa,Z,V,W,U,X,O,K,I,T,N,P,J,ac,H,u,n,L,Q,F=[],A=[],Y=new THREE.Vector3,z=new THREE.Vector3,v=new THREE.Vector3,x=new THREE.Vector3,B=new THREE.Vector3;ah=0;for(ag=this.vertices.length;ah<ag;ah++){F[ah]=new THREE.Vector3,A[ah]=new THREE.Vector3}ah=0;for(ag=this.faces.length;ah<ag;ah++){ad=this.faces[ah],aa=this.faceVertexUvs[0][ah],ad instanceof THREE.Face3?ai(this,ad.a,ad.b,ad.c,0,1,2):ad instanceof THREE.Face4&&(ai(this,ad.a,ad.b,ad.c,0,1,2),ai(this,ad.a,ad.b,ad.d,0,1,3))}var ae=["a","b","c","d"];ah=0;for(ag=this.faces.length;ah<ag;ah++){ad=this.faces[ah];for(af=0;af<ad.vertexNormals.length;af++){B.copy(ad.vertexNormals[af]),ab=ad[ae[af]],Q=F[ab],v.copy(Q),v.subSelf(B.multiplyScalar(B.dot(Q))).normalize(),x.cross(ad.vertexNormals[af],Q),ab=x.dot(A[ab]),ab=ab<0?-1:1,ad.vertexTangents[af]=new THREE.Vector4(v.x,v.y,v.z,ab)}}this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var h=1,f=this.vertices.length;h<f;h++){e=this.vertices[h];if(e.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=e.position.x}else{if(e.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=e.position.x}}if(e.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=e.position.y}else{if(e.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=e.position.y}}if(e.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=e.position.z}else{if(e.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=e.position.z}}}}},computeBoundingSphere:function(){for(var e=0,h=0,f=this.vertices.length;h<f;h++){e=Math.max(e,this.vertices[h].position.length())}this.boundingSphere={radius:e}},mergeVertices:function(){var f={},t=[],p=[],o,m=Math.pow(10,4),n,k;n=0;for(k=this.vertices.length;n<k;n++){o=this.vertices[n].position,o=[Math.round(o.x*m),Math.round(o.y*m),Math.round(o.z*m)].join("_"),f[o]===void 0?(f[o]=n,t.push(this.vertices[n]),p[n]=t.length-1):p[n]=p[f[o]]}n=0;for(k=this.faces.length;n<k;n++){f=this.faces[n];if(f instanceof THREE.Face3){f.a=p[f.a],f.b=p[f.b],f.c=p[f.c]}if(f instanceof THREE.Face4){f.a=p[f.a],f.b=p[f.b],f.c=p[f.c],f.d=p[f.d]}}this.vertices=t}};THREE.GeometryCount=0;THREE.Spline=function(D){function C(k,G,F,t,p,o,m){k=(F-k)*0.5;t=(t-G)*0.5;return(2*(G-F)+k+t)*m+(-3*(G-F)-2*k-t)*o+k*p+G}this.points=D;var B=[],A={x:0,y:0,z:0},y,z,x,w,n,u,f,v,E;this.initFromArray=function(e){this.points=[];for(var h=0;h<e.length;h++){this.points[h]={x:e[h][0],y:e[h][1],z:e[h][2]}}};this.getPoint=function(c){y=(this.points.length-1)*c;z=Math.floor(y);x=y-z;B[0]=z==0?z:z-1;B[1]=z;B[2]=z>this.points.length-2?z:z+1;B[3]=z>this.points.length-3?z:z+2;u=this.points[B[0]];f=this.points[B[1]];v=this.points[B[2]];E=this.points[B[3]];w=x*x;n=x*w;A.x=C(u.x,f.x,v.x,E.x,x,w,n);A.y=C(u.y,f.y,v.y,E.y,x,w,n);A.z=C(u.z,f.z,v.z,E.z,x,w,n);return A};this.getControlPointsArray=function(){var h,o,m=this.points.length,k=[];for(h=0;h<m;h++){o=this.points[h],k[h]=[o.x,o.y,o.z]}return k};this.getLength=function(m){var I,H,G=I=I=0,F=new THREE.Vector3,t=new THREE.Vector3,p=[],o=0;p[0]=0;m||(m=100);H=this.points.length*m;F.copy(this.points[0]);for(m=1;m<H;m++){I=m/H,position=this.getPoint(I),t.copy(position),o+=t.distanceTo(F),F.copy(position),I*=this.points.length-1,I=Math.floor(I),I!=G&&(p[I]=o,G=I)}p[p.length]=o;return{chunks:p,total:o}};this.reparametrizeByArcLength=function(M){var L,K,J,I,H,G,F=[],t=new THREE.Vector3,m=this.getLength();F.push(t.copy(this.points[0]).clone());for(L=1;L<this.points.length;L++){K=m.chunks[L]-m.chunks[L-1];G=Math.ceil(M*K/m.total);I=(L-1)/(this.points.length-1);H=L/(this.points.length-1);for(K=1;K<G-1;K++){J=I+K*(1/G)*(H-I),position=this.getPoint(J),F.push(t.copy(position).clone())}F.push(t.copy(this.points[L]).clone())}this.points=F}};THREE.Edge=function(f,m,k,h){this.vertices=[f,m];this.vertexIndices=[k,h];this.faces=[];this.faceIndices=[]};THREE.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(c){this.matrix.lookAt(this.position,c,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};THREE.Camera.prototype.update=function(e,h,f){this.matrixAutoUpdate&&this.updateMatrix();if(h||this.matrixWorldNeedsUpdate){e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,h=!0,THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}for(e=0;e<this.children.length;e++){this.children[e].update(this.matrixWorld,h,f)}};THREE.OrthographicCamera=function(f,p,o,n,k,m){THREE.Camera.call(this);this.left=f;this.right=p;this.top=o;this.bottom=n;this.near=k!==void 0?k:0.1;this.far=m!==void 0?m:2000;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=new THREE.Camera;THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(f,m,k,h){THREE.Camera.call(this);this.fov=f!==void 0?f:50;this.aspect=m!==void 0?m:1;this.near=k!==void 0?k:0.1;this.far=h!==void 0?h:2000;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=new THREE.Camera;THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(e,f){this.fov=2*Math.atan((f!==void 0?f:43.25)/(e*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(f,p,o,n,k,m){this.fullWidth=f;this.fullHeight=p;this.x=o;this.y=n;this.width=k;this.height=m;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var f=this.fullWidth/this.fullHeight,m=Math.tan(this.fov*Math.PI/360)*this.near,k=-m,h=f*k,f=Math.abs(f*m-h),k=Math.abs(m-k);this.projectionMatrix=THREE.Matrix4.makeFrustum(h+this.x*f/this.fullWidth,h+(this.x+this.width)*f/this.fullWidth,m-(this.y+this.height)*k/this.fullHeight,m-this.y*k/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.Light=function(c){THREE.Object3D.call(this);this.color=new THREE.Color(c)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(c){THREE.Light.call(this,c)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(e,h,f){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,1,0);this.intensity=h!==void 0?h:1;this.distance=f!==void 0?f:0};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(e,h,f){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,0,0);this.intensity=h!==void 0?h:1;this.distance=f!==void 0?f:0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.SpotLight=function(f,m,k,h){THREE.Light.call(this,f);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D;this.intensity=m!==void 0?m:1;this.distance=k!==void 0?k:0;this.castShadow=h!==void 0?h:!1};THREE.SpotLight.prototype=new THREE.Light;THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.Material=function(c){this.name="";this.id=THREE.MaterialCount++;c=c||{};this.opacity=c.opacity!==void 0?c.opacity:1;this.transparent=c.transparent!==void 0?c.transparent:!1;this.blending=c.blending!==void 0?c.blending:THREE.NormalBlending;this.depthTest=c.depthTest!==void 0?c.depthTest:!0;this.depthWrite=c.depthWrite!==void 0?c.depthWrite:!0;this.polygonOffset=c.polygonOffset!==void 0?c.polygonOffset:!1;this.polygonOffsetFactor=c.polygonOffsetFactor!==void 0?c.polygonOffsetFactor:0;this.polygonOffsetUnits=c.polygonOffsetUnits!==void 0?c.polygonOffsetUnits:0;this.alphaTest=c.alphaTest!==void 0?c.alphaTest:0};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.LineBasicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.linewidth=c.linewidth!==void 0?c.linewidth:1;this.linecap=c.linecap!==void 0?c.linecap:"round";this.linejoin=c.linejoin!==void 0?c.linejoin:"round";this.vertexColors=c.vertexColors?c.vertexColors:!1;this.fog=c.fog!==void 0?c.fog:!0};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.fog=c.fog!==void 0?c.fog:!0;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.fog=c.fog!==void 0?c.fog:!0;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.ambient=c.ambient!==void 0?new THREE.Color(c.ambient):new THREE.Color(328965);this.specular=c.specular!==void 0?new THREE.Color(c.specular):new THREE.Color(1118481);this.shininess=c.shininess!==void 0?c.shininess:30;this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.fog=c.fog!==void 0?c.fog:!0;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.shading=c.shading?c.shading:THREE.FlatShading;this.wireframe=c.wireframe?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth?c.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.MeshShaderMaterial=function(c){console.warn("DEPRECATED: MeshShaderMaterial() is now ShaderMaterial().");return new THREE.ShaderMaterial(c)};THREE.ParticleBasicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.size=c.size!==void 0?c.size:1;this.sizeAttenuation=c.sizeAttenuation!==void 0?c.sizeAttenuation:!0;this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.fog=c.fog!==void 0?c.fog:!0};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ShaderMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.fragmentShader=c.fragmentShader!==void 0?c.fragmentShader:"void main() {}";this.vertexShader=c.vertexShader!==void 0?c.vertexShader:"void main() {}";this.uniforms=c.uniforms!==void 0?c.uniforms:{};this.attributes=c.attributes;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.fog=c.fog!==void 0?c.fog:!1;this.lights=c.lights!==void 0?c.lights:!1;this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.ShaderMaterial.prototype=new THREE.Material;THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.Texture=function(f,p,o,n,k,m){this.id=THREE.TextureCount++;this.image=f;this.mapping=p!==void 0?p:new THREE.UVMapping;this.wrapS=o!==void 0?o:THREE.ClampToEdgeWrapping;this.wrapT=n!==void 0?n:THREE.ClampToEdgeWrapping;this.magFilter=k!==void 0?k:THREE.LinearFilter;this.minFilter=m!==void 0?m:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.needsUpdate=!1};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var c=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);c.offset.copy(this.offset);c.repeat.copy(this.repeat);return c}};THREE.TextureCount=0;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.DataTexture=function(x,w,v,u,o,t,n,m,f){THREE.Texture.call(this,null,o,t,n,m,f);this.image={data:x,width:w,height:v};this.format=u!==void 0?u:THREE.RGBAFormat};THREE.DataTexture.prototype=new THREE.Texture;THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var c=new THREE.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);c.offset.copy(this.offset);c.repeat.copy(this.repeat);return c};THREE.Particle=function(c){THREE.Object3D.call(this);this.materials=c instanceof Array?c:[c]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(e,f){THREE.Object3D.call(this);this.geometry=e;this.materials=f instanceof Array?f:[f];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(e,h,f){THREE.Object3D.call(this);this.geometry=e;this.materials=h instanceof Array?h:[h];this.type=f!=void 0?f:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(e,h){THREE.Object3D.call(this);this.geometry=e;this.materials=h&&h.length?h:[h];this.overdraw=!1;if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var f=0;f<this.geometry.morphTargets.length;f++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[f].name]=f}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(c){if(this.morphTargetDictionary[c]!==void 0){return this.morphTargetDictionary[c]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+c+" does not exist. Returning 0.");return 0};THREE.Bone=function(c){THREE.Object3D.call(this);this.skin=c;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;THREE.Bone.prototype.update=function(f,n,m){this.matrixAutoUpdate&&(n|=this.updateMatrix());if(n||this.matrixWorldNeedsUpdate){f?this.skinMatrix.multiply(f,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0}var k,h=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(k=0;k<h;k++){f=this.children[k],f instanceof THREE.Bone?f.update(this.skinMatrix,n,m):f.update(this.matrixWorld,!0,m)}}else{for(k=0;k<h;k++){this.children[k].update(this.skinMatrix,n,m)}}};THREE.Bone.prototype.addChild=function(c){if(this.children.indexOf(c)===-1&&(c.parent!==void 0&&c.parent.removeChild(c),c.parent=this,this.children.push(c),!(c instanceof THREE.Bone))){this.hasNoneBoneChildren=!0}};THREE.SkinnedMesh=function(f,v){THREE.Mesh.call(this,f,v);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var u,t,o,p,n,m;if(this.geometry.bones!==void 0){for(u=0;u<this.geometry.bones.length;u++){o=this.geometry.bones[u],p=o.pos,n=o.rotq,m=o.scl,t=this.addBone(),t.name=o.name,t.position.set(p[0],p[1],p[2]),t.quaternion.set(n[0],n[1],n[2],n[3]),t.useQuaternion=!0,m!==void 0?t.scale.set(m[0],m[1],m[2]):t.scale.set(1,1,1)}for(u=0;u<this.bones.length;u++){o=this.geometry.bones[u],t=this.bones[u],o.parent===-1?this.addChild(t):this.bones[o.parent].addChild(t)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.update=function(f,n,m){if(this.visible){this.matrixAutoUpdate&&(n|=this.updateMatrix());if(n||this.matrixWorldNeedsUpdate){f?this.matrixWorld.multiply(f,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0}var k,h=this.children.length;for(k=0;k<h;k++){f=this.children[k],f instanceof THREE.Bone?f.update(this.identityMatrix,!1,m):f.update(this.matrixWorld,n,m)}m=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(n=0;n<m;n++){ba[n].skinMatrix.flattenToArrayOffset(bm,n*16)}}};THREE.SkinnedMesh.prototype.addBone=function(c){c===void 0&&(c=new THREE.Bone(this));this.bones.push(c);return c};THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var f,p=[],o=0;o<this.bones.length;o++){f=this.bones[o],p.push(THREE.Matrix4.makeInvert(f.skinMatrix)),f.skinMatrix.flattenToArrayOffset(this.boneMatrices,o*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var n;for(f=0;f<this.geometry.skinIndices.length;f++){var o=this.geometry.vertices[f].position,k=this.geometry.skinIndices[f].x,m=this.geometry.skinIndices[f].y;n=new THREE.Vector3(o.x,o.y,o.z);this.geometry.skinVerticesA.push(p[k].multiplyVector3(n));n=new THREE.Vector3(o.x,o.y,o.z);this.geometry.skinVerticesB.push(p[m].multiplyVector3(n));this.geometry.skinWeights[f].x+this.geometry.skinWeights[f].y!==1&&(o=(1-(this.geometry.skinWeights[f].x+this.geometry.skinWeights[f].y))*0.5,this.geometry.skinWeights[f].x+=o,this.geometry.skinWeights[f].y+=o)}}};THREE.Ribbon=function(e,f){THREE.Object3D.call(this);this.geometry=e;this.materials=f instanceof Array?f:[f]};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.addLevel=function(e,h){h===void 0&&(h=0);for(var h=Math.abs(h),f=0;f<this.LODs.length;f++){if(h<this.LODs[f].visibleAtDistance){break}}this.LODs.splice(f,0,{visibleAtDistance:h,object3D:e});this.add(e)};THREE.LOD.prototype.update=function(f,m,k){this.matrixAutoUpdate&&(m|=this.updateMatrix());if(m||this.matrixWorldNeedsUpdate){f?this.matrixWorld.multiply(f,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,m=!0}if(this.LODs.length>1){f=k.matrixWorldInverse;f=-(f.n31*this.position.x+f.n32*this.position.y+f.n33*this.position.z+f.n34);this.LODs[0].object3D.visible=!0;for(var h=1;h<this.LODs.length;h++){if(f>=this.LODs[h].visibleAtDistance){this.LODs[h-1].object3D.visible=!1,this.LODs[h].object3D.visible=!0}else{break}}for(;h<this.LODs.length;h++){this.LODs[h].object3D.visible=!1}}for(f=0;f<this.children.length;f++){this.children[f].update(this.matrixWorld,m,k)}};THREE.Sprite=function(c){THREE.Object3D.call(this);this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map instanceof THREE.Texture?c.map:THREE.ImageUtils.loadTexture(c.map);this.blending=c.blending!==void 0?c.blending:THREE.NormalBlending;this.useScreenCoordinates=c.useScreenCoordinates!==void 0?c.useScreenCoordinates:!0;this.mergeWith3D=c.mergeWith3D!==void 0?c.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=c.affectedByDistance!==void 0?c.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=c.scaleByViewport!==void 0?c.scaleByViewport:!this.affectedByDistance;this.alignment=c.alignment instanceof THREE.Vector2?c.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.matrixAutoUpdate=!1;this.collisions=this.overrideMaterial=null;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.add=function(c){this.supr.add.call(this,c);this.addChildRecurse(c)};THREE.Scene.prototype.addChildRecurse=function(e){if(e instanceof THREE.Light){this.lights.indexOf(e)===-1&&this.lights.push(e)}else{if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&this.objects.indexOf(e)===-1){this.objects.push(e);this.__objectsAdded.push(e);var f=this.__objectsRemoved.indexOf(e);f!==-1&&this.__objectsRemoved.splice(f,1)}}for(f=0;f<e.children.length;f++){this.addChildRecurse(e.children[f])}};THREE.Scene.prototype.remove=function(c){this.supr.remove.call(this,c);this.removeChildRecurse(c)};THREE.Scene.prototype.removeChildRecurse=function(e){if(e instanceof THREE.Light){var f=this.lights.indexOf(e);f!==-1&&this.lights.splice(f,1)}else{e instanceof THREE.Camera||(f=this.objects.indexOf(e),f!==-1&&(this.objects.splice(f,1),this.__objectsRemoved.push(e),f=this.__objectsAdded.indexOf(e),f!==-1&&this.__objectsAdded.splice(f,1)))}for(f=0;f<e.children.length;f++){this.removeChildRecurse(e.children[f])}};THREE.Scene.prototype.addChild=function(c){console.warn("DEPRECATED: Scene.addChild() is now Scene.add().");this.add(c)};THREE.Scene.prototype.addObject=function(c){console.warn("DEPRECATED: Scene.addObject() is now Scene.add().");this.add(c)};THREE.Scene.prototype.addLight=function(c){console.warn("DEPRECATED: Scene.addLight() is now Scene.add().");this.add(c)};THREE.Scene.prototype.removeChild=function(c){console.warn("DEPRECATED: Scene.removeChild() is now Scene.remove().");this.remove(c)};THREE.Scene.prototype.removeObject=function(c){console.warn("DEPRECATED: Scene.removeObject() is now Scene.remove().");this.remove(c)};THREE.Scene.prototype.removeLight=function(c){console.warn("DEPRECATED: Scene.removeLight() is now Scene.remove().");this.remove(c)};THREE.Fog=function(e,h,f){this.color=new THREE.Color(e);this.near=h!==void 0?h:1;this.far=f!==void 0?f:1000};THREE.FogExp2=function(e,f){this.color=new THREE.Color(e);this.density=f!==void 0?f:0.00025};THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n}\n#endif\n}",lights_phong_pars_vertex:"#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif",lights_phong_vertex:"#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif",lights_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * pointDistance;\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * totalDiffuse + totalSpecular + ambientLightColor * ambient;",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec4 shadowColor = vec4( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nshadowCoord.z += shadowBias;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec4( vec3( ( 1.0 - shadowDarkness * shadow ) ), 1.0 );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec4( vec3( shadowDarkness ), 1.0 );\n#endif\n}\n}\ngl_FragColor = gl_FragColor * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif"};THREE.UniformsUtils={merge:function(f){var n,m,k,h={};for(n=0;n<f.length;n++){for(m in k=this.clone(f[n]),k){h[m]=k[m]}}return h},clone:function(f){var n,m,k,h={};for(n in f){for(m in h[n]={},f[n]){k=f[n][m],h[n][m]=k instanceof THREE.Color||k instanceof THREE.Vector2||k instanceof THREE.Vector3||k instanceof THREE.Vector4||k instanceof THREE.Matrix4||k instanceof THREE.Texture?k.clone():k instanceof Array?k.slice():k}}return h}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:0.0039},shadowDarkness:{type:"f",value:0.2}}};THREE.ShaderLib={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap]),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"gl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};THREE.WebGLRenderer=function(ay){function aw(X,W,V){var U,T,S,R=X.vertices,f=R.length,w=X.colors,N=w.length,J=X.__vertexArray,I=X.__colorArray,G=X.__sortArray,y=X.__dirtyVertices,M=X.__dirtyColors,D=X.__webglCustomAttributes,C,E;if(D){for(C in D){D[C].offset=0}}if(V.sortParticles){B.multiplySelf(V.matrixWorld);for(U=0;U<f;U++){T=R[U].position,ax.copy(T),B.multiplyVector3(ax),G[U]=[ax.z,U]}G.sort(function(e,h){return h[0]-e[0]});for(U=0;U<f;U++){T=R[G[U][1]].position,S=U*3,J[S]=T.x,J[S+1]=T.y,J[S+2]=T.z}for(U=0;U<N;U++){S=U*3,color=w[G[U][1]],I[S]=color.r,I[S+1]=color.g,I[S+2]=color.b}if(D){for(C in D){U=D[C];w=U.value.length;for(S=0;S<w;S++){index=G[S][1];N=U.offset;if(U.size===1){if(U.boundTo===void 0||U.boundTo==="vertices"){U.array[N]=U.value[index]}}else{if(U.boundTo===void 0||U.boundTo==="vertices"){E=U.value[index]}U.size===2?(U.array[N]=E.x,U.array[N+1]=E.y):U.size===3?U.type==="c"?(U.array[N]=E.r,U.array[N+1]=E.g,U.array[N+2]=E.b):(U.array[N]=E.x,U.array[N+1]=E.y,U.array[N+2]=E.z):(U.array[N]=E.x,U.array[N+1]=E.y,U.array[N+2]=E.z,U.array[N+3]=E.w)}U.offset+=U.size}}}}else{if(y){for(U=0;U<f;U++){T=R[U].position,S=U*3,J[S]=T.x,J[S+1]=T.y,J[S+2]=T.z}}if(M){for(U=0;U<N;U++){color=w[U],S=U*3,I[S]=color.r,I[S+1]=color.g,I[S+2]=color.b}}if(D){for(C in D){if(U=D[C],U.__original.needsUpdate){w=U.value.length;for(S=0;S<w;S++){N=U.offset;if(U.size===1){if(U.boundTo===void 0||U.boundTo==="vertices"){U.array[N]=U.value[S]}}else{if(U.boundTo===void 0||U.boundTo==="vertices"){E=U.value[S]}U.size===2?(U.array[N]=E.x,U.array[N+1]=E.y):U.size===3?U.type==="c"?(U.array[N]=E.r,U.array[N+1]=E.g,U.array[N+2]=E.b):(U.array[N]=E.x,U.array[N+1]=E.y,U.array[N+2]=E.z):(U.array[N]=E.x,U.array[N+1]=E.y,U.array[N+2]=E.z,U.array[N+3]=E.w)}U.offset+=U.size}}}}}if(y||V.sortParticles){at.bindBuffer(at.ARRAY_BUFFER,X.__webglVertexBuffer),at.bufferData(at.ARRAY_BUFFER,J,W)}if(M||V.sortParticles){at.bindBuffer(at.ARRAY_BUFFER,X.__webglColorBuffer),at.bufferData(at.ARRAY_BUFFER,I,W)}if(D){for(C in D){if(U=D[C],U.__original.needsUpdate||V.sortParticles){at.bindBuffer(at.ARRAY_BUFFER,U.buffer),at.bufferData(at.ARRAY_BUFFER,U.array,W)}}}}function av(bk,bj,bi,bh,bg){bh.program||aL.initMaterial(bh,bj,bi,bg);if(bh.morphTargets&&!bg.__webglMorphTargetInfluences){bg.__webglMorphTargetInfluences=new Float32Array(aL.maxMorphTargets);for(var bf=0,be=aL.maxMorphTargets;bf<be;bf++){bg.__webglMorphTargetInfluences[bf]=0}}var bd=!1,bf=bh.program,be=bf.uniforms,I=bh.uniforms;bf!=ad&&(at.useProgram(bf),ad=bf,bd=!0);if(bh.id!=aK){aK=bh.id,bd=!0}if(bd){at.uniformMatrix4fv(be.projectionMatrix,!1,a4);if(bi&&bh.fog){if(I.fogColor.value=bi.color,bi instanceof THREE.Fog){I.fogNear.value=bi.near,I.fogFar.value=bi.far}else{if(bi instanceof THREE.FogExp2){I.fogDensity.value=bi.density}}}if(bh instanceof THREE.MeshPhongMaterial||bh instanceof THREE.MeshLambertMaterial||bh.lights){for(var bb,ab,Y=0,bc=0,R=0,V,T,M,J=x,S=J.directional.colors,X=J.directional.positions,aa=J.point.colors,W=J.point.positions,U=J.point.distances,N=0,f=0,bi=bb=M=0,bd=bj.length;bi<bd;bi++){if(bb=bj[bi],ab=bb.color,V=bb.position,T=bb.intensity,M=bb.distance,bb instanceof THREE.AmbientLight){Y+=ab.r,bc+=ab.g,R+=ab.b}else{if(bb instanceof THREE.DirectionalLight){M=N*3,S[M]=ab.r*T,S[M+1]=ab.g*T,S[M+2]=ab.b*T,X[M]=V.x,X[M+1]=V.y,X[M+2]=V.z,N+=1}else{if(bb instanceof THREE.SpotLight){M=N*3,S[M]=ab.r*T,S[M+1]=ab.g*T,S[M+2]=ab.b*T,ab=1/V.length(),X[M]=V.x*ab,X[M+1]=V.y*ab,X[M+2]=V.z*ab,N+=1}else{if(bb instanceof THREE.PointLight){bb=f*3,aa[bb]=ab.r*T,aa[bb+1]=ab.g*T,aa[bb+2]=ab.b*T,W[bb]=V.x,W[bb+1]=V.y,W[bb+2]=V.z,U[f]=M,f+=1}}}}}bi=N*3;for(bd=S.length;bi<bd;bi++){S[bi]=0}bi=f*3;for(bd=aa.length;bi<bd;bi++){aa[bi]=0}J.point.length=f;J.directional.length=N;J.ambient[0]=Y;J.ambient[1]=bc;J.ambient[2]=R;bj=x;I.enableLighting.value=bj.directional.length+bj.point.length;I.ambientLightColor.value=bj.ambient;I.directionalLightColor.value=bj.directional.colors;I.directionalLightDirection.value=bj.directional.positions;I.pointLightColor.value=bj.point.colors;I.pointLightPosition.value=bj.point.positions;I.pointLightDistance.value=bj.point.distances}if(bh instanceof THREE.MeshBasicMaterial||bh instanceof THREE.MeshLambertMaterial||bh instanceof THREE.MeshPhongMaterial){I.diffuse.value=bh.color,I.opacity.value=bh.opacity,(I.map.texture=bh.map)&&I.offsetRepeat.value.set(bh.map.offset.x,bh.map.offset.y,bh.map.repeat.x,bh.map.repeat.y),I.lightMap.texture=bh.lightMap,I.envMap.texture=bh.envMap,I.reflectivity.value=bh.reflectivity,I.refractionRatio.value=bh.refractionRatio,I.combine.value=bh.combine,I.useRefract.value=bh.envMap&&bh.envMap.mapping instanceof THREE.CubeRefractionMapping}if(bh instanceof THREE.LineBasicMaterial){I.diffuse.value=bh.color,I.opacity.value=bh.opacity}else{if(bh instanceof THREE.ParticleBasicMaterial){I.psColor.value=bh.color,I.opacity.value=bh.opacity,I.size.value=bh.size,I.scale.value=aP.height/2,I.map.texture=bh.map}else{if(bh instanceof THREE.MeshPhongMaterial){I.ambient.value=bh.ambient,I.specular.value=bh.specular,I.shininess.value=bh.shininess}else{if(bh instanceof THREE.MeshDepthMaterial){I.mNear.value=bk.near,I.mFar.value=bk.far,I.opacity.value=bh.opacity}else{if(bh instanceof THREE.MeshNormalMaterial){I.opacity.value=bh.opacity}}}}}if(bg.receiveShadow&&!bh._shadowPass&&I.shadowMatrix){for(bj=0;bj<v.length;bj++){I.shadowMatrix.value[bj]=v[bj],I.shadowMap.texture[bj]=aL.shadowMap[bj]}I.shadowDarkness.value=aL.shadowMapDarkness;I.shadowBias.value=aL.shadowMapBias}bj=bh.uniformsList;I=0;for(bi=bj.length;I<bi;I++){if(bc=bf.uniforms[bj[I][1]]){if(Y=bj[I][0],R=Y.type,bd=Y.value,R=="i"){at.uniform1i(bc,bd)}else{if(R=="f"){at.uniform1f(bc,bd)}else{if(R=="v2"){at.uniform2f(bc,bd.x,bd.y)}else{if(R=="v3"){at.uniform3f(bc,bd.x,bd.y,bd.z)}else{if(R=="v4"){at.uniform4f(bc,bd.x,bd.y,bd.z,bd.w)}else{if(R=="c"){at.uniform3f(bc,bd.r,bd.g,bd.b)}else{if(R=="fv1"){at.uniform1fv(bc,bd)}else{if(R=="fv"){at.uniform3fv(bc,bd)}else{if(R=="v3v"){if(!Y._array){Y._array=new Float32Array(3*bd.length)}R=0;for(V=bd.length;R<V;R++){J=R*3,Y._array[J]=bd[R].x,Y._array[J+1]=bd[R].y,Y._array[J+2]=bd[R].z}at.uniform3fv(bc,Y._array)}else{if(R=="m4"){if(!Y._array){Y._array=new Float32Array(16)}bd.flattenToArray(Y._array);at.uniformMatrix4fv(bc,!1,Y._array)}else{if(R=="m4v"){if(!Y._array){Y._array=new Float32Array(16*bd.length)}R=0;for(V=bd.length;R<V;R++){bd[R].flattenToArrayOffset(Y._array,R*16)}at.uniformMatrix4fv(bc,!1,Y._array)}else{if(R=="t"){if(at.uniform1i(bc,bd),bc=Y.texture){if(bc.image instanceof Array&&bc.image.length==6){if(Y=bc,Y.image.length==6){if(Y.needsUpdate){if(!Y.image.__webglTextureCube){Y.image.__webglTextureCube=at.createTexture()}at.activeTexture(at.TEXTURE0+bd);at.bindTexture(at.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube);for(bd=0;bd<6;bd++){at.texImage2D(at.TEXTURE_CUBE_MAP_POSITIVE_X+bd,0,at.RGBA,at.RGBA,at.UNSIGNED_BYTE,Y.image[bd])}ah(at.TEXTURE_CUBE_MAP,Y,Y.image[0]);Y.needsUpdate=!1}else{at.activeTexture(at.TEXTURE0+bd),at.bindTexture(at.TEXTURE_CUBE_MAP,Y.image.__webglTextureCube)}}}else{bc instanceof THREE.WebGLRenderTargetCube?(Y=bc,at.activeTexture(at.TEXTURE0+bd),at.bindTexture(at.TEXTURE_CUBE_MAP,Y.__webglTexture)):A(bc,bd)}}}else{if(R=="tv"){if(!Y._array){Y._array=[];R=0;for(V=Y.texture.length;R<V;R++){Y._array[R]=bd+R}}at.uniform1iv(bc,Y._array);R=0;for(V=Y.texture.length;R<V;R++){(bc=Y.texture[R])&&A(bc,Y._array[R])}}}}}}}}}}}}}}}}(bh instanceof THREE.ShaderMaterial||bh instanceof THREE.MeshPhongMaterial||bh.envMap)&&be.cameraPosition!==null&&at.uniform3f(be.cameraPosition,bk.position.x,bk.position.y,bk.position.z);(bh instanceof THREE.MeshPhongMaterial||bh instanceof THREE.MeshLambertMaterial||bh instanceof THREE.ShaderMaterial||bh.skinning)&&be.viewMatrix!==null&&at.uniformMatrix4fv(be.viewMatrix,!1,aX);bh.skinning&&(at.uniformMatrix4fv(be.cameraInverseMatrix,!1,aX),at.uniformMatrix4fv(be.boneGlobalMatrices,!1,bg.boneMatrices))}at.uniformMatrix4fv(be.modelViewMatrix,!1,bg._modelViewMatrixArray);be.normalMatrix&&at.uniformMatrix3fv(be.normalMatrix,!1,bg._normalMatrixArray);(bh instanceof THREE.ShaderMaterial||bh.envMap||bh.skinning||bg.receiveShadow)&&be.objectMatrix!==null&&at.uniformMatrix4fv(be.objectMatrix,!1,bg._objectMatrixArray);return bf}function au(N,M,I,G,E,D){if(G.opacity!=0){var C,I=av(N,M,I,G,D),N=I.attributes,M=!1,I=E.id*16777215+I.id;I!=aG&&(aG=I,M=!0);if(!G.morphTargets&&N.position>=0){M&&(at.bindBuffer(at.ARRAY_BUFFER,E.__webglVertexBuffer),at.vertexAttribPointer(N.position,3,at.FLOAT,!1,0,0))}else{if(D.morphTargetBase){I=G.program.attributes;D.morphTargetBase!==-1?(at.bindBuffer(at.ARRAY_BUFFER,E.__webglMorphTargetsBuffers[D.morphTargetBase]),at.vertexAttribPointer(I.position,3,at.FLOAT,!1,0,0)):I.position>=0&&(at.bindBuffer(at.ARRAY_BUFFER,E.__webglVertexBuffer),at.vertexAttribPointer(I.position,3,at.FLOAT,!1,0,0));if(D.morphTargetForcedOrder.length){for(var w=0,J=D.morphTargetForcedOrder,f=D.morphTargetInfluences;w<G.numSupportedMorphTargets&&w<J.length;){at.bindBuffer(at.ARRAY_BUFFER,E.__webglMorphTargetsBuffers[J[w]]),at.vertexAttribPointer(I["morphTarget"+w],3,at.FLOAT,!1,0,0),D.__webglMorphTargetInfluences[w]=f[J[w]],w++}}else{var J=[],u=-1,y=0,f=D.morphTargetInfluences,S,R=f.length,w=0;for(D.morphTargetBase!==-1&&(J[D.morphTargetBase]=!0);w<G.numSupportedMorphTargets;){for(S=0;S<R;S++){!J[S]&&f[S]>u&&(y=S,u=f[y])}at.bindBuffer(at.ARRAY_BUFFER,E.__webglMorphTargetsBuffers[y]);at.vertexAttribPointer(I["morphTarget"+w],3,at.FLOAT,!1,0,0);D.__webglMorphTargetInfluences[w]=u;J[y]=1;u=-1;w++}}G.program.uniforms.morphTargetInfluences!==null&&at.uniform1fv(G.program.uniforms.morphTargetInfluences,D.__webglMorphTargetInfluences)}}if(M){if(E.__webglCustomAttributes){for(C in E.__webglCustomAttributes){N[C]>=0&&(I=E.__webglCustomAttributes[C],at.bindBuffer(at.ARRAY_BUFFER,I.buffer),at.vertexAttribPointer(N[C],I.size,at.FLOAT,!1,0,0))}}N.color>=0&&(at.bindBuffer(at.ARRAY_BUFFER,E.__webglColorBuffer),at.vertexAttribPointer(N.color,3,at.FLOAT,!1,0,0));N.normal>=0&&(at.bindBuffer(at.ARRAY_BUFFER,E.__webglNormalBuffer),at.vertexAttribPointer(N.normal,3,at.FLOAT,!1,0,0));N.tangent>=0&&(at.bindBuffer(at.ARRAY_BUFFER,E.__webglTangentBuffer),at.vertexAttribPointer(N.tangent,4,at.FLOAT,!1,0,0));N.uv>=0&&(E.__webglUVBuffer?(at.bindBuffer(at.ARRAY_BUFFER,E.__webglUVBuffer),at.vertexAttribPointer(N.uv,2,at.FLOAT,!1,0,0),at.enableVertexAttribArray(N.uv)):at.disableVertexAttribArray(N.uv));N.uv2>=0&&(E.__webglUV2Buffer?(at.bindBuffer(at.ARRAY_BUFFER,E.__webglUV2Buffer),at.vertexAttribPointer(N.uv2,2,at.FLOAT,!1,0,0),at.enableVertexAttribArray(N.uv2)):at.disableVertexAttribArray(N.uv2));G.skinning&&N.skinVertexA>=0&&N.skinVertexB>=0&&N.skinIndex>=0&&N.skinWeight>=0&&(at.bindBuffer(at.ARRAY_BUFFER,E.__webglSkinVertexABuffer),at.vertexAttribPointer(N.skinVertexA,4,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,E.__webglSkinVertexBBuffer),at.vertexAttribPointer(N.skinVertexB,4,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,E.__webglSkinIndicesBuffer),at.vertexAttribPointer(N.skinIndex,4,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,E.__webglSkinWeightsBuffer),at.vertexAttribPointer(N.skinWeight,4,at.FLOAT,!1,0,0))}D instanceof THREE.Mesh?(G.wireframe?(at.lineWidth(G.wireframeLinewidth),M&&at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,E.__webglLineBuffer),at.drawElements(at.LINES,E.__webglLineCount,at.UNSIGNED_SHORT,0)):(M&&at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,E.__webglFaceBuffer),at.drawElements(at.TRIANGLES,E.__webglFaceCount,at.UNSIGNED_SHORT,0)),aL.info.render.calls++,aL.info.render.vertices+=E.__webglFaceCount,aL.info.render.faces+=E.__webglFaceCount/3):D instanceof THREE.Line?(D=D.type==THREE.LineStrip?at.LINE_STRIP:at.LINES,at.lineWidth(G.linewidth),at.drawArrays(D,0,E.__webglLineCount),aL.info.render.calls++):D instanceof THREE.ParticleSystem?(at.drawArrays(at.POINTS,0,E.__webglParticleCount),aL.info.render.calls++):D instanceof THREE.Ribbon&&(at.drawArrays(at.TRIANGLE_STRIP,0,E.__webglVertexCount),aL.info.render.calls++)}}function ap(N,M,I){if(!N.__webglVertexBuffer){N.__webglVertexBuffer=at.createBuffer()}if(!N.__webglNormalBuffer){N.__webglNormalBuffer=at.createBuffer()}N.hasPos&&(at.bindBuffer(at.ARRAY_BUFFER,N.__webglVertexBuffer),at.bufferData(at.ARRAY_BUFFER,N.positionArray,at.DYNAMIC_DRAW),at.enableVertexAttribArray(M.attributes.position),at.vertexAttribPointer(M.attributes.position,3,at.FLOAT,!1,0,0));if(N.hasNormal){at.bindBuffer(at.ARRAY_BUFFER,N.__webglNormalBuffer);if(I==THREE.FlatShading){var G,E,D,C,y,J,u,f,t,w,R=N.count*3;for(w=0;w<R;w+=9){I=N.normalArray,G=I[w],E=I[w+1],D=I[w+2],C=I[w+3],J=I[w+4],f=I[w+5],y=I[w+6],u=I[w+7],t=I[w+8],G=(G+C+y)/3,E=(E+J+u)/3,D=(D+f+t)/3,I[w]=G,I[w+1]=E,I[w+2]=D,I[w+3]=G,I[w+4]=E,I[w+5]=D,I[w+6]=G,I[w+7]=E,I[w+8]=D}}at.bufferData(at.ARRAY_BUFFER,N.normalArray,at.DYNAMIC_DRAW);at.enableVertexAttribArray(M.attributes.normal);at.vertexAttribPointer(M.attributes.normal,3,at.FLOAT,!1,0,0)}at.drawArrays(at.TRIANGLES,0,N.count);N.count=0}function aq(c){if(aE!=c.doubleSided){c.doubleSided?at.disable(at.CULL_FACE):at.enable(at.CULL_FACE),aE=c.doubleSided}if(aC!=c.flipSided){c.flipSided?at.frontFace(at.CW):at.frontFace(at.CCW),aC=c.flipSided}}function ao(c){aZ!=c&&(c?at.enable(at.DEPTH_TEST):at.disable(at.DEPTH_TEST),aZ=c)}function an(c){aM!=c&&(at.depthMask(c),aM=c)}function aj(e,h,f){a6!=e&&(e?at.enable(at.POLYGON_OFFSET_FILL):at.disable(at.POLYGON_OFFSET_FILL),a6=e);if(e&&(H!=h||L!=f)){at.polygonOffset(h,f),H=h,L=f}}function ak(e){aN[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14);aN[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14);aN[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24);aN[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24);aN[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34);aN[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);for(var f,e=0;e<6;e++){f=aN[e],f.divideScalar(Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z))}}function ai(e){for(var m=e.matrixWorld,h=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),k=0;k<6;k++){if(e=aN[k].x*m.n14+aN[k].y*m.n24+aN[k].z*m.n34+aN[k].w,e<=h){return !1}}return !0}function am(e,f){e.list[e.count]=f;e.count+=1}function ag(k){var u,o,t=k.object,p=k.opaque,m=k.transparent;m.count=0;k=p.count=0;for(u=t.materials.length;k<u;k++){o=t.materials[k],o.transparent?am(m,o):am(p,o)}}function ae(D){var C,u,y,w,t=D.object,p=D.buffer,o=D.opaque,m=D.transparent;m.count=0;D=o.count=0;for(y=t.materials.length;D<y;D++){if(C=t.materials[D],C instanceof THREE.MeshFaceMaterial){C=0;for(u=p.materials.length;C<u;C++){(w=p.materials[C])&&(w.transparent?am(m,w):am(o,w))}}else{(w=C)&&(w.transparent?am(m,w):am(o,w))}}}function ac(e,f){return f.z-e.z}function aV(C){var w,o,h,D=0,f,E,y,u,e=C.lights;a9||(a9=new THREE.PerspectiveCamera(aL.shadowCameraFov,aL.shadowMapWidth/aL.shadowMapHeight,aL.shadowCameraNear,aL.shadowCameraFar));w=0;for(o=e.length;w<o;w++){if(h=e[w],h instanceof THREE.SpotLight&&h.castShadow){aK=-1;aL.shadowMap[D]||(aL.shadowMap[D]=new THREE.WebGLRenderTarget(aL.shadowMapWidth,aL.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}));v[D]||(v[D]=new THREE.Matrix4);f=aL.shadowMap[D];E=v[D];a9.position.copy(h.position);a9.lookAt(h.target.position);a9.update(void 0,!0);C.update(void 0,!1,a9);E.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);E.multiplySelf(a9.projectionMatrix);E.multiplySelf(a9.matrixWorldInverse);a9.matrixWorldInverse.flattenToArray(aX);a9.projectionMatrix.flattenToArray(a4);B.multiply(a9.projectionMatrix,a9.matrixWorldInverse);ak(B);aL.initWebGLObjects(C);aI(f);at.clearColor(1,1,1,1);aL.clear();at.clearColor(aB.r,aB.g,aB.b,a8);E=C.__webglObjects.length;h=C.__webglObjectsImmediate.length;for(f=0;f<E;f++){y=C.__webglObjects[f],u=y.object,u.visible&&u.castShadow?!(u instanceof THREE.Mesh)||!u.frustumCulled||ai(u)?(u.matrixWorld.flattenToArray(u._objectMatrixArray),aS(u,a9,!1),y.render=!0):y.render=!1:y.render=!1}ao(!0);aQ(THREE.NormalBlending);for(f=0;f<E;f++){if(y=C.__webglObjects[f],y.render){u=y.object,buffer=y.buffer,aq(u),y=u.customDepthMaterial?u.customDepthMaterial:u.geometry.morphTargets.length?a5:aA,au(a9,e,null,y,buffer,u)}}for(f=0;f<h;f++){y=C.__webglObjectsImmediate[f],u=y.object,u.visible&&u.castShadow&&(u.matrixAutoUpdate&&u.matrixWorld.flattenToArray(u._objectMatrixArray),aG=-1,aS(u,a9,!1),aq(u),program=av(a9,e,null,aA,u),u.immediateRenderCallback?u.immediateRenderCallback(program,at,aN):u.render(function(c){ap(c,program,aA.shading)}))}D++}}}function aR(M,J){var G,E,D;G=af.attributes;var C=af.uniforms,y=aW/ar,w,I=[],t=ar*0.5,u=aW*0.5,f=!0;at.useProgram(af.program);ad=af.program;aG=aZ=aD=-1;aU||(at.enableVertexAttribArray(af.attributes.position),at.enableVertexAttribArray(af.attributes.uv),aU=!0);at.disable(at.CULL_FACE);at.enable(at.BLEND);at.depthMask(!0);at.bindBuffer(at.ARRAY_BUFFER,af.vertexBuffer);at.vertexAttribPointer(G.position,2,at.FLOAT,!1,16,0);at.vertexAttribPointer(G.uv,2,at.FLOAT,!1,16,8);at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,af.elementBuffer);at.uniformMatrix4fv(C.projectionMatrix,!1,a4);at.activeTexture(at.TEXTURE0);at.uniform1i(C.map,0);G=0;for(E=M.__webglSprites.length;G<E;G++){if(D=M.__webglSprites[G],D.visible&&D.opacity!=0){D.useScreenCoordinates?D.z=-D.position.z:(D._modelViewMatrix.multiplyToArray(J.matrixWorldInverse,D.matrixWorld,D._modelViewMatrixArray),D.z=-D._modelViewMatrix.n34)}}M.__webglSprites.sort(ac);G=0;for(E=M.__webglSprites.length;G<E;G++){D=M.__webglSprites[G],D.visible&&D.opacity!=0&&D.map&&D.map.image&&D.map.image.width&&(D.useScreenCoordinates?(at.uniform1i(C.useScreenCoordinates,1),at.uniform3f(C.screenPosition,(D.position.x-t)/t,(u-D.position.y)/u,Math.max(0,Math.min(1,D.position.z)))):(at.uniform1i(C.useScreenCoordinates,0),at.uniform1i(C.affectedByDistance,D.affectedByDistance?1:0),at.uniformMatrix4fv(C.modelViewMatrix,!1,D._modelViewMatrixArray)),w=D.map.image.width/(D.scaleByViewport?aW:1),I[0]=w*y*D.scale.x,I[1]=w*D.scale.y,at.uniform2f(C.uvScale,D.uvScale.x,D.uvScale.y),at.uniform2f(C.uvOffset,D.uvOffset.x,D.uvOffset.y),at.uniform2f(C.alignment,D.alignment.x,D.alignment.y),at.uniform1f(C.opacity,D.opacity),at.uniform3f(C.color,D.color.r,D.color.g,D.color.b),at.uniform1f(C.rotation,D.rotation),at.uniform2fv(C.scale,I),D.mergeWith3D&&!f?(at.enable(at.DEPTH_TEST),f=!0):!D.mergeWith3D&&f&&(at.disable(at.DEPTH_TEST),f=!1),aQ(D.blending),A(D.map,0),at.drawElements(at.TRIANGLES,6,at.UNSIGNED_SHORT,0))}at.enable(at.CULL_FACE);at.enable(at.DEPTH_TEST);at.depthMask(aM)}function aS(e,k,h){e._modelViewMatrix.multiplyToArray(k.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray);h&&THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function K(h){var p,k,o,m;m=h.__materials;h=0;for(k=m.length;h<k;h++){if(o=m[h],o.attributes){for(p in o.attributes){if(o.attributes[p].needsUpdate){return !0}}}}return !1}function n(h){var p,k,o,m;m=h.__materials;h=0;for(k=m.length;h<k;h++){if(o=m[h],o.attributes){for(p in o.attributes){o.attributes[p].needsUpdate=!1}}}}function F(e,k){var h;for(h=e.length-1;h>=0;h--){e[h].object==k&&e.splice(h,1)}}function a2(R){function N(c){var f=[];I=0;for(M=c.length;I<M;I++){c[I]==void 0?f.push("undefined"):f.push(c[I].id)}return f.join("_")}var I,M,J,G,E,D,C,w,y={},u=R.morphTargets!==void 0?R.morphTargets.length:0;R.geometryGroups={};J=0;for(G=R.faces.length;J<G;J++){E=R.faces[J],D=E.materials,C=N(D),y[C]==void 0&&(y[C]={hash:C,counter:0}),w=y[C].hash+"_"+y[C].counter,R.geometryGroups[w]==void 0&&(R.geometryGroups[w]={faces:[],materials:D,vertices:0,numMorphTargets:u}),E=E instanceof THREE.Face3?3:4,R.geometryGroups[w].vertices+E>65535&&(y[C].counter+=1,w=y[C].hash+"_"+y[C].counter,R.geometryGroups[w]==void 0&&(R.geometryGroups[w]={faces:[],materials:D,vertices:0,numMorphTargets:u})),R.geometryGroups[w].faces.push(J),R.geometryGroups[w].vertices+=E}R.geometryGroupsList=[];for(var t in R.geometryGroups){R.geometryGroups[t].id=aO++,R.geometryGroupsList.push(R.geometryGroups[t])}}function Q(e,k,h){e.push({buffer:k,object:h,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function aQ(c){if(c!=aD){switch(c){case THREE.AdditiveBlending:at.blendEquation(at.FUNC_ADD);at.blendFunc(at.SRC_ALPHA,at.ONE);break;case THREE.SubtractiveBlending:at.blendEquation(at.FUNC_ADD);at.blendFunc(at.ZERO,at.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:at.blendEquation(at.FUNC_ADD);at.blendFunc(at.ZERO,at.SRC_COLOR);break;default:at.blendEquationSeparate(at.FUNC_ADD,at.FUNC_ADD),at.blendFuncSeparate(at.SRC_ALPHA,at.ONE_MINUS_SRC_ALPHA,at.ONE,at.ONE_MINUS_SRC_ALPHA)}aD=c}}function ah(e,h,f){(f.width&f.width-1)==0&&(f.height&f.height-1)==0?(at.texParameteri(e,at.TEXTURE_WRAP_S,aH(h.wrapS)),at.texParameteri(e,at.TEXTURE_WRAP_T,aH(h.wrapT)),at.texParameteri(e,at.TEXTURE_MAG_FILTER,aH(h.magFilter)),at.texParameteri(e,at.TEXTURE_MIN_FILTER,aH(h.minFilter)),at.generateMipmap(e)):(at.texParameteri(e,at.TEXTURE_WRAP_S,at.CLAMP_TO_EDGE),at.texParameteri(e,at.TEXTURE_WRAP_T,at.CLAMP_TO_EDGE),at.texParameteri(e,at.TEXTURE_MAG_FILTER,a3(h.magFilter)),at.texParameteri(e,at.TEXTURE_MIN_FILTER,a3(h.minFilter)))}function A(e,f){if(e.needsUpdate){if(!e.__webglInit){e.__webglInit=!0,e.__webglTexture=at.createTexture(),aL.info.memory.textures++}at.activeTexture(at.TEXTURE0+f);at.bindTexture(at.TEXTURE_2D,e.__webglTexture);e instanceof THREE.DataTexture?at.texImage2D(at.TEXTURE_2D,0,aH(e.format),e.image.width,e.image.height,0,aH(e.format),at.UNSIGNED_BYTE,e.image.data):at.texImage2D(at.TEXTURE_2D,0,at.RGBA,at.RGBA,at.UNSIGNED_BYTE,e.image);ah(at.TEXTURE_2D,e,e.image);e.needsUpdate=!1}else{at.activeTexture(at.TEXTURE0+f),at.bindTexture(at.TEXTURE_2D,e.__webglTexture)}}function aI(f){var p=f instanceof THREE.WebGLRenderTargetCube;if(f&&!f.__webglFramebuffer){if(f.depthBuffer===void 0){f.depthBuffer=!0}if(f.stencilBuffer===void 0){f.stencilBuffer=!0}f.__webglRenderbuffer=at.createRenderbuffer();f.__webglTexture=at.createTexture();if(p){at.bindTexture(at.TEXTURE_CUBE_MAP,f.__webglTexture);ah(at.TEXTURE_CUBE_MAP,f,f);f.__webglFramebuffer=[];for(var o=0;o<6;o++){f.__webglFramebuffer[o]=at.createFramebuffer(),at.texImage2D(at.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,aH(f.format),f.width,f.height,0,aH(f.format),aH(f.type),null)}}else{f.__webglFramebuffer=at.createFramebuffer(),at.bindTexture(at.TEXTURE_2D,f.__webglTexture),ah(at.TEXTURE_2D,f,f),at.texImage2D(at.TEXTURE_2D,0,aH(f.format),f.width,f.height,0,aH(f.format),aH(f.type),null)}at.bindRenderbuffer(at.RENDERBUFFER,f.__webglRenderbuffer);if(p){for(o=0;o<6;++o){at.bindFramebuffer(at.FRAMEBUFFER,f.__webglFramebuffer[o]),at.framebufferTexture2D(at.FRAMEBUFFER,at.COLOR_ATTACHMENT0,at.TEXTURE_CUBE_MAP_POSITIVE_X+o,f.__webglTexture,0)}}else{at.bindFramebuffer(at.FRAMEBUFFER,f.__webglFramebuffer),at.framebufferTexture2D(at.FRAMEBUFFER,at.COLOR_ATTACHMENT0,at.TEXTURE_2D,f.__webglTexture,0)}f.depthBuffer&&!f.stencilBuffer?(at.renderbufferStorage(at.RENDERBUFFER,at.DEPTH_COMPONENT16,f.width,f.height),at.framebufferRenderbuffer(at.FRAMEBUFFER,at.DEPTH_ATTACHMENT,at.RENDERBUFFER,f.__webglRenderbuffer)):f.depthBuffer&&f.stencilBuffer?(at.renderbufferStorage(at.RENDERBUFFER,at.DEPTH_STENCIL,f.width,f.height),at.framebufferRenderbuffer(at.FRAMEBUFFER,at.DEPTH_STENCIL_ATTACHMENT,at.RENDERBUFFER,f.__webglRenderbuffer)):at.renderbufferStorage(at.RENDERBUFFER,at.RGBA4,f.width,f.height);p?at.bindTexture(at.TEXTURE_CUBE_MAP,null):at.bindTexture(at.TEXTURE_2D,null);at.bindRenderbuffer(at.RENDERBUFFER,null);at.bindFramebuffer(at.FRAMEBUFFER,null)}var m,k;f?(p=p?f.__webglFramebuffer[f.activeCubeFace]:f.__webglFramebuffer,o=f.width,f=f.height,k=m=0):(p=null,o=ar,f=aW,m=aT,k=a0);p!=Z&&(at.bindFramebuffer(at.FRAMEBUFFER,p),at.viewport(m,k,o,f),Z=p)}function a7(c){c instanceof THREE.WebGLRenderTargetCube?(at.bindTexture(at.TEXTURE_CUBE_MAP,c.__webglTexture),at.generateMipmap(at.TEXTURE_CUBE_MAP),at.bindTexture(at.TEXTURE_CUBE_MAP,null)):(at.bindTexture(at.TEXTURE_2D,c.__webglTexture),at.generateMipmap(at.TEXTURE_2D),at.bindTexture(at.TEXTURE_2D,null))}function a1(e,h){var f;e=="fragment"?f=at.createShader(at.FRAGMENT_SHADER):e=="vertex"&&(f=at.createShader(at.VERTEX_SHADER));at.shaderSource(f,h);at.compileShader(f);if(!at.getShaderParameter(f,at.COMPILE_STATUS)){return console.error(at.getShaderInfoLog(f)),console.error(h),null}return f}function a3(c){switch(c){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return at.NEAREST;default:return at.LINEAR}}function aH(c){switch(c){case THREE.RepeatWrapping:return at.REPEAT;case THREE.ClampToEdgeWrapping:return at.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return at.MIRRORED_REPEAT;case THREE.NearestFilter:return at.NEAREST;case THREE.NearestMipMapNearestFilter:return at.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return at.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return at.LINEAR;case THREE.LinearMipMapNearestFilter:return at.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return at.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return at.BYTE;case THREE.UnsignedByteType:return at.UNSIGNED_BYTE;case THREE.ShortType:return at.SHORT;case THREE.UnsignedShortType:return at.UNSIGNED_SHORT;case THREE.IntType:return at.INT;case THREE.UnsignedShortType:return at.UNSIGNED_INT;case THREE.FloatType:return at.FLOAT;case THREE.AlphaFormat:return at.ALPHA;case THREE.RGBFormat:return at.RGB;case THREE.RGBAFormat:return at.RGBA;case THREE.LuminanceFormat:return at.LUMINANCE;case THREE.LuminanceAlphaFormat:return at.LUMINANCE_ALPHA}return 0}var aL=this,at,az=[],ad=null,Z=null,aK=-1,aG=null,aO=0,aE=null,aC=null,aD=null,aZ=null,aM=null,a6=null,H=null,L=null,aT=0,a0=0,ar=0,aW=0,aN=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],B=new THREE.Matrix4,a4=new Float32Array(16),aX=new Float32Array(16),ax=new THREE.Vector4,x={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},ay=ay||{},aP=ay.canvas!==void 0?ay.canvas:document.createElement("canvas"),aF=ay.stencil!==void 0?ay.stencil:!0,al=ay.preserveDrawingBuffer!==void 0?ay.preserveDrawingBuffer:!1,P=ay.antialias!==void 0?ay.antialias:!1,aB=ay.clearColor!==void 0?new THREE.Color(ay.clearColor):new THREE.Color(0),a8=ay.clearAlpha!==void 0?ay.clearAlpha:0,O=ay.maxLights!==void 0?ay.maxLights:4;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0}};this.maxMorphTargets=8;this.domElement=aP;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.shadowMapBias=0.0039;this.shadowMapDarkness=0.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCameraNear=1;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowMap=[];this.shadowMapEnabled=!1;this.shadowMapSoft=!0;var a9,v=[],ay=THREE.ShaderLib.depthRGBA,aY=THREE.UniformsUtils.clone(ay.uniforms),aA=new THREE.ShaderMaterial({fragmentShader:ay.fragmentShader,vertexShader:ay.vertexShader,uniforms:aY}),a5=new THREE.ShaderMaterial({fragmentShader:ay.fragmentShader,vertexShader:ay.vertexShader,uniforms:aY,morphTargets:!0});aA._shadowPass=!0;a5._shadowPass=!0;try{if(!(at=aP.getContext("experimental-webgl",{antialias:P,stencil:aF,preserveDrawingBuffer:al}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+at.getParameter(at.VERSION)+" | "+at.getParameter(at.VENDOR)+" | "+at.getParameter(at.RENDERER)+" | "+at.getParameter(at.SHADING_LANGUAGE_VERSION))}catch(z){console.error(z)}at.clearColor(0,0,0,1);at.clearDepth(1);at.clearStencil(0);at.enable(at.DEPTH_TEST);at.depthFunc(at.LEQUAL);at.frontFace(at.CCW);at.cullFace(at.BACK);at.enable(at.CULL_FACE);at.enable(at.BLEND);at.blendEquation(at.FUNC_ADD);at.blendFunc(at.SRC_ALPHA,at.ONE_MINUS_SRC_ALPHA);at.clearColor(aB.r,aB.g,aB.b,a8);this.context=at;var aJ=at.getParameter(at.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,af={};af.vertices=new Float32Array(16);af.faces=new Uint16Array(6);aF=0;af.vertices[aF++]=-1;af.vertices[aF++]=-1;af.vertices[aF++]=0;af.vertices[aF++]=1;af.vertices[aF++]=1;af.vertices[aF++]=-1;af.vertices[aF++]=1;af.vertices[aF++]=1;af.vertices[aF++]=1;af.vertices[aF++]=1;af.vertices[aF++]=1;af.vertices[aF++]=0;af.vertices[aF++]=-1;af.vertices[aF++]=1;af.vertices[aF++]=0;aF=af.vertices[aF++]=0;af.faces[aF++]=0;af.faces[aF++]=1;af.faces[aF++]=2;af.faces[aF++]=0;af.faces[aF++]=2;af.faces[aF++]=3;af.vertexBuffer=at.createBuffer();af.elementBuffer=at.createBuffer();at.bindBuffer(at.ARRAY_BUFFER,af.vertexBuffer);at.bufferData(at.ARRAY_BUFFER,af.vertices,at.STATIC_DRAW);at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,af.elementBuffer);at.bufferData(at.ELEMENT_ARRAY_BUFFER,af.faces,at.STATIC_DRAW);af.program=at.createProgram();at.attachShader(af.program,a1("fragment",THREE.ShaderLib.sprite.fragmentShader));at.attachShader(af.program,a1("vertex",THREE.ShaderLib.sprite.vertexShader));at.linkProgram(af.program);af.attributes={};af.uniforms={};af.attributes.position=at.getAttribLocation(af.program,"position");af.attributes.uv=at.getAttribLocation(af.program,"uv");af.uniforms.uvOffset=at.getUniformLocation(af.program,"uvOffset");af.uniforms.uvScale=at.getUniformLocation(af.program,"uvScale");af.uniforms.rotation=at.getUniformLocation(af.program,"rotation");af.uniforms.scale=at.getUniformLocation(af.program,"scale");af.uniforms.alignment=at.getUniformLocation(af.program,"alignment");af.uniforms.color=at.getUniformLocation(af.program,"color");af.uniforms.map=at.getUniformLocation(af.program,"map");af.uniforms.opacity=at.getUniformLocation(af.program,"opacity");af.uniforms.useScreenCoordinates=at.getUniformLocation(af.program,"useScreenCoordinates");af.uniforms.affectedByDistance=at.getUniformLocation(af.program,"affectedByDistance");af.uniforms.screenPosition=at.getUniformLocation(af.program,"screenPosition");af.uniforms.modelViewMatrix=at.getUniformLocation(af.program,"modelViewMatrix");af.uniforms.projectionMatrix=at.getUniformLocation(af.program,"projectionMatrix");var aU=!1;this.setSize=function(e,f){aP.width=e;aP.height=f;this.setViewport(0,0,aP.width,aP.height)};this.setViewport=function(f,m,k,h){aT=f;a0=m;ar=k;aW=h;at.viewport(aT,a0,ar,aW)};this.setScissor=function(f,m,k,h){at.scissor(f,m,k,h)};this.enableScissorTest=function(c){c?at.enable(at.SCISSOR_TEST):at.disable(at.SCISSOR_TEST)};this.setClearColorHex=function(e,f){aB.setHex(e);a8=f;at.clearColor(aB.r,aB.g,aB.b,a8)};this.setClearColor=function(e,f){aB.copy(e);a8=f;at.clearColor(aB.r,aB.g,aB.b,a8)};this.getClearColor=function(){return aB};this.getClearAlpha=function(){return a8};this.clear=function(f,m,k){var h=0;if(f==void 0||f){h|=at.COLOR_BUFFER_BIT}if(m==void 0||m){h|=at.DEPTH_BUFFER_BIT}if(k==void 0||k){h|=at.STENCIL_BUFFER_BIT}at.clear(h)};this.getContext=function(){return at};this.deallocateObject=function(f){if(f.__webglInit){if(f.__webglInit=!1,delete f._modelViewMatrix,delete f._normalMatrixArray,delete f._modelViewMatrixArray,delete f._objectMatrixArray,f instanceof THREE.Mesh){for(g in f.geometry.geometryGroups){var m=f.geometry.geometryGroups[g];at.deleteBuffer(m.__webglVertexBuffer);at.deleteBuffer(m.__webglNormalBuffer);at.deleteBuffer(m.__webglTangentBuffer);at.deleteBuffer(m.__webglColorBuffer);at.deleteBuffer(m.__webglUVBuffer);at.deleteBuffer(m.__webglUV2Buffer);at.deleteBuffer(m.__webglSkinVertexABuffer);at.deleteBuffer(m.__webglSkinVertexBBuffer);at.deleteBuffer(m.__webglSkinIndicesBuffer);at.deleteBuffer(m.__webglSkinWeightsBuffer);at.deleteBuffer(m.__webglFaceBuffer);at.deleteBuffer(m.__webglLineBuffer);if(m.numMorphTargets){for(var k=0,h=m.numMorphTargets;k<h;k++){at.deleteBuffer(m.__webglMorphTargetsBuffers[k])}}aL.info.memory.geometries--}}else{if(f instanceof THREE.Ribbon){f=f.geometry,at.deleteBuffer(f.__webglVertexBuffer),at.deleteBuffer(f.__webglColorBuffer),aL.info.memory.geometries--}else{if(f instanceof THREE.Line){f=f.geometry,at.deleteBuffer(f.__webglVertexBuffer),at.deleteBuffer(f.__webglColorBuffer),aL.info.memory.geometries--}else{if(f instanceof THREE.ParticleSystem){f=f.geometry,at.deleteBuffer(f.__webglVertexBuffer),at.deleteBuffer(f.__webglColorBuffer),aL.info.memory.geometries--}}}}}};this.deallocateTexture=function(c){if(c.__webglInit){c.__webglInit=!1,at.deleteTexture(c.__webglTexture),aL.info.memory.textures--}};this.initMaterial=function(S,R,N,M){var J,I,G,E;S instanceof THREE.MeshDepthMaterial?E="depth":S instanceof THREE.MeshNormalMaterial?E="normal":S instanceof THREE.MeshBasicMaterial?E="basic":S instanceof THREE.MeshLambertMaterial?E="lambert":S instanceof THREE.MeshPhongMaterial?E="phong":S instanceof THREE.LineBasicMaterial?E="basic":S instanceof THREE.ParticleBasicMaterial&&(E="particle_basic");if(E){var C=THREE.ShaderLib[E];S.uniforms=THREE.UniformsUtils.clone(C.uniforms);S.vertexShader=C.vertexShader;S.fragmentShader=C.fragmentShader}var D,y,w;D=w=C=0;for(y=R.length;D<y;D++){G=R[D],G instanceof THREE.SpotLight&&w++,G instanceof THREE.DirectionalLight&&w++,G instanceof THREE.PointLight&&C++}C+w<=O?D=w:(D=Math.ceil(O*w/(C+w)),C=O-D);G={directional:D,point:C};C=w=0;for(D=R.length;C<D;C++){y=R[C],y instanceof THREE.SpotLight&&y.castShadow&&w++}var V=50;if(M!==void 0&&M instanceof THREE.SkinnedMesh){V=M.bones.length}var T;a:{D=S.fragmentShader;y=S.vertexShader;var C=S.uniforms,R=S.attributes,N={map:!!S.map,envMap:!!S.envMap,lightMap:!!S.lightMap,vertexColors:S.vertexColors,fog:N,useFog:S.fog,sizeAttenuation:S.sizeAttenuation,skinning:S.skinning,morphTargets:S.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:G.directional,maxPointLights:G.point,maxBones:V,shadowMapEnabled:this.shadowMapEnabled&&M.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:w,alphaTest:S.alphaTest},f,M=[];E?M.push(E):(M.push(D),M.push(y));for(f in N){M.push(f),M.push(N[f])}E=M.join();f=0;for(M=az.length;f<M;f++){if(az[f].code==E){T=az[f].program;break a}}f=at.createProgram();M=[aJ?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+N.maxDirLights,"#define MAX_POINT_LIGHTS "+N.maxPointLights,"#define MAX_SHADOWS "+N.maxShadows,"#define MAX_BONES "+N.maxBones,N.map?"#define USE_MAP":"",N.envMap?"#define USE_ENVMAP":"",N.lightMap?"#define USE_LIGHTMAP":"",N.vertexColors?"#define USE_COLOR":"",N.skinning?"#define USE_SKINNING":"",N.morphTargets?"#define USE_MORPHTARGETS":"",N.shadowMapEnabled?"#define USE_SHADOWMAP":"",N.shadowMapSoft?"#define SHADOWMAP_SOFT":"",N.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");G=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+N.maxDirLights,"#define MAX_POINT_LIGHTS "+N.maxPointLights,"#define MAX_SHADOWS "+N.maxShadows,N.alphaTest?"#define ALPHATEST "+N.alphaTest:"",N.useFog&&N.fog?"#define USE_FOG":"",N.useFog&&N.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",N.map?"#define USE_MAP":"",N.envMap?"#define USE_ENVMAP":"",N.lightMap?"#define USE_LIGHTMAP":"",N.vertexColors?"#define USE_COLOR":"",N.shadowMapEnabled?"#define USE_SHADOWMAP":"",N.shadowMapSoft?"#define SHADOWMAP_SOFT":"",N.shadowMapSoft?"#define SHADOWMAP_WIDTH "+N.shadowMapWidth.toFixed(1):"",N.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+N.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");at.attachShader(f,a1("fragment",G+D));at.attachShader(f,a1("vertex",M+y));at.linkProgram(f);at.getProgramParameter(f,at.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+at.getProgramParameter(f,at.VALIDATE_STATUS)+", gl error ["+at.getError()+"]");f.uniforms={};f.attributes={};var U,M=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(U in C){M.push(U)}U=M;M=0;for(C=U.length;M<C;M++){D=U[M],f.uniforms[D]=at.getUniformLocation(f,D)}M=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(U=0;U<N.maxMorphTargets;U++){M.push("morphTarget"+U)}for(T in R){M.push(T)}T=M;U=0;for(R=T.length;U<R;U++){N=T[U],f.attributes[N]=at.getAttribLocation(f,N)}f.id=az.length;az.push({program:f,code:E});aL.info.memory.programs=az.length;T=f}S.program=T;T=S.program.attributes;T.position>=0&&at.enableVertexAttribArray(T.position);T.color>=0&&at.enableVertexAttribArray(T.color);T.normal>=0&&at.enableVertexAttribArray(T.normal);T.tangent>=0&&at.enableVertexAttribArray(T.tangent);S.skinning&&T.skinVertexA>=0&&T.skinVertexB>=0&&T.skinIndex>=0&&T.skinWeight>=0&&(at.enableVertexAttribArray(T.skinVertexA),at.enableVertexAttribArray(T.skinVertexB),at.enableVertexAttribArray(T.skinIndex),at.enableVertexAttribArray(T.skinWeight));if(S.attributes){for(I in S.attributes){T[I]!==void 0&&T[I]>=0&&at.enableVertexAttribArray(T[I])}}if(S.morphTargets){for(I=S.numSupportedMorphTargets=0;I<this.maxMorphTargets;I++){U="morphTarget"+I,T[U]>=0&&(at.enableVertexAttribArray(T[U]),S.numSupportedMorphTargets++)}}S.uniformsList=[];for(J in S.uniforms){S.uniformsList.push([S.uniforms[J],J])}};this.clearTarget=function(e,m,k,h){aI(e);this.clear(m,k,h)};this.render=function(w,p,f,e){var E,G,y,t,o,C,h,J,k=w.lights,D=w.fog;aK=-1;this.shadowMapEnabled&&aV(w,p);aL.info.render.calls=0;aL.info.render.vertices=0;aL.info.render.faces=0;p.matrixAutoUpdate&&p.update(void 0,!0);w.update(void 0,!1,p);p.matrixWorldInverse.flattenToArray(aX);p.projectionMatrix.flattenToArray(a4);B.multiply(p.projectionMatrix,p.matrixWorldInverse);ak(B);this.initWebGLObjects(w);aI(f);(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);o=w.__webglObjects.length;for(e=0;e<o;e++){if(E=w.__webglObjects[e],h=E.object,h.visible){if(!(h instanceof THREE.Mesh)||!h.frustumCulled||ai(h)){if(h.matrixWorld.flattenToArray(h._objectMatrixArray),aS(h,p,!0),ae(E),E.render=!0,this.sortObjects){E.object.renderDepth?E.z=E.object.renderDepth:(ax.copy(h.position),B.multiplyVector3(ax),E.z=ax.z)}}else{E.render=!1}}else{E.render=!1}}this.sortObjects&&w.__webglObjects.sort(ac);C=w.__webglObjectsImmediate.length;for(e=0;e<C;e++){E=w.__webglObjectsImmediate[e],h=E.object,h.visible&&(h.matrixAutoUpdate&&h.matrixWorld.flattenToArray(h._objectMatrixArray),aS(h,p,!0),ag(E))}if(w.overrideMaterial){ao(w.overrideMaterial.depthTest);aQ(w.overrideMaterial.blending);for(e=0;e<o;e++){if(E=w.__webglObjects[e],E.render){h=E.object,J=E.buffer,aq(h),au(p,k,D,w.overrideMaterial,J,h)}}for(e=0;e<C;e++){E=w.__webglObjectsImmediate[e],h=E.object,h.visible&&(aG=-1,aq(h),G=av(p,k,D,w.overrideMaterial,h),h.immediateRenderCallback?h.immediateRenderCallback(G,at,aN):h.render(function(b){ap(b,G,w.overrideMaterial.shading)}))}}else{aQ(THREE.NormalBlending);for(e=o-1;e>=0;e--){if(E=w.__webglObjects[e],E.render){h=E.object;J=E.buffer;y=E.opaque;aq(h);for(E=0;E<y.count;E++){t=y.list[E],ao(t.depthTest),an(t.depthWrite),aj(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),au(p,k,D,t,J,h)}}}for(e=0;e<C;e++){if(E=w.__webglObjectsImmediate[e],h=E.object,h.visible){aG=-1;y=E.opaque;aq(h);for(E=0;E<y.count;E++){t=y.list[E],ao(t.depthTest),an(t.depthWrite),aj(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),G=av(p,k,D,t,h),h.immediateRenderCallback?h.immediateRenderCallback(G,at,aN):h.render(function(c){ap(c,G,t.shading)})}}}for(e=0;e<o;e++){if(E=w.__webglObjects[e],E.render){h=E.object;J=E.buffer;y=E.transparent;aq(h);for(E=0;E<y.count;E++){t=y.list[E],aQ(t.blending),ao(t.depthTest),an(t.depthWrite),aj(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),au(p,k,D,t,J,h)}}}for(e=0;e<C;e++){if(E=w.__webglObjectsImmediate[e],h=E.object,h.visible){aG=-1;y=E.transparent;aq(h);for(E=0;E<y.count;E++){t=y.list[E],aQ(t.blending),ao(t.depthTest),an(t.depthWrite),aj(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),G=av(p,k,D,t,h),h.immediateRenderCallback?h.immediateRenderCallback(G,at,aN):h.render(function(c){ap(c,G,t.shading)})}}}}w.__webglSprites.length&&aR(w,p);f&&f.minFilter!==THREE.NearestFilter&&f.minFilter!==THREE.LinearFilter&&a7(f)};this.initWebGLObjects=function(bE){if(!bE.__webglObjects){bE.__webglObjects=[],bE.__webglObjectsImmediate=[],bE.__webglSprites=[]}for(;bE.__objectsAdded.length;){var bB=bE.__objectsAdded[0],bA=bE,by=void 0,bw=void 0,bv=void 0;if(!bB.__webglInit){if(bB.__webglInit=!0,bB._modelViewMatrix=new THREE.Matrix4,bB._normalMatrixArray=new Float32Array(9),bB._modelViewMatrixArray=new Float32Array(16),bB._objectMatrixArray=new Float32Array(16),bB.matrixWorld.flattenToArray(bB._objectMatrixArray),bB instanceof THREE.Mesh){for(by in bw=bB.geometry,bw.geometryGroups==void 0&&a2(bw),bw.geometryGroups){if(bv=bw.geometryGroups[by],!bv.__webglVertexBuffer){var bu=bv;bu.__webglVertexBuffer=at.createBuffer();bu.__webglNormalBuffer=at.createBuffer();bu.__webglTangentBuffer=at.createBuffer();bu.__webglColorBuffer=at.createBuffer();bu.__webglUVBuffer=at.createBuffer();bu.__webglUV2Buffer=at.createBuffer();bu.__webglSkinVertexABuffer=at.createBuffer();bu.__webglSkinVertexBBuffer=at.createBuffer();bu.__webglSkinIndicesBuffer=at.createBuffer();bu.__webglSkinWeightsBuffer=at.createBuffer();bu.__webglFaceBuffer=at.createBuffer();bu.__webglLineBuffer=at.createBuffer();if(bu.numMorphTargets){var bq=void 0,bt=void 0;bu.__webglMorphTargetsBuffers=[];bq=0;for(bt=bu.numMorphTargets;bq<bt;bq++){bu.__webglMorphTargetsBuffers.push(at.createBuffer())}}aL.info.memory.geometries++;for(var bu=bB,bp=void 0,bo=void 0,bn=void 0,bk=bn=void 0,bi=void 0,bj=void 0,bh=bj=bq=0,bf=bn=bo=void 0,bn=bt=bf=bo=bp=void 0,bk=bu.geometry,bi=bk.faces,bf=bv.faces,bp=0,bo=bf.length;bp<bo;bp++){bn=bf[bp],bn=bi[bn],bn instanceof THREE.Face3?(bq+=3,bj+=1,bh+=3):bn instanceof THREE.Face4&&(bq+=4,bj+=2,bh+=4)}for(var bp=bv,bo=bu,b3=bf=bi=void 0,bY=void 0,b3=void 0,bn=[],bi=0,bf=bo.materials.length;bi<bf;bi++){if(b3=bo.materials[bi],b3 instanceof THREE.MeshFaceMaterial){b3=0;for(l=bp.materials.length;b3<l;b3++){(bY=bp.materials[b3])&&bn.push(bY)}}else{(bY=b3)&&bn.push(bY)}}bp=bn;bv.__materials=bp;a:{bi=bo=void 0;bf=bp.length;for(bo=0;bo<bf;bo++){if(bi=bp[bo],bi.map||bi.lightMap||bi instanceof THREE.ShaderMaterial){bo=!0;break a}}bo=!1}a:{bf=bi=void 0;bn=bp.length;for(bi=0;bi<bn;bi++){if(bf=bp[bi],!(bf instanceof THREE.MeshBasicMaterial&&!bf.envMap||bf instanceof THREE.MeshDepthMaterial)){bf=bf&&bf.shading!=void 0&&bf.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}bf=!1}a:{bn=bi=void 0;b3=bp.length;for(bi=0;bi<b3;bi++){if(bn=bp[bi],bn.vertexColors){bn=bn.vertexColors;break a}}bn=!1}bv.__vertexArray=new Float32Array(bq*3);if(bf){bv.__normalArray=new Float32Array(bq*3)}if(bk.hasTangents){bv.__tangentArray=new Float32Array(bq*4)}if(bn){bv.__colorArray=new Float32Array(bq*3)}if(bo){if(bk.faceUvs.length>0||bk.faceVertexUvs.length>0){bv.__uvArray=new Float32Array(bq*2)}if(bk.faceUvs.length>1||bk.faceVertexUvs.length>1){bv.__uv2Array=new Float32Array(bq*2)}}if(bu.geometry.skinWeights.length&&bu.geometry.skinIndices.length){bv.__skinVertexAArray=new Float32Array(bq*4),bv.__skinVertexBArray=new Float32Array(bq*4),bv.__skinIndexArray=new Float32Array(bq*4),bv.__skinWeightArray=new Float32Array(bq*4)}bv.__faceArray=new Uint16Array(bj*3+(bu.geometry.edgeFaces?bu.geometry.edgeFaces.length*6:0));bv.__lineArray=new Uint16Array(bh*2);if(bv.numMorphTargets){bv.__morphTargetsArrays=[];bk=0;for(bi=bv.numMorphTargets;bk<bi;bk++){bv.__morphTargetsArrays.push(new Float32Array(bq*3))}}bv.__needsSmoothNormals=bf==THREE.SmoothShading;bv.__uvType=bo;bv.__vertexColorType=bn;bv.__normalType=bf;bv.__webglFaceCount=bj*3+(bu.geometry.edgeFaces?bu.geometry.edgeFaces.length*6:0);bv.__webglLineCount=bh*2;bk=0;for(bi=bp.length;bk<bi;bk++){if(bo=bp[bk],bo.attributes){if(bv.__webglCustomAttributes===void 0){bv.__webglCustomAttributes={}}for(a in bo.attributes){bn=bo.attributes[a];bf={};for(bt in bn){bf[bt]=bn[bt]}if(!bf.__webglInitialized||bf.createUniqueBuffers){bf.__webglInitialized=!0,bj=1,bf.type==="v2"?bj=2:bf.type==="v3"?bj=3:bf.type==="v4"?bj=4:bf.type==="c"&&(bj=3),bf.size=bj,bf.array=new Float32Array(bq*bj),bf.buffer=at.createBuffer(),bf.buffer.belongsToAttribute=a,bn.needsUpdate=!0,bf.__original=bn}bv.__webglCustomAttributes[a]=bf}}}bv.__inittedArrays=!0;bw.__dirtyVertices=!0;bw.__dirtyMorphTargets=!0;bw.__dirtyElements=!0;bw.__dirtyUvs=!0;bw.__dirtyNormals=!0;bw.__dirtyTangents=!0;bw.__dirtyColors=!0}}}else{if(bB instanceof THREE.Ribbon){if(bw=bB.geometry,!bw.__webglVertexBuffer){bv=bw,bv.__webglVertexBuffer=at.createBuffer(),bv.__webglColorBuffer=at.createBuffer(),aL.info.memory.geometries++,bv=bw,bu=bv.vertices.length,bv.__vertexArray=new Float32Array(bu*3),bv.__colorArray=new Float32Array(bu*3),bv.__webglVertexCount=bu,bw.__dirtyVertices=!0,bw.__dirtyColors=!0}}else{if(bB instanceof THREE.Line){if(bw=bB.geometry,!bw.__webglVertexBuffer){bv=bw,bv.__webglVertexBuffer=at.createBuffer(),bv.__webglColorBuffer=at.createBuffer(),aL.info.memory.geometries++,bv=bw,bu=bv.vertices.length,bv.__vertexArray=new Float32Array(bu*3),bv.__colorArray=new Float32Array(bu*3),bv.__webglLineCount=bu,bw.__dirtyVertices=!0,bw.__dirtyColors=!0}}else{if(bB instanceof THREE.ParticleSystem&&(bw=bB.geometry,!bw.__webglVertexBuffer)){bv=bw;bv.__webglVertexBuffer=at.createBuffer();bv.__webglColorBuffer=at.createBuffer();aL.info.geometries++;bv=bw;bu=bB;bq=bv.vertices.length;bv.__vertexArray=new Float32Array(bq*3);bv.__colorArray=new Float32Array(bq*3);bv.__sortArray=[];bv.__webglParticleCount=bq;bv.__materials=bu.materials;bh=bj=bt=void 0;bt=0;for(bj=bu.materials.length;bt<bj;bt++){if(bh=bu.materials[bt],bh.attributes){if(bv.__webglCustomAttributes===void 0){bv.__webglCustomAttributes={}}for(a in bh.attributes){originalAttribute=bh.attributes[a];attribute={};for(property in originalAttribute){attribute[property]=originalAttribute[property]}if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=!0,size=1,attribute.type==="v2"?size=2:attribute.type==="v3"?size=3:attribute.type==="v4"?size=4:attribute.type==="c"&&(size=3),attribute.size=size,attribute.array=new Float32Array(bq*size),attribute.buffer=at.createBuffer(),attribute.buffer.belongsToAttribute=a,originalAttribute.needsUpdate=!0,attribute.__original=originalAttribute}bv.__webglCustomAttributes[a]=attribute}}}bw.__dirtyVertices=!0;bw.__dirtyColors=!0}}}}}if(!bB.__webglActive){if(bB instanceof THREE.Mesh){for(by in bw=bB.geometry,bw.geometryGroups){bv=bw.geometryGroups[by],Q(bA.__webglObjects,bv,bB)}}else{bB instanceof THREE.Ribbon||bB instanceof THREE.Line||bB instanceof THREE.ParticleSystem?(bw=bB.geometry,Q(bA.__webglObjects,bw,bB)):THREE.MarchingCubes!==void 0&&bB instanceof THREE.MarchingCubes||bB.immediateRenderCallback?bA.__webglObjectsImmediate.push({object:bB,opaque:{list:[],count:0},transparent:{list:[],count:0}}):bB instanceof THREE.Sprite&&bA.__webglSprites.push(bB)}bB.__webglActive=!0}bE.__objectsAdded.splice(0,1)}for(;bE.__objectsRemoved.length;){bB=bE.__objectsRemoved[0];bA=bE;if(bB instanceof THREE.Mesh||bB instanceof THREE.ParticleSystem||bB instanceof THREE.Ribbon||bB instanceof THREE.Line){F(bA.__webglObjects,bB)}else{if(bB instanceof THREE.Sprite){bA=bA.__webglSprites;by=bB;bw=void 0;for(bw=bA.length-1;bw>=0;bw--){bA[bw]==by&&bA.splice(bw,1)}}else{(bB instanceof THREE.MarchingCubes||bB.immediateRenderCallback)&&F(bA.__webglObjectsImmediate,bB)}}bB.__webglActive=!1;bE.__objectsRemoved.splice(0,1)}bB=0;for(bA=bE.__webglObjects.length;bB<bA;bB++){if(bw=bE.__webglObjects[bB].object,bt=bv=by=void 0,bw instanceof THREE.Mesh){by=bw.geometry;bu=0;for(bq=by.geometryGroupsList.length;bu<bq;bu++){if(bv=by.geometryGroupsList[bu],bt=K(bv),by.__dirtyVertices||by.__dirtyMorphTargets||by.__dirtyElements||by.__dirtyUvs||by.__dirtyNormals||by.__dirtyColors||by.__dirtyTangents||bt){if(bt=bv,bj=at.DYNAMIC_DRAW,bh=!by.dynamic,bt.__inittedArrays){var b1=bp=bk=void 0,b5=void 0,bX=b1=void 0,bZ=void 0,bV=void 0,bS=void 0,bQ=bY=b3=bn=bf=bi=bo=void 0,bP=void 0,bT=void 0,bl=b5=bS=b5=bV=bZ=void 0,br=void 0,b4=br=bl=bZ=void 0,bO=void 0,bL=b4=br=bl=b1=b1=bX=bS=b5=b4=br=bl=bO=b4=br=bl=bO=b4=br=bl=void 0,bx=0,bR=0,bI=0,cf=0,bK=0,bN=0,bG=0,bM=0,cd=0,bg=0,b0=0,b4=bl=0,b4=void 0,bC=bt.__vertexArray,f=bt.__uvArray,ck=bt.__uv2Array,bJ=bt.__normalArray,bs=bt.__tangentArray,bc=bt.__colorArray,bb=bt.__skinVertexAArray,c=bt.__skinVertexBArray,ci=bt.__skinIndexArray,cb=bt.__skinWeightArray,cm=bt.__morphTargetsArrays,b9=bt.__webglCustomAttributes,br=void 0,bU=bt.__faceArray,bH=bt.__lineArray,ch=bt.__needsSmoothNormals,bi=bt.__vertexColorType,bo=bt.__uvType,bf=bt.__normalType,b6=bw.geometry,be=b6.__dirtyVertices,b8=b6.__dirtyElements,bF=b6.__dirtyUvs,cj=b6.__dirtyNormals,cc=b6.__dirtyTangents,bz=b6.__dirtyColors,M=b6.__dirtyMorphTargets,bW=b6.vertices,cl=bt.faces,ab=b6.faces,b2=b6.faceVertexUvs[0],bD=b6.faceVertexUvs[1],cn=b6.skinVerticesA,cg=b6.skinVerticesB,b7=b6.skinIndices,bd=b6.skinWeights,ce=b6.morphTargets;if(b9){for(bL in b9){b9[bL].offset=0,b9[bL].offsetSrc=0}}bk=0;for(bp=cl.length;bk<bp;bk++){if(b1=cl[bk],b5=ab[b1],b2&&(bn=b2[b1]),bD&&(b3=bD[b1]),b1=b5.vertexNormals,bX=b5.normal,bZ=b5.vertexColors,bV=b5.color,bS=b5.vertexTangents,b5 instanceof THREE.Face3){if(be){bY=bW[b5.a].position,bQ=bW[b5.b].position,bP=bW[b5.c].position,bC[bR]=bY.x,bC[bR+1]=bY.y,bC[bR+2]=bY.z,bC[bR+3]=bQ.x,bC[bR+4]=bQ.y,bC[bR+5]=bQ.z,bC[bR+6]=bP.x,bC[bR+7]=bP.y,bC[bR+8]=bP.z,bR+=9}if(b9){for(bL in b9){if(br=b9[bL],br.__original.needsUpdate){bl=br.offset,b4=br.offsetSrc,br.size===1?(br.boundTo===void 0||br.boundTo==="vertices"?(br.array[bl]=br.value[b5.a],br.array[bl+1]=br.value[b5.b],br.array[bl+2]=br.value[b5.c]):br.boundTo==="faces"?(b4=br.value[b4],br.array[bl]=b4,br.array[bl+1]=b4,br.array[bl+2]=b4,br.offsetSrc++):br.boundTo==="faceVertices"&&(br.array[bl]=br.value[b4],br.array[bl+1]=br.value[b4+1],br.array[bl+2]=br.value[b4+2],br.offsetSrc+=3),br.offset+=3):(br.boundTo===void 0||br.boundTo==="vertices"?(bY=br.value[b5.a],bQ=br.value[b5.b],bP=br.value[b5.c]):br.boundTo==="faces"?(bP=bQ=bY=b4=br.value[b4],br.offsetSrc++):br.boundTo==="faceVertices"&&(bY=br.value[b4],bQ=br.value[b4+1],bP=br.value[b4+2],br.offsetSrc+=3),br.size===2?(br.array[bl]=bY.x,br.array[bl+1]=bY.y,br.array[bl+2]=bQ.x,br.array[bl+3]=bQ.y,br.array[bl+4]=bP.x,br.array[bl+5]=bP.y,br.offset+=6):br.size===3?(br.type==="c"?(br.array[bl]=bY.r,br.array[bl+1]=bY.g,br.array[bl+2]=bY.b,br.array[bl+3]=bQ.r,br.array[bl+4]=bQ.g,br.array[bl+5]=bQ.b,br.array[bl+6]=bP.r,br.array[bl+7]=bP.g,br.array[bl+8]=bP.b):(br.array[bl]=bY.x,br.array[bl+1]=bY.y,br.array[bl+2]=bY.z,br.array[bl+3]=bQ.x,br.array[bl+4]=bQ.y,br.array[bl+5]=bQ.z,br.array[bl+6]=bP.x,br.array[bl+7]=bP.y,br.array[bl+8]=bP.z),br.offset+=9):(br.array[bl]=bY.x,br.array[bl+1]=bY.y,br.array[bl+2]=bY.z,br.array[bl+3]=bY.w,br.array[bl+4]=bQ.x,br.array[bl+5]=bQ.y,br.array[bl+6]=bQ.z,br.array[bl+7]=bQ.w,br.array[bl+8]=bP.x,br.array[bl+9]=bP.y,br.array[bl+10]=bP.z,br.array[bl+11]=bP.w,br.offset+=12))}}}if(M){bl=0;for(br=ce.length;bl<br;bl++){bY=ce[bl].vertices[b5.a].position,bQ=ce[bl].vertices[b5.b].position,bP=ce[bl].vertices[b5.c].position,b4=cm[bl],b4[b0]=bY.x,b4[b0+1]=bY.y,b4[b0+2]=bY.z,b4[b0+3]=bQ.x,b4[b0+4]=bQ.y,b4[b0+5]=bQ.z,b4[b0+6]=bP.x,b4[b0+7]=bP.y,b4[b0+8]=bP.z}b0+=9}if(bd.length){bl=bd[b5.a],br=bd[b5.b],b4=bd[b5.c],cb[bg]=bl.x,cb[bg+1]=bl.y,cb[bg+2]=bl.z,cb[bg+3]=bl.w,cb[bg+4]=br.x,cb[bg+5]=br.y,cb[bg+6]=br.z,cb[bg+7]=br.w,cb[bg+8]=b4.x,cb[bg+9]=b4.y,cb[bg+10]=b4.z,cb[bg+11]=b4.w,bl=b7[b5.a],br=b7[b5.b],b4=b7[b5.c],ci[bg]=bl.x,ci[bg+1]=bl.y,ci[bg+2]=bl.z,ci[bg+3]=bl.w,ci[bg+4]=br.x,ci[bg+5]=br.y,ci[bg+6]=br.z,ci[bg+7]=br.w,ci[bg+8]=b4.x,ci[bg+9]=b4.y,ci[bg+10]=b4.z,ci[bg+11]=b4.w,bl=cn[b5.a],br=cn[b5.b],b4=cn[b5.c],bb[bg]=bl.x,bb[bg+1]=bl.y,bb[bg+2]=bl.z,bb[bg+3]=1,bb[bg+4]=br.x,bb[bg+5]=br.y,bb[bg+6]=br.z,bb[bg+7]=1,bb[bg+8]=b4.x,bb[bg+9]=b4.y,bb[bg+10]=b4.z,bb[bg+11]=1,bl=cg[b5.a],br=cg[b5.b],b4=cg[b5.c],c[bg]=bl.x,c[bg+1]=bl.y,c[bg+2]=bl.z,c[bg+3]=1,c[bg+4]=br.x,c[bg+5]=br.y,c[bg+6]=br.z,c[bg+7]=1,c[bg+8]=b4.x,c[bg+9]=b4.y,c[bg+10]=b4.z,c[bg+11]=1,bg+=12}if(bz&&bi){bZ.length==3&&bi==THREE.VertexColors?(b5=bZ[0],bl=bZ[1],br=bZ[2]):br=bl=b5=bV,bc[cd]=b5.r,bc[cd+1]=b5.g,bc[cd+2]=b5.b,bc[cd+3]=bl.r,bc[cd+4]=bl.g,bc[cd+5]=bl.b,bc[cd+6]=br.r,bc[cd+7]=br.g,bc[cd+8]=br.b,cd+=9}if(cc&&b6.hasTangents){bZ=bS[0],bV=bS[1],b5=bS[2],bs[bG]=bZ.x,bs[bG+1]=bZ.y,bs[bG+2]=bZ.z,bs[bG+3]=bZ.w,bs[bG+4]=bV.x,bs[bG+5]=bV.y,bs[bG+6]=bV.z,bs[bG+7]=bV.w,bs[bG+8]=b5.x,bs[bG+9]=b5.y,bs[bG+10]=b5.z,bs[bG+11]=b5.w,bG+=12}if(cj&&bf){if(b1.length==3&&ch){for(bS=0;bS<3;bS++){bX=b1[bS],bJ[bN]=bX.x,bJ[bN+1]=bX.y,bJ[bN+2]=bX.z,bN+=3}}else{for(bS=0;bS<3;bS++){bJ[bN]=bX.x,bJ[bN+1]=bX.y,bJ[bN+2]=bX.z,bN+=3}}}if(bF&&bn!==void 0&&bo){for(bS=0;bS<3;bS++){b1=bn[bS],f[bI]=b1.u,f[bI+1]=b1.v,bI+=2}}if(bF&&b3!==void 0&&bo){for(bS=0;bS<3;bS++){b1=b3[bS],ck[cf]=b1.u,ck[cf+1]=b1.v,cf+=2}}b8&&(bU[bK]=bx,bU[bK+1]=bx+1,bU[bK+2]=bx+2,bK+=3,bH[bM]=bx,bH[bM+1]=bx+1,bH[bM+2]=bx,bH[bM+3]=bx+2,bH[bM+4]=bx+1,bH[bM+5]=bx+2,bM+=6,bx+=3)}else{if(b5 instanceof THREE.Face4){if(be){bY=bW[b5.a].position,bQ=bW[b5.b].position,bP=bW[b5.c].position,bT=bW[b5.d].position,bC[bR]=bY.x,bC[bR+1]=bY.y,bC[bR+2]=bY.z,bC[bR+3]=bQ.x,bC[bR+4]=bQ.y,bC[bR+5]=bQ.z,bC[bR+6]=bP.x,bC[bR+7]=bP.y,bC[bR+8]=bP.z,bC[bR+9]=bT.x,bC[bR+10]=bT.y,bC[bR+11]=bT.z,bR+=12}if(b9){for(bL in b9){if(br=b9[bL],br.__original.needsUpdate){bl=br.offset,b4=br.offsetSrc,br.size===1?(br.boundTo===void 0||br.boundTo==="vertices"?(br.array[bl]=br.value[b5.a],br.array[bl+1]=br.value[b5.b],br.array[bl+2]=br.value[b5.c],br.array[bl+3]=br.value[b5.d]):br.boundTo==="faces"?(b4=br.value[b4],br.array[bl]=b4,br.array[bl+1]=b4,br.array[bl+2]=b4,br.array[bl+3]=b4,br.offsetSrc++):br.boundTo==="faceVertices"&&(br.array[bl]=br.value[b4],br.array[bl+1]=br.value[b4+1],br.array[bl+2]=br.value[b4+2],br.array[bl+3]=br.value[b4+3],br.offsetSrc+=4),br.offset+=4):(br.boundTo===void 0||br.boundTo==="vertices"?(bY=br.value[b5.a],bQ=br.value[b5.b],bP=br.value[b5.c],bT=br.value[b5.d]):br.boundTo==="faces"?(bT=bP=bQ=bY=b4=br.value[b4],br.offsetSrc++):br.boundTo==="faceVertices"&&(bY=br.value[b4],bQ=br.value[b4+1],bP=br.value[b4+2],bT=br.value[b4+3],br.offsetSrc+=4),br.size===2?(br.array[bl]=bY.x,br.array[bl+1]=bY.y,br.array[bl+2]=bQ.x,br.array[bl+3]=bQ.y,br.array[bl+4]=bP.x,br.array[bl+5]=bP.y,br.array[bl+6]=bT.x,br.array[bl+7]=bT.y,br.offset+=8):br.size===3?(br.type==="c"?(br.array[bl]=bY.r,br.array[bl+1]=bY.g,br.array[bl+2]=bY.b,br.array[bl+3]=bQ.r,br.array[bl+4]=bQ.g,br.array[bl+5]=bQ.b,br.array[bl+6]=bP.r,br.array[bl+7]=bP.g,br.array[bl+8]=bP.b,br.array[bl+9]=bT.r,br.array[bl+10]=bT.g,br.array[bl+11]=bT.b):(br.array[bl]=bY.x,br.array[bl+1]=bY.y,br.array[bl+2]=bY.z,br.array[bl+3]=bQ.x,br.array[bl+4]=bQ.y,br.array[bl+5]=bQ.z,br.array[bl+6]=bP.x,br.array[bl+7]=bP.y,br.array[bl+8]=bP.z,br.array[bl+9]=bT.x,br.array[bl+10]=bT.y,br.array[bl+11]=bT.z),br.offset+=12):(br.array[bl]=bY.x,br.array[bl+1]=bY.y,br.array[bl+2]=bY.z,br.array[bl+3]=bY.w,br.array[bl+4]=bQ.x,br.array[bl+5]=bQ.y,br.array[bl+6]=bQ.z,br.array[bl+7]=bQ.w,br.array[bl+8]=bP.x,br.array[bl+9]=bP.y,br.array[bl+10]=bP.z,br.array[bl+11]=bP.w,br.array[bl+12]=bT.x,br.array[bl+13]=bT.y,br.array[bl+14]=bT.z,br.array[bl+15]=bT.w,br.offset+=16))}}}if(M){bl=0;for(br=ce.length;bl<br;bl++){bY=ce[bl].vertices[b5.a].position,bQ=ce[bl].vertices[b5.b].position,bP=ce[bl].vertices[b5.c].position,bT=ce[bl].vertices[b5.d].position,b4=cm[bl],b4[b0]=bY.x,b4[b0+1]=bY.y,b4[b0+2]=bY.z,b4[b0+3]=bQ.x,b4[b0+4]=bQ.y,b4[b0+5]=bQ.z,b4[b0+6]=bP.x,b4[b0+7]=bP.y,b4[b0+8]=bP.z,b4[b0+9]=bT.x,b4[b0+10]=bT.y,b4[b0+11]=bT.z}b0+=12}if(bd.length){bl=bd[b5.a],br=bd[b5.b],b4=bd[b5.c],bO=bd[b5.d],cb[bg]=bl.x,cb[bg+1]=bl.y,cb[bg+2]=bl.z,cb[bg+3]=bl.w,cb[bg+4]=br.x,cb[bg+5]=br.y,cb[bg+6]=br.z,cb[bg+7]=br.w,cb[bg+8]=b4.x,cb[bg+9]=b4.y,cb[bg+10]=b4.z,cb[bg+11]=b4.w,cb[bg+12]=bO.x,cb[bg+13]=bO.y,cb[bg+14]=bO.z,cb[bg+15]=bO.w,bl=b7[b5.a],br=b7[b5.b],b4=b7[b5.c],bO=b7[b5.d],ci[bg]=bl.x,ci[bg+1]=bl.y,ci[bg+2]=bl.z,ci[bg+3]=bl.w,ci[bg+4]=br.x,ci[bg+5]=br.y,ci[bg+6]=br.z,ci[bg+7]=br.w,ci[bg+8]=b4.x,ci[bg+9]=b4.y,ci[bg+10]=b4.z,ci[bg+11]=b4.w,ci[bg+12]=bO.x,ci[bg+13]=bO.y,ci[bg+14]=bO.z,ci[bg+15]=bO.w,bl=cn[b5.a],br=cn[b5.b],b4=cn[b5.c],bO=cn[b5.d],bb[bg]=bl.x,bb[bg+1]=bl.y,bb[bg+2]=bl.z,bb[bg+3]=1,bb[bg+4]=br.x,bb[bg+5]=br.y,bb[bg+6]=br.z,bb[bg+7]=1,bb[bg+8]=b4.x,bb[bg+9]=b4.y,bb[bg+10]=b4.z,bb[bg+11]=1,bb[bg+12]=bO.x,bb[bg+13]=bO.y,bb[bg+14]=bO.z,bb[bg+15]=1,bl=cg[b5.a],br=cg[b5.b],b4=cg[b5.c],b5=cg[b5.d],c[bg]=bl.x,c[bg+1]=bl.y,c[bg+2]=bl.z,c[bg+3]=1,c[bg+4]=br.x,c[bg+5]=br.y,c[bg+6]=br.z,c[bg+7]=1,c[bg+8]=b4.x,c[bg+9]=b4.y,c[bg+10]=b4.z,c[bg+11]=1,c[bg+12]=b5.x,c[bg+13]=b5.y,c[bg+14]=b5.z,c[bg+15]=1,bg+=16}if(bz&&bi){bZ.length==4&&bi==THREE.VertexColors?(b5=bZ[0],bl=bZ[1],br=bZ[2],bZ=bZ[3]):bZ=br=bl=b5=bV,bc[cd]=b5.r,bc[cd+1]=b5.g,bc[cd+2]=b5.b,bc[cd+3]=bl.r,bc[cd+4]=bl.g,bc[cd+5]=bl.b,bc[cd+6]=br.r,bc[cd+7]=br.g,bc[cd+8]=br.b,bc[cd+9]=bZ.r,bc[cd+10]=bZ.g,bc[cd+11]=bZ.b,cd+=12}if(cc&&b6.hasTangents){bZ=bS[0],bV=bS[1],b5=bS[2],bS=bS[3],bs[bG]=bZ.x,bs[bG+1]=bZ.y,bs[bG+2]=bZ.z,bs[bG+3]=bZ.w,bs[bG+4]=bV.x,bs[bG+5]=bV.y,bs[bG+6]=bV.z,bs[bG+7]=bV.w,bs[bG+8]=b5.x,bs[bG+9]=b5.y,bs[bG+10]=b5.z,bs[bG+11]=b5.w,bs[bG+12]=bS.x,bs[bG+13]=bS.y,bs[bG+14]=bS.z,bs[bG+15]=bS.w,bG+=16}if(cj&&bf){if(b1.length==4&&ch){for(bS=0;bS<4;bS++){bX=b1[bS],bJ[bN]=bX.x,bJ[bN+1]=bX.y,bJ[bN+2]=bX.z,bN+=3}}else{for(bS=0;bS<4;bS++){bJ[bN]=bX.x,bJ[bN+1]=bX.y,bJ[bN+2]=bX.z,bN+=3}}}if(bF&&bn!==void 0&&bo){for(bS=0;bS<4;bS++){b1=bn[bS],f[bI]=b1.u,f[bI+1]=b1.v,bI+=2}}if(bF&&b3!==void 0&&bo){for(bS=0;bS<4;bS++){b1=b3[bS],ck[cf]=b1.u,ck[cf+1]=b1.v,cf+=2}}b8&&(bU[bK]=bx,bU[bK+1]=bx+1,bU[bK+2]=bx+3,bU[bK+3]=bx+1,bU[bK+4]=bx+2,bU[bK+5]=bx+3,bK+=6,bH[bM]=bx,bH[bM+1]=bx+1,bH[bM+2]=bx,bH[bM+3]=bx+3,bH[bM+4]=bx+1,bH[bM+5]=bx+2,bH[bM+6]=bx+2,bH[bM+7]=bx+3,bM+=8,bx+=4)}}}be&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglVertexBuffer),at.bufferData(at.ARRAY_BUFFER,bC,bj));if(b9){for(bL in b9){br=b9[bL],br.__original.needsUpdate&&(at.bindBuffer(at.ARRAY_BUFFER,br.buffer),at.bufferData(at.ARRAY_BUFFER,br.array,bj))}}if(M){bl=0;for(br=ce.length;bl<br;bl++){at.bindBuffer(at.ARRAY_BUFFER,bt.__webglMorphTargetsBuffers[bl]),at.bufferData(at.ARRAY_BUFFER,cm[bl],bj)}}bz&&cd>0&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglColorBuffer),at.bufferData(at.ARRAY_BUFFER,bc,bj));cj&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglNormalBuffer),at.bufferData(at.ARRAY_BUFFER,bJ,bj));cc&&b6.hasTangents&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglTangentBuffer),at.bufferData(at.ARRAY_BUFFER,bs,bj));bF&&bI>0&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglUVBuffer),at.bufferData(at.ARRAY_BUFFER,f,bj));bF&&cf>0&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglUV2Buffer),at.bufferData(at.ARRAY_BUFFER,ck,bj));b8&&(at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,bt.__webglFaceBuffer),at.bufferData(at.ELEMENT_ARRAY_BUFFER,bU,bj),at.bindBuffer(at.ELEMENT_ARRAY_BUFFER,bt.__webglLineBuffer),at.bufferData(at.ELEMENT_ARRAY_BUFFER,bH,bj));bg>0&&(at.bindBuffer(at.ARRAY_BUFFER,bt.__webglSkinVertexABuffer),at.bufferData(at.ARRAY_BUFFER,bb,bj),at.bindBuffer(at.ARRAY_BUFFER,bt.__webglSkinVertexBBuffer),at.bufferData(at.ARRAY_BUFFER,c,bj),at.bindBuffer(at.ARRAY_BUFFER,bt.__webglSkinIndicesBuffer),at.bufferData(at.ARRAY_BUFFER,ci,bj),at.bindBuffer(at.ARRAY_BUFFER,bt.__webglSkinWeightsBuffer),at.bufferData(at.ARRAY_BUFFER,cb,bj));bh&&(delete bt.__inittedArrays,delete bt.__colorArray,delete bt.__normalArray,delete bt.__tangentArray,delete bt.__uvArray,delete bt.__uv2Array,delete bt.__faceArray,delete bt.__vertexArray,delete bt.__lineArray,delete bt.__skinVertexAArray,delete bt.__skinVertexBArray,delete bt.__skinIndexArray,delete bt.__skinWeightArray)}}}by.__dirtyVertices=!1;by.__dirtyMorphTargets=!1;by.__dirtyElements=!1;by.__dirtyUvs=!1;by.__dirtyNormals=!1;by.__dirtyTangents=!1;by.__dirtyColors=!1;n(bv)}else{if(bw instanceof THREE.Ribbon){by=bw.geometry;if(by.__dirtyVertices||by.__dirtyColors){bw=by;bv=at.DYNAMIC_DRAW;bu=bk=bh=bh=void 0;bp=bw.vertices;bq=bw.colors;bo=bp.length;bt=bq.length;bi=bw.__vertexArray;bj=bw.__colorArray;bf=bw.__dirtyColors;if(bw.__dirtyVertices){for(bh=0;bh<bo;bh++){bk=bp[bh].position,bu=bh*3,bi[bu]=bk.x,bi[bu+1]=bk.y,bi[bu+2]=bk.z}at.bindBuffer(at.ARRAY_BUFFER,bw.__webglVertexBuffer);at.bufferData(at.ARRAY_BUFFER,bi,bv)}if(bf){for(bh=0;bh<bt;bh++){color=bq[bh],bu=bh*3,bj[bu]=color.r,bj[bu+1]=color.g,bj[bu+2]=color.b}at.bindBuffer(at.ARRAY_BUFFER,bw.__webglColorBuffer);at.bufferData(at.ARRAY_BUFFER,bj,bv)}}by.__dirtyVertices=!1;by.__dirtyColors=!1}else{if(bw instanceof THREE.Line){by=bw.geometry;if(by.__dirtyVertices||by.__dirtyColors){bw=by;bv=at.DYNAMIC_DRAW;bu=bk=bh=bh=void 0;bp=bw.vertices;bq=bw.colors;bo=bp.length;bt=bq.length;bi=bw.__vertexArray;bj=bw.__colorArray;bf=bw.__dirtyColors;if(bw.__dirtyVertices){for(bh=0;bh<bo;bh++){bk=bp[bh].position,bu=bh*3,bi[bu]=bk.x,bi[bu+1]=bk.y,bi[bu+2]=bk.z}at.bindBuffer(at.ARRAY_BUFFER,bw.__webglVertexBuffer);at.bufferData(at.ARRAY_BUFFER,bi,bv)}if(bf){for(bh=0;bh<bt;bh++){color=bq[bh],bu=bh*3,bj[bu]=color.r,bj[bu+1]=color.g,bj[bu+2]=color.b}at.bindBuffer(at.ARRAY_BUFFER,bw.__webglColorBuffer);at.bufferData(at.ARRAY_BUFFER,bj,bv)}}by.__dirtyVertices=!1;by.__dirtyColors=!1}else{if(bw instanceof THREE.ParticleSystem){by=bw.geometry,bt=K(by),(by.__dirtyVertices||by.__dirtyColors||bw.sortParticles||bt)&&aw(by,at.DYNAMIC_DRAW,bw),by.__dirtyVertices=!1,by.__dirtyColors=!1,n(by)}}}}}};this.setFaceCulling=function(e,f){e?(!f||f=="ccw"?at.frontFace(at.CCW):at.frontFace(at.CW),e=="back"?at.cullFace(at.BACK):e=="front"?at.cullFace(at.FRONT):at.cullFace(at.FRONT_AND_BACK),at.enable(at.CULL_FACE)):at.disable(at.CULL_FACE)};this.supportsVertexTextures=function(){return aJ}};THREE.WebGLRenderTarget=function(e,h,f){this.width=e;this.height=h;f=f||{};this.wrapS=f.wrapS!==void 0?f.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=f.wrapT!==void 0?f.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=f.magFilter!==void 0?f.magFilter:THREE.LinearFilter;this.minFilter=f.minFilter!==void 0?f.minFilter:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=f.format!==void 0?f.format:THREE.RGBAFormat;this.type=f.type!==void 0?f.type:THREE.UnsignedByteType;this.depthBuffer=f.depthBuffer!==void 0?f.depthBuffer:!0;this.stencilBuffer=f.stencilBuffer!==void 0?f.stencilBuffer:!0};THREE.WebGLRenderTarget.prototype.clone=function(){var c=new THREE.WebGLRenderTarget(this.width,this.height);c.wrapS=this.wrapS;c.wrapT=this.wrapT;c.magFilter=this.magFilter;c.minFilter=this.minFilter;c.offset.copy(this.offset);c.repeat.copy(this.repeat);c.format=this.format;c.type=this.type;c.depthBuffer=this.depthBuffer;c.stencilBuffer=this.stencilBuffer;return c};THREE.WebGLRenderTargetCube=function(e,h,f){THREE.WebGLRenderTarget.call(this,e,h,f);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget;THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{return !!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(b){return false}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var b=document.createElement("div");b.style.fontFamily="monospace";b.style.fontSize="13px";b.style.textAlign="center";b.style.background="#eee";b.style.color="#000";b.style.padding="1em";b.style.width="475px";b.style.margin="5em auto 0";if(!this.webgl){b.innerHTML=window.WebGLRenderingContext?['Sorry, your graphics card doesn\'t support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>'].join("\n"):['Sorry, your browser doesn\'t support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a><br/>',"Please try with",'<a href="http://www.google.com/chrome">Chrome</a>, ','<a href="http://www.mozilla.com/en-US/firefox/new/">Firefox 4</a> or','<a href="http://nightly.webkit.org/">Webkit Nightly (Mac)</a>'].join("\n")}return b},addGetWebGLMessage:function(c){var b,f,e;c=c||{};b=c.parent!==undefined?c.parent:document.body;f=c.id!==undefined?c.id:"oldie";e=Detector.getWebGLErrorMessage();e.id=f;b.appendChild(e)}};THREE.ColorUtils={adjustHSV:function(h,f,n,m){var k=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(h,k);k.h=THREE.ColorUtils.clamp(k.h+f,0,1);k.s=THREE.ColorUtils.clamp(k.s+n,0,1);k.v=THREE.ColorUtils.clamp(k.v+m,0,1);h.setHSV(k.h,k.s,k.v)},rgbToHsv:function(n,m){var w=n.r,v=n.g,t=n.b,p=Math.max(Math.max(w,v),t),u=Math.min(Math.min(w,v),t);if(u==p){u=w=0}else{var o=p-u,u=o/p,w=w==p?(v-t)/o:v==p?2+(t-w)/o:4+(w-v)/o;w/=6;w<0&&(w+=1);w>1&&(w-=1)}m===void 0&&(m={h:0,s:0,v:0});m.h=w;m.s=u;m.v=p;return m},clamp:function(f,e,h){return f<e?e:f>h?h:f}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};THREE.GeometryUtils={merge:function(P,O){var N,M,K=P.vertices.length,J=O instanceof THREE.Mesh?O.geometry:O,L=P.vertices,I=J.vertices,H=P.faces,G=J.faces,F=P.faceVertexUvs[0],J=J.faceVertexUvs[0];if(O instanceof THREE.Mesh){O.matrixAutoUpdate&&O.updateMatrix(),N=O.matrix,M=new THREE.Matrix4,M.extractRotation(N,O.scale)}for(var E=0,C=I.length;E<C;E++){var B=new THREE.Vertex(I[E].position.clone());N&&N.multiplyVector3(B.position);L.push(B)}E=0;for(C=G.length;E<C;E++){var B=G[E],A,x,D=B.vertexNormals,w=B.vertexColors;B instanceof THREE.Face3?A=new THREE.Face3(B.a+K,B.b+K,B.c+K):B instanceof THREE.Face4&&(A=new THREE.Face4(B.a+K,B.b+K,B.c+K,B.d+K));A.normal.copy(B.normal);M&&M.multiplyVector3(A.normal);L=0;for(I=D.length;L<I;L++){x=D[L].clone(),M&&M.multiplyVector3(x),A.vertexNormals.push(x)}A.color.copy(B.color);L=0;for(I=w.length;L<I;L++){x=w[L],A.vertexColors.push(x.clone())}A.materials=B.materials.slice();A.centroid.copy(B.centroid);N&&N.multiplyVector3(A.centroid);H.push(A)}E=0;for(C=J.length;E<C;E++){N=J[E];M=[];L=0;for(I=N.length;L<I;L++){M.push(new THREE.UV(N[L].u,N[L].v))}F.push(M)}},clone:function(D){var C=new THREE.Geometry,B,A=D.vertices,y=D.faces,x=D.faceVertexUvs[0],D=0;for(B=A.length;D<B;D++){var z=new THREE.Vertex(A[D].position.clone());C.vertices.push(z)}D=0;for(B=y.length;D<B;D++){var w=y[D],v,u,t=w.vertexNormals,p=w.vertexColors;w instanceof THREE.Face3?v=new THREE.Face3(w.a,w.b,w.c):w instanceof THREE.Face4&&(v=new THREE.Face4(w.a,w.b,w.c,w.d));v.normal.copy(w.normal);A=0;for(z=t.length;A<z;A++){u=t[A],v.vertexNormals.push(u.clone())}v.color.copy(w.color);A=0;for(z=p.length;A<z;A++){u=p[A],v.vertexColors.push(u.clone())}v.materials=w.materials.slice();v.centroid.copy(w.centroid);C.faces.push(v)}D=0;for(B=x.length;D<B;D++){y=x[D];v=[];A=0;for(z=y.length;A<z;A++){v.push(new THREE.UV(y[A].u,y[A].v))}C.faceVertexUvs[0].push(v)}return C},randomPointInTriangle:function(n,m,w){var v,t,p,u=new THREE.Vector3,o=THREE.GeometryUtils.__v1;v=THREE.GeometryUtils.random();t=THREE.GeometryUtils.random();v+t>1&&(v=1-v,t=1-t);p=1-v-t;u.copy(n);u.multiplyScalar(v);o.copy(m);o.multiplyScalar(t);u.addSelf(o);o.copy(w);o.multiplyScalar(p);u.addSelf(o);return u},randomPointInFace:function(m,k,u){var t,o,n;if(m instanceof THREE.Face3){return t=k.vertices[m.a].position,o=k.vertices[m.b].position,n=k.vertices[m.c].position,THREE.GeometryUtils.randomPointInTriangle(t,o,n)}else{if(m instanceof THREE.Face4){t=k.vertices[m.a].position;o=k.vertices[m.b].position;n=k.vertices[m.c].position;var k=k.vertices[m.d].position,p;u?m._area1&&m._area2?(u=m._area1,p=m._area2):(u=THREE.GeometryUtils.triangleArea(t,o,k),p=THREE.GeometryUtils.triangleArea(o,n,k),m._area1=u,m._area2=p):(u=THREE.GeometryUtils.triangleArea(t,o,k),p=THREE.GeometryUtils.triangleArea(o,n,k));return THREE.GeometryUtils.random()*(u+p)<u?THREE.GeometryUtils.randomPointInTriangle(t,o,k):THREE.GeometryUtils.randomPointInTriangle(o,n,k)}}},randomPointsInGeometry:function(F,E){function D(b){function e(c,k){if(k<c){return c}var h=c+Math.floor((k-c)/2);return w[h]>b?e(c,h-1):w[h]<b?e(h+1,k):h}return e(0,w.length-1)}var C,A,z=F.faces,B=F.vertices,y=z.length,x=0,w=[],v,p,H,G;for(A=0;A<y;A++){C=z[A];if(C instanceof THREE.Face3){v=B[C.a].position,p=B[C.b].position,H=B[C.c].position,C._area=THREE.GeometryUtils.triangleArea(v,p,H)}else{if(C instanceof THREE.Face4){v=B[C.a].position,p=B[C.b].position,H=B[C.c].position,G=B[C.d].position,C._area1=THREE.GeometryUtils.triangleArea(v,p,G),C._area2=THREE.GeometryUtils.triangleArea(p,H,G),C._area=C._area1+C._area2}}x+=C._area;w[A]=x}C=[];B={};for(A=0;A<E;A++){y=THREE.GeometryUtils.random()*x,y=D(y),C[A]=THREE.GeometryUtils.randomPointInFace(z[y],F,!0),B[y]?B[y]+=1:B[y]=1}return C},triangleArea:function(h,f,n){var m,k=THREE.GeometryUtils.__v1;k.sub(h,f);m=k.length();k.sub(h,n);h=k.length();k.sub(f,n);n=k.length();f=0.5*(m+h+n);return Math.sqrt(f*(f-m)*(f-h)*(f-n))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},center:function(e){e.computeBoundingBox();var c=new THREE.Matrix4;c.setTranslation(-0.5*(e.boundingBox.x[1]+e.boundingBox.x[0]),-0.5*(e.boundingBox.y[1]+e.boundingBox.y[0]),-0.5*(e.boundingBox.z[1]+e.boundingBox.z[0]));e.applyMatrix(c);e.computeBoundingBox()}};THREE.GeometryUtils.random=THREE.GeometryUtils.random16;THREE.GeometryUtils.__v1=new THREE.Vector3;THREE.ImageUtils={loadTexture:function(h,f,n){var m=new Image,k=new THREE.Texture(m,f);m.onload=function(){k.needsUpdate=!0;n&&n(this)};m.crossOrigin="";m.src=h;return k},loadTextureCube:function(k,f,p){var o,n=[],m=new THREE.Texture(n,f),f=n.loadCount=0;for(o=k.length;f<o;++f){n[f]=new Image,n[f].onload=function(){n.loadCount+=1;if(n.loadCount==6){m.needsUpdate=!0}p&&p(this)},n[f].crossOrigin="",n[f].src=k[f]}return m},getNormalMap:function(R,Q){var P=function(b){var e=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);return[b[0]/e,b[1]/e,b[2]/e]};Q|=1;var O=R.width,M=R.height,L=document.createElement("canvas");L.width=O;L.height=M;var N=L.getContext("2d");N.drawImage(R,0,0);for(var K=N.getImageData(0,0,O,M).data,J=N.createImageData(O,M),I=J.data,H=0;H<O;H++){for(var G=1;G<M;G++){var E=G-1<0?M-1:G-1,D=(G+1)%M,C=H-1<0?O-1:H-1,A=(H+1)%O,F=[],x=[0,0,K[(G*O+H)*4]/255*Q];F.push([-1,0,K[(G*O+C)*4]/255*Q]);F.push([-1,-1,K[(E*O+C)*4]/255*Q]);F.push([0,-1,K[(E*O+H)*4]/255*Q]);F.push([1,-1,K[(E*O+A)*4]/255*Q]);F.push([1,0,K[(G*O+A)*4]/255*Q]);F.push([1,1,K[(D*O+A)*4]/255*Q]);F.push([0,1,K[(D*O+H)*4]/255*Q]);F.push([-1,1,K[(D*O+C)*4]/255*Q]);E=[];C=F.length;for(D=0;D<C;D++){var A=F[D],B=F[(D+1)%C],A=[A[0]-x[0],A[1]-x[1],A[2]-x[2]],B=[B[0]-x[0],B[1]-x[1],B[2]-x[2]];E.push(P([A[1]*B[2]-A[2]*B[1],A[2]*B[0]-A[0]*B[2],A[0]*B[1]-A[1]*B[0]]))}F=[0,0,0];for(D=0;D<E.length;D++){F[0]+=E[D][0],F[1]+=E[D][1],F[2]+=E[D][2]}F[0]/=E.length;F[1]/=E.length;F[2]/=E.length;x=(G*O+H)*4;I[x]=(F[0]+1)/2*255|0;I[x+1]=(F[1]+0.5)*255|0;I[x+2]=F[2]*255|0;I[x+3]=255}}N.putImageData(J,0,0);return L}};THREE.SceneUtils={showHierarchy:function(e,c){THREE.SceneUtils.traverseHierarchy(e,function(b){b.visible=c})},traverseHierarchy:function(h,f){var n,m,k=h.children.length;for(m=0;m<k;m++){n=h.children[m],f(n),THREE.SceneUtils.traverseHierarchy(n,f)}}};if(THREE.WebGLRenderer){THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight;\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * totalDiffuse + totalSpecular + ambientLightColor * uAmbientColor;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"}}}}THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(b){return this.getPoint(this.getUtoTmapping(b))};THREE.Curve.prototype.getPoints=function(f){f||(f=5);var e,h=[];for(e=0;e<=f;e++){h.push(this.getPoint(e/f))}return h};THREE.Curve.prototype.getSpacedPoints=function(f){f||(f=5);var e,h=[];for(e=0;e<=f;e++){h.push(this.getPointAt(e/f))}return h};THREE.Curve.prototype.getLength=function(){var b=this.getLengths();return b[b.length-1]};THREE.Curve.prototype.getLengths=function(k){k||(k=200);if(this.cacheArcLengths&&this.cacheArcLengths.length==k+1){return this.cacheArcLengths}var f=[],p,o=this.getPoint(0),n,m=0;f.push(0);for(n=1;n<=k;n++){p=this.getPoint(n/k),m+=p.distanceTo(o),f.push(m),o=p}return this.cacheArcLengths=f};THREE.Curve.prototype.getUtoTmapping=function(x,w){var v=this.getLengths(),u=0,p=v.length,o;o=w?w:x*v[p-1];time=Date.now();for(var t=0,n=p-1,m;t<=n;){if(u=Math.floor(t+(n-t)/2),m=v[u]-o,m<0){t=u+1}else{if(m>0){n=u-1}else{n=u;break}}}u=n;if(v[u]==o){return u/(p-1)}t=v[u];return v=(u+(o-t)/(v[u+1]-t))/(p-1)};THREE.Curve.prototype.getNormalVector=function(b){b=this.getTangent(b);return new THREE.Vector2(-b.y,b.x)};THREE.Curve.prototype.getTangent=function(f){var e=f-0.0001;f+=0.0001;e<0&&(e=0);f>1&&(f=1);var e=this.getPoint(e),f=this.getPoint(f),h=new THREE.Vector2;h.sub(f,e);return h.unit()};THREE.LineCurve=function(e,c){e instanceof THREE.Vector2?(this.v1=e,this.v2=c):THREE.LineCurve.oldConstructor.apply(this,arguments)};THREE.LineCurve.oldConstructor=function(h,f,m,k){this.constructor(new THREE.Vector2(h,f),new THREE.Vector2(m,k))};THREE.LineCurve.prototype=new THREE.Curve;THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(e){var c=new THREE.Vector2;c.sub(this.v2,this.v1);c.multiplyScalar(e).addSelf(this.v1);return c};THREE.LineCurve.prototype.getPointAt=function(b){return this.getPoint(b)};THREE.LineCurve.prototype.getTangent=function(){var b=new THREE.Vector2;b.sub(this.v2,this.v1);b.normalize();return b};THREE.QuadraticBezierCurve=function(h,f,m){if(!(f instanceof THREE.Vector2)){var k=Array.prototype.slice.call(arguments),h=new THREE.Vector2(k[0],k[1]),f=new THREE.Vector2(k[2],k[3]),m=new THREE.Vector2(k[4],k[5])}this.v0=h;this.v1=f;this.v2=m};THREE.QuadraticBezierCurve.prototype=new THREE.Curve;THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var c;c=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(c,e)};THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var c;c=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);c=new THREE.Vector2(c,e);c.normalize();return c};THREE.CubicBezierCurve=function(h,f,n,m){if(!(f instanceof THREE.Vector2)){var k=Array.prototype.slice.call(arguments),h=new THREE.Vector2(k[0],k[1]),f=new THREE.Vector2(k[2],k[3]),n=new THREE.Vector2(k[4],k[5]),m=new THREE.Vector2(k[6],k[7])}this.v0=h;this.v1=f;this.v2=n;this.v3=m};THREE.CubicBezierCurve.prototype=new THREE.Curve;THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(e){var c;c=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(c,e)};THREE.CubicBezierCurve.prototype.getTangent=function(e){var c;c=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);c=new THREE.Vector2(c,e);c.normalize();return c};THREE.SplineCurve=function(b){this.points=b};THREE.SplineCurve.prototype=new THREE.Curve;THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(h){var f=new THREE.Vector2,n=[],m=this.points,k;k=(m.length-1)*h;h=Math.floor(k);k-=h;n[0]=h==0?h:h-1;n[1]=h;n[2]=h>m.length-2?h:h+1;n[3]=h>m.length-3?h:h+2;f.x=THREE.Curve.Utils.interpolate(m[n[0]].x,m[n[1]].x,m[n[2]].x,m[n[3]].x,k);f.y=THREE.Curve.Utils.interpolate(m[n[0]].y,m[n[1]].y,m[n[2]].y,m[n[3]].y,k);return f};THREE.ArcCurve=function(k,f,p,o,n,m){this.aX=k;this.aY=f;this.aRadius=p;this.aStartAngle=o;this.aEndAngle=n;this.aClockwise=m};THREE.ArcCurve.prototype=new THREE.Curve;THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.ArcCurve.prototype.getPoint=function(e){var c=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);e=this.aStartAngle+e*c;return new THREE.Vector2(this.aX+this.aRadius*Math.cos(e),this.aY+this.aRadius*Math.sin(e))};THREE.Curve.Utils={tangentQuadraticBezier:function(h,f,m,k){return 2*(1-h)*(m-f)+2*h*(k-m)},tangentCubicBezier:function(h,f,n,m,k){return -3*f*(1-h)*(1-h)+3*n*(1-h)*(1-h)-6*h*n*(1-h)+6*h*m*(1-h)-3*h*h*m+3*h*h*k},tangentSpline:function(b){return 6*b*b-6*b+(3*b*b-4*b+1)+(-6*b*b+6*b)+(3*b*b-2*b)},interpolate:function(k,f,p,o,n){var k=(p-k)*0.5,o=(o-f)*0.5,m=n*n;return(2*f-2*p+k+o)*n*m+(-3*f+3*p-2*k-o)*m+k*n+f}};THREE.Curve.create=function(e,c){e.prototype=new THREE.Curve;e.prototype.constructor=e;e.prototype.getPoint=c;return e};THREE.LineCurve3=THREE.Curve.create(function(e,c){this.v1=e;this.v2=c},function(e){var c=new THREE.Vector3;c.sub(v2,v1);c.multiplyScalar(e);c.addSelf(this.v1);return c});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(f,e,h){this.v0=f;this.v1=e;this.v2=h},function(f){var e,h;e=THREE.Shape.Utils.b2(f,this.v0.x,this.v1.x,this.v2.x);h=THREE.Shape.Utils.b2(f,this.v0.y,this.v1.y,this.v2.y);f=THREE.Shape.Utils.b2(f,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(e,h,f)});THREE.CubicBezierCurve3=THREE.Curve.create(function(h,f,m,k){this.v0=h;this.v1=f;this.v2=m;this.v3=k},function(f){var e,h;e=THREE.Shape.Utils.b3(f,this.v0.x,this.v1.x,this.v2.x,this.v3.x);h=THREE.Shape.Utils.b3(f,this.v0.y,this.v1.y,this.v2.y,this.v3.y);f=THREE.Shape.Utils.b3(f,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(e,h,f)});THREE.SplineCurve3=THREE.Curve.create(function(b){this.points=b},function(h){var f=new THREE.Vector3,n=[],m=this.points,k;k=(m.length-1)*h;h=Math.floor(k);k-=h;n[0]=h==0?h:h-1;n[1]=h;n[2]=h>m.length-2?h:h+1;n[3]=h>m.length-3?h:h+2;f.x=THREE.Curve.Utils.interpolate(m[n[0]].x,m[n[1]].x,m[n[2]].x,m[n[3]].x,k);f.y=THREE.Curve.Utils.interpolate(m[n[0]].y,m[n[1]].y,m[n[2]].y,m[n[3]].y,k);f.z=THREE.Curve.Utils.interpolate(m[n[0]].z,m[n[1]].z,m[n[2]].z,m[n[3]].z,k);return f});THREE.CurvePath=function(){this.curves=[];this.bends=[]};THREE.CurvePath.prototype=new THREE.Curve;THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(b){this.curves.push(b)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){};THREE.CurvePath.prototype.getPoint=function(f){for(var e=f*this.getLength(),h=this.getCurveLengths(),f=0;f<h.length;){if(h[f]>=e){return e=h[f]-e,f=this.curves[f],e=1-e/f.getLength(),f.getPointAt(e)}f++}return null};THREE.CurvePath.prototype.getLength=function(){var b=this.getCurveLengths();return b[b.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var h=[],f=0,m,k=this.curves.length;for(m=0;m<k;m++){f+=this.curves[m].getLength(),h.push(f)}return this.cacheLengths=h};THREE.CurvePath.prototype.getBoundingBox=function(){var x=this.getPoints(),w,v,u,p;w=v=Number.NEGATIVE_INFINITY;u=p=Number.POSITIVE_INFINITY;var o,t,n,m;m=new THREE.Vector2;t=0;for(n=x.length;t<n;t++){o=x[t];if(o.x>w){w=o.x}else{if(o.x<u){u=o.x}}if(o.y>v){v=o.y}else{if(o.y<v){p=o.y}}m.addSelf(o.x,o.y)}return{minX:u,minY:p,maxX:w,maxY:v,centroid:m.divideScalar(n)}};THREE.CurvePath.prototype.createPointsGeometry=function(b){return this.createGeometry(this.getPoints(b,!0))};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(b){return this.createGeometry(this.getSpacedPoints(b,!0))};THREE.CurvePath.prototype.createGeometry=function(f){for(var e=new THREE.Geometry,h=0;h<f.length;h++){e.vertices.push(new THREE.Vertex(new THREE.Vector3(f[h].x,f[h].y,0)))}return e};THREE.CurvePath.prototype.addWrapPath=function(b){this.bends.push(b)};THREE.CurvePath.prototype.getTransformedPoints=function(h,f){var n=this.getPoints(h),m,k;if(!f){f=this.bends}m=0;for(k=f.length;m<k;m++){n=this.getWrapPoints(n,f[m])}return n};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(h,f){var n=this.getSpacedPoints(h),m,k;if(!f){f=this.bends}m=0;for(k=f.length;m<k;m++){n=this.getWrapPoints(n,f[m])}return n};THREE.CurvePath.prototype.getWrapPoints=function(x,w){var v=this.getBoundingBox(),u,p,o,t,n,m;u=0;for(p=x.length;u<p;u++){o=x[u],t=o.x,n=o.y,m=t/v.maxX,m=w.getUtoTmapping(m,t),t=w.getPoint(m),n=w.getNormalVector(m).multiplyScalar(n),o.x=t.x+n.x,o.y=t.y+n.y}return x};THREE.Path=function(b){THREE.CurvePath.call(this);this.actions=[];b&&this.fromPoints(b)};THREE.Path.prototype=new THREE.CurvePath;THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};THREE.Path.prototype.fromPoints=function(f){this.moveTo(f[0].x,f[0].y);var e,h=f.length;for(e=1;e<h;e++){this.lineTo(f[e].x,f[e].y)}};THREE.Path.prototype.moveTo=function(){var b=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:b})};THREE.Path.prototype.lineTo=function(h,f){var m=Array.prototype.slice.call(arguments),k=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(k[k.length-2],k[k.length-1]),new THREE.Vector2(h,f)));this.actions.push({action:THREE.PathActions.LINE_TO,args:m})};THREE.Path.prototype.quadraticCurveTo=function(k,f,p,o){var n=Array.prototype.slice.call(arguments),m=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(m[m.length-2],m[m.length-1]),new THREE.Vector2(k,f),new THREE.Vector2(p,o)));this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:n})};THREE.Path.prototype.bezierCurveTo=function(n,m,w,v,t,p){var u=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(n,m),new THREE.Vector2(w,v),new THREE.Vector2(t,p)));this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:u})};THREE.Path.prototype.splineThru=function(f){var e=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=[new THREE.Vector2(h[h.length-2],h[h.length-1])];Array.prototype.push.apply(h,f);this.curves.push(new THREE.SplineCurve(h));this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:e})};THREE.Path.prototype.arc=function(m,k,u,t,o,n){var p=Array.prototype.slice.call(arguments);this.curves.push(new THREE.ArcCurve(m,k,u,t,o,n));this.actions.push({action:THREE.PathActions.ARC,args:p})};THREE.Path.prototype.getSpacedPoints=function(f){f||(f=40);for(var e=[],h=0;h<f;h++){e.push(this.getPoint(h/f))}return e};THREE.Path.prototype.getPoints=function(K,J){var K=K||12,H=[],G,E,D,F,C,B,A,z,x,N,M,L,I;G=0;for(E=this.actions.length;G<E;G++){switch(D=this.actions[G],F=D.action,D=D.args,F){case THREE.PathActions.LINE_TO:H.push(new THREE.Vector2(D[0],D[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:C=D[2];B=D[3];x=D[0];N=D[1];H.length>0?(F=H[H.length-1],M=F.x,L=F.y):(F=this.actions[G-1].args,M=F[F.length-2],L=F[F.length-1]);for(F=1;F<=K;F++){I=F/K,D=THREE.Shape.Utils.b2(I,M,x,C),I=THREE.Shape.Utils.b2(I,L,N,B),H.push(new THREE.Vector2(D,I))}break;case THREE.PathActions.BEZIER_CURVE_TO:C=D[4];B=D[5];x=D[0];N=D[1];A=D[2];z=D[3];H.length>0?(F=H[H.length-1],M=F.x,L=F.y):(F=this.actions[G-1].args,M=F[F.length-2],L=F[F.length-1]);for(F=1;F<=K;F++){I=F/K,D=THREE.Shape.Utils.b3(I,M,x,A,C),I=THREE.Shape.Utils.b3(I,L,N,z,B),H.push(new THREE.Vector2(D,I))}break;case THREE.PathActions.CSPLINE_THRU:F=this.actions[G-1].args;F=[new THREE.Vector2(F[F.length-2],F[F.length-1])];I=K*D[0].length;F=F.concat(D[0]);D=new THREE.SplineCurve(F);for(F=1;F<=I;F++){H.push(D.getPointAt(F/I))}break;case THREE.PathActions.ARC:F=this.actions[G-1].args;C=D[0];B=D[1];A=D[2];x=D[3];I=D[4];N=!!D[5];z=F[F.length-2];M=F[F.length-1];F.length==0&&(z=M=0);L=I-x;var w=K*2;for(F=1;F<=w;F++){I=F/w,N||(I=1-I),I=x+I*L,D=z+C+A*Math.cos(I),I=M+B+A*Math.sin(I),H.push(new THREE.Vector2(D,I))}}}J&&H.push(H[0]);return H};THREE.Path.prototype.transform=function(e,c){this.getBoundingBox();return this.getWrapPoints(this.getPoints(c),e)};THREE.Path.prototype.nltransform=function(D,C,B,A,y,x){var z=this.getPoints(),w,v,u,t,p;w=0;for(v=z.length;w<v;w++){u=z[w],t=u.x,p=u.y,u.x=D*t+C*p+B,u.y=A*p+y*t+x}return z};THREE.Path.prototype.debug=function(h){var f=this.getBoundingBox();h||(h=document.createElement("canvas"),h.setAttribute("width",f.maxX+100),h.setAttribute("height",f.maxY+100),document.body.appendChild(h));f=h.getContext("2d");f.fillStyle="white";f.fillRect(0,0,h.width,h.height);f.strokeStyle="black";f.beginPath();var n,m,k,h=0;for(n=this.actions.length;h<n;h++){m=this.actions[h],k=m.args,m=m.action,m!=THREE.PathActions.CSPLINE_THRU&&f[m].apply(f,k)}f.stroke();f.closePath();f.strokeStyle="red";m=this.getPoints();h=0;for(n=m.length;h<n;h++){k=m[h],f.beginPath(),f.arc(k.x,k.y,1.5,0,Math.PI*2,!1),f.stroke(),f.closePath()}};THREE.Path.prototype.toShapes=function(){var m,k,u,t,o=[],n=new THREE.Path;m=0;for(k=this.actions.length;m<k;m++){u=this.actions[m],t=u.args,u=u.action,u==THREE.PathActions.MOVE_TO&&n.actions.length!=0&&(o.push(n),n=new THREE.Path),n[u].apply(n,t)}n.actions.length!=0&&o.push(n);if(o.length==0){return[]}var p,n=[];if(THREE.Shape.Utils.isClockWise(o[0].getPoints())){m=0;for(k=o.length;m<k;m++){t=o[m],THREE.Shape.Utils.isClockWise(t.getPoints())?(p&&n.push(p),p=new THREE.Shape,p.actions=t.actions,p.curves=t.curves):p.holes.push(t)}n.push(p)}else{p=new THREE.Shape;m=0;for(k=o.length;m<k;m++){t=o[m],THREE.Shape.Utils.isClockWise(t.getPoints())?(p.actions=t.actions,p.curves=t.curves,n.push(p),p=new THREE.Shape):p.holes.push(t)}}return n};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=new THREE.Path;THREE.Shape.prototype.constructor=THREE.Path;THREE.Shape.prototype.extrude=function(b){return new THREE.ExtrudeGeometry(this,b)};THREE.Shape.prototype.getPointsHoles=function(h){var f,m=this.holes.length,k=[];for(f=0;f<m;f++){k[f]=this.holes[f].getTransformedPoints(h,this.bends)}return k};THREE.Shape.prototype.getSpacedPointsHoles=function(h){var f,m=this.holes.length,k=[];for(f=0;f<m;f++){k[f]=this.holes[f].getTransformedSpacedPoints(h,this.bends)}return k};THREE.Shape.prototype.extractAllPoints=function(b){return{shape:this.getTransformedPoints(b),holes:this.getPointsHoles(b)}};THREE.Shape.prototype.extractAllSpacedPoints=function(b){return{shape:this.getTransformedSpacedPoints(b),holes:this.getSpacedPointsHoles(b)}};THREE.Shape.Utils={removeHoles:function(K,J){var H=K.concat(),G=H.concat(),E,D,F,C,B,A,z,x,N,M,L=[];for(B=0;B<J.length;B++){A=J[B];Array.prototype.push.apply(G,A);D=Number.POSITIVE_INFINITY;for(E=0;E<A.length;E++){N=A[E];M=[];for(x=0;x<H.length;x++){z=H[x],z=N.distanceToSquared(z),M.push(z),z<D&&(D=z,F=E,C=x)}}E=C-1>=0?C-1:H.length-1;D=F-1>=0?F-1:A.length-1;var I=[A[F],H[C],H[E]];x=THREE.FontUtils.Triangulate.area(I);var w=[A[F],A[D],H[C]];N=THREE.FontUtils.Triangulate.area(w);M=C;z=F;C+=1;F+=-1;C<0&&(C+=H.length);C%=H.length;F<0&&(F+=A.length);F%=A.length;E=C-1>=0?C-1:H.length-1;D=F-1>=0?F-1:A.length-1;I=[A[F],H[C],H[E]];I=THREE.FontUtils.Triangulate.area(I);w=[A[F],A[D],H[C]];w=THREE.FontUtils.Triangulate.area(w);x+N>I+w&&(C=M,F=z,C<0&&(C+=H.length),C%=H.length,F<0&&(F+=A.length),F%=A.length,E=C-1>=0?C-1:H.length-1,D=F-1>=0?F-1:A.length-1);x=H.slice(0,C);N=H.slice(C);M=A.slice(F);z=A.slice(0,F);D=[A[F],A[D],H[C]];L.push([A[F],H[C],H[E]]);L.push(D);H=x.concat(M).concat(z).concat(N)}return{shape:H,isolatedPts:L,allpoints:G}},triangulateShape:function(z,y){var x=THREE.Shape.Utils.removeHoles(z,y),w=x.allpoints,u=x.isolatedPts,x=THREE.FontUtils.Triangulate(x.shape,!1),t,v,p,o,n={};t=0;for(v=w.length;t<v;t++){o=w[t].x+":"+w[t].y,n[o]!==void 0&&console.log("Duplicate point",o),n[o]=t}t=0;for(v=x.length;t<v;t++){p=x[t];for(w=0;w<3;w++){o=p[w].x+":"+p[w].y,o=n[o],o!==void 0&&(p[w]=o)}}t=0;for(v=u.length;t<v;t++){p=u[t];for(w=0;w<3;w++){o=p[w].x+":"+p[w].y,o=n[o],o!==void 0&&(p[w]=o)}}return x.concat(u)},isClockWise:function(b){return THREE.FontUtils.Triangulate.area(b)<0},b2p0:function(f,e){var h=1-f;return h*h*e},b2p1:function(e,c){return 2*(1-e)*e*c},b2p2:function(e,c){return e*e*c},b2:function(h,f,m,k){return this.b2p0(h,f)+this.b2p1(h,m)+this.b2p2(h,k)},b3p0:function(f,e){var h=1-f;return h*h*h*e},b3p1:function(f,e){var h=1-f;return 3*h*h*f*e},b3p2:function(e,c){return 3*(1-e)*e*e*c},b3p3:function(e,c){return e*e*e*c},b3:function(h,f,n,m,k){return this.b3p0(h,f)+this.b3p1(h,n)+this.b3p2(h,m)+this.b3p3(h,k)}};THREE.TextPath=function(e,c){THREE.Path.call(this);this.parameters=c||{};this.set(e)};THREE.TextPath.prototype.set=function(k,f){this.text=k;var f=f||this.parameters,p=f.curveSegments!==void 0?f.curveSegments:4,o=f.font!==void 0?f.font:"helvetiker",n=f.weight!==void 0?f.weight:"normal",m=f.style!==void 0?f.style:"normal";THREE.FontUtils.size=f.size!==void 0?f.size:100;THREE.FontUtils.divisions=p;THREE.FontUtils.face=o;THREE.FontUtils.weight=n;THREE.FontUtils.style=m};THREE.TextPath.prototype.toShapes=function(){for(var h=THREE.FontUtils.drawText(this.text).paths,f=[],m=0,k=h.length;m<k;m++){Array.prototype.push.apply(f,h[m].toShapes())}return f};THREE.AnimationHandler=function(){var h=[],f={},m={update:function(n){for(var e=0;e<h.length;e++){h[e].update(n)}},addToUpdate:function(b){h.indexOf(b)===-1&&h.push(b)},removeFromUpdate:function(b){b=h.indexOf(b);b!==-1&&h.splice(b,1)},add:function(p){f[p.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+p.name+" already exists in library. Overwriting.");f[p.name]=p;if(p.initialized!==!0){for(var w=0;w<p.hierarchy.length;w++){for(var u=0;u<p.hierarchy[w].keys.length;u++){if(p.hierarchy[w].keys[u].time<0){p.hierarchy[w].keys[u].time=0}if(p.hierarchy[w].keys[u].rot!==void 0&&!(p.hierarchy[w].keys[u].rot instanceof THREE.Quaternion)){var t=p.hierarchy[w].keys[u].rot;p.hierarchy[w].keys[u].rot=new THREE.Quaternion(t[0],t[1],t[2],t[3])}}if(p.hierarchy[w].keys[0].morphTargets!==void 0){t={};for(u=0;u<p.hierarchy[w].keys.length;u++){for(var o=0;o<p.hierarchy[w].keys[u].morphTargets.length;o++){var b=p.hierarchy[w].keys[u].morphTargets[o];t[b]=-1}}p.hierarchy[w].usedMorphTargets=t;for(u=0;u<p.hierarchy[w].keys.length;u++){var v={};for(b in t){for(o=0;o<p.hierarchy[w].keys[u].morphTargets.length;o++){if(p.hierarchy[w].keys[u].morphTargets[o]===b){v[b]=p.hierarchy[w].keys[u].morphTargetsInfluences[o];break}}o===p.hierarchy[w].keys[u].morphTargets.length&&(v[b]=0)}p.hierarchy[w].keys[u].morphTargetsInfluences=v}}for(u=1;u<p.hierarchy[w].keys.length;u++){p.hierarchy[w].keys[u].time===p.hierarchy[w].keys[u-1].time&&(p.hierarchy[w].keys.splice(u,1),u--)}for(u=1;u<p.hierarchy[w].keys.length;u++){p.hierarchy[w].keys[u].index=u}}u=parseInt(p.length*p.fps,10);p.JIT={};p.JIT.hierarchy=[];for(w=0;w<p.hierarchy.length;w++){p.JIT.hierarchy.push(Array(u))}p.initialized=!0}},get:function(b){if(typeof b==="string"){return f[b]?f[b]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+b),null)}},parse:function(n){var o=[];if(n instanceof THREE.SkinnedMesh){for(var e=0;e<n.bones.length;e++){o.push(n.bones[e])}}else{k(n,o)}return o}},k=function(n,o){o.push(n);for(var e=0;e<n.children.length;e++){k(n.children[e],o)}};m.LINEAR=0;m.CATMULLROM=1;m.CATMULLROM_FORWARD=2;return m}();THREE.Animation=function(h,f,m,k){this.root=h;this.data=THREE.AnimationHandler.get(f);this.hierarchy=THREE.AnimationHandler.parse(h);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=m!==void 0?m:THREE.AnimationHandler.LINEAR;this.JITCompile=k!==void 0?k:!0;this.points=[];this.target=new THREE.Vector3};THREE.Animation.prototype.play=function(k,f){if(!this.isPlaying){this.isPlaying=!0;this.loop=k!==void 0?k:!0;this.currentTime=f!==void 0?f:0;var p,o=this.hierarchy.length,n;for(p=0;p<o;p++){n=this.hierarchy[p];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD){n.useQuaternion=!0}n.matrixAutoUpdate=!0;if(n.animationCache===void 0){n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix}var m=n.animationCache.prevKey;n=n.animationCache.nextKey;m.pos=this.data.hierarchy[p].keys[0];m.rot=this.data.hierarchy[p].keys[0];m.scl=this.data.hierarchy[p].keys[0];n.pos=this.getNextKeyWith("pos",p,1);n.rot=this.getNextKeyWith("rot",p,1);n.scl=this.getNextKeyWith("scl",p,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.hierarchy.length;b++){if(this.hierarchy[b].animationCache!==void 0){this.hierarchy[b] instanceof THREE.Bone?this.hierarchy[b].skinMatrix=this.hierarchy[b].animationCache.originalMatrix:this.hierarchy[b].matrix=this.hierarchy[b].animationCache.originalMatrix,delete this.hierarchy[b].animationCache}}};THREE.Animation.prototype.update=function(I){if(this.isPlaying){var H=["pos","rot","scl"],F,E,C,B,D,A,z,x,w=this.data.JIT.hierarchy,p,L;this.currentTime+=I*this.timeScale;L=this.currentTime;p=this.currentTime%=this.data.length;x=parseInt(Math.min(p*this.data.fps,this.data.length*this.data.fps),10);for(var K=0,J=this.hierarchy.length;K<J;K++){if(I=this.hierarchy[K],z=I.animationCache,this.JITCompile&&w[K][x]!==void 0){I instanceof THREE.Bone?(I.skinMatrix=w[K][x],I.matrixAutoUpdate=!1,I.matrixWorldNeedsUpdate=!1):(I.matrix=w[K][x],I.matrixAutoUpdate=!1,I.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){I instanceof THREE.Bone?I.skinMatrix=I.animationCache.originalMatrix:I.matrix=I.animationCache.originalMatrix}for(var G=0;G<3;G++){F=H[G];D=z.prevKey[F];A=z.nextKey[F];if(A.time<=L){if(p<L){if(this.loop){D=this.data.hierarchy[K].keys[0];for(A=this.getNextKeyWith(F,K,1);A.time<p;){D=A,A=this.getNextKeyWith(F,K,A.index+1)}}else{this.stop();return}}else{do{D=A,A=this.getNextKeyWith(F,K,A.index+1)}while(A.time<p)}z.prevKey[F]=D;z.nextKey[F]=A}I.matrixAutoUpdate=!0;I.matrixWorldNeedsUpdate=!0;E=(p-D.time)/(A.time-D.time);C=D[F];B=A[F];if(E<0||E>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+E+" on bone "+K),E=E<0?0:1}if(F==="pos"){if(F=I.position,this.interpolationType===THREE.AnimationHandler.LINEAR){F.x=C[0]+(B[0]-C[0])*E,F.y=C[1]+(B[1]-C[1])*E,F.z=C[2]+(B[2]-C[2])*E}else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",K,D.index-1).pos,this.points[1]=C,this.points[2]=B,this.points[3]=this.getNextKeyWith("pos",K,A.index+1).pos,E=E*0.33+0.33,C=this.interpolateCatmullRom(this.points,E),F.x=C[0],F.y=C[1],F.z=C[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){E=this.interpolateCatmullRom(this.points,E*1.01),this.target.set(E[0],E[1],E[2]),this.target.subSelf(F),this.target.y=0,this.target.normalize(),E=Math.atan2(this.target.x,this.target.z),I.rotation.set(0,E,0)}}}}else{if(F==="rot"){THREE.Quaternion.slerp(C,B,I.quaternion,E)}else{if(F==="scl"){F=I.scale,F.x=C[0]+(B[0]-C[0])*E,F.y=C[1]+(B[1]-C[1])*E,F.z=C[2]+(B[2]-C[2])*E}}}}}}if(this.JITCompile&&w[0][x]===void 0){this.hierarchy[0].update(void 0,!0);for(K=0;K<this.hierarchy.length;K++){w[K][x]=this.hierarchy[K] instanceof THREE.Bone?this.hierarchy[K].skinMatrix.clone():this.hierarchy[K].matrix.clone()}}}};THREE.Animation.prototype.interpolateCatmullRom=function(z,y){var x=[],w=[],u,t,v,p,o,n;u=(z.length-1)*y;t=Math.floor(u);u-=t;x[0]=t==0?t:t-1;x[1]=t;x[2]=t>z.length-2?t:t+1;x[3]=t>z.length-3?t:t+2;t=z[x[0]];p=z[x[1]];o=z[x[2]];n=z[x[3]];x=u*u;v=u*x;w[0]=this.interpolate(t[0],p[0],o[0],n[0],u,x,v);w[1]=this.interpolate(t[1],p[1],o[1],n[1],u,x,v);w[2]=this.interpolate(t[2],p[2],o[2],n[2],u,x,v);return w};THREE.Animation.prototype.interpolate=function(m,k,u,t,o,n,p){m=(u-m)*0.5;t=(t-k)*0.5;return(2*(k-u)+m+t)*p+(-3*(k-u)-2*m-t)*n+m*o+k};THREE.Animation.prototype.getNextKeyWith=function(h,f,m){var k=this.data.hierarchy[f].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?m=m<k.length-1?m:k.length-1:m%=k.length;m<k.length;m++){if(k[m][h]!==void 0){return k[m]}}return this.data.hierarchy[f].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(h,f,m){for(var k=this.data.hierarchy[f].keys,m=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?m>0?m:0:m>=0?m:m+k.length;m>=0;m--){if(k[m][h]!==void 0){return k[m]}}return this.data.hierarchy[f].keys[k.length-1]};THREE.CubeCamera=function(h,f,m,k){this.cameraPX=new THREE.PerspectiveCamera(90,1,h,f);this.cameraNX=new THREE.PerspectiveCamera(90,1,h,f);this.cameraPY=new THREE.PerspectiveCamera(90,1,h,f);this.cameraNY=new THREE.PerspectiveCamera(90,1,h,f);this.cameraPZ=new THREE.PerspectiveCamera(90,1,h,f);this.cameraNZ=new THREE.PerspectiveCamera(90,1,h,f);this.cameraPXTarget=new THREE.Vector3(0,0,0);this.cameraNXTarget=new THREE.Vector3(0,0,0);this.cameraPYTarget=new THREE.Vector3(0,0,0);this.cameraNYTarget=new THREE.Vector3(0,0,0);this.cameraPZTarget=new THREE.Vector3(0,0,0);this.cameraNZTarget=new THREE.Vector3(0,0,0);this.height=m;this.position=new THREE.Vector3(0,m,0);this.cameraPX.position=this.position;this.cameraNX.position=this.position;this.cameraPY.position=this.position;this.cameraNY.position=this.position;this.cameraPZ.position=this.position;this.cameraNZ.position=this.position;this.cameraPY.up.set(0,0,1);this.cameraPZ.up.set(0,-1,0);this.cameraNZ.up.set(0,-1,0);this.renderTarget=new THREE.WebGLRenderTargetCube(k,k,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updatePosition=function(b){this.position.x=b.x;this.position.z=b.z;this.cameraPXTarget.add(this.position,new THREE.Vector3(-1,0,0));this.cameraNXTarget.add(this.position,new THREE.Vector3(1,0,0));this.cameraPYTarget.add(this.position,new THREE.Vector3(0,1,0));this.cameraNYTarget.add(this.position,new THREE.Vector3(0,-1,0));this.cameraPZTarget.add(this.position,new THREE.Vector3(0,0,1));this.cameraNZTarget.add(this.position,new THREE.Vector3(0,0,-1));this.cameraPX.lookAt(this.cameraPXTarget);this.cameraNX.lookAt(this.cameraNXTarget);this.cameraPY.lookAt(this.cameraPYTarget);this.cameraNY.lookAt(this.cameraNYTarget);this.cameraPZ.lookAt(this.cameraPZTarget);this.cameraNZ.lookAt(this.cameraNZTarget)};this.updateCubeMap=function(n,o){var e=this.renderTarget;n.setFaceCulling("back","cw");o.scale.y=-1;o.position.y=2*this.height;o.updateMatrix();e.activeCubeFace=0;n.render(o,this.cameraPX,e);e.activeCubeFace=1;n.render(o,this.cameraNX,e);o.scale.y=1;o.position.y=0;o.updateMatrix();o.scale.x=-1;o.updateMatrix();e.activeCubeFace=2;n.render(o,this.cameraPY,e);o.scale.x=1;o.updateMatrix();n.setFaceCulling("back","ccw");e.activeCubeFace=3;n.render(o,this.cameraNY,e);o.scale.x=-1;o.updateMatrix();n.setFaceCulling("back","cw");e.activeCubeFace=4;n.render(o,this.cameraPZ,e);e.activeCubeFace=5;n.render(o,this.cameraNZ,e);o.scale.x=1;o.updateMatrix();n.setFaceCulling("back","ccw")}};THREE.FirstPersonCamera=function(){console.warn("DEPRECATED: FirstPersonCamera() is FirstPersonControls().")};THREE.PathCamera=function(){console.warn("DEPRECATED: PathCamera() is PathControls().")};THREE.FlyCamera=function(){console.warn("DEPRECATED: FlyCamera() is FlyControls().")};THREE.RollCamera=function(){console.warn("DEPRECATED: RollCamera() is RollControls().")};THREE.TrackballCamera=function(){console.warn("DEPRECATED: TrackballCamera() is TrackballControls().")};THREE.CombinedCamera=function(m,k,u,t,o,n,p){THREE.Camera.call(this);this.cameraO=new THREE.OrthographicCamera(m/-2,m/2,k/2,k/-2,n,p);this.cameraP=new THREE.PerspectiveCamera(u,m/k,t,o);this.toPerspective()};THREE.CombinedCamera.prototype=new THREE.Camera;THREE.CombinedCamera.prototype.constructor=THREE.CoolCamera;THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.projectionMatrix=this.cameraP.projectionMatrix};THREE.CombinedCamera.prototype.toOrthographic=function(){this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix};THREE.CombinedCamera.prototype.setFov=function(b){this.cameraP.fov=b;this.cameraP.updateProjectionMatrix();this.toPerspective()};THREE.CombinedCamera.prototype.setLens=function(f,e){e||(e=43.25);var h=2*Math.atan(e/(f*2));h*=180/Math.PI;this.setFov(h);return h};THREE.FirstPersonControls=function(f,e){function h(b,k){return function(){k.apply(b,arguments)}}this.object=f;this.target=new THREE.Vector3(0,0,0);this.domElement=e!==void 0?e:document;this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.lastUpdate=(new Date).getTime();this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=this.tdiff=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));this.onMouseDown=function(b){this.domElement!==document&&this.domElement.focus();b.preventDefault();b.stopPropagation();if(this.activeLook){switch(b.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(b){b.preventDefault();b.stopPropagation();if(this.activeLook){switch(b.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(b){this.domElement===document?(this.mouseX=b.pageX-this.viewHalfX,this.mouseY=b.pageY-this.viewHalfY):(this.mouseX=b.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=b.pageY-this.domElement.offsetTop-this.viewHalfY)};this.onKeyDown=function(b){switch(b.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(b){switch(b.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(){var m=(new Date).getTime();this.tdiff=(m-this.lastUpdate)/1000;this.lastUpdate=m;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.object.position.y<this.heightMin?this.heightMin:this.object.position.y>this.heightMax?this.heightMax:this.object.position.y)-this.heightMin)*this.heightCoef:0;var n=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(n);this.moveLeft&&this.object.translateX(-n);this.moveRight&&this.object.translateX(n);this.moveUp&&this.object.translateY(n);this.moveDown&&this.object.translateY(-n);n=this.tdiff*this.lookSpeed;this.activeLook||(n=0);this.lon+=this.mouseX*n;this.lookVertical&&(this.lat-=this.mouseY*n);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var m=this.target,k=this.object.position;m.x=k.x+100*Math.sin(this.phi)*Math.cos(this.theta);m.y=k.y+100*Math.cos(this.phi);m.z=k.z+100*Math.sin(this.phi)*Math.sin(this.theta)}m=1;this.constrainVertical&&(m=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*n;this.lookVertical&&(this.lat-=this.mouseY*n*m);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/(Math.PI-0)+this.verticalMin}m=this.target;k=this.object.position;m.x=k.x+100*Math.sin(this.phi)*Math.cos(this.theta);m.y=k.y+100*Math.cos(this.phi);m.z=k.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(m)};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousemove",h(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",h(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",h(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",h(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",h(this,this.onKeyUp),!1)};THREE.PathControls=function(n,m){function w(b){if((b*=2)<1){return 0.5*b*b}return -0.5*(--b*(b-2)-1)}function v(b,e){return function(){e.apply(b,arguments)}}function t(H,F,G,D){var C={name:G,fps:0.6,length:D,hierarchy:[]},A,B=F.getControlPointsArray(),y=F.getLength(),x=B.length,E=0;A=x-1;F={parent:-1,keys:[]};F.keys[0]={time:0,pos:B[0],rot:[0,0,0,1],scl:[1,1,1]};F.keys[A]={time:D,pos:B[A],rot:[0,0,0,1],scl:[1,1,1]};for(A=1;A<x-1;A++){E=D*y.chunks[A]/y.total,F.keys[A]={time:E,pos:B[A]}}C.hierarchy[0]=F;THREE.AnimationHandler.add(C);return new THREE.Animation(H,G,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function p(k,z){var h,y,x=new THREE.Geometry;for(h=0;h<k.points.length*z;h++){y=h/(k.points.length*z),y=k.getPoint(y),x.vertices[h]=new THREE.Vertex(new THREE.Vector3(y.x,y.y,y.z))}return x}this.object=n;this.domElement=m!==void 0?m:document;this.id="PathControls"+THREE.PathControlsIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new THREE.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2,this.domElement.setAttribute("tabindex",-1));var u=Math.PI*2,o=Math.PI/180;this.update=function(){var f,c;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*o;this.theta=this.lon*o;f=this.phi%u;this.phi=f>=0?f:f+u;f=this.verticalAngleMap.srcRange;c=this.verticalAngleMap.dstRange;var h=c[1]-c[0];this.phi=w(((this.phi-f[0])*(c[1]-c[0])/(f[1]-f[0])+c[0]-c[0])/h)*h+c[0];f=this.horizontalAngleMap.srcRange;c=this.horizontalAngleMap.dstRange;h=c[1]-c[0];this.theta=w(((this.theta-f[0])*(c[1]-c[0])/(f[1]-f[0])+c[0]-c[0])/h)*h+c[0];f=this.target.position;f.x=100*Math.sin(this.phi)*Math.cos(this.theta);f.y=100*Math.cos(this.phi);f.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(b){this.domElement===document?(this.mouseX=b.pageX-this.viewHalfX,this.mouseY=b.pageY-this.viewHalfY):(this.mouseX=b.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=b.pageY-this.domElement.offsetTop-this.viewHalfY)};this.init=function(){this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var h=new THREE.MeshLambertMaterial({color:30719}),z=new THREE.MeshLambertMaterial({color:65280}),e=new THREE.CubeGeometry(10,10,20),y=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(e,h);h=new THREE.Mesh(y,z);h.position.set(0,10,0);this.animation=t(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(h)}else{this.animation=t(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object)}if(this.createDebugPath){var h=this.debugPath,z=this.spline,e=p(z,10),y=p(z,10),x=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(e,x);particleObj=new THREE.ParticleSystem(y,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);h.add(lineObj);particleObj.scale.set(1,1,1);h.add(particleObj);y=new THREE.SphereGeometry(1,16,8);x=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<z.points.length;i++){e=new THREE.Mesh(y,x),e.position.copy(z.points[i]),h.add(e)}}this.domElement.addEventListener("mousemove",v(this,this.onMouseMove),!1)}};THREE.PathControlsIdCounter=0;THREE.FlyControls=function(f,e){function h(b,k){return function(){k.apply(b,arguments)}}this.object=f;this.domElement=e!==void 0?e:document;e&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.object.useQuaternion=!0;this.tmpQuaternion=new THREE.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(b){if(typeof this[b.type]=="function"){this[b.type](b)}};this.keydown=function(b){if(!b.altKey){switch(b.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(b){switch(b.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(b){this.domElement!==document&&this.domElement.focus();b.preventDefault();b.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(b.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}}};this.mousemove=function(m){if(!this.dragToLook||this.mouseStatus>0){var o=this.getContainerDimensions(),k=o.size[0]/2,n=o.size[1]/2;this.moveState.yawLeft=-(m.pageX-o.offset[0]-k)/k;this.moveState.pitchDown=(m.pageY-o.offset[1]-n)/n;this.updateRotationVector()}};this.mouseup=function(b){b.preventDefault();b.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(b.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(){var b=(new Date).getTime();if(this.lastUpdate==-1){this.lastUpdate=b}this.tdiff=(b-this.lastUpdate)/1000;this.lastUpdate=b;var b=this.tdiff*this.movementSpeed,k=this.tdiff*this.rollSpeed;this.object.translateX(this.moveVector.x*b);this.object.translateY(this.moveVector.y*b);this.object.translateZ(this.moveVector.z*b);this.tmpQuaternion.set(this.rotationVector.x*k,this.rotationVector.y*k,this.rotationVector.z*k,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=!0};this.updateMovementVector=function(){var b=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-b+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",h(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",h(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",h(this,this.mouseup),!1);this.domElement.addEventListener("keydown",h(this,this.keydown),!1);this.domElement.addEventListener("keyup",h(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.RollControls=function(G,F){this.object=G;this.domElement=F!==void 0?F:document;this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var E=new THREE.Vector3,D=new THREE.Vector3,B=new THREE.Vector3,A=new THREE.Matrix4,C=!1,z=1,y=0,x=0,w=0,p=0,J=0,I=window.innerWidth/2,H=window.innerHeight/2;this.update=function(){var b=(new Date).getTime();if(this.lastUpdate==-1){this.lastUpdate=b}this.delta=(b-this.lastUpdate)/1000;this.lastUpdate=b;this.mouseLook&&(b=this.delta*this.lookSpeed,this.rotateHorizontally(b*p),this.rotateVertically(b*J));b=this.delta*this.movementSpeed;this.object.translateZ(-b*(y>0||this.autoForward&&!(y<0)?1:y));this.object.translateX(b*x);this.object.translateY(b*w);C&&(this.roll+=this.rollSpeed*this.delta*z);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}B.copy(this.forward);D.set(0,1,0);E.cross(D,B).normalize();D.cross(B,E).normalize();this.object.matrix.n11=E.x;this.object.matrix.n12=D.x;this.object.matrix.n13=B.x;this.object.matrix.n21=E.y;this.object.matrix.n22=D.y;this.object.matrix.n23=B.y;this.object.matrix.n31=E.z;this.object.matrix.n32=D.z;this.object.matrix.n33=B.z;A.identity();A.n11=Math.cos(this.roll);A.n12=-Math.sin(this.roll);A.n21=Math.sin(this.roll);A.n22=Math.cos(this.roll);this.object.matrix.multiplySelf(A);this.object.matrixWorldNeedsUpdate=!0;this.object.matrix.n14=this.object.position.x;this.object.matrix.n24=this.object.position.y;this.object.matrix.n34=this.object.position.z};this.translateX=function(b){this.object.position.x+=this.object.matrix.n11*b;this.object.position.y+=this.object.matrix.n21*b;this.object.position.z+=this.object.matrix.n31*b};this.translateY=function(b){this.object.position.x+=this.object.matrix.n12*b;this.object.position.y+=this.object.matrix.n22*b;this.object.position.z+=this.object.matrix.n32*b};this.translateZ=function(b){this.object.position.x-=this.object.matrix.n13*b;this.object.position.y-=this.object.matrix.n23*b;this.object.position.z-=this.object.matrix.n33*b};this.rotateHorizontally=function(b){E.set(this.object.matrix.n11,this.object.matrix.n21,this.object.matrix.n31);E.multiplyScalar(b);this.forward.subSelf(E);this.forward.normalize()};this.rotateVertically=function(b){D.set(this.object.matrix.n12,this.object.matrix.n22,this.object.matrix.n32);D.multiplyScalar(b);this.forward.addSelf(D);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(b){p=(b.clientX-I)/window.innerWidth;J=(b.clientY-H)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();switch(b.button){case 0:y=1;break;case 2:y=-1}},!1);this.domElement.addEventListener("mouseup",function(b){b.preventDefault();b.stopPropagation();switch(b.button){case 0:y=0;break;case 2:y=0}},!1);this.domElement.addEventListener("keydown",function(b){switch(b.keyCode){case 38:case 87:y=1;break;case 37:case 65:x=-1;break;case 40:case 83:y=-1;break;case 39:case 68:x=1;break;case 81:C=!0;z=1;break;case 69:C=!0;z=-1;break;case 82:w=1;break;case 70:w=-1}},!1);this.domElement.addEventListener("keyup",function(b){switch(b.keyCode){case 38:case 87:y=0;break;case 37:case 65:x=0;break;case 40:case 83:y=0;break;case 39:case 68:x=0;break;case 81:C=!1;break;case 69:C=!1;break;case 82:w=0;break;case 70:w=0}},!1)};THREE.TrackballControls=function(D,C){function B(b,e){return function(){e.apply(b,arguments)}}this.object=D;this.domElement=C!==void 0?C:document;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.staticMoving=this.noPan=this.noZoom=!1;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3(0,0,0);var A=!1,y=this.STATE.NONE,x=new THREE.Vector3,z=new THREE.Vector3,w=new THREE.Vector3,v=new THREE.Vector2,u=new THREE.Vector2,t=new THREE.Vector2,p=new THREE.Vector2;this.handleEvent=function(b){if(typeof this[b.type]=="function"){this[b.type](b)}};this.getMouseOnScreen=function(b,e){return new THREE.Vector2((b-this.screen.offsetLeft)/this.radius*0.5,(e-this.screen.offsetTop)/this.radius*0.5)};this.getMouseProjectionOnBall=function(h,m){var f=new THREE.Vector3((h-this.screen.width*0.5-this.screen.offsetLeft)/this.radius,(this.screen.height*0.5+this.screen.offsetTop-m)/this.radius,0),k=f.length();k>1?f.normalize():f.z=Math.sqrt(1-k*k);x.copy(this.object.position).subSelf(this.target);k=this.object.up.clone().setLength(f.y);k.addSelf(this.object.up.clone().crossSelf(x).setLength(f.x));k.addSelf(x.setLength(f.z));return k};this.rotateCamera=function(){var f=Math.acos(z.dot(w)/z.length()/w.length());if(f){var h=(new THREE.Vector3).cross(z,w).normalize(),e=new THREE.Quaternion;f*=this.rotateSpeed;e.setFromAxisAngle(h,-f);e.multiplyVector3(x);e.multiplyVector3(this.object.up);e.multiplyVector3(w);this.staticMoving?z=w:(e.setFromAxisAngle(h,f*(this.dynamicDampingFactor-1)),e.multiplyVector3(z))}};this.zoomCamera=function(){var b=1+(u.y-v.y)*this.zoomSpeed;b!==1&&b>0&&(x.multiplyScalar(b),this.staticMoving?v=u:v.y+=(u.y-v.y)*this.dynamicDampingFactor)};this.panCamera=function(){var b=p.clone().subSelf(t);if(b.lengthSq()){b.multiplyScalar(x.length()*this.panSpeed);var e=x.clone().crossSelf(this.object.up).setLength(b.x);e.addSelf(this.object.up.clone().setLength(b.y));this.object.position.addSelf(e);this.target.addSelf(e);this.staticMoving?t=p:t.addSelf(b.sub(p,t).multiplyScalar(this.dynamicDampingFactor))}};this.checkDistances=function(){if(!this.noZoom||!this.noPan){this.object.position.lengthSq()>this.maxDistance*this.maxDistance&&this.object.position.setLength(this.maxDistance),x.lengthSq()<this.minDistance*this.minDistance&&this.object.position.add(this.target,x.setLength(this.minDistance))}};this.update=function(){x.copy(this.object.position).subSelf(this.target);this.rotateCamera();this.noZoom||this.zoomCamera();this.noPan||this.panCamera();this.object.position.add(this.target,x);this.checkDistances();this.object.lookAt(this.target)};this.domElement.addEventListener("contextmenu",function(b){b.preventDefault()},!1);this.domElement.addEventListener("mousemove",B(this,function(b){A&&(z=w=this.getMouseProjectionOnBall(b.clientX,b.clientY),v=u=this.getMouseOnScreen(b.clientX,b.clientY),t=p=this.getMouseOnScreen(b.clientX,b.clientY),A=!1);y!==this.STATE.NONE&&(y===this.STATE.ROTATE?w=this.getMouseProjectionOnBall(b.clientX,b.clientY):y===this.STATE.ZOOM&&!this.noZoom?u=this.getMouseOnScreen(b.clientX,b.clientY):y===this.STATE.PAN&&!this.noPan&&(p=this.getMouseOnScreen(b.clientX,b.clientY)))}),!1);this.domElement.addEventListener("mousedown",B(this,function(b){b.preventDefault();b.stopPropagation();if(y===this.STATE.NONE){y=b.button,y===this.STATE.ROTATE?z=w=this.getMouseProjectionOnBall(b.clientX,b.clientY):y===this.STATE.ZOOM&&!this.noZoom?v=u=this.getMouseOnScreen(b.clientX,b.clientY):this.noPan||(t=p=this.getMouseOnScreen(b.clientX,b.clientY))}}),!1);this.domElement.addEventListener("mouseup",B(this,function(b){b.preventDefault();b.stopPropagation();y=this.STATE.NONE}),!1);window.addEventListener("keydown",B(this,function(b){if(y===this.STATE.NONE){if(b.keyCode===this.keys[this.STATE.ROTATE]){y=this.STATE.ROTATE}else{if(b.keyCode===this.keys[this.STATE.ZOOM]&&!this.noZoom){y=this.STATE.ZOOM}else{if(b.keyCode===this.keys[this.STATE.PAN]&&!this.noPan){y=this.STATE.PAN}}}y!==this.STATE.NONE&&(A=!0)}}),!1);window.addEventListener("keyup",B(this,function(){if(y!==this.STATE.NONE){y=this.STATE.NONE}}),!1)};THREE.TrackballControls.prototype.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};THREE.CubeGeometry=function(G,F,E,D,B,A,C,z){function y(ae,ac,ad,ab,aa,Z,X,Y){var U,V,S=D||1,R=B||1,W=aa/2,T=Z/2,Q=x.vertices.length;if(ae=="x"&&ac=="y"||ae=="y"&&ac=="x"){U="z"}else{if(ae=="x"&&ac=="z"||ae=="z"&&ac=="x"){U="y",R=A||1}else{if(ae=="z"&&ac=="y"||ae=="y"&&ac=="z"){U="x",S=A||1}}}var m=S+1,h=R+1;aa/=S;var P=Z/R;for(V=0;V<h;V++){for(Z=0;Z<m;Z++){var e=new THREE.Vector3;e[ae]=(Z*aa-W)*ad;e[ac]=(V*P-T)*ab;e[U]=X;x.vertices.push(new THREE.Vertex(e))}}for(V=0;V<R;V++){for(Z=0;Z<S;Z++){x.faces.push(new THREE.Face4(Z+m*V+Q,Z+m*(V+1)+Q,Z+1+m*(V+1)+Q,Z+1+m*V+Q,null,null,Y)),x.faceVertexUvs[0].push([new THREE.UV(Z/S,V/R),new THREE.UV(Z/S,(V+1)/R),new THREE.UV((Z+1)/S,(V+1)/R),new THREE.UV((Z+1)/S,V/R)])}}}THREE.Geometry.call(this);var x=this,w=G/2,p=F/2,J=E/2;if(C!==void 0){if(C instanceof Array){this.materials=C}else{this.materials=[];for(var I=0;I<6;I++){this.materials.push([C])}}}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(z!=void 0){for(var H in z){this.sides[H]!=void 0&&(this.sides[H]=z[H])}}this.sides.px&&y("z","y",-1,-1,E,F,w,this.materials[0]);this.sides.nx&&y("z","y",1,-1,E,F,-w,this.materials[1]);this.sides.py&&y("x","z",1,1,G,E,p,this.materials[2]);this.sides.ny&&y("x","z",1,-1,G,E,-p,this.materials[3]);this.sides.pz&&y("x","y",1,-1,G,F,J,this.materials[4]);this.sides.nz&&y("x","y",-1,-1,G,F,-J,this.materials[5]);this.mergeVertices();this.computeCentroids();this.computeFaceNormals()};THREE.CubeGeometry.prototype=new THREE.Geometry;THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry;THREE.CylinderGeometry=function(X,W,V,U,S,R){THREE.Geometry.call(this);var X=X!=null?X:20,W=W!=null?W:20,V=V||100,T=V/2,U=U||8,S=S||1,Q,P,O=[],N=[];for(P=0;P<=S;P++){var M=[],I=[],H=P/S,G=H*(W-X)+X;for(Q=0;Q<=U;Q++){var C=Q/U;this.vertices.push(new THREE.Vertex(new THREE.Vector3(G*Math.sin(C*Math.PI*2),-H*V+T,G*Math.cos(C*Math.PI*2))));M.push(this.vertices.length-1);I.push(new THREE.UV(C,H))}O.push(M);N.push(I)}for(P=0;P<S;P++){for(Q=0;Q<U;Q++){var V=O[P][Q],M=O[P+1][Q],I=O[P+1][Q+1],H=O[P][Q+1],G=this.vertices[V].position.clone().setY(0).normalize(),C=this.vertices[M].position.clone().setY(0).normalize(),L=this.vertices[I].position.clone().setY(0).normalize(),B=this.vertices[H].position.clone().setY(0).normalize(),F=N[P][Q].clone(),E=N[P+1][Q].clone(),K=N[P+1][Q+1].clone(),J=N[P][Q+1].clone();this.faces.push(new THREE.Face4(V,M,I,H,[G,C,L,B]));this.faceVertexUvs[0].push([F,E,K,J])}}if(!R&&X>0){this.vertices.push(new THREE.Vertex(new THREE.Vector3(0,T,0)));for(Q=0;Q<U;Q++){V=O[0][Q],M=O[0][Q+1],I=this.vertices.length-1,G=new THREE.Vector3(0,1,0),C=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,1,0),F=N[0][Q].clone(),E=N[0][Q+1].clone(),K=new THREE.UV(E.u,0),this.faces.push(new THREE.Face3(V,M,I,[G,C,L])),this.faceVertexUvs[0].push([F,E,K])}}if(!R&&W>0){this.vertices.push(new THREE.Vertex(new THREE.Vector3(0,-T,0)));for(Q=0;Q<U;Q++){V=O[P][Q+1],M=O[P][Q],I=this.vertices.length-1,G=new THREE.Vector3(0,-1,0),C=new THREE.Vector3(0,-1,0),L=new THREE.Vector3(0,-1,0),F=N[P][Q+1].clone(),E=N[P][Q].clone(),K=new THREE.UV(E.u,1),this.faces.push(new THREE.Face3(V,M,I,[G,C,L])),this.faceVertexUvs[0].push([F,E,K])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=new THREE.Geometry;THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(h,f){if(typeof h!="undefined"){THREE.Geometry.call(this);var h=h instanceof Array?h:[h],n,m=h.length,k;this.shapebb=h[m-1].getBoundingBox();for(n=0;n<m;n++){k=h[n],this.addShape(k,f)}this.computeCentroids();this.computeFaceNormals()}};THREE.ExtrudeGeometry.prototype=new THREE.Geometry;THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShape=function(aM,aL){function aK(f,h,e){h||console.log("die");return h.clone().multiplyScalar(e).addSelf(f)}function aJ(x,v,w){var u=THREE.ExtrudeGeometry.__v1,t=THREE.ExtrudeGeometry.__v2,o=THREE.ExtrudeGeometry.__v3,p=THREE.ExtrudeGeometry.__v4,n=THREE.ExtrudeGeometry.__v5,m=THREE.ExtrudeGeometry.__v6;u.set(x.x-v.x,x.y-v.y);t.set(x.x-w.x,x.y-w.y);u=u.normalize();t=t.normalize();o.set(-u.y,u.x);p.set(t.y,-t.x);n.copy(x).addSelf(o);m.copy(x).addSelf(p);if(n.equals(m)){return p.clone()}n.copy(v).addSelf(o);m.copy(w).addSelf(p);o=u.dot(p);p=m.subSelf(n).dot(p);o==0&&(console.log("Either infinite or no solutions!"),p==0?console.log("Its finite solutions."):console.log("Too bad, no solutions."));p/=o;if(p<0){return v=Math.atan2(v.y-x.y,v.x-x.x),x=Math.atan2(w.y-x.y,w.x-x.x),v>x&&(x+=Math.PI*2),anglec=(v+x)/2,new THREE.Vector2(-Math.cos(anglec),-Math.sin(anglec))}return u.multiplyScalar(p).addSelf(n).subSelf(x).clone()}function aH(y){for(ap=y.length;--ap>=0;){Y=ap;aa=ap-1;aa<0&&(aa=y.length-1);for(var w=0,x=ay+aC*2,w=0;w<x;w++){var v=ad*w,u=ad*(w+1),p=ab+Y+v,t=ab+Y+u,n=p,v=ab+aa+v,u=ab+aa+u,k=t;n+=ai;v+=ai;u+=ai;k+=ai;ak.faces.push(new THREE.Face4(n,v,u,k,null,null,ar));ar&&(n=w/x,v=(w+1)/x,u=aF+aE*2,p=(ak.vertices[p].position.z+aE)/u,t=(ak.vertices[t].position.z+aE)/u,ak.faceVertexUvs[0].push([new THREE.UV(p,n),new THREE.UV(t,n),new THREE.UV(t,v),new THREE.UV(p,v)]))}}}function aG(f,h,e){ak.vertices.push(new THREE.Vertex(new THREE.Vector3(f,h,e)))}function aI(m,u,k){m+=ai;u+=ai;k+=ai;ak.faces.push(new THREE.Face3(m,u,k,null,null,av));if(av){var t=ao.maxY,p=ao.maxX,n=ak.vertices[u].position.x,u=ak.vertices[u].position.y,o=ak.vertices[k].position.x,k=ak.vertices[k].position.y;ak.faceVertexUvs[0].push([new THREE.UV(ak.vertices[m].position.x/p,ak.vertices[m].position.y/t),new THREE.UV(n/p,u/t),new THREE.UV(o/p,k/t)])}}var aF=aL.amount!==void 0?aL.amount:100,aE=aL.bevelThickness!==void 0?aL.bevelThickness:6,aD=aL.bevelSize!==void 0?aL.bevelSize:aE-2,aC=aL.bevelSegments!==void 0?aL.bevelSegments:3,aB=aL.bevelEnabled!==void 0?aL.bevelEnabled:!0,az=aL.curveSegments!==void 0?aL.curveSegments:12,ay=aL.steps!==void 0?aL.steps:1,ax=aL.bendPath,au=aL.extrudePath,aA,at=!1,aw=aL.useSpacedPoints!==void 0?aL.useSpacedPoints:!1,av=aL.material,ar=aL.extrudeMaterial,ao=this.shapebb;if(au){aA=au.getPoints(az),ay=aA.length,at=!0,aB=!1}aB||(aD=aE=aC=0);var aq,an,aj,ak=this,ai=this.vertices.length;ax&&aM.addWrapPath(ax);az=aw?aM.extractAllSpacedPoints(az):aM.extractAllPoints(az);ax=az.shape;az=az.holes;if(au=!THREE.Shape.Utils.isClockWise(ax)){ax=ax.reverse();an=0;for(aj=az.length;an<aj;an++){aq=az[an],THREE.Shape.Utils.isClockWise(aq)&&(az[an]=aq.reverse())}au=!1}au=THREE.Shape.Utils.triangulateShape(ax,az);aw=ax;an=0;for(aj=az.length;an<aj;an++){aq=az[an],ax=ax.concat(aq)}var ap,am,ah,af,ae,ag,ad=ax.length,al=au.length,Z=[];ap=0;am=aw.length;Y=am-1;for(aa=ap+1;ap<am;ap++,Y++,aa++){Y==am&&(Y=0),aa==am&&(aa=0),Z[ap]=aJ(aw[ap],aw[Y],aw[aa])}var ac=[],X,W=Z.concat();an=0;for(aj=az.length;an<aj;an++){aq=az[an];X=[];ap=0;am=aq.length;Y=am-1;for(aa=ap+1;ap<am;ap++,Y++,aa++){Y==am&&(Y=0),aa==am&&(aa=0),X[ap]=aJ(aq[ap],aq[Y],aq[aa])}ac.push(X);W=W.concat(X)}for(ah=0;ah<aC;ah++){af=ah/aC;ae=aE*(1-af);af=aD*Math.sin(af*Math.PI/2);ap=0;for(am=aw.length;ap<am;ap++){ag=aK(aw[ap],Z[ap],af),aG(ag.x,ag.y,-ae)}an=0;for(aj=az.length;an<aj;an++){aq=az[an];X=ac[an];ap=0;for(am=aq.length;ap<am;ap++){ag=aK(aq[ap],X[ap],af),aG(ag.x,ag.y,-ae)}}}af=aD;for(ap=0;ap<ad;ap++){ag=aB?aK(ax[ap],W[ap],af):ax[ap],at?aG(ag.x,ag.y+aA[0].y,aA[0].x):aG(ag.x,ag.y,0)}for(ah=1;ah<=ay;ah++){for(ap=0;ap<ad;ap++){ag=aB?aK(ax[ap],W[ap],af):ax[ap],at?aG(ag.x,ag.y+aA[ah-1].y,aA[ah-1].x):aG(ag.x,ag.y,aF/ay*ah)}}for(ah=aC-1;ah>=0;ah--){af=ah/aC;ae=aE*(1-af);af=aD*Math.sin(af*Math.PI/2);ap=0;for(am=aw.length;ap<am;ap++){ag=aK(aw[ap],Z[ap],af),aG(ag.x,ag.y,aF+ae)}an=0;for(aj=az.length;an<aj;an++){aq=az[an];X=ac[an];ap=0;for(am=aq.length;ap<am;ap++){ag=aK(aq[ap],X[ap],af),at?aG(ag.x,ag.y+aA[ay-1].y,aA[ay-1].x+ae):aG(ag.x,ag.y,aF+ae)}}}if(aB){aB=ad*0;for(ap=0;ap<al;ap++){aD=au[ap],aI(aD[2]+aB,aD[1]+aB,aD[0]+aB)}aB=ad*(ay+aC*2);for(ap=0;ap<al;ap++){aD=au[ap],aI(aD[0]+aB,aD[1]+aB,aD[2]+aB)}}else{for(ap=0;ap<al;ap++){aD=au[ap],aI(aD[2],aD[1],aD[0])}for(ap=0;ap<al;ap++){aD=au[ap],aI(aD[0]+ad*ay,aD[1]+ad*ay,aD[2]+ad*ay)}}var Y,aa,ab=0;aH(aw);ab+=aw.length;an=0;for(aj=az.length;an<aj;an++){aq=az[an],aH(aq),ab+=aq.length}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.IcosahedronGeometry=function(B){function A(h,m,f){var k=Math.sqrt(h*h+m*m+f*f);return w.vertices.push(new THREE.Vertex(new THREE.Vector3(h/k,m/k,f/k)))-1}function z(h,m,f,k){k.faces.push(new THREE.Face3(h,m,f))}function y(b,m){var k=w.vertices[b].position,h=w.vertices[m].position;return A((k.x+h.x)/2,(k.y+h.y)/2,(k.z+h.z)/2)}var w=this,v=new THREE.Geometry;this.subdivisions=B||0;THREE.Geometry.call(this);B=(1+Math.sqrt(5))/2;A(-1,B,0);A(1,B,0);A(-1,-B,0);A(1,-B,0);A(0,-1,B);A(0,1,B);A(0,-1,-B);A(0,1,-B);A(B,0,-1);A(B,0,1);A(-B,0,-1);A(-B,0,1);z(0,11,5,v);z(0,5,1,v);z(0,1,7,v);z(0,7,10,v);z(0,10,11,v);z(1,5,9,v);z(5,11,4,v);z(11,10,2,v);z(10,7,6,v);z(7,1,8,v);z(3,9,4,v);z(3,4,2,v);z(3,2,6,v);z(3,6,8,v);z(3,8,9,v);z(4,9,5,v);z(2,4,11,v);z(6,2,10,v);z(8,6,7,v);z(9,8,1,v);for(var x=0;x<this.subdivisions;x++){var B=new THREE.Geometry,u;for(u in v.faces){var t=y(v.faces[u].a,v.faces[u].b),p=y(v.faces[u].b,v.faces[u].c),o=y(v.faces[u].c,v.faces[u].a);z(v.faces[u].a,t,o,B);z(v.faces[u].b,p,t,B);z(v.faces[u].c,o,p,B);z(t,p,o,B)}v.faces=B.faces}w.faces=v.faces;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.IcosahedronGeometry.prototype=new THREE.Geometry;THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.LatheGeometry=function(x,w,v){THREE.Geometry.call(this);this.steps=w||12;this.angle=v||2*Math.PI;for(var w=this.angle/this.steps,v=[],u=[],p=[],o=[],t=(new THREE.Matrix4).setRotationZ(w),n=0;n<x.length;n++){this.vertices.push(new THREE.Vertex(x[n])),v[n]=x[n].clone(),u[n]=this.vertices.length-1}for(var m=0;m<=this.angle+0.001;m+=w){for(n=0;n<v.length;n++){m<this.angle?(v[n]=t.multiplyVector3(v[n].clone()),this.vertices.push(new THREE.Vertex(v[n])),p[n]=this.vertices.length-1):p=o}m==0&&(o=u);for(n=0;n<u.length-1;n++){this.faces.push(new THREE.Face4(p[n],p[n+1],u[n+1],u[n])),this.faceVertexUvs[0].push([new THREE.UV(1-m/this.angle,n/x.length),new THREE.UV(1-m/this.angle,(n+1)/x.length),new THREE.UV(1-(m-w)/this.angle,(n+1)/x.length),new THREE.UV(1-(m-w)/this.angle,n/x.length)])}u=p;p=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=new THREE.Geometry;THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.OctahedronGeometry=function(x,w){function v(f){var e=f.clone().normalize(),e=new THREE.Vertex(e.clone().multiplyScalar(x));e.index=t.vertices.push(e)-1;e.uv=new THREE.UV(Math.atan2(f.z,-f.x)/2/Math.PI+0.5,Math.atan2(-f.y,Math.sqrt(f.x*f.x+f.z*f.z))/Math.PI+0.5);return e}function u(f,y,e,h){h<1?(h=new THREE.Face3(f.index,y.index,e.index,[f.position,y.position,e.position]),h.centroid.addSelf(f.position).addSelf(y.position).addSelf(e.position).divideScalar(3),h.normal=h.centroid.clone().normalize(),t.faces.push(h),h=Math.atan2(h.centroid.z,-h.centroid.x),t.faceVertexUvs[0].push([o(f.uv,f.position,h),o(y.uv,y.position,h),o(e.uv,e.position,h)])):(h-=1,u(f,p(f,y),p(f,e),h),u(p(f,y),y,p(y,e),h),u(p(f,e),p(y,e),e,h),u(p(f,y),p(y,e),p(f,e),h))}function p(f,c){n[f.index]||(n[f.index]=[]);n[c.index]||(n[c.index]=[]);var h=n[f.index][c.index];h===void 0&&(n[f.index][c.index]=n[c.index][f.index]=h=v((new THREE.Vector3).add(f.position,c.position).divideScalar(2)));return h}function o(f,h,e){e<0&&f.u===1&&(f=new THREE.UV(f.u-1,f.v));h.x===0&&h.z===0&&(f=new THREE.UV(e/2/Math.PI+0.5,f.v));return f}THREE.Geometry.call(this);var w=isFinite(w)?w:3,t=this;v(new THREE.Vector3(1,0,0));v(new THREE.Vector3(-1,0,0));v(new THREE.Vector3(0,1,0));v(new THREE.Vector3(0,-1,0));v(new THREE.Vector3(0,0,1));v(new THREE.Vector3(0,0,-1));var n=[],m=this.vertices;u(m[0],m[2],m[4],w);u(m[0],m[4],m[3],w);u(m[0],m[3],m[5],w);u(m[0],m[5],m[2],w);u(m[1],m[2],m[5],w);u(m[1],m[5],m[3],w);u(m[1],m[3],m[4],w);u(m[1],m[4],m[2],w);this.boundingSphere={radius:x}};THREE.OctahedronGeometry.prototype=new THREE.Geometry;THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.PlaneGeometry=function(z,y,x,w){THREE.Geometry.call(this);var u,t=z/2,v=y/2,x=x||1,w=w||1,p=x+1,o=w+1;z/=x;var n=y/w;for(u=0;u<o;u++){for(y=0;y<p;y++){this.vertices.push(new THREE.Vertex(new THREE.Vector3(y*z-t,-(u*n-v),0)))}}for(u=0;u<w;u++){for(y=0;y<x;y++){this.faces.push(new THREE.Face4(y+p*u,y+p*(u+1),y+1+p*(u+1),y+1+p*u)),this.faceVertexUvs[0].push([new THREE.UV(y/x,u/w),new THREE.UV(y/x,(u+1)/w),new THREE.UV((y+1)/x,(u+1)/w),new THREE.UV((y+1)/x,u/w)])}}this.computeCentroids();this.computeFaceNormals()};THREE.PlaneGeometry.prototype=new THREE.Geometry;THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.SphereGeometry=function(K,J,H){THREE.Geometry.call(this);for(var K=K||50,G,E=Math.PI,D=Math.max(3,J||8),F=Math.max(2,H||6),J=[],H=0;H<F+1;H++){G=H/F;var C=K*Math.cos(G*E),B=K*Math.sin(G*E),A=[],z=0;for(G=0;G<D;G++){var x=2*G/D,N=B*Math.sin(x*E),x=B*Math.cos(x*E);(H==0||H==F)&&G>0||(z=this.vertices.push(new THREE.Vertex(new THREE.Vector3(x,C,N)))-1);A.push(z)}J.push(A)}for(var M,L,I,E=J.length,H=0;H<E;H++){if(D=J[H].length,H>0){for(G=0;G<D;G++){A=G==D-1;F=J[H][A?0:G+1];C=J[H][A?D-1:G];B=J[H-1][A?D-1:G];A=J[H-1][A?0:G+1];N=H/(E-1);M=(H-1)/(E-1);L=(G+1)/D;var x=G/D,z=new THREE.UV(1-L,N),N=new THREE.UV(1-x,N),x=new THREE.UV(1-x,M),w=new THREE.UV(1-L,M);H<J.length-1&&(M=this.vertices[F].position.clone(),L=this.vertices[C].position.clone(),I=this.vertices[B].position.clone(),M.normalize(),L.normalize(),I.normalize(),this.faces.push(new THREE.Face3(F,C,B,[new THREE.Vector3(M.x,M.y,M.z),new THREE.Vector3(L.x,L.y,L.z),new THREE.Vector3(I.x,I.y,I.z)])),this.faceVertexUvs[0].push([z,N,x]));H>1&&(M=this.vertices[F].position.clone(),L=this.vertices[B].position.clone(),I=this.vertices[A].position.clone(),M.normalize(),L.normalize(),I.normalize(),this.faces.push(new THREE.Face3(F,B,A,[new THREE.Vector3(M.x,M.y,M.z),new THREE.Vector3(L.x,L.y,L.z),new THREE.Vector3(I.x,I.y,I.z)])),this.faceVertexUvs[0].push([z,x,w]))}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:K}};THREE.SphereGeometry.prototype=new THREE.Geometry;THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(h,f){var m=(new THREE.TextPath(h,f)).toShapes();f.amount=f.height!==void 0?f.height:50;if(f.bevelThickness===void 0){f.bevelThickness=10}if(f.bevelSize===void 0){f.bevelSize=8}if(f.bevelEnabled===void 0){f.bevelEnabled=!1}if(f.bend){var k=m[m.length-1].getBoundingBox().maxX;f.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(k/2,120),new THREE.Vector2(k,0))}THREE.ExtrudeGeometry.call(this,m,f)};THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry;THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},getTextShapes:function(e,c){return(new TextPath(e,c)).toShapes()},loadFace:function(e){var c=e.familyName.toLowerCase();this.faces[c]=this.faces[c]||{};this.faces[c][e.cssFontWeight]=this.faces[c][e.cssFontWeight]||{};this.faces[c][e.cssFontWeight][e.cssFontStyle]=e;return this.faces[c][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(n){for(var m=this.getFace(),w=this.size/m.resolution,v=0,t=String(n).split(""),p=t.length,u=[],n=0;n<p;n++){var o=new THREE.Path,o=this.extractGlyphPoints(t[n],m,w,v,o);v+=o.offset;u.push(o.path)}return{paths:u,offset:v/2}},extractGlyphPoints:function(R,Q,P,O,M){var L=[],N,K,J,I,H,G,E,D,C,A,F=Q.glyphs[R]||Q.glyphs[ctxt.options.fallbackCharacter];if(F){if(F.o){Q=F._cachedOutline||(F._cachedOutline=F.o.split(" "));J=Q.length;for(R=0;R<J;){switch(K=Q[R++],K){case"m":K=Q[R++]*P+O;I=Q[R++]*P;L.push(new THREE.Vector2(K,I));M.moveTo(K,I);break;case"l":K=Q[R++]*P+O;I=Q[R++]*P;L.push(new THREE.Vector2(K,I));M.lineTo(K,I);break;case"q":K=Q[R++]*P+O;I=Q[R++]*P;E=Q[R++]*P+O;D=Q[R++]*P;M.quadraticCurveTo(E,D,K,I);if(N=L[L.length-1]){H=N.x;G=N.y;N=1;for(divisions=this.divisions;N<=divisions;N++){var x=N/divisions,B=THREE.Shape.Utils.b2(x,H,E,K),x=THREE.Shape.Utils.b2(x,G,D,I);L.push(new THREE.Vector2(B,x))}}break;case"b":if(K=Q[R++]*P+O,I=Q[R++]*P,E=Q[R++]*P+O,D=Q[R++]*-P,C=Q[R++]*P+O,A=Q[R++]*-P,M.bezierCurveTo(K,I,E,D,C,A),N=L[L.length-1]){H=N.x;G=N.y;N=1;for(divisions=this.divisions;N<=divisions;N++){x=N/divisions,B=THREE.Shape.Utils.b3(x,H,E,C,K),x=THREE.Shape.Utils.b3(x,G,D,A,I),L.push(new THREE.Vector2(B,x))}}}}}return{offset:F.ha*P,points:L,path:M}}}};(function(e){var c=function(m){for(var k=m.length,o=0,n=k-1,p=0;p<k;n=p++){o+=m[n].x*m[p].y-m[p].x*m[n].y}return o*0.5};e.Triangulate=function(aD,aC){var aA=aD.length;if(aA<3){return null}var az=[],aB=[],ay=[],ax,aw,av;if(c(aD)>0){for(aw=0;aw<aA;aw++){aB[aw]=aw}}else{for(aw=0;aw<aA;aw++){aB[aw]=aA-1-aw}}var au=2*aA;for(aw=aA-1;aA>2;){if(au--<=0){console.log("Warning, unable to triangulate polygon!");if(aC){return ay}return az}ax=aw;aA<=ax&&(ax=0);aw=ax+1;aA<=aw&&(aw=0);av=aw+1;aA<=av&&(av=0);var ar;aD:{ar=aD;var aq=ax,ap=aw,am=av,at=aA,al=aB,ao=void 0,an=void 0,ak=void 0,ah=void 0,aj=void 0,ag=void 0,ac=void 0,ad=void 0,ab=void 0,an=ar[al[aq]].x,ak=ar[al[aq]].y,ah=ar[al[ap]].x,aj=ar[al[ap]].y,ag=ar[al[am]].x,ac=ar[al[am]].y;if(1e-10>(ah-an)*(ac-ak)-(aj-ak)*(ag-an)){ar=!1}else{for(ao=0;ao<at;ao++){if(!(ao==aq||ao==ap||ao==am)){var ad=ar[al[ao]].x,ab=ar[al[ao]].y,ai=void 0,af=void 0,aa=void 0,Y=void 0,X=void 0,Z=void 0,W=void 0,ae=void 0,R=void 0,T=void 0,Q=void 0,b=void 0,ai=aa=X=void 0,ai=ag-ah,af=ac-aj,aa=an-ag,Y=ak-ac,X=ah-an,Z=aj-ak,W=ad-an,ae=ab-ak,R=ad-ah,T=ab-aj,Q=ad-ag,b=ab-ac,ai=ai*T-af*R,X=X*ae-Z*W,aa=aa*b-Y*Q;if(ai>=0&&aa>=0&&X>=0){ar=!1;break aD}}}ar=!0}}if(ar){az.push([aD[aB[ax]],aD[aB[aw]],aD[aB[av]]]);ay.push([aB[ax],aB[aw],aB[av]]);ax=aw;for(av=aw+1;av<aA;ax++,av++){aB[ax]=aB[av]}aA--;au=2*aA}}if(aC){return ay}return az};e.Triangulate.area=c;return e})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.TorusGeometry=function(x,w,v,u,p){THREE.Geometry.call(this);this.radius=x||100;this.tube=w||40;this.segmentsR=v||8;this.segmentsT=u||6;this.arc=p||Math.PI*2;p=new THREE.Vector3;x=[];w=[];for(v=0;v<=this.segmentsR;v++){for(u=0;u<=this.segmentsT;u++){var o=u/this.segmentsT*this.arc,t=v/this.segmentsR*Math.PI*2;p.x=this.radius*Math.cos(o);p.y=this.radius*Math.sin(o);var n=new THREE.Vector3;n.x=(this.radius+this.tube*Math.cos(t))*Math.cos(o);n.y=(this.radius+this.tube*Math.cos(t))*Math.sin(o);n.z=this.tube*Math.sin(t);this.vertices.push(new THREE.Vertex(n));x.push(new THREE.UV(u/this.segmentsT,1-v/this.segmentsR));w.push(n.clone().subSelf(p).normalize())}}for(v=1;v<=this.segmentsR;v++){for(u=1;u<=this.segmentsT;u++){var p=(this.segmentsT+1)*v+u-1,o=(this.segmentsT+1)*(v-1)+u-1,t=(this.segmentsT+1)*(v-1)+u,n=(this.segmentsT+1)*v+u,m=new THREE.Face4(p,o,t,n,[w[p],w[o],w[t],w[n]]);m.normal.addSelf(w[p]);m.normal.addSelf(w[o]);m.normal.addSelf(w[t]);m.normal.addSelf(w[n]);m.normal.normalize();this.faces.push(m);this.faceVertexUvs[0].push([x[p].clone(),x[o].clone(),x[t].clone(),x[n].clone()])}}this.computeCentroids()};THREE.TorusGeometry.prototype=new THREE.Geometry;THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(B,A,z,y,w,v,x){function u(m,E,k,D,C,n){E=k/D*m;k=Math.cos(E);return new THREE.Vector3(C*(2+k)*0.5*Math.cos(m),C*(2+k)*Math.sin(m)*0.5,n*C*Math.sin(E)*0.5)}THREE.Geometry.call(this);this.radius=B||200;this.tube=A||40;this.segmentsR=z||64;this.segmentsT=y||8;this.p=w||2;this.q=v||3;this.heightScale=x||1;this.grid=Array(this.segmentsR);z=new THREE.Vector3;y=new THREE.Vector3;v=new THREE.Vector3;for(B=0;B<this.segmentsR;++B){this.grid[B]=Array(this.segmentsT);for(A=0;A<this.segmentsT;++A){var t=B/this.segmentsR*2*this.p*Math.PI,x=A/this.segmentsT*2*Math.PI,w=u(t,x,this.q,this.p,this.radius,this.heightScale),t=u(t+0.01,x,this.q,this.p,this.radius,this.heightScale);z.x=t.x-w.x;z.y=t.y-w.y;z.z=t.z-w.z;y.x=t.x+w.x;y.y=t.y+w.y;y.z=t.z+w.z;v.cross(z,y);y.cross(v,z);v.normalize();y.normalize();t=-this.tube*Math.cos(x);x=this.tube*Math.sin(x);w.x+=t*y.x+x*v.x;w.y+=t*y.y+x*v.y;w.z+=t*y.z+x*v.z;this.grid[B][A]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(w.x,w.y,w.z)))-1}}for(B=0;B<this.segmentsR;++B){for(A=0;A<this.segmentsT;++A){var y=(B+1)%this.segmentsR,v=(A+1)%this.segmentsT,w=this.grid[B][A],z=this.grid[y][A],y=this.grid[y][v],v=this.grid[B][v],x=new THREE.UV(B/this.segmentsR,A/this.segmentsT),t=new THREE.UV((B+1)/this.segmentsR,A/this.segmentsT),p=new THREE.UV((B+1)/this.segmentsR,(A+1)/this.segmentsT),o=new THREE.UV(B/this.segmentsR,(A+1)/this.segmentsT);this.faces.push(new THREE.Face4(w,z,y,v));this.faceVertexUvs[0].push([x,t,p,o])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=new THREE.Geometry;THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.SubdivisionModifier=function(b){this.subdivisions=b===void 0?1:b;this.useOldVertexColors=!1;this.supportUVs=!0};THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier;THREE.SubdivisionModifier.prototype.modify=function(e){for(var c=this.subdivisions;c-->0;){this.smooth(e)}};THREE.SubdivisionModifier.prototype.smooth=function(ad){function ac(B,z,A,y,x,w){var o=new THREE.Face4(B,z,A,y,null,x.color,x.material);if(Z.useOldVertexColors){o.vertexColors=[];for(var h,f,E,I=0;I<4;I++){E=w[I];h=new THREE.Color;h.setRGB(0,0,0);for(var D=0;D<E.length;D++){f=x.vertexColors[E[D]-1],h.r+=f.r,h.g+=f.g,h.b+=f.b}h.r/=E.length;h.g/=E.length;h.b/=E.length;o.vertexColors[I]=h}}Y.push(o);(!Z.supportUVs||S.length!=0)&&X.push([S[B],S[z],S[A],S[y]])}function ab(b,e){return Math.min(b,e)+"_"+Math.max(b,e)}var aa=[],Y=[],X=[],Z=this,W=ad.vertices,aa=ad.faces,V=W.concat(),U=[],T={},S=[],N,L,K,F,R,C=ad.faceVertexUvs[0];N=0;for(L=C.length;N<L;N++){K=0;for(F=C[N].length;K<F;K++){R=aa[N]["abcd".charAt(K)],S[R]||(S[R]=C[N][K])}}var J;N=0;for(L=aa.length;N<L;N++){if(R=aa[N],U.push(R.centroid),V.push(new THREE.Vertex(R.centroid)),Z.supportUVs&&S.length!=0){J=new THREE.UV;if(R instanceof THREE.Face3){J.u=S[R.a].u+S[R.b].u+S[R.c].u,J.v=S[R.a].v+S[R.b].v+S[R.c].v,J.u/=3,J.v/=3}else{if(R instanceof THREE.Face4){J.u=S[R.a].u+S[R.b].u+S[R.c].u+S[R.d].u,J.v=S[R.a].v+S[R.b].v+S[R.c].v+S[R.d].v,J.u/=4,J.v/=4}}S.push(J)}}F=function(m){function c(b,h,f){b[h]===void 0&&(b[h]=[]);b[h].push(f)}var u,t,o,p,n={};u=0;for(t=m.faces.length;u<t;u++){o=m.faces[u],o instanceof THREE.Face3?(p=ab(o.a,o.b),c(n,p,u),p=ab(o.b,o.c),c(n,p,u),p=ab(o.c,o.a),c(n,p,u)):o instanceof THREE.Face4&&(p=ab(o.a,o.b),c(n,p,u),p=ab(o.b,o.c),c(n,p,u),p=ab(o.c,o.d),c(n,p,u),p=ab(o.d,o.a),c(n,p,u))}return n}(ad);var H,Q,O=0,C=W.length,P;for(N in F){if(R=F[N],J=R[0],H=R[1],P=N.split("_"),L=P[0],P=P[1],Q=new THREE.Vector3,R.length!=2?(Q.addSelf(W[L].position),Q.addSelf(W[P].position),Q.multiplyScalar(0.5)):(Q.addSelf(U[J]),Q.addSelf(U[H]),Q.addSelf(W[L].position),Q.addSelf(W[P].position),Q.multiplyScalar(0.25)),T[N]=C+aa.length+O,V.push(new THREE.Vertex(Q)),O++,Z.supportUVs&&S.length!=0){J=new THREE.UV,J.u=S[L].u+S[P].u,J.v=S[L].v+S[P].v,J.u/=2,J.v/=2,S.push(J)}}N=0;for(L=U.length;N<L;N++){R=aa[N],J=C+N,R instanceof THREE.Face3?(H=ab(R.a,R.b),P=ab(R.b,R.c),O=ab(R.c,R.a),ac(J,T[H],R.b,T[P],R,["123","12","2","23"]),ac(J,T[P],R.c,T[O],R,["123","23","3","31"]),ac(J,T[O],R.a,T[H],R,["123","31","1","12"])):R instanceof THREE.Face4?(H=ab(R.a,R.b),P=ab(R.b,R.c),O=ab(R.c,R.d),Q=ab(R.d,R.a),ac(J,T[H],R.b,T[P],R,["1234","12","2","23"]),ac(J,T[P],R.c,T[O],R,["1234","23","3","34"]),ac(J,T[O],R.d,T[Q],R,["1234","34","4","41"]),ac(J,T[Q],R.a,T[H],R,["1234","41","1","12"])):console.log("face should be a face!",R)}var aa=V,M={},G={},V=function(b,e){M[b]===void 0&&(M[b]=[]);M[b].push(e)},T=function(b,e){G[b]===void 0&&(G[b]={});G[b][e]=null};for(N in F){R=F[N],P=N.split("_"),L=P[0],P=P[1],V(L,[L,P]),V(P,[L,P]),J=R[0],H=R[1],T(L,J),H?T(L,H):T(L,J),T(P,J),H?T(P,H):T(P,J)}V=new THREE.Vector3;T=new THREE.Vector3;N=0;for(L=W.length;N<L;N++){if(M[N]!==void 0){V.set(0,0,0);T.set(0,0,0);F=new THREE.Vector3(0,0,0);C=0;for(K in G[N]){V.addSelf(U[K]),C++}V.divideScalar(C);C=M[N].length;for(K=0;K<C;K++){R=M[N][K],R=W[R[0]].position.clone().addSelf(W[R[1]].position).divideScalar(2),T.addSelf(R)}T.divideScalar(C);F.addSelf(W[N].position);F.multiplyScalar(C-3);F.addSelf(V);F.addSelf(T.multiplyScalar(2));F.divideScalar(C);aa[N].position=F}}ad.vertices=aa;ad.faces=Y;ad.faceVertexUvs[0]=X;delete ad.__tmpVertices;ad.computeCentroids();ad.computeFaceNormals();ad.computeVertexNormals()};THREE.Loader=function(b){this.statusDomElement=(this.showStatus=b)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,addStatusElement:function(){var b=document.createElement("div");b.style.position="absolute";b.style.right="0px";b.style.top="0px";b.style.fontSize="0.8em";b.style.textAlign="left";b.style.background="rgba(0,0,0,0.25)";b.style.color="#fff";b.style.width="120px";b.style.padding="0.5em 0.5em 0.5em 0.5em";b.style.zIndex=1000;b.innerHTML="Loading ...";return b},updateProgress:function(e){var c="Loaded ";c+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=c},extractUrlbase:function(b){b=b.split("/");b.pop();return b.length<1?"":b.join("/")+"/"},init_materials:function(h,f,m){h.materials=[];for(var k=0;k<f.length;++k){h.materials[k]=[THREE.Loader.prototype.createMaterial(f[k],m)]}},hasNormals:function(h){var f,m,k=h.materials.length;for(m=0;m<k;m++){if(f=h.materials[m][0],f instanceof THREE.ShaderMaterial){return !0}}return !1},createMaterial:function(E,D){function C(b){b=Math.log(b)/Math.LN2;return Math.floor(b)==b}function B(f,c){var h=new Image;h.onload=function(){if(!C(this.width)||!C(this.height)){var k=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),m=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));f.image.width=k;f.image.height=m;f.image.getContext("2d").drawImage(this,0,0,k,m)}else{f.image=this}f.needsUpdate=!0};h.src=c}function z(e,G,t,n,o,m){var b=document.createElement("canvas");e[G]=new THREE.Texture(b);e[G].sourceFile=t;if(n){e[G].repeat.set(n[0],n[1]);if(n[0]!=1){e[G].wrapS=THREE.RepeatWrapping}if(n[1]!=1){e[G].wrapT=THREE.RepeatWrapping}}o&&e[G].offset.set(o[0],o[1]);if(m){n={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(n[m[0]]!==void 0){e[G].wrapS=n[m[0]]}if(n[m[1]]!==void 0){e[G].wrapT=n[m[1]]}}B(e[G],D+"/"+t)}function y(b){return(b[0]*255<<16)+(b[1]*255<<8)+b[2]*255}var A,x,w;x="MeshLambertMaterial";A={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:E.wireframe};E.shading&&(E.shading=="Phong"?x="MeshPhongMaterial":E.shading=="Basic"&&(x="MeshBasicMaterial"));if(E.blending){if(E.blending=="Additive"){A.blending=THREE.AdditiveBlending}else{if(E.blending=="Subtractive"){A.blending=THREE.SubtractiveBlending}else{if(E.blending=="Multiply"){A.blending=THREE.MultiplyBlending}}}}if(E.transparent!==void 0||E.opacity<1){A.transparent=E.transparent}if(E.depthTest!==void 0){A.depthTest=E.depthTest}if(E.vertexColors!==void 0){if(E.vertexColors=="face"){A.vertexColors=THREE.FaceColors}else{if(E.vertexColors){A.vertexColors=THREE.VertexColors}}}if(E.colorDiffuse){A.color=y(E.colorDiffuse)}else{if(E.DbgColor){A.color=E.DbgColor}}if(E.colorSpecular){A.specular=y(E.colorSpecular)}if(E.colorAmbient){A.ambient=y(E.colorAmbient)}if(E.transparency){A.opacity=E.transparency}if(E.specularCoef){A.shininess=E.specularCoef}E.mapDiffuse&&D&&z(A,"map",E.mapDiffuse,E.mapDiffuseRepeat,E.mapDiffuseOffset,E.mapDiffuseWrap);E.mapLight&&D&&z(A,"lightMap",E.mapLight,E.mapLightRepeat,E.mapLightOffset,E.mapLightWrap);E.mapNormal&&D&&z(A,"normalMap",E.mapNormal,E.mapNormalRepeat,E.mapNormalOffset,E.mapNormalWrap);E.mapSpecular&&D&&z(A,"specularMap",E.mapSpecular,E.mapSpecularRepeat,E.mapSpecularOffset,E.mapSpecularWrap);if(E.mapNormal){var v=THREE.ShaderUtils.lib.normal,u=THREE.UniformsUtils.clone(v.uniforms),p=A.color;x=A.specular;w=A.ambient;var F=A.shininess;u.tNormal.texture=A.normalMap;if(E.mapNormalFactor){u.uNormalScale.value=E.mapNormalFactor}if(A.map){u.tDiffuse.texture=A.map,u.enableDiffuse.value=!0}if(A.specularMap){u.tSpecular.texture=A.specularMap,u.enableSpecular.value=!0}if(A.lightMap){u.tAO.texture=A.lightMap,u.enableAO.value=!0}u.uDiffuseColor.value.setHex(p);u.uSpecularColor.value.setHex(x);u.uAmbientColor.value.setHex(w);u.uShininess.value=F;if(A.opacity){u.uOpacity.value=A.opacity}A=new THREE.ShaderMaterial({fragmentShader:v.fragmentShader,vertexShader:v.vertexShader,uniforms:u,lights:!0,fog:!0})}else{A=new THREE[x](A)}return A}};THREE.BinaryLoader=function(b){THREE.Loader.call(this,b)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;THREE.BinaryLoader.prototype.load=function(k){var f=k.model,p=k.callback,o=k.texture_path?k.texture_path:THREE.Loader.prototype.extractUrlbase(f),n=k.bin_path?k.bin_path:THREE.Loader.prototype.extractUrlbase(f),k=(new Date).getTime(),f=new Worker(f),m=this.showProgress?THREE.Loader.prototype.updateProgress:null;f.onmessage=function(b){THREE.BinaryLoader.prototype.loadAjaxBuffers(b.data.buffers,b.data.materials,p,n,o,m)};f.onerror=function(b){alert("worker.onerror: "+b.message+"\n"+b.data);b.preventDefault()};f.postMessage(k)};THREE.BinaryLoader.prototype.loadAjaxBuffers=function(x,w,v,u,p,o){var t=new XMLHttpRequest,n=u+"/"+x,m=0;t.onreadystatechange=function(){t.readyState==4?t.status==200||t.status==0?THREE.BinaryLoader.prototype.createBinModel(t.responseText,v,p,w):alert("Couldn't load ["+n+"] ["+t.status+"]"):t.readyState==3?o&&(m==0&&(m=t.getResponseHeader("Content-Length")),o({total:m,loaded:t.responseText.length})):t.readyState==2&&(m=t.getResponseHeader("Content-Length"))};t.open("GET",n,!0);t.overrideMimeType("text/plain; charset=x-user-defined");t.setRequestHeader("Content-Type","text/plain");t.send(null)};THREE.BinaryLoader.prototype.createBinModel=function(h,f,n,m){var k=function(aO){function aP(b,w){var v=aK(b,w),u=aK(b,w+1),t=aK(b,w+2),p=aK(b,w+3),o=(p<<1&255|t>>7)-127;v|=(t&127)<<16|u<<8;if(v==0&&o==-127){return 0}return(1-2*(p>>7))*(1+v*Math.pow(2,-23))*Math.pow(2,o)}function aN(p,v){var o=aK(p,v),u=aK(p,v+1),t=aK(p,v+2);return(aK(p,v+3)<<24)+(t<<16)+(u<<8)+o}function aM(p,t){var o=aK(p,t);return(aK(p,t+1)<<8)+o}function aL(p,t){var o=aK(p,t);return o>127?o-256:o}function aK(b,o){return b.charCodeAt(o)&255}function aJ(u){var o,t,p;o=aN(h,u);t=aN(h,u+ay);p=aN(h,u+av);u=aM(h,u+aq);aB.faces.push(new THREE.Face3(o,t,p,null,null,aB.materials[u]))}function aH(C){var D,B,A,z,y,w;D=aN(h,C);B=aN(h,C+ay);A=aN(h,C+av);z=aM(h,C+aq);y=aN(h,C+ar);w=aN(h,C+ap);C=aN(h,C+ax);z=aB.materials[z];var v=az[w*3],u=az[w*3+1];w=az[w*3+2];var E=az[C*3],x=az[C*3+1],C=az[C*3+2];aB.faces.push(new THREE.Face3(D,B,A,[new THREE.Vector3(az[y*3],az[y*3+1],az[y*3+2]),new THREE.Vector3(v,u,w),new THREE.Vector3(E,x,C)],null,z))}function aG(v){var o,u,t,p;o=aN(h,v);u=aN(h,v+au);t=aN(h,v+ao);p=aN(h,v+am);v=aM(h,v+al);aB.faces.push(new THREE.Face4(o,u,t,p,null,null,aB.materials[v]))}function aF(F){var G,E,D,C,B,z,x,w;G=aN(h,F);E=aN(h,F+au);D=aN(h,F+ao);C=aN(h,F+am);B=aM(h,F+al);z=aN(h,F+an);x=aN(h,F+ak);w=aN(h,F+at);F=aN(h,F+ag);B=aB.materials[B];var K=az[x*3],A=az[x*3+1];x=az[x*3+2];var y=az[w*3],I=az[w*3+1];w=az[w*3+2];var J=az[F*3],H=az[F*3+1],F=az[F*3+2];aB.faces.push(new THREE.Face4(G,E,D,C,[new THREE.Vector3(az[z*3],az[z*3+1],az[z*3+2]),new THREE.Vector3(K,A,x),new THREE.Vector3(y,I,w),new THREE.Vector3(J,H,F)],null,B))}function aC(y){var p,w,v,u;p=aN(h,y);w=aN(h,y+aj);v=aN(h,y+ae);y=aw[p*2];u=aw[p*2+1];p=aw[w*2];var t=aB.faceVertexUvs[0];w=aw[w*2+1];var o=aw[v*2];v=aw[v*2+1];var x=[];x.push(new THREE.UV(y,u));x.push(new THREE.UV(p,w));x.push(new THREE.UV(o,v));t.push(x)}function aI(B){var C,A,z,y,x,w;C=aN(h,B);A=aN(h,B+ad);z=aN(h,B+af);y=aN(h,B+ah);B=aw[C*2];x=aw[C*2+1];C=aw[A*2];w=aw[A*2+1];A=aw[z*2];var v=aB.faceVertexUvs[0];z=aw[z*2+1];var u=aw[y*2];y=aw[y*2+1];var t=[];t.push(new THREE.UV(B,x));t.push(new THREE.UV(C,w));t.push(new THREE.UV(A,z));t.push(new THREE.UV(u,y));v.push(t)}var aB=this,aE=0,aD,az=[],aw=[],ay,av,aq,ar,ap,ax,au,ao,am,al,an,ak,at,ag,aj,ae,ad,af,ah,ai,e,ac,aA,ab,aa;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(aB,m,aO);aD={signature:h.substr(aE,8),header_bytes:aK(h,aE+8),vertex_coordinate_bytes:aK(h,aE+9),normal_coordinate_bytes:aK(h,aE+10),uv_coordinate_bytes:aK(h,aE+11),vertex_index_bytes:aK(h,aE+12),normal_index_bytes:aK(h,aE+13),uv_index_bytes:aK(h,aE+14),material_index_bytes:aK(h,aE+15),nvertices:aN(h,aE+16),nnormals:aN(h,aE+16+4),nuvs:aN(h,aE+16+8),ntri_flat:aN(h,aE+16+12),ntri_smooth:aN(h,aE+16+16),ntri_flat_uv:aN(h,aE+16+20),ntri_smooth_uv:aN(h,aE+16+24),nquad_flat:aN(h,aE+16+28),nquad_smooth:aN(h,aE+16+32),nquad_flat_uv:aN(h,aE+16+36),nquad_smooth_uv:aN(h,aE+16+40)};aE+=aD.header_bytes;ay=aD.vertex_index_bytes;av=aD.vertex_index_bytes*2;aq=aD.vertex_index_bytes*3;ar=aD.vertex_index_bytes*3+aD.material_index_bytes;ap=aD.vertex_index_bytes*3+aD.material_index_bytes+aD.normal_index_bytes;ax=aD.vertex_index_bytes*3+aD.material_index_bytes+aD.normal_index_bytes*2;au=aD.vertex_index_bytes;ao=aD.vertex_index_bytes*2;am=aD.vertex_index_bytes*3;al=aD.vertex_index_bytes*4;an=aD.vertex_index_bytes*4+aD.material_index_bytes;ak=aD.vertex_index_bytes*4+aD.material_index_bytes+aD.normal_index_bytes;at=aD.vertex_index_bytes*4+aD.material_index_bytes+aD.normal_index_bytes*2;ag=aD.vertex_index_bytes*4+aD.material_index_bytes+aD.normal_index_bytes*3;aj=aD.uv_index_bytes;ae=aD.uv_index_bytes*2;ad=aD.uv_index_bytes;af=aD.uv_index_bytes*2;ah=aD.uv_index_bytes*3;aO=aD.vertex_index_bytes*3+aD.material_index_bytes;aa=aD.vertex_index_bytes*4+aD.material_index_bytes;ai=aD.ntri_flat*aO;e=aD.ntri_smooth*(aO+aD.normal_index_bytes*3);ac=aD.ntri_flat_uv*(aO+aD.uv_index_bytes*3);aA=aD.ntri_smooth_uv*(aO+aD.normal_index_bytes*3+aD.uv_index_bytes*3);ab=aD.nquad_flat*aa;aO=aD.nquad_smooth*(aa+aD.normal_index_bytes*4);aa=aD.nquad_flat_uv*(aa+aD.uv_index_bytes*4);aE+=function(v){for(var u,p,t,o=aD.vertex_coordinate_bytes*3,b=v+aD.nvertices*o;v<b;v+=o){u=aP(h,v),p=aP(h,v+aD.vertex_coordinate_bytes),t=aP(h,v+aD.vertex_coordinate_bytes*2),aB.vertices.push(new THREE.Vertex(new THREE.Vector3(u,p,t)))}return aD.nvertices*o}(aE);aE+=function(w){for(var o,v,u,p=aD.normal_coordinate_bytes*3,t=w+aD.nnormals*p;w<t;w+=p){o=aL(h,w),v=aL(h,w+aD.normal_coordinate_bytes),u=aL(h,w+aD.normal_coordinate_bytes*2),az.push(o/127,v/127,u/127)}return aD.nnormals*p}(aE);aE+=function(u){for(var t,o,p=aD.uv_coordinate_bytes*2,b=u+aD.nuvs*p;u<b;u+=p){t=aP(h,u),o=aP(h,u+aD.uv_coordinate_bytes),aw.push(t,o)}return aD.nuvs*p}(aE);ai=aE+ai;e=ai+e;ac=e+ac;aA=ac+aA;ab=aA+ab;aO=ab+aO;aa=aO+aa;(function(p){var v,o=aD.vertex_index_bytes*3+aD.material_index_bytes,u=o+aD.uv_index_bytes*3,t=p+aD.ntri_flat_uv*u;for(v=p;v<t;v+=u){aJ(v),aC(v+o)}return t-p})(e);(function(p){var v,o=aD.vertex_index_bytes*3+aD.material_index_bytes+aD.normal_index_bytes*3,u=o+aD.uv_index_bytes*3,t=p+aD.ntri_smooth_uv*u;for(v=p;v<t;v+=u){aH(v),aC(v+o)}return t-p})(ac);(function(p){var v,o=aD.vertex_index_bytes*4+aD.material_index_bytes,u=o+aD.uv_index_bytes*4,t=p+aD.nquad_flat_uv*u;for(v=p;v<t;v+=u){aG(v),aI(v+o)}return t-p})(aO);(function(p){var v,o=aD.vertex_index_bytes*4+aD.material_index_bytes+aD.normal_index_bytes*4,u=o+aD.uv_index_bytes*4,t=p+aD.nquad_smooth_uv*u;for(v=p;v<t;v+=u){aF(v),aI(v+o)}return t-p})(aa);(function(p){var u,o=aD.vertex_index_bytes*3+aD.material_index_bytes,t=p+aD.ntri_flat*o;for(u=p;u<t;u+=o){aJ(u)}return t-p})(aE);(function(p){var u,o=aD.vertex_index_bytes*3+aD.material_index_bytes+aD.normal_index_bytes*3,t=p+aD.ntri_smooth*o;for(u=p;u<t;u+=o){aH(u)}return t-p})(ai);(function(p){var u,o=aD.vertex_index_bytes*4+aD.material_index_bytes,t=p+aD.nquad_flat*o;for(u=p;u<t;u+=o){aG(u)}return t-p})(aA);(function(p){var u,o=aD.vertex_index_bytes*4+aD.material_index_bytes+aD.normal_index_bytes*4,t=p+aD.nquad_smooth*o;for(u=p;u<t;u+=o){aF(u)}return t-p})(ab);this.computeCentroids();this.computeFaceNormals();THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};k.prototype=new THREE.Geometry;k.prototype.constructor=k;f(new k(n))};THREE.ColladaLoader=function(){function a5(m,t,k){for(var m=an.evaluate(m,an,ay,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),p={},o=m.iterateNext(),n=0;o;){o=(new t).parse(o);if(o.id.length==0){o.id=k+n++}p[o.id]=o;o=m.iterateNext()}return p}function a4(){var m=1000000,u=-m,k=0,t;for(t in aK){for(var p=aK[t],n=0;n<p.sampler.length;n++){var o=p.sampler[n];o.create();m=Math.min(m,o.startTime);u=Math.max(u,o.endTime);k=Math.max(k,o.input.length)}}return{start:m,end:u,frames:k}}function a3(k,c,o,n){k.world=k.world||new THREE.Matrix4;k.world.copy(k.matrix);if(k.channels&&k.channels.length){var m=k.channels[0].sampler.output[o];m instanceof THREE.Matrix4&&k.world.copy(m)}n&&k.world.multiply(n,k.world);c.push(k);for(n=0;n<k.nodes.length;n++){a3(k.nodes[n],c,o,k.world)}}function a2(H,F,E){var C=aF[F.url];if(!C||!C.skin){console.log("ColladaLoader: Could not find skin controller.")}else{if(!F.skeleton||!F.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ")}else{var D=a4(),F=ah.getChildById(F.skeleton[0],!0)||ah.getChildBySid(F.skeleton[0],!0),B,A,z,x,c=new THREE.Vector3,b;for(B=0;B<H.vertices.length;B++){C.skin.bindShapeMatrix.multiplyVector3(H.vertices[B].position)}for(E=0;E<D.frames;E++){var L=[],K=[];for(B=0;B<H.vertices.length;B++){K.push(new THREE.Vertex(new THREE.Vector3))}a3(F,L,E);B=L;A=C.skin;for(x=0;x<B.length;x++){if(z=B[x],b=-1,z.type=="JOINT"){for(var J=0;J<A.joints.length;J++){if(z.sid==A.joints[J]){b=J;break}}if(b>=0){J=A.invBindMatrices[b];z.invBindMatrix=J;z.skinningMatrix=new THREE.Matrix4;z.skinningMatrix.multiply(z.world,J);z.weights=[];for(J=0;J<A.weights.length;J++){for(var G=0;G<A.weights[J].length;G++){var I=A.weights[J][G];I.joint==b&&z.weights.push(I)}}}else{throw"ColladaLoader: Could not find joint '"+z.sid+"'."}}}for(B=0;B<L.length;B++){if(L[B].type=="JOINT"){for(A=0;A<L[B].weights.length;A++){z=L[B].weights[A],x=z.index,z=z.weight,b=H.vertices[x],x=K[x],c.x=b.position.x,c.y=b.position.y,c.z=b.position.z,L[B].skinningMatrix.multiplyVector3(c),x.position.x+=c.x*z,x.position.y+=c.y*z,x.position.z+=c.z*z}}}H.morphTargets.push({name:"target_"+E,vertices:K})}}}}function a0(D){var B=new THREE.Object3D,C,A,z;B.name=D.id||"";B.matrixAutoUpdate=!1;B.matrix=D.matrix;for(z=0;z<D.controllers.length;z++){var y=aF[D.controllers[z].url];switch(y.type){case"skin":if(a6[y.skin.source]){var x=new aQ;x.url=y.skin.source;x.instance_material=D.controllers[z].instance_material;D.geometries.push(x);C=D.controllers[z]}else{if(aF[y.skin.source]&&(A=y=aF[y.skin.source],y.morph&&a6[y.morph.source])){x=new aQ,x.url=y.morph.source,x.instance_material=D.controllers[z].instance_material,D.geometries.push(x)}}break;case"morph":if(a6[y.morph.source]){x=new aQ,x.url=y.morph.source,x.instance_material=D.controllers[z].instance_material,D.geometries.push(x),A=D.controllers[z]}console.log("ColladaLoader: Morph-controller partially supported.")}}for(z=0;z<D.geometries.length;z++){var y=D.geometries[z],x=y.instance_material,y=a6[y.url],w={},v=0,t;if(y&&y.mesh&&y.mesh.primitives){if(B.name.length==0){B.name=y.id}if(x){for(j=0;j<x.length;j++){t=x[j];var e=aH[aL[t.target].instance_effect.url].shader;e.material.opacity=!e.material.opacity?1:e.material.opacity;t=w[t.symbol]=e.material;v++}}x=t||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading});y=y.mesh.geometry3js;if(v>1){x=new THREE.MeshFaceMaterial;for(j=0;j<y.faces.length;j++){v=y.faces[j],v.materials=[w[v.daeMaterial]]}}if(C!==void 0){a2(y,C),x.morphTargets=!0,x=new THREE.SkinnedMesh(y,x),x.skeleton=C.skeleton,x.skinController=aF[C.url],x.skinInstanceController=C,x.name="skin_"+ab.length,ab.push(x)}else{if(A!==void 0){w=y;v=A instanceof aS?aF[A.url]:A;if(!v||!v.morph){console.log("could not find morph controller!")}else{v=v.morph;for(e=0;e<v.targets.length;e++){var E=a6[v.targets[e]];if(E.mesh&&E.mesh.primitives&&E.mesh.primitives.length){E=E.mesh.primitives[0].geometry,E.vertices.length===w.vertices.length&&w.morphTargets.push({name:"target_1",vertices:E.vertices})}}w.morphTargets.push({name:"target_Z",vertices:w.vertices})}x.morphTargets=!0;x=new THREE.Mesh(y,x);x.name="morph_"+aG.length;aG.push(x)}else{x=new THREE.Mesh(y,x)}}B.add(x)}}for(z=0;z<D.nodes.length;z++){B.add(a0(D.nodes[z],D))}return B}function aZ(){this.init_from=this.id=""}function a1(){this.type=this.name=this.id="";this.morph=this.skin=null}function aY(){this.weights=this.targets=this.source=this.method=null}function aX(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function aW(){this.name=this.id="";this.nodes=[];this.scene=new THREE.Object3D}function aV(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4}function aU(){this.type=this.sid="";this.data=[];this.matrix=new THREE.Matrix4}function aS(){this.url="";this.skeleton=[];this.instance_material=[]}function aR(){this.target=this.symbol=""}function aQ(){this.url="";this.instance_material=[]}function aN(){this.id="";this.mesh=null}function aT(b){this.geometry=b.id;this.primitives=[];this.geometry3js=this.vertices=null}function aM(){}function aP(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry}function aO(){this.source="";this.stride=this.count=0;this.params=[]}function aE(){this.input={}}function aB(){this.semantic="";this.offset=0;this.source="";this.set=0}function aD(b){this.id=b;this.type=null}function aA(){this.name=this.id="";this.instance_effect=null}function aw(){this.color=new THREE.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texcoord=this.texture=null}function ax(b,e){this.type=b;this.effect=e;this.material=null}function av(b){this.effect=b;this.format=this.init_from=null}function aC(b){this.effect=b;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function az(){this.name=this.id="";this.sampler=this.surface=this.shader=null}function au(){this.url=""}function ar(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function aq(b){this.animation=b;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=null}function at(b){this.id="";this.animation=b;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.output=this.input=null;this.duration=0}function ap(b){var e=b.getAttribute("id");if(ag[e]!=void 0){return ag[e]}ag[e]=(new aD(e)).parse(b);return ag[e]}function ay(b){if(b=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function al(f){for(var f=aj(f).split(/\s+/),h=[],e=0;e<f.length;e++){h.push(parseFloat(f[e]))}return h}function ao(f){for(var f=aj(f).split(/\s+/),h=[],e=0;e<f.length;e++){h.push(parseInt(f[e],10))}return h}function aj(b){return b.replace(/^\s+/,"").replace(/\s+$/,"")}function ai(f,h,e){return f.hasAttribute(h)?parseInt(f.getAttribute(h),10):e}function ak(f,h){if(f===void 0){for(var e="0.";e.length<h+2;){e+="0"}return e}h=h||2;e=f.toString().split(".");for(e[1]=e.length>1?e[1].substr(0,h):"0";e[1].length<h;){e[1]+="0"}return e.join(".")}function am(f,h){var e="";e+=ak(f.x,h)+",";e+=ak(f.y,h)+",";e+=ak(f.z,h);return e}var an=null,ad=null,ah,aJ=null,ag={},af={},aK={},aF={},a6={},aL={},aH={},ac,aI,aG,ab,ae=THREE.SmoothShading;aZ.prototype.parse=function(f){this.id=f.getAttribute("id");for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeName=="init_from"){this.init_from=e.textContent}}return this};a1.prototype.parse=function(f){this.id=f.getAttribute("id");this.name=f.getAttribute("name");this.type="none";for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];switch(e.nodeName){case"skin":this.skin=(new aX).parse(e);this.type=e.nodeName;break;case"morph":this.morph=(new aY).parse(e),this.type=e.nodeName}}return this};aY.prototype.parse=function(k){var o={},h=[],n;this.method=k.getAttribute("method");this.source=k.getAttribute("source").replace(/^#/,"");for(n=0;n<k.childNodes.length;n++){var m=k.childNodes[n];if(m.nodeType==1){switch(m.nodeName){case"source":m=(new aD).parse(m);o[m.id]=m;break;case"targets":h=this.parseInputs(m);break;default:console.log(m.nodeName)}}}for(n=0;n<h.length;n++){switch(k=h[n],m=o[k.source],k.semantic){case"MORPH_TARGET":this.targets=m.read();break;case"MORPH_WEIGHT":this.weights=m.read()}}return this};aY.prototype.parseInputs=function(h){for(var m=[],f=0;f<h.childNodes.length;f++){var k=h.childNodes[f];if(k.nodeType==1){switch(k.nodeName){case"input":m.push((new aB).parse(k))}}}return m};aX.prototype.parse=function(m){var t={},k,p;this.source=m.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var o=0;o<m.childNodes.length;o++){var n=m.childNodes[o];if(n.nodeType==1){switch(n.nodeName){case"bind_shape_matrix":n=al(n.textContent);this.bindShapeMatrix=new THREE.Matrix4;this.bindShapeMatrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]);break;case"source":n=(new aD).parse(n);t[n.id]=n;break;case"joints":k=n;break;case"vertex_weights":p=n;break;default:console.log(n.nodeName)}}}this.parseJoints(k,t);this.parseWeights(p,t);return this};aX.prototype.parseJoints=function(k,o){for(var h=0;h<k.childNodes.length;h++){var n=k.childNodes[h];if(n.nodeType==1){switch(n.nodeName){case"input":var n=(new aB).parse(n),m=o[n.source];if(n.semantic=="JOINT"){this.joints=m.read()}else{if(n.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=m.read()}}}}}};aX.prototype.parseWeights=function(G,E){for(var F,D,C=[],A=0;A<G.childNodes.length;A++){var B=G.childNodes[A];if(B.nodeType==1){switch(B.nodeName){case"input":C.push((new aB).parse(B));break;case"v":F=ao(B.textContent);break;case"vcount":D=ao(B.textContent)}}}for(A=B=0;A<D.length;A++){for(var z=D[A],y=[],x=0;x<z;x++){for(var w={},v=0;v<C.length;v++){var u=C[v],H=F[B+u.offset];switch(u.semantic){case"JOINT":w.joint=H;break;case"WEIGHT":w.weight=E[u.source].data[H]}}y.push(w);B+=C.length}for(x=0;x<y.length;x++){y[x].index=A}this.weights.push(y)}};aW.prototype.getChildById=function(h,m){for(var f=0;f<this.nodes.length;f++){var k=this.nodes[f].getChildById(h,m);if(k){return k}}return null};aW.prototype.getChildBySid=function(h,m){for(var f=0;f<this.nodes.length;f++){var k=this.nodes[f].getChildBySid(h,m);if(k){return k}}return null};aW.prototype.parse=function(f){this.id=f.getAttribute("id");this.name=f.getAttribute("name");this.nodes=[];for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"node":this.nodes.push((new aV).parse(e))}}}return this};aV.prototype.getChannelForTransform=function(n){for(var w=0;w<this.channels.length;w++){var m=this.channels[w],v=m.target.split("/");v.shift();var u=v.shift(),p=u.indexOf(".")>=0,t=u.indexOf("(")>=0,o;if(p){v=u.split("."),u=v.shift(),v.shift()}else{if(t){o=u.split("(");u=o.shift();for(v=0;v<o.length;v++){o[v]=parseInt(o[v].replace(/\)/,""))}}}if(u==n){return m.info={sid:u,dotSyntax:p,arrSyntax:t,arrIndices:o},m}}return null};aV.prototype.getChildById=function(h,m){if(this.id==h){return this}if(m){for(var f=0;f<this.nodes.length;f++){var k=this.nodes[f].getChildById(h,m);if(k){return k}}}return null};aV.prototype.getChildBySid=function(h,m){if(this.sid==h){return this}if(m){for(var f=0;f<this.nodes.length;f++){var k=this.nodes[f].getChildBySid(h,m);if(k){return k}}}return null};aV.prototype.getTransformBySid=function(b){for(var e=0;e<this.transforms.length;e++){if(this.transforms[e].sid==b){return this.transforms[e]}}return null};aV.prototype.parse=function(B){var z;this.id=B.getAttribute("id");this.sid=B.getAttribute("sid");this.name=B.getAttribute("name");this.type=B.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.controllers=[];this.matrix=new THREE.Matrix4;for(var A=0;A<B.childNodes.length;A++){if(z=B.childNodes[A],z.nodeType==1){switch(z.nodeName){case"node":this.nodes.push((new aV).parse(z));break;case"instance_camera":break;case"instance_controller":this.controllers.push((new aS).parse(z));break;case"instance_geometry":this.geometries.push((new aQ).parse(z));break;case"instance_light":break;case"instance_node":z=z.getAttribute("url").replace(/^#/,"");(z=an.evaluate(".//dae:library_nodes//dae:node[@id='"+z+"']",an,ay,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())&&this.nodes.push((new aV).parse(z));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new aU).parse(z));break;case"extra":break;default:console.log(z.nodeName)}}}B=[];A=1000000;z=-1000000;for(var y in aK){for(var x=aK[y],v=0;v<x.channel.length;v++){var w=x.channel[v],u=x.sampler[v];y=w.target.split("/")[0];if(y==this.id){u.create(),w.sampler=u,A=Math.min(A,u.startTime),z=Math.max(z,u.endTime),B.push(w)}}}if(B.length){this.startTime=A,this.endTime=z}if((this.channels=B)&&this.channels.length){y=10000000;for(i=0;i<this.channels.length;i++){B=this.channels[i].sampler;for(A=0;A<B.input.length-1;A++){y=Math.min(y,B.input[A+1]-B.input[A])}}A=[];for(B=this.startTime;B<this.endTime;B+=y){z=B;for(var x={},t=v=void 0,v=0;v<this.channels.length;v++){t=this.channels[v],x[t.sid]=t}w=new THREE.Matrix4;for(v=0;v<this.transforms.length;v++){if(u=this.transforms[v],t=x[u.sid],t!==void 0){for(var o=t.sampler,n,t=0;t<o.input.length-1;t++){if(o.input[t+1]>z){n=o.output[t];break}}w=n!==void 0?n instanceof THREE.Matrix4?w.multiply(w,n):w.multiply(w,u.matrix):w.multiply(w,u.matrix)}else{w=w.multiply(w,u.matrix)}}z=w;A.push({time:B,pos:[z.n14,z.n24,z.n34],rotq:[0,0,0,1],scl:[1,1,1]})}this.keys=A}this.updateMatrix();return this};aV.prototype.updateMatrix=function(){this.matrix.identity();for(var b=0;b<this.transforms.length;b++){this.matrix.multiply(this.matrix,this.transforms[b].matrix)}};aU.prototype.parse=function(b){this.sid=b.getAttribute("sid");this.type=b.nodeName;this.data=al(b.textContent);this.updateMatrix();return this};aU.prototype.updateMatrix=function(){var b=0;this.matrix.identity();switch(this.type){case"matrix":this.matrix.set(this.data[0],this.data[1],this.data[2],this.data[3],this.data[4],this.data[5],this.data[6],this.data[7],this.data[8],this.data[9],this.data[10],this.data[11],this.data[12],this.data[13],this.data[14],this.data[15]);break;case"translate":this.matrix.setTranslation(this.data[0],this.data[1],this.data[2]);break;case"rotate":b=this.data[3]*(Math.PI/180);this.matrix.setRotationAxis(new THREE.Vector3(this.data[0],this.data[1],this.data[2]),b);break;case"scale":this.matrix.setScale(this.data[0],this.data[1],this.data[2])}return this.matrix};aS.prototype.parse=function(h){this.url=h.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var m=0;m<h.childNodes.length;m++){var f=h.childNodes[m];if(f.nodeType==1){switch(f.nodeName){case"skeleton":this.skeleton.push(f.textContent.replace(/^#/,""));break;case"bind_material":if(f=an.evaluate(".//dae:instance_material",f,ay,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(var k=f.iterateNext();k;){this.instance_material.push((new aR).parse(k)),k=f.iterateNext()}}}}}return this};aR.prototype.parse=function(b){this.symbol=b.getAttribute("symbol");this.target=b.getAttribute("target").replace(/^#/,"");return this};aQ.prototype.parse=function(f){this.url=f.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1&&e.nodeName=="bind_material"){if(f=an.evaluate(".//dae:instance_material",e,ay,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null)){for(h=f.iterateNext();h;){this.instance_material.push((new aR).parse(h)),h=f.iterateNext()}}break}}return this};aN.prototype.parse=function(f){this.id=f.getAttribute("id");for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];switch(e.nodeName){case"mesh":this.mesh=(new aT(this)).parse(e)}}return this};aT.prototype.parse=function(m){function t(f,c){var h=am(f.position);o[h]===void 0&&(o[h]={v:f,index:c});return o[h]}this.primitives=[];var k;for(k=0;k<m.childNodes.length;k++){var p=m.childNodes[k];switch(p.nodeName){case"source":ap(p);break;case"vertices":this.vertices=(new aE).parse(p);break;case"triangles":this.primitives.push((new aP).parse(p));break;case"polygons":console.warn("polygon holes not yet supported!");case"polylist":this.primitives.push((new aM).parse(p))}}var o={};this.geometry3js=new THREE.Geometry;p=ag[this.vertices.input.POSITION.source].data;for(m=k=0;k<p.length;k+=3,m++){var n=new THREE.Vertex(new THREE.Vector3(p[k],p[k+1],p[k+2]));t(n,m);this.geometry3js.vertices.push(n)}for(k=0;k<this.primitives.length;k++){primitive=this.primitives[k],primitive.setVertices(this.vertices),this.handlePrimitive(primitive,this.geometry3js,o)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();this.geometry3js.computeVertexNormals();this.geometry3js.computeBoundingBox();return this};aT.prototype.handlePrimitive=function(R,P,Q){var O=0,N,L,M=R.p,K=R.inputs,J,I,H,G=0,F=3,E=[];for(N=0;N<K.length;N++){switch(J=K[N],J.semantic){case"TEXCOORD":E.push(J.set)}}for(;O<M.length;){var D=[],C=[],z={},B=[];R.vcount&&(F=R.vcount[G++]);for(N=0;N<F;N++){for(L=0;L<K.length;L++){switch(J=K[L],source=ag[J.source],I=M[O+N*K.length+J.offset],numParams=source.accessor.params.length,H=I*numParams,J.semantic){case"VERTEX":J=am(P.vertices[I].position);D.push(Q[J].index);break;case"NORMAL":C.push(new THREE.Vector3(source.data[H],source.data[H+1],source.data[H+2]));break;case"TEXCOORD":z[J.set]===void 0&&(z[J.set]=[]);z[J.set].push(new THREE.UV(source.data[H],source.data[H+1]));break;case"COLOR":B.push((new THREE.Color).setRGB(source.data[H],source.data[H+1],source.data[H+2]))}}}var A;F==3?A=new THREE.Face3(D[0],D[1],D[2],[C[0],C[1],C[2]],B.length?B:new THREE.Color):F==4&&(A=new THREE.Face4(D[0],D[1],D[2],D[3],[C[0],C[1],C[2],C[3]],B.length?B:new THREE.Color));A.daeMaterial=R.material;P.faces.push(A);for(L=0;L<E.length;L++){N=z[E[L]],P.faceVertexUvs[L].push([N[0],N[1],N[2]])}O+=K.length*F}};aM.prototype=new aP;aM.prototype.constructor=aM;aP.prototype.setVertices=function(b){for(var e=0;e<this.inputs.length;e++){if(this.inputs[e].source==b.id){this.inputs[e].source=b.input.POSITION.source}}};aP.prototype.parse=function(f){this.inputs=[];this.material=f.getAttribute("material");this.count=ai(f,"count",0);for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];switch(e.nodeName){case"input":this.inputs.push((new aB).parse(f.childNodes[h]));break;case"vcount":this.vcount=ao(e.textContent);break;case"p":this.p=ao(e.textContent)}}return this};aO.prototype.parse=function(h){this.params=[];this.source=h.getAttribute("source");this.count=ai(h,"count",0);this.stride=ai(h,"stride",0);for(var m=0;m<h.childNodes.length;m++){var f=h.childNodes[m];if(f.nodeName=="param"){var k={};k.name=f.getAttribute("name");k.type=f.getAttribute("type");this.params.push(k)}}return this};aE.prototype.parse=function(b){this.id=b.getAttribute("id");for(var e=0;e<b.childNodes.length;e++){b.childNodes[e].nodeName=="input"&&(input=(new aB).parse(b.childNodes[e]),this.input[input.semantic]=input)}return this};aB.prototype.parse=function(b){this.semantic=b.getAttribute("semantic");this.source=b.getAttribute("source").replace(/^#/,"");this.set=ai(b,"set",-1);this.offset=ai(b,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};aD.prototype.parse=function(m){this.id=m.getAttribute("id");for(var t=0;t<m.childNodes.length;t++){var k=m.childNodes[t];switch(k.nodeName){case"bool_array":for(var p=aj(k.textContent).split(/\s+/),o=[],n=0;n<p.length;n++){o.push(p[n]=="true"||p[n]=="1"?!0:!1)}this.data=o;this.type=k.nodeName;break;case"float_array":this.data=al(k.textContent);this.type=k.nodeName;break;case"int_array":this.data=ao(k.textContent);this.type=k.nodeName;break;case"IDREF_array":case"Name_array":this.data=aj(k.textContent).split(/\s+/);this.type=k.nodeName;break;case"technique_common":for(p=0;p<k.childNodes.length;p++){if(k.childNodes[p].nodeName=="accessor"){this.accessor=(new aO).parse(k.childNodes[p]);break}}}}return this};aD.prototype.read=function(){var h=[],m=this.accessor.params[0];switch(m.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(m=0;m<this.data.length;m+=16){var f=this.data.slice(m,m+16),k=new THREE.Matrix4;k.set(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]);h.push(k)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+m.type+".")}return h};aA.prototype.parse=function(b){this.id=b.getAttribute("id");this.name=b.getAttribute("name");for(var e=0;e<b.childNodes.length;e++){if(b.childNodes[e].nodeName=="instance_effect"){this.instance_effect=(new au).parse(b.childNodes[e]);break}}return this};aw.prototype.isColor=function(){return this.texture==null};aw.prototype.isTexture=function(){return this.texture!=null};aw.prototype.parse=function(f){for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"color":e=al(e.textContent);this.color=new THREE.Color(0);this.color.setRGB(e[0],e[1],e[2]);this.color.a=e[3];break;case"texture":this.texture=e.getAttribute("texture"),this.texcoord=e.getAttribute("texcoord")}}}return this};ax.prototype.parse=function(m){for(var t=0;t<m.childNodes.length;t++){var k=m.childNodes[t];if(k.nodeType==1){switch(k.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[k.nodeName]=(new aw).parse(k);break;case"shininess":case"reflectivity":case"transparency":var p;p=an.evaluate(".//dae:float",k,ay,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);for(var o=p.iterateNext(),n=[];o;){n.push(o),o=p.iterateNext()}p=n;p.length>0&&(this[k.nodeName]=parseFloat(p[0].textContent))}}}this.create();return this};ax.prototype.create=function(){var h={},m=this.transparency!==void 0&&this.transparency<1,f;for(f in this){switch(f){case"ambient":case"emission":case"diffuse":case"specular":var k=this[f];if(k instanceof aw){if(k.isTexture()){if(this.effect.sampler&&this.effect.surface&&this.effect.sampler.source==this.effect.surface.sid&&(k=af[this.effect.surface.init_from])){h.map=THREE.ImageUtils.loadTexture(aI+k.init_from),h.map.wrapS=THREE.RepeatWrapping,h.map.wrapT=THREE.RepeatWrapping,h.map.repeat.x=1,h.map.repeat.y=-1}}else{f=="diffuse"?h.color=k.color.getHex():m||(h[f]=k.color.getHex())}}break;case"shininess":case"reflectivity":h[f]=this[f];break;case"transparency":if(m){h.transparent=!0,h.opacity=this[f],m=!0}}}h.shading=ae;return this.material=new THREE.MeshLambertMaterial(h)};av.prototype.parse=function(f){for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"init_from":this.init_from=e.textContent;break;case"format":this.format=e.textContent;break;default:console.log("unhandled Surface prop: "+e.nodeName)}}}return this};aC.prototype.parse=function(f){for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"source":this.source=e.textContent;break;case"minfilter":this.minfilter=e.textContent;break;case"magfilter":this.magfilter=e.textContent;break;case"mipfilter":this.mipfilter=e.textContent;break;case"wrap_s":this.wrap_s=e.textContent;break;case"wrap_t":this.wrap_t=e.textContent;break;default:console.log("unhandled Sampler2D prop: "+e.nodeName)}}}return this};az.prototype.create=function(){if(this.shader==null){return null}};az.prototype.parse=function(f){this.id=f.getAttribute("id");this.name=f.getAttribute("name");this.shader=null;for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(e))}}}return this};az.prototype.parseNewparam=function(h){for(var m=h.getAttribute("sid"),f=0;f<h.childNodes.length;f++){var k=h.childNodes[f];if(k.nodeType==1){switch(k.nodeName){case"surface":this.surface=(new av(this)).parse(k);this.surface.sid=m;break;case"sampler2D":this.sampler=(new aC(this)).parse(k);this.sampler.sid=m;break;case"extra":break;default:console.log(k.nodeName)}}}};az.prototype.parseProfileCOMMON=function(h){for(var m,f=0;f<h.childNodes.length;f++){var k=h.childNodes[f];if(k.nodeType==1){switch(k.nodeName){case"profile_COMMON":this.parseProfileCOMMON(k);break;case"technique":m=k;break;case"newparam":this.parseNewparam(k);break;case"extra":break;default:console.log(k.nodeName)}}}return m};az.prototype.parseTechnique=function(f){for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"lambert":case"blinn":case"phong":this.shader=(new ax(e.nodeName,this)).parse(e)}}}};au.prototype.parse=function(b){this.url=b.getAttribute("url").replace(/^#/,"");return this};ar.prototype.parse=function(f){this.id=f.getAttribute("id");this.name=f.getAttribute("name");this.source={};for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"source":e=(new aD).parse(e);this.source[e.id]=e;break;case"sampler":this.sampler.push((new at(this)).parse(e));break;case"channel":this.channel.push((new aq(this)).parse(e))}}}return this};aq.prototype.parse=function(m){this.source=m.getAttribute("source").replace(/^#/,"");this.target=m.getAttribute("target");var t=this.target.split("/");t.shift();var m=t.shift(),k=m.indexOf(".")>=0,p=m.indexOf("(")>=0,o,n;if(k){t=m.split("."),m=t.shift(),n=t.shift()}else{if(p){o=m.split("(");m=o.shift();for(t=0;t<o.length;t++){o[t]=parseInt(o[t].replace(/\)/,""))}}}this.sid=m;this.dotSyntax=k;this.arrSyntax=p;this.arrIndices=o;this.member=n;return this};at.prototype.parse=function(f){this.id=f.getAttribute("id");this.inputs=[];for(var h=0;h<f.childNodes.length;h++){var e=f.childNodes[h];if(e.nodeType==1){switch(e.nodeName){case"input":this.inputs.push((new aB).parse(e))}}}return this};at.prototype.create=function(){for(var f=0;f<this.inputs.length;f++){var h=this.inputs[f],e=this.animation.source[h.source];switch(h.semantic){case"INPUT":this.input=e.read();break;case"OUTPUT":this.output=e.read();break;case"INTERPOLATION":this.interpolation=e.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(h.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(f=0;f<this.input.length;f++){this.startTime=Math.min(this.startTime,this.input[f]),this.endTime=Math.max(this.endTime,this.input[f])}this.duration=this.endTime-this.startTime}};return{load:function(h,f){if(document.implementation&&document.implementation.createDocument){document.implementation.createDocument("http://www.collada.org/2005/11/COLLADASchema","COLLADA",null);h+="?rnd="+Math.random();var b=new XMLHttpRequest;b.overrideMimeType&&b.overrideMimeType("text/xml");b.onreadystatechange=function(){if(b.readyState==4&&(b.status==0||b.status==200)){aJ=f;var c,k=h;an=b.responseXML;c=aJ;k!==void 0&&(k=k.split("/"),k.pop(),aI=k.length<1?"":k.join("/")+"/");af=a5("//dae:library_images/dae:image",aZ,"image");aL=a5("//dae:library_materials/dae:material",aA,"material");aH=a5("//dae:library_effects/dae:effect",az,"effect");a6=a5("//dae:library_geometries/dae:geometry",aN,"geometry");aF=a5("//dae:library_controllers/dae:controller",a1,"controller");aK=a5("//dae:library_animations/dae:animation",ar,"animation");ac=a5(".//dae:library_visual_scenes/dae:visual_scene",aW,"visual_scene");aG=[];ab=[];(k=an.evaluate(".//dae:scene/dae:instance_visual_scene",an,ay,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext())?(k=k.getAttribute("url").replace(/^#/,""),ah=ac[k]):ah=null;ad=new THREE.Object3D;for(k=0;k<ah.nodes.length;k++){ad.add(a0(ah.nodes[k]))}a4();for(var e in aK){}e={scene:ad,morphs:aG,skins:ab,dae:{images:af,materials:aL,effects:aH,geometries:a6,controllers:aF,animations:aK,visualScenes:ac,scene:ah}};c&&c(e)}};b.open("GET",h,!0);b.send(null)}else{alert("Don't know how to parse XML!")}},setPreferredShading:function(b){ae=b},applySkin:a2,geometries:a6}};THREE.JSONLoader=function(b){THREE.Loader.call(this,b)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;THREE.JSONLoader.prototype.load=function(h){var f=this,n=h.model,m=h.callback,k=h.texture_path?h.texture_path:this.extractUrlbase(n),h=new Worker(n);h.onmessage=function(b){f.createModel(b.data,m,k);f.onLoadComplete()};this.onLoadStart();h.postMessage((new Date).getTime())};THREE.JSONLoader.prototype.createModel=function(h,f,n){var m=new THREE.Geometry,k=h.scale!==void 0?1/h.scale:1;this.init_materials(m,h.materials,n);(function(U){if(h.version===void 0||h.version!=2){console.error("Deprecated file format.")}else{var V,T,S,R,Q,P,K,I,H,C,O,e,G,F,N=h.faces;P=h.vertices;var L=h.normals,M=h.colors,J=0;for(V=0;V<h.uvs.length;V++){h.uvs[V].length&&J++}for(V=0;V<J;V++){m.faceUvs[V]=[],m.faceVertexUvs[V]=[]}R=0;for(Q=P.length;R<Q;){K=new THREE.Vertex,K.position.x=P[R++]*U,K.position.y=P[R++]*U,K.position.z=P[R++]*U,m.vertices.push(K)}R=0;for(Q=N.length;R<Q;){U=N[R++];P=U&1;S=U&2;V=U&4;T=U&8;I=U&16;K=U&32;C=U&64;U&=128;P?(O=new THREE.Face4,O.a=N[R++],O.b=N[R++],O.c=N[R++],O.d=N[R++],P=4):(O=new THREE.Face3,O.a=N[R++],O.b=N[R++],O.c=N[R++],P=3);if(S){S=N[R++],O.materials=m.materials[S]}S=m.faces.length;if(V){for(V=0;V<J;V++){e=h.uvs[V],H=N[R++],F=e[H*2],H=e[H*2+1],m.faceUvs[V][S]=new THREE.UV(F,H)}}if(T){for(V=0;V<J;V++){e=h.uvs[V];G=[];for(T=0;T<P;T++){H=N[R++],F=e[H*2],H=e[H*2+1],G[T]=new THREE.UV(F,H)}m.faceVertexUvs[V][S]=G}}if(I){I=N[R++]*3,T=new THREE.Vector3,T.x=L[I++],T.y=L[I++],T.z=L[I],O.normal=T}if(K){for(V=0;V<P;V++){I=N[R++]*3,T=new THREE.Vector3,T.x=L[I++],T.y=L[I++],T.z=L[I],O.vertexNormals.push(T)}}if(C){K=N[R++],K=new THREE.Color(M[K]),O.color=K}if(U){for(V=0;V<P;V++){K=N[R++],K=new THREE.Color(M[K]),O.vertexColors.push(K)}}m.faces.push(O)}}})(k);(function(){var t,e,p,o;if(h.skinWeights){t=0;for(e=h.skinWeights.length;t<e;t+=2){p=h.skinWeights[t],o=h.skinWeights[t+1],m.skinWeights.push(new THREE.Vector4(p,o,0,0))}}if(h.skinIndices){t=0;for(e=h.skinIndices.length;t<e;t+=2){p=h.skinIndices[t],o=h.skinIndices[t+1],m.skinIndices.push(new THREE.Vector4(p,o,0,0))}}m.bones=h.bones;m.animation=h.animation})();(function(z){if(h.morphTargets!==void 0){var A,y,x,w,p,e,D,C,B;A=0;for(y=h.morphTargets.length;A<y;A++){m.morphTargets[A]={};m.morphTargets[A].name=h.morphTargets[A].name;m.morphTargets[A].vertices=[];C=m.morphTargets[A].vertices;B=h.morphTargets[A].vertices;x=0;for(w=B.length;x<w;x+=3){p=B[x]*z,e=B[x+1]*z,D=B[x+2]*z,C.push(new THREE.Vertex(new THREE.Vector3(p,e,D)))}}}if(h.morphColors!==void 0){A=0;for(y=h.morphColors.length;A<y;A++){m.morphColors[A]={};m.morphColors[A].name=h.morphColors[A].name;m.morphColors[A].colors=[];w=m.morphColors[A].colors;p=h.morphColors[A].colors;z=0;for(x=p.length;z<x;z+=3){e=new THREE.Color(16755200),e.setRGB(p[z],p[z+1],p[z+2]),w.push(e)}}}})(k);m.computeCentroids();m.computeFaceNormals();this.hasNormals(m)&&m.computeTangents();f(m)};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};THREE.SceneLoader.prototype={load:function(h,f){var n=this,m=new Worker(h);m.postMessage(0);var k=THREE.Loader.prototype.extractUrlbase(h);m.onmessage=function(av){function au(e,o){return o=="relativeToHTML"?e:k+"/"+e}function at(){for(ag in af.objects){if(!ad.objects[ag]){if(ac=af.objects[ag],ac.geometry!==void 0){if(al=ad.geometries[ac.geometry]){var e=!1;X=[];for(c=0;c<ac.materials.length;c++){X[c]=ad.materials[ac.materials[c]],e=X[c] instanceof THREE.ShaderMaterial}e&&al.computeTangents();aa=ac.position;r=ac.rotation;q=ac.quaternion;s=ac.scale;q=0;X.length==0&&(X[0]=new THREE.MeshFaceMaterial);X.length>1&&(X=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(al,X);object.name=ag;object.position.set(aa[0],aa[1],aa[2]);q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=ac.visible;ad.scene.add(object);ad.objects[ag]=object;ac.meshCollider&&(e=THREE.CollisionUtils.MeshColliderWBox(object),ad.scene.collisions.colliders.push(e));if(ac.castsShadow){e=new THREE.ShadowVolume(al),ad.scene.add(e),e.position=object.position,e.rotation=object.rotation,e.scale=object.scale}ac.trigger&&ac.trigger.toLowerCase()!="none"&&(e={type:ac.trigger,object:ac},ad.triggers[object.name]=e)}}else{aa=ac.position,r=ac.rotation,q=ac.quaternion,s=ac.scale,q=0,object=new THREE.Object3D,object.name=ag,object.position.set(aa[0],aa[1],aa[2]),q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]),object.scale.set(s[0],s[1],s[2]),object.visible=ac.visible!==void 0?ac.visible:!1,ad.scene.add(object),ad.objects[ag]=object,ad.empties[ag]=object,ac.trigger&&ac.trigger.toLowerCase()!="none"&&(e={type:ac.trigger,object:ac},ad.triggers[object.name]=e)}}}}function ar(e){return function(o){ad.geometries[e]=o;at();T-=1;n.onLoadComplete();ap()}}function aq(e){return function(o){ad.geometries[e]=o}}function ap(){n.callbackProgress({totalModels:U,totalTextures:Q,loadedModels:U-T,loadedTextures:Q-R},ad);n.onLoadProgress();T==0&&R==0&&f(ad)}var ao,ai,ag,ae,Y,an,W,ac,aa,am,aj,al,ah,Z,ab,X,ak,af,V,T,R,U,Q,ad;af=av.data;ab=new THREE.BinaryLoader;V=new THREE.JSONLoader;R=T=0;ad={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};av=!1;for(ag in af.objects){if(ac=af.objects[ag],ac.meshCollider){av=!0;break}}if(av){ad.scene.collisions=new THREE.CollisionSystem}if(af.transform){av=af.transform.position;am=af.transform.rotation;var b=af.transform.scale;av&&ad.scene.position.set(av[0],av[1],av[2]);am&&ad.scene.rotation.set(am[0],am[1],am[2]);b&&ad.scene.scale.set(b[0],b[1],b[2]);(av||am||b)&&ad.scene.updateMatrix()}av=function(){R-=1;ap();n.onLoadComplete()};for(Y in af.cameras){am=af.cameras[Y],am.type=="perspective"?ah=new THREE.PerspectiveCamera(am.fov,am.aspect,am.near,am.far):am.type=="ortho"&&(ah=new THREE.OrthographicCamera(am.left,am.right,am.top,am.bottom,am.near,am.far)),aa=am.position,am=am.target,ah.position.set(aa[0],aa[1],aa[2]),ah.target=new THREE.Vector3(am[0],am[1],am[2]),ad.cameras[Y]=ah}for(ae in af.lights){Y=af.lights[ae],ah=Y.color!==void 0?Y.color:16777215,am=Y.intensity!==void 0?Y.intensity:1,Y.type=="directional"?(aa=Y.direction,ak=new THREE.DirectionalLight(ah,am),ak.position.set(aa[0],aa[1],aa[2]),ak.position.normalize()):Y.type=="point"?(aa=Y.position,d=Y.distance,ak=new THREE.PointLight(ah,am,d),ak.position.set(aa[0],aa[1],aa[2])):Y.type=="ambient"&&(ak=new THREE.AmbientLight(ah)),ad.scene.add(ak),ad.lights[ae]=ak}for(an in af.fogs){ae=af.fogs[an],ae.type=="linear"?Z=new THREE.Fog(0,ae.near,ae.far):ae.type=="exp2"&&(Z=new THREE.FogExp2(0,ae.density)),am=ae.color,Z.color.setRGB(am[0],am[1],am[2]),ad.fogs[an]=Z}if(ad.cameras&&af.defaults.camera){ad.currentCamera=ad.cameras[af.defaults.camera]}if(ad.fogs&&af.defaults.fog){ad.scene.fog=ad.fogs[af.defaults.fog]}am=af.defaults.bgcolor;ad.bgColor=new THREE.Color;ad.bgColor.setRGB(am[0],am[1],am[2]);ad.bgColorAlpha=af.defaults.bgalpha;for(ao in af.geometries){if(an=af.geometries[ao],an.type=="bin_mesh"||an.type=="ascii_mesh"){T+=1,n.onLoadStart()}}U=T;for(ao in af.geometries){an=af.geometries[ao],an.type=="cube"?(al=new THREE.CubeGeometry(an.width,an.height,an.depth,an.segmentsWidth,an.segmentsHeight,an.segmentsDepth,null,an.flipped,an.sides),ad.geometries[ao]=al):an.type=="plane"?(al=new THREE.PlaneGeometry(an.width,an.height,an.segmentsWidth,an.segmentsHeight),ad.geometries[ao]=al):an.type=="sphere"?(al=new THREE.SphereGeometry(an.radius,an.segmentsWidth,an.segmentsHeight),ad.geometries[ao]=al):an.type=="cylinder"?(al=new THREE.CylinderGeometry(an.topRad,an.botRad,an.height,an.radSegs,an.heightSegs),ad.geometries[ao]=al):an.type=="torus"?(al=new THREE.TorusGeometry(an.radius,an.tube,an.segmentsR,an.segmentsT),ad.geometries[ao]=al):an.type=="icosahedron"?(al=new THREE.IcosahedronGeometry(an.subdivisions),ad.geometries[ao]=al):an.type=="bin_mesh"?ab.load({model:au(an.url,af.urlBaseType),callback:ar(ao)}):an.type=="ascii_mesh"?V.load({model:au(an.url,af.urlBaseType),callback:ar(ao)}):an.type=="embedded_mesh"&&(an=af.embeds[an.id])&&V.createModel(an,aq(ao),"")}for(W in af.textures){if(ao=af.textures[W],ao.url instanceof Array){R+=ao.url.length;for(ab=0;ab<ao.url.length;ab++){n.onLoadStart()}}else{R+=1,n.onLoadStart()}}Q=R;for(W in af.textures){ao=af.textures[W];if(ao.mapping!=void 0&&THREE[ao.mapping]!=void 0){ao.mapping=new THREE[ao.mapping]}if(ao.url instanceof Array){ab=[];for(var c=0;c<ao.url.length;c++){ab[c]=au(ao.url[c],af.urlBaseType)}ab=THREE.ImageUtils.loadTextureCube(ab,ao.mapping,av)}else{ab=THREE.ImageUtils.loadTexture(au(ao.url,af.urlBaseType),ao.mapping,av);if(THREE[ao.minFilter]!=void 0){ab.minFilter=THREE[ao.minFilter]}if(THREE[ao.magFilter]!=void 0){ab.magFilter=THREE[ao.magFilter]}if(ao.repeat){ab.repeat.set(ao.repeat[0],ao.repeat[1]);if(ao.repeat[0]!=1){ab.wrapS=THREE.RepeatWrapping}if(ao.repeat[1]!=1){ab.wrapT=THREE.RepeatWrapping}}ao.offset&&ab.offset.set(ao.offset[0],ao.offset[1]);if(ao.wrap){V={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(V[ao.wrap[0]]!==void 0){ab.wrapS=V[ao.wrap[0]]}if(V[ao.wrap[1]]!==void 0){ab.wrapT=V[ao.wrap[1]]}}}ad.textures[W]=ab}for(ai in af.materials){W=af.materials[ai];for(aj in W.parameters){if(aj=="envMap"||aj=="map"||aj=="lightMap"){W.parameters[aj]=ad.textures[W.parameters[aj]]}else{if(aj=="shading"){W.parameters[aj]=W.parameters[aj]=="flat"?THREE.FlatShading:THREE.SmoothShading}else{if(aj=="blending"){W.parameters[aj]=THREE[W.parameters[aj]]?THREE[W.parameters[aj]]:THREE.NormalBlending}else{if(aj=="combine"){W.parameters[aj]=W.parameters[aj]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation}else{if(aj=="vertexColors"){if(W.parameters[aj]=="face"){W.parameters[aj]=THREE.FaceColors}else{if(W.parameters[aj]){W.parameters[aj]=THREE.VertexColors}}}}}}}}if(W.parameters.opacity!==void 0&&W.parameters.opacity<1){W.parameters.transparent=!0}if(W.parameters.normalMap){ao=THREE.ShaderUtils.lib.normal;av=THREE.UniformsUtils.clone(ao.uniforms);ab=W.parameters.color;V=W.parameters.specular;an=W.parameters.ambient;Z=W.parameters.shininess;av.tNormal.texture=ad.textures[W.parameters.normalMap];if(W.parameters.normalMapFactor){av.uNormalScale.value=W.parameters.normalMapFactor}if(W.parameters.map){av.tDiffuse.texture=W.parameters.map,av.enableDiffuse.value=!0}if(W.parameters.lightMap){av.tAO.texture=W.parameters.lightMap,av.enableAO.value=!0}if(W.parameters.specularMap){av.tSpecular.texture=ad.textures[W.parameters.specularMap],av.enableSpecular.value=!0}av.uDiffuseColor.value.setHex(ab);av.uSpecularColor.value.setHex(V);av.uAmbientColor.value.setHex(an);av.uShininess.value=Z;if(W.parameters.opacity){av.uOpacity.value=W.parameters.opacity}W=new THREE.ShaderMaterial({fragmentShader:ao.fragmentShader,vertexShader:ao.vertexShader,uniforms:av,lights:!0,fog:!0})}else{W=new THREE[W.type](W.parameters)}ad.materials[ai]=W}at();n.callbackSync(ad)}},constructor:THREE.SceneLoader};THREE.UTF8Loader=function(){};THREE.UTF8Loader.prototype=new THREE.UTF8Loader;THREE.UTF8Loader.prototype.constructor=THREE.UTF8Loader;THREE.UTF8Loader.prototype.load=function(n){var m=new XMLHttpRequest,w=n.model,v=n.callback,t=n.scale!==void 0?n.scale:1,p=n.offsetX!==void 0?n.offsetX:0,u=n.offsetY!==void 0?n.offsetY:0,o=n.offsetZ!==void 0?n.offsetZ:0;m.onreadystatechange=function(){m.readyState==4?m.status==200||m.status==0?THREE.UTF8Loader.prototype.createModel(m.responseText,v,t,p,u,o):alert("Couldn't load ["+w+"] ["+m.status+"]"):m.readyState!=3&&m.readyState==2&&m.getResponseHeader("Content-Length")};m.open("GET",w,!0);m.send(null)};THREE.UTF8Loader.prototype.decompressMesh=function(n){var m=n.charCodeAt(0);m>=57344&&(m-=2048);m++;for(var w=new Float32Array(8*m),v=1,t=0;t<8;t++){for(var p=0,u=0;u<m;++u){var o=n.charCodeAt(u+v);p+=o>>1^-(o&1);w[8*u+t]=p}v+=m}m=n.length-v;p=new Uint16Array(m);for(t=u=0;t<m;t++){o=n.charCodeAt(t+v),p[t]=u-o,o==0&&u++}return[w,p]};THREE.UTF8Loader.prototype.createModel=function(m,k,u,t,o,n){var p=function(){var e=this;e.materials=[];THREE.Geometry.call(this);var h=THREE.UTF8Loader.prototype.decompressMesh(m),c=[],v=[];(function(x,y,w){for(var b,C,A,B=x.length;w<B;w+=y){b=x[w],C=x[w+1],A=x[w+2],b=b/16383*u,C=C/16383*u,A=A/16383*u,b+=t,C+=o,A+=n,e.vertices.push(new THREE.Vertex(new THREE.Vector3(b,C,A)))}})(h[0],8,0);(function(x,B,w){for(var A,z,y=x.length;w<y;w+=B){A=x[w],z=x[w+1],A/=1023,z/=1023,v.push(A,1-z)}})(h[0],8,3);(function(x,C,w){for(var B,A,z,y=x.length;w<y;w+=C){B=x[w],A=x[w+1],z=x[w+2],B=(B-512)/511,A=(A-512)/511,z=(z-512)/511,c.push(B,A,z)}})(h[0],8,5);(function(X){var W,V,U,T,S,R,K,z,Q,N=X.length;for(W=0;W<N;W+=3){V=X[W];U=X[W+1];T=X[W+2];S=e;z=V;Q=U;R=T;K=V;var P=U,M=T,y=S.materials[0],G=c[P*3],b=c[P*3+1],P=c[P*3+2],O=c[M*3],L=c[M*3+1],M=c[M*3+2];K=new THREE.Vector3(c[K*3],c[K*3+1],c[K*3+2]);P=new THREE.Vector3(G,b,P);M=new THREE.Vector3(O,L,M);S.faces.push(new THREE.Face3(z,Q,R,[K,P,M],null,y));S=v[V*2];V=v[V*2+1];R=v[U*2];K=v[U*2+1];z=v[T*2];Q=v[T*2+1];T=e.faceVertexUvs[0];U=R;R=K;K=[];K.push(new THREE.UV(S,V));K.push(new THREE.UV(U,R));K.push(new THREE.UV(z,Q));T.push(K)}})(h[1]);this.computeCentroids();this.computeFaceNormals()};p.prototype=new THREE.Geometry;p.prototype.constructor=p;k(new p)};THREE.Axes=function(){THREE.Object3D.call(this);var f=new THREE.Geometry;f.vertices.push(new THREE.Vertex);f.vertices.push(new THREE.Vertex(new THREE.Vector3(0,100,0)));var e=new THREE.CylinderGeometry(0,5,25,5,1),h=new THREE.Line(f,new THREE.LineBasicMaterial({color:16711680}));h.rotation.z=-Math.PI/2;this.add(h);h=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:16711680}));h.position.x=100;h.rotation.z=-Math.PI/2;this.add(h);h=new THREE.Line(f,new THREE.LineBasicMaterial({color:65280}));this.add(h);h=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:65280}));h.position.y=100;this.add(h);h=new THREE.Line(f,new THREE.LineBasicMaterial({color:255}));h.rotation.x=Math.PI/2;this.add(h);h=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:255}));h.position.z=100;h.rotation.x=Math.PI/2;this.add(h)};THREE.Axes.prototype=new THREE.Object3D;THREE.Axes.prototype.constructor=THREE.Axes;THREE.MarchingCubes=function(e,c){THREE.Object3D.call(this);this.materials=c instanceof Array?c:[c];this.init=function(b){this.isolation=80;this.size=b;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(h,f,k){return h+(f-h)*k};this.VIntX=function(B,A,y,x,z,w,v,u,t,p){z=(z-t)/(p-t);t=this.normal_cache;A[x]=w+z*this.delta;A[x+1]=v;A[x+2]=u;y[x]=this.lerp(t[B],t[B+3],z);y[x+1]=this.lerp(t[B+1],t[B+4],z);y[x+2]=this.lerp(t[B+2],t[B+5],z)};this.VIntY=function(B,A,y,x,z,w,v,u,t,p){z=(z-t)/(p-t);t=this.normal_cache;A[x]=w;A[x+1]=v+z*this.delta;A[x+2]=u;A=B+this.yd*3;y[x]=this.lerp(t[B],t[A],z);y[x+1]=this.lerp(t[B+1],t[A+1],z);y[x+2]=this.lerp(t[B+2],t[A+2],z)};this.VIntZ=function(B,A,y,x,z,w,v,u,t,p){z=(z-t)/(p-t);t=this.normal_cache;A[x]=w;A[x+1]=v;A[x+2]=u+z*this.delta;A=B+this.zd*3;y[x]=this.lerp(t[B],t[A],z);y[x+1]=this.lerp(t[B+1],t[A+1],z);y[x+2]=this.lerp(t[B+2],t[A+2],z)};this.compNorm=function(h){var f=h*3;this.normal_cache[f]==0&&(this.normal_cache[f]=this.field[h-1]-this.field[h+1],this.normal_cache[f+1]=this.field[h-this.yd]-this.field[h+this.yd],this.normal_cache[f+2]=this.field[h-this.zd]-this.field[h+this.zd])};this.polygonize=function(ah,ag,ae,ad,af,ac){var ab=ad+1,aa=ad+this.yd,Z=ad+this.zd,Y=ab+this.yd,S=ab+this.zd,Q=ad+this.yd+this.zd,P=ab+this.yd+this.zd,K=0,X=this.field[ad],F=this.field[ab],O=this.field[aa],M=this.field[Y],W=this.field[Z],T=this.field[S],V=this.field[Q],R=this.field[P];X<af&&(K|=1);F<af&&(K|=2);O<af&&(K|=8);M<af&&(K|=4);W<af&&(K|=16);T<af&&(K|=32);V<af&&(K|=128);R<af&&(K|=64);var L=THREE.edgeTable[K];if(L==0){return 0}var N=this.delta,G=ah+N,U=ag+N,N=ae+N;L&1&&(this.compNorm(ad),this.compNorm(ab),this.VIntX(ad*3,this.vlist,this.nlist,0,af,ah,ag,ae,X,F));L&2&&(this.compNorm(ab),this.compNorm(Y),this.VIntY(ab*3,this.vlist,this.nlist,3,af,G,ag,ae,F,M));L&4&&(this.compNorm(aa),this.compNorm(Y),this.VIntX(aa*3,this.vlist,this.nlist,6,af,ah,U,ae,O,M));L&8&&(this.compNorm(ad),this.compNorm(aa),this.VIntY(ad*3,this.vlist,this.nlist,9,af,ah,ag,ae,X,O));L&16&&(this.compNorm(Z),this.compNorm(S),this.VIntX(Z*3,this.vlist,this.nlist,12,af,ah,ag,N,W,T));L&32&&(this.compNorm(S),this.compNorm(P),this.VIntY(S*3,this.vlist,this.nlist,15,af,G,ag,N,T,R));L&64&&(this.compNorm(Q),this.compNorm(P),this.VIntX(Q*3,this.vlist,this.nlist,18,af,ah,U,N,V,R));L&128&&(this.compNorm(Z),this.compNorm(Q),this.VIntY(Z*3,this.vlist,this.nlist,21,af,ah,ag,N,W,V));L&256&&(this.compNorm(ad),this.compNorm(Z),this.VIntZ(ad*3,this.vlist,this.nlist,24,af,ah,ag,ae,X,W));L&512&&(this.compNorm(ab),this.compNorm(S),this.VIntZ(ab*3,this.vlist,this.nlist,27,af,G,ag,ae,F,T));L&1024&&(this.compNorm(Y),this.compNorm(P),this.VIntZ(Y*3,this.vlist,this.nlist,30,af,G,U,ae,M,R));L&2048&&(this.compNorm(aa),this.compNorm(Q),this.VIntZ(aa*3,this.vlist,this.nlist,33,af,ah,U,ae,O,V));K<<=4;for(af=ad=0;THREE.triTable[K+af]!=-1;){ah=K+af,ag=ah+1,ae=ah+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[ah],3*THREE.triTable[ag],3*THREE.triTable[ae],ac),af+=3,ad++}return ad};this.posnormtriv=function(o,m,u,t,v,p){var n=this.count*3;this.positionArray[n]=o[u];this.positionArray[n+1]=o[u+1];this.positionArray[n+2]=o[u+2];this.positionArray[n+3]=o[t];this.positionArray[n+4]=o[t+1];this.positionArray[n+5]=o[t+2];this.positionArray[n+6]=o[v];this.positionArray[n+7]=o[v+1];this.positionArray[n+8]=o[v+2];this.normalArray[n]=m[u];this.normalArray[n+1]=m[u+1];this.normalArray[n+2]=m[u+2];this.normalArray[n+3]=m[t];this.normalArray[n+4]=m[t+1];this.normalArray[n+5]=m[t+2];this.normalArray[n+6]=m[v];this.normalArray[n+7]=m[v+1];this.normalArray[n+8]=m[v+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&p(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(h){if(this.count!=0){for(var f=this.count*3;f<this.positionArray.length;f++){this.positionArray[f]=0}h(this)}};this.addBall=function(R,Q,O,N,P){var M=this.size*Math.sqrt(N/P),L=O*this.size,K=Q*this.size,J=R*this.size,I=Math.floor(L-M);I<1&&(I=1);L=Math.floor(L+M);L>this.size-1&&(L=this.size-1);var G=Math.floor(K-M);G<1&&(G=1);K=Math.floor(K+M);K>this.size-1&&(K=this.size-1);var F=Math.floor(J-M);F<1&&(F=1);M=Math.floor(J+M);M>this.size-1&&(M=this.size-1);for(var E,B,H,A,D,C;I<L;I++){J=this.size2*I;B=I/this.size-O;D=B*B;for(B=G;B<K;B++){H=J+this.size*B;E=B/this.size-Q;C=E*E;for(E=F;E<M;E++){A=E/this.size-R,A=N/(0.000001+A*A+C+D)-P,A>0&&(this.field[H+E]+=A)}}}};this.addPlaneX=function(D,C){var A,z,B,y,x,w=this.size,v=this.yd,p=this.zd,F=this.field,E=w*Math.sqrt(D/C);E>w&&(E=w);for(A=0;A<E;A++){if(z=A/w,z*=z,y=D/(0.0001+z)-C,y>0){for(z=0;z<w;z++){x=A+z*v;for(B=0;B<w;B++){F[p*B+x]+=y}}}}};this.addPlaneY=function(E,D){var B,A,C,z,y,x,w=this.size,p=this.yd,H=this.zd,G=this.field,F=w*Math.sqrt(E/D);F>w&&(F=w);for(A=0;A<F;A++){if(B=A/w,B*=B,z=E/(0.0001+B)-D,z>0){y=A*p;for(B=0;B<w;B++){x=y+B;for(C=0;C<w;C++){G[H*C+x]+=z}}}}};this.addPlaneZ=function(t,o){var w,v,x,u,p,n;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(t/o);dist>size&&(dist=size);for(x=0;x<dist;x++){if(w=x/size,w*=w,u=t/(0.0001+w)-o,u>0){p=zd*x;for(v=0;v<size;v++){n=p+v*yd;for(w=0;w<size;w++){field[n+w]+=u}}}}};this.reset=function(){var b;for(b=0;b<this.size3;b++){this.normal_cache[b*3]=0,this.field[b]=0}};this.render=function(C){this.begin();var B,z,y,A,x,w,v,u,p,D=this.size-2;for(A=1;A<D;A++){p=this.size2*A;v=(A-this.halfsize)/this.halfsize;for(y=1;y<D;y++){u=p+this.size*y;w=(y-this.halfsize)/this.halfsize;for(z=1;z<D;z++){x=(z-this.halfsize)/this.halfsize,B=u+z,this.polygonize(x,w,v,B,this.isolation,C)}}}this.end(C)};this.generateGeometry=function(){var h=0,f=new THREE.Geometry,k=[];this.render(function(y){var z,x,w,v,p,b,B,A;for(z=0;z<y.count;z++){B=z*3,p=B+1,A=B+2,x=y.positionArray[B],w=y.positionArray[p],v=y.positionArray[A],b=new THREE.Vector3(x,w,v),x=y.normalArray[B],w=y.normalArray[p],v=y.normalArray[A],B=new THREE.Vector3(x,w,v),B.normalize(),p=new THREE.Vertex(b),f.vertices.push(p),k.push(B)}nfaces=y.count/3;for(z=0;z<nfaces;z++){B=(h+z)*3,p=B+1,A=B+2,b=k[B],x=k[p],w=k[A],B=new THREE.Face3(B,p,A,[b,x,w]),f.faces.push(B)}h+=nfaces;y.count=0});return f};this.init(e)};THREE.MarchingCubes.prototype=new THREE.Object3D;THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);THREE.PlaneCollider=function(e,c){this.point=e;this.normal=c};THREE.SphereCollider=function(e,c){this.center=e;this.radius=c;this.radiusSq=c*c};THREE.BoxCollider=function(e,c){this.min=e;this.max=c;this.dynamic=!0;this.normal=new THREE.Vector3};THREE.MeshCollider=function(e,c){this.mesh=e;this.box=c;this.numFaces=this.mesh.geometry.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(b){Array.prototype.push.apply(this.colliders,b.colliders);Array.prototype.push.apply(this.hits,b.hits)};THREE.CollisionSystem.prototype.rayCastAll=function(k){k.direction.normalize();this.hits.length=0;var f,p,o,n,m=0;f=0;for(p=this.colliders.length;f<p;f++){if(n=this.colliders[f],o=this.rayCast(k,n),o<Number.MAX_VALUE){n.distance=o,o>m?this.hits.push(n):this.hits.unshift(n),m=o}}return this.hits};THREE.CollisionSystem.prototype.rayCastNearest=function(h){var f=this.rayCastAll(h);if(f.length==0){return null}for(var m=0;f[m] instanceof THREE.MeshCollider;){var k=this.rayMesh(h,f[m]);if(k.dist<Number.MAX_VALUE){f[m].distance=k.dist;f[m].faceIndex=k.faceIndex;break}m++}if(m>f.length){return null}return f[m]};THREE.CollisionSystem.prototype.rayCast=function(e,c){if(c instanceof THREE.PlaneCollider){return this.rayPlane(e,c)}else{if(c instanceof THREE.SphereCollider){return this.raySphere(e,c)}else{if(c instanceof THREE.BoxCollider){return this.rayBox(e,c)}else{if(c instanceof THREE.MeshCollider&&c.box){return this.rayBox(e,c.box)}}}}};THREE.CollisionSystem.prototype.rayMesh=function(B,A){for(var z=this.makeRayLocal(B,A.mesh),y=Number.MAX_VALUE,w,v=0;v<A.numFaces;v++){var x=A.mesh.geometry.faces[v],u=A.mesh.geometry.vertices[x.a].position,t=A.mesh.geometry.vertices[x.b].position,p=A.mesh.geometry.vertices[x.c].position,o=x instanceof THREE.Face4?A.mesh.geometry.vertices[x.d].position:null;x instanceof THREE.Face3?(x=this.rayTriangle(z,u,t,p,y,this.collisionNormal,A.mesh),x<y&&(y=x,w=v,A.normal.copy(this.collisionNormal),A.normal.normalize())):x instanceof THREE.Face4&&(x=this.rayTriangle(z,u,t,o,y,this.collisionNormal,A.mesh),x<y&&(y=x,w=v,A.normal.copy(this.collisionNormal),A.normal.normalize()),x=this.rayTriangle(z,t,p,o,y,this.collisionNormal,A.mesh),x<y&&(y=x,w=v,A.normal.copy(this.collisionNormal),A.normal.normalize()))}return{dist:y,faceIndex:w}};THREE.CollisionSystem.prototype.rayTriangle=function(x,w,v,u,p,o,t){var n=THREE.CollisionSystem.__v1,m=THREE.CollisionSystem.__v2;o.set(0,0,0);n.sub(v,w);m.sub(u,v);o.cross(n,m);n=o.dot(x.direction);if(!(n<0)){if(t.doubleSided||t.flipSided){o.multiplyScalar(-1),n*=-1}else{return Number.MAX_VALUE}}t=o.dot(w)-o.dot(x.origin);if(!(t<=0)){return Number.MAX_VALUE}if(!(t>=n*p)){return Number.MAX_VALUE}t/=n;n=THREE.CollisionSystem.__v3;n.copy(x.direction);n.multiplyScalar(t);n.addSelf(x.origin);Math.abs(o.x)>Math.abs(o.y)?Math.abs(o.x)>Math.abs(o.z)?(x=n.y-w.y,o=v.y-w.y,p=u.y-w.y,n=n.z-w.z,v=v.z-w.z,u=u.z-w.z):(x=n.x-w.x,o=v.x-w.x,p=u.x-w.x,n=n.y-w.y,v=v.y-w.y,u=u.y-w.y):Math.abs(o.y)>Math.abs(o.z)?(x=n.x-w.x,o=v.x-w.x,p=u.x-w.x,n=n.z-w.z,v=v.z-w.z,u=u.z-w.z):(x=n.x-w.x,o=v.x-w.x,p=u.x-w.x,n=n.y-w.y,v=v.y-w.y,u=u.y-w.y);w=o*u-v*p;if(w==0){return Number.MAX_VALUE}w=1/w;u=(x*u-n*p)*w;if(!(u>=0)){return Number.MAX_VALUE}w*=o*n-v*x;if(!(w>=0)){return Number.MAX_VALUE}if(!(1-u-w>=0)){return Number.MAX_VALUE}return t};THREE.CollisionSystem.prototype.makeRayLocal=function(h,f){var m=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(f.matrixWorld,m);var k=THREE.CollisionSystem.__r;k.origin.copy(h.origin);k.direction.copy(h.direction);m.multiplyVector3(k.origin);m.rotateAxis(k.direction);k.direction.normalize();return k};THREE.CollisionSystem.prototype.rayBox=function(z,y){var x;y.dynamic&&y.mesh&&y.mesh.matrixWorld?x=this.makeRayLocal(z,y.mesh):(x=THREE.CollisionSystem.__r,x.origin.copy(z.origin),x.direction.copy(z.direction));var w=0,u=0,t=0,v=0,p=0,o=0,n=!0;x.origin.x<y.min.x?(w=y.min.x-x.origin.x,w/=x.direction.x,n=!1,v=-1):x.origin.x>y.max.x&&(w=y.max.x-x.origin.x,w/=x.direction.x,n=!1,v=1);x.origin.y<y.min.y?(u=y.min.y-x.origin.y,u/=x.direction.y,n=!1,p=-1):x.origin.y>y.max.y&&(u=y.max.y-x.origin.y,u/=x.direction.y,n=!1,p=1);x.origin.z<y.min.z?(t=y.min.z-x.origin.z,t/=x.direction.z,n=!1,o=-1):x.origin.z>y.max.z&&(t=y.max.z-x.origin.z,t/=x.direction.z,n=!1,o=1);if(n){return -1}n=0;u>w&&(n=1,w=u);t>w&&(n=2,w=t);switch(n){case 0:p=x.origin.y+x.direction.y*w;if(p<y.min.y||p>y.max.y){return Number.MAX_VALUE}x=x.origin.z+x.direction.z*w;if(x<y.min.z||x>y.max.z){return Number.MAX_VALUE}y.normal.set(v,0,0);break;case 1:v=x.origin.x+x.direction.x*w;if(v<y.min.x||v>y.max.x){return Number.MAX_VALUE}x=x.origin.z+x.direction.z*w;if(x<y.min.z||x>y.max.z){return Number.MAX_VALUE}y.normal.set(0,p,0);break;case 2:v=x.origin.x+x.direction.x*w;if(v<y.min.x||v>y.max.x){return Number.MAX_VALUE}p=x.origin.y+x.direction.y*w;if(p<y.min.y||p>y.max.y){return Number.MAX_VALUE}y.normal.set(0,0,o)}return w};THREE.CollisionSystem.prototype.rayPlane=function(h,f){var m=h.direction.dot(f.normal),k=f.point.dot(f.normal);if(m<0){m=(k-h.origin.dot(f.normal))/m}else{return Number.MAX_VALUE}return m>0?m:Number.MAX_VALUE};THREE.CollisionSystem.prototype.raySphere=function(h,f){var m=f.center.clone().subSelf(h.origin);if(m.lengthSq<f.radiusSq){return -1}var k=m.dot(h.direction.clone());if(k<=0){return Number.MAX_VALUE}m=f.radiusSq-(m.lengthSq()-k*k);if(m>=0){return Math.abs(k)-Math.sqrt(m)}return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(f){f.geometry.computeBoundingBox();var e=f.geometry.boundingBox,h=new THREE.Vector3(e.x[0],e.y[0],e.z[0]),e=new THREE.Vector3(e.x[1],e.y[1],e.z[1]),h=new THREE.BoxCollider(h,e);h.mesh=f;return h};THREE.CollisionUtils.MeshAABB=function(e){var c=THREE.CollisionUtils.MeshOBB(e);c.min.addSelf(e.position);c.max.addSelf(e.position);c.dynamic=!1;return c};THREE.CollisionUtils.MeshColliderWBox=function(b){return new THREE.MeshCollider(b,THREE.CollisionUtils.MeshOBB(b))};if(THREE.WebGLRenderer){THREE.AnaglyphWebGLRenderer=function(G){THREE.WebGLRenderer.call(this,G);var F=this,E=this.setSize,D=this.render,B=new THREE.PerspectiveCamera,A=new THREE.PerspectiveCamera,C=new THREE.Matrix4,z=new THREE.Matrix4,y,x,w;B.matrixAutoUpdate=A.matrixAutoUpdate=!1;var G={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},p=new THREE.WebGLRenderTarget(512,512,G),J=new THREE.WebGLRenderTarget(512,512,G),I=new THREE.PerspectiveCamera(53,1,1,10000);I.position.z=2;_material=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:p},mapRight:{type:"t",value:1,texture:J}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"});var H=new THREE.Scene;H.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),_material));this.setSize=function(b,c){E.call(F,b,c);p.width=b;p.height=c;J.width=b;J.height=c};this.render=function(h,n){n.update(null,!0);if(y!==n.aspect||x!==n.near||w!==n.fov){y=n.aspect;x=n.near;w=n.fov;var m=n.projectionMatrix.clone(),f=125/30*0.5,e=f*x/125,b=x*Math.tan(w*Math.PI/360),k;C.n14=f;z.n14=-f;f=-b*y+e;k=b*y+e;m.n11=2*x/(k-f);m.n13=(k+f)/(k-f);B.projectionMatrix=m.clone();f=-b*y-e;k=b*y-e;m.n11=2*x/(k-f);m.n13=(k+f)/(k-f);A.projectionMatrix=m.clone()}B.matrix=n.matrixWorld.clone().multiplySelf(z);B.update(null,!0);B.position.copy(n.position);B.near=x;B.far=n.far;D.call(F,h,B,p,!0);A.matrix=n.matrixWorld.clone().multiplySelf(C);A.update(null,!0);A.position.copy(n.position);A.near=x;A.far=n.far;D.call(F,h,A,J,!0);D.call(F,H,I)}}}if(THREE.WebGLRenderer){THREE.CrosseyedWebGLRenderer=function(n){THREE.WebGLRenderer.call(this,n);this.autoClear=!1;var m=this,w=this.setSize,v=this.render,t,p,u=new THREE.PerspectiveCamera;u.target=new THREE.Vector3(0,0,0);var o=new THREE.PerspectiveCamera;o.target=new THREE.Vector3(0,0,0);m.separation=10;if(n&&n.separation!==void 0){m.separation=n.separation}this.setSize=function(b,c){w.call(m,b,c);t=b/2;p=c};this.render=function(b,e){this.clear();u.fov=e.fov;u.aspect=0.5*e.aspect;u.near=e.near;u.far=e.far;u.updateProjectionMatrix();u.position.copy(e.position);u.target.copy(e.target);u.translateX(m.separation);u.lookAt(u.target);o.projectionMatrix=u.projectionMatrix;o.position.copy(e.position);o.target.copy(e.target);o.translateX(-m.separation);o.lookAt(o.target);this.setViewport(0,0,t,p);v.call(m,b,u);this.setViewport(t,0,t,p);v.call(m,b,o,!1)}}}if(!window.requestAnimationFrame){window.requestAnimationFrame=(function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c,b){window.setTimeout(c,1000/60)}})()}var SSI=SSI||{};SSI.Core3D=function(I){var y,D,L,J,K,U;var f,Q;var m;var t=0;var F={x:0,y:0},C={x:0,y:0};var E={x:0,y:0},b={x:Math.PI*3/2,y:Math.PI/6},v={x:0,y:0};var A=50000,H=50000;var z=Math.PI/2;var p=500000;var o=10000;var M=new Array();var e=null;function R(){K=I.offsetWidth||window.innerWidth;U=I.offsetHeight||window.innerHeight;S();y=new THREE.PerspectiveCamera(30,K/U,1,1000000);y.position.z=A;f=new THREE.Vector3();D=new THREE.Scene();B();Q()}function S(){L=new THREE.Projector();J=new THREE.WebGLRenderer({antialias:true});J.autoClear=false;J.setClearColorHex(0,0);J.setSize(K,U);J.domElement.style.position="absolute";I.appendChild(J.domElement)}function B(){I.addEventListener("mousedown",T,false);I.addEventListener("mousewheel",N,false);I.addEventListener("DOMMouseScroll",O,false);document.addEventListener("keydown",W,false);window.addEventListener("resize",n,false);I.addEventListener("mouseover",function(){m=true},false);I.addEventListener("mouseout",function(){m=false},false)}function Q(){requestAnimationFrame(Q);G()}function G(){P(t);E.x+=(b.x-E.x)*0.1;E.y+=(b.y-E.y)*0.1;A+=(H-A)*0.3;y.position.x=A*Math.sin(E.x)*Math.cos(E.y);y.position.y=A*Math.sin(E.y);y.position.z=A*Math.cos(E.x)*Math.cos(E.y);y.lookAt(D.position);f.copy(y.position);u();J.clear();J.render(D,y)}function u(){for(var X in M){if(M[X].scale==true){var aa=M[X].shape.position;var ab=aa.x-y.position.x;var Y=aa.y-y.position.y;var h=aa.z-y.position.z;var w=Math.sqrt(ab*ab+Y*Y+h*h);var Z=w/(6371*7);M[X].shape.scale.x=M[X].shape.scale.y=M[X].shape.scale.z=Z}}}function T(h){h.preventDefault();I.addEventListener("mousemove",c,false);I.addEventListener("mouseup",V,false);I.addEventListener("mouseout",k,false);C.x=-h.clientX;C.y=h.clientY;v.x=b.x;v.y=b.y;I.style.cursor="move"}function c(h){F.x=-h.clientX;F.y=h.clientY;var w=A/(35000);b.x=v.x+(F.x-C.x)*0.005*w;b.y=v.y+(F.y-C.y)*0.005*w;b.y=b.y>z?z:b.y;b.y=b.y<-z?-z:b.y}function V(h){h.preventDefault();I.removeEventListener("mousemove",c,false);I.removeEventListener("mouseup",V,false);I.removeEventListener("mouseout",k,false);I.style.cursor="auto"}function k(h){I.removeEventListener("mousemove",c,false);I.removeEventListener("mouseup",V,false);I.removeEventListener("mouseout",k,false)}function N(h){h.preventDefault();if(m){P(h.wheelDeltaY*(10))}return false}function O(h){h.preventDefault();if(m){var w=h.detail?h.detail*(-120):h.wheelDelta;P(w*(10))}return false}function W(h){switch(h.keyCode){case 38:P(3200);h.preventDefault();break;case 40:P(-3200);h.preventDefault();break}}function n(h){clearTimeout(e);e=setTimeout(function(){x()},250)}function x(){K=I.offsetWidth||window.innerWidth;U=I.offsetHeight||window.innerHeight;y.aspect=K/U;y.updateProjectionMatrix();J.setSize(K,U)}function P(h){H-=h;H=H>p?p:H;H=H<o?o:H}this.draw=function(X,h,w){if(M[X]==undefined){D.add(h);M[X]={shape:h,scale:w}}};this.showObject=function(w,h){if(M[w]!=undefined){if(h){D.add(M[w].shape)}else{D.remove(M[w].shape)}}};this.removeObject=function(h){if(M[h]!=undefined){D.remove(M[h].shape);delete M[h]}};this.removeAllObjects=function(){for(var h in M){D.remove(M[h].shape)}M=new Array()};this.getObjectPosition=function(h){if(M[h]==undefined){return undefined}return M[h].shape.position};this.moveCameraTo=function(X){H=X.length();var w=new THREE.Vector3(0,0,1);var Z=new THREE.Vector3(0,1,0);var Y=new THREE.Vector3();Y.copy(X);Y.y=0;Y.normalize();X.normalize();var aa=(Math.PI/2)-Math.acos(Z.dot(X));var h=Math.acos(w.dot(Y));if(Y.x<0){h=-h}b.y=isNaN(aa)?0:aa;b.x=isNaN(h)?0:h};R();return this};var SSI=SSI||{};SSI.ObjectLibrary=function(){var b=new Array();var c=0;this.addGeometryObjectFromUrl=function(k,f,h){if(b[k]!=undefined){h();return}b[k]="loading";var e=new THREE.JSONLoader();e.load({model:f,callback:function(m){b[k]=m;h()}})};this.getObjectById=function(k,h){var e=b[k];var f=this;if(e=="loading"){setTimeout(function(){f.getObjectById(k,h)},1000)}else{if(e==null){throw"Tried to retrieve object ["+k+"] from object library but didn't exist"}else{h(e)}}};this.setObject=function(f,e){b[f]=e}};var SSI=SSI||{};SSI.UniverseController=function(e){var c=new Array();var h;var f=e.refreshRate||30;var b=0;function k(){var o=(new Date()).getTime();var m=o-b;b=o;for(var n in c){c[n].update(m);c[n].draw()}h=setTimeout(function(){k()},f)}this.updateOnce=function(){for(var m in c){c[m].update(null);c[m].draw()}};this.addGraphicsObject=function(m){c[m.id]=m;this.updateOnce()};this.removeGraphicsObject=function(m){delete c[m]};this.play=function(){b=(new Date()).getTime();k()};this.pause=function(){clearTimeout(h)};this.removeAllGraphicsObjects=function(){c=new Array()};this.getGraphicsObjects=function(){return c}};SSI.UniverseController.prototype.changeRefreshRate=function(b){this.refreshRate=b};var SSI=SSI||{};SSI.EarthExtensions=function(m){var c=this;var e=6371;var n=new THREE.Vector3(0,0,0);var k=undefined;m.setObjectInLibrary("default_ground_object_geometry",new THREE.SphereGeometry(150,20,10));m.setObjectInLibrary("default_ground_object_material",new THREE.MeshLambertMaterial({color:52224}));m.setObjectInLibrary("default_ground_track_material",new THREE.MeshBasicMaterial({color:13369344,transparent:true,opacity:0.4,blending:THREE.AdditiveBlending}));m.setObjectInLibrary("default_sensor_projection_material",new THREE.MeshBasicMaterial({color:16755200,transparent:true,blending:THREE.AdditiveBlending,overdraw:true,opacity:0.15}));m.setObjectInLibrary("default_orbit_line_material",new THREE.LineBasicMaterial({color:10027008,opacity:1}));m.setObjectInLibrary("default_ground_object_tracing_line_material",new THREE.LineBasicMaterial({color:39168,opacity:1}));this.addEarth=function(y){var x=40,v=30;var w=new THREE.SphereGeometry(e,x,v);var t={uniforms:{texture:{type:"t",value:0,texture:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","float intensity = 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );","vec3 atmosphere = vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );","gl_FragColor = vec4( diffuse + atmosphere, 1.0 );","}"].join("\n")};var o=THREE.UniformsUtils.clone(t.uniforms);o.texture.texture=THREE.ImageUtils.loadTexture(y.image);var p=new THREE.ShaderMaterial({uniforms:o,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader});var u=new THREE.Mesh(w,p);m.addObject({id:"earth",objectName:"earth",update:function(z){var A=CoordinateConversionTools.convertTimeToGMST(m.getCurrentUniverseTime());u.rotation.y=A*(2*Math.PI/360)},draw:function(){m.draw(this.id,u,false)}})};this.addMoon=function(A){var x=40,o=30;var p=1737.1;var z={x:-360680.9359251,y:-42332.8629642,z:-30945.6526294,x_dot:0.1634206,y_dot:-1.0634127,z_dot:0.0412856,epoch:new Date(m.getCurrentUniverseTime())};var w=new THREE.SphereGeometry(p,x,o);var u={uniforms:{texture:{type:"t",value:0,texture:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","float intensity = 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );","vec3 atmosphere = vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );","gl_FragColor = vec4( diffuse + atmosphere, 1.0 );","}"].join("\n")};var y=THREE.UniformsUtils.clone(u.uniforms);y.texture.texture=THREE.ImageUtils.loadTexture(A.image);var v=new THREE.ShaderMaterial({uniforms:y,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});var t=new THREE.Mesh(w,v);m.addObject({id:"moon",objectName:"moon",stateVector:z,update:function(B){var E=new ECICoordinates(this.stateVector.x,this.stateVector.y,this.stateVector.z,this.stateVector.x_dot,this.stateVector.y_dot,this.stateVector.z_dot);var F=new Date(m.getCurrentUniverseTime());var B=(F.getTime()-this.stateVector.epoch.getTime())/1000;var D=OrbitPropagator.propagateOrbit(E,B,100,this.stateVector.epoch);var C=f({x:D.x,y:D.y,z:D.z});t.position={x:C.x,y:C.y,z:C.z}},draw:function(){m.draw(this.id,t,false)}})};this.addSpaceObject=function(t){var p,o;m.getObjectFromLibraryById(t.modelId,function(u){p=u;m.getObjectFromLibraryById("default_material",function(v){o=v;var w=new THREE.Mesh(p,o);m.addObject({id:t.id,objectName:t.objectName,update:function(x){var y=f(t.propagator());if(y!=undefined){w.position.set(y.x,y.y,y.z);w.lookAt(n)}},draw:function(){m.draw(this.id,w,false);c.showModelForId(t.showVehicle,this.id)}});c.addPropogationLineForObject(t);c.showOrbitLineForObject(t.showPropogationLine,t.id);c.addGroundTrackPointForObject(t);c.showGroundTrackForId(t.showGroundTrackPoint,t.id);c.addSensorProjection(t);c.showSensorProjectionForId(t.showSensorProjections,t.id);c.addClosestGroundObjectTracingLine(t)})})};this.addGroundObject=function(p){var u,o,t;if(!p.modelId){p.modelId="default_ground_object_geometry";t="default_ground_object_material"}else{t="default_material"}m.getObjectFromLibraryById(p.modelId,function(v){u=v;m.getObjectFromLibraryById(t,function(x){o=x;u.applyMatrix(new THREE.Matrix4().setRotationFromEuler(new THREE.Vector3(Math.PI/2,Math.PI,0)));var w=new THREE.Mesh(u,o);m.addObject({id:p.id,objectName:p.objectName,currentLocation:undefined,update:function(A){var z=f(p.propagator());w.position.set(z.x,z.y,z.z);this.currentLocation={x:z.x,y:z.y,z:z.z};var y=new THREE.Vector3(z.x,z.y,z.z);y.multiplyScalar(1.4);w.lookAt(y)},draw:function(){m.draw(this.id,w,true)}})})})};this.addGroundTrackPointForObject=function(p){var t,o;m.getObjectFromLibraryById("default_ground_object_geometry",function(u){t=u;m.getObjectFromLibraryById("default_ground_track_material",function(w){o=w;var v=new THREE.Mesh(t,o);m.addObject({id:p.id+"_groundPoint",objectName:p.objectName,update:function(y){var z=f(p.propagator(undefined,false));if(z!=undefined){var x=new THREE.Vector3(z.x,z.y,z.z);x.multiplyScalar(e/x.length());v.position.copy(x)}},draw:function(){m.draw(this.id,v,true)}})})})};this.addPropogationLineForObject=function(p){var t,o;t=new THREE.Geometry();m.getObjectFromLibraryById("default_orbit_line_material",function(y){o=y;var A=new Date(m.getCurrentUniverseTime());var w=1440;for(var x=0;x<w;x+=5){var z=f(p.propagator(A,false));if(z!=undefined){var v=new THREE.Vector3(z.x,z.y,z.z);t.vertices.push(new THREE.Vertex(v))}A.setMinutes(A.getMinutes()+5)}var u=new THREE.Line(t,o);m.addObject({id:p.id+"_propogation",objectName:p.objectName,update:function(B){},draw:function(){m.draw(this.id,u,false)}})})};this.addSensorProjection=function(u){var v,p;var y=f(u.propagator(undefined,false));if(y!=undefined){var o=1;v=new SensorPatternGeometry(o);var w=new THREE.Vector3(y.x,y.y,y.z);var t=w.length()-e;var x=0.15;m.getObjectFromLibraryById("default_sensor_projection_material",function(z){p=z;var A=new THREE.Mesh(v,p);A.doubleSided=true;m.addObject({id:u.id+"_sensorProjection",objectName:u.objectName,update:function(C){var D=f(u.propagator(undefined,false));if(D!=undefined){var B=new THREE.Vector3(D.x,D.y,D.z);A.position.copy(B);A.scale.z=B.length()-e+200;A.scale.x=A.scale.y=A.scale.z*x;var E=new THREE.Vector3(0,0,0);A.lookAt(E)}},draw:function(){m.draw(this.id,A,false)}})})}};this.addClosestGroundObjectTracingLine=function(p){var t,o;m.getObjectFromLibraryById("default_ground_object_tracing_line_material",function(v){o=v;var u=undefined;m.addObject({id:p.id+"_controlLine",objectName:p.objectName,update:function(x){var A=f(p.propagator(undefined,false));var z=b(A);if(z!=undefined){t=new THREE.Geometry();var w=new THREE.Vector3(A.x,A.y,A.z);t.vertices.push(new THREE.Vertex(w));var y=new THREE.Vector3(z.currentLocation.x,z.currentLocation.y,z.currentLocation.z);t.vertices.push(new THREE.Vertex(y));u=new THREE.Line(t,o)}},draw:function(){m.unDraw(this.id);if(u!=undefined){m.draw(this.id,u,false);if(k!=undefined){c.showControlLineForId(k,p.id)}else{c.showControlLineForId(p.showControlLine,p.id)}}}})})};function b(o){if(o!=undefined){var p=new THREE.Vector3(o.x,o.y,o.z);p.multiplyScalar(e/p.length());return h(p)}return undefined}function h(u){var p=m.getGraphicsObjects();var x=undefined;var v=undefined;for(var t in p){if(p[t].currentLocation!=undefined){var o=new THREE.Vector3(p[t].currentLocation.x,p[t].currentLocation.y,p[t].currentLocation.z);var w=o.distanceTo(u);if(x==undefined||w<x){v=p[t];x=w}}}return v}this.showAllOrbitLines=function(t){var o=m.getGraphicsObjects();for(var p in o){if(o[p].id.indexOf("_propogation")!=-1){m.showObject(o[p].id,t)}}};this.showOrbitLineForObject=function(o,p){m.showObject(p+"_propogation",o)};this.showModelForId=function(o,p){m.showObject(p,o)};this.showAllGroundTracks=function(t){var o=m.getGraphicsObjects();for(var p in o){if(o[p].id.indexOf("_groundPoint")!=-1){m.showObject(o[p].id,t)}}};this.showGroundTrackForId=function(o,p){m.showObject(p+"_groundPoint",o)};this.showAllSensorProjections=function(t){var o=m.getGraphicsObjects();for(var p in o){if(o[p].id.indexOf("_sensorProjection")!=-1){m.showObject(o[p].id,t)}}};this.showSensorProjectionForId=function(o,p){m.showObject(p+"_sensorProjection",o)};this.showAllControlLines=function(t){k=t;var o=m.getGraphicsObjects();for(var p in o){if(o[p].id.indexOf("_controlLine")!=-1){m.showObject(o[p].id,t)}}};this.showControlLineForId=function(o,p){m.showObject(p+"_controlLine",o)};this.removeAllExceptEarthAndMoon=function(){var o=m.getGraphicsObjects();for(var p in o){if(o[p].id!="earth"&&o[p].id!="moon"){m.removeObject(o[p].id)}}};this.setup=function(){this.removeAllExceptEarthAndMoon();m.setup()};function f(o){if(o==undefined){return undefined}return{x:-o.x,y:o.z,z:o.y}}};var HarmonicTerms={calculatePerturbationTerms:function(c,b){}};var OrbitPropagator={rungeKuttaFehlbergIntegrator:function(b,v,x,k){var w=b;var F=new Array();var e=new Array();var z=0;var o=1;var D=x;var y=0.02;if(x>y){D=y}var E=k.getTime();o=v/D;var A=1;for(A=1;A<=o;A++){E=E+(D*1000);var C=new Date(E);GST=CoordinateConversionTools.convertTimeToGMST(C);var u=new Array();var t=new Array();var p=new Array();var n=new Array();var m=new Array();var c=new Array();var B=0;for(B=0;B<9;B++){e[B]=w[B]}z=D;F=this.generateStateUpdate(e,z,GST);for(B=0;B<9;B++){u[B]=D*F[B]}for(B=0;B<9;B++){e[B]=w[B]+0.25*u[B]}z=0.25*D;F=this.generateStateUpdate(e,z,GST);for(B=0;B<9;B++){t[B]=D*F[B]}for(B=0;B<9;B++){e[B]=w[B]+(3/32)*u[B]+(9/32)*t[B]}z=0.375*D;F=this.generateStateUpdate(e,z,GST);for(B=0;B<9;B++){p[B]=D*F[B]}for(B=0;B<9;B++){e[B]=w[B]+((1932/2197)*u[B])-((7200/2197)*t[B])+((7296/2197)*p[B])}z=0.9230769230769231*D;F=this.generateStateUpdate(e,z,GST);for(B=0;B<9;B++){n[B]=D*F[B]}for(B=0;B<9;B++){e[B]=w[B]+((439/216)*u[B])-(8*t[B])+((3680/513)*p[B])-((845/4104)*n[B])}z=D;F=this.generateStateUpdate(e,z,GST);for(B=0;B<9;B++){m[B]=D*F[B]}for(B=0;B<9;B++){e[B]=w[B]-((8/27)*u[B])+((2)*t[B])-((3544/2565)*p[B])+((1859/4104)*n[B])-((11/40)*m[B])}z=(0.5)*D;F=this.generateStateUpdate(e,z,GST);for(B=0;B<9;B++){c[B]=D*F[B]}for(B=0;B<9;B++){w[B]=w[B]+((16/135)*u[B])+((6656/12825)*p[B])+((28561/56430)*n[B])-((9/50)*m[B])+((2/55)*c[B])}}return w},generateStateUpdate:function(k,h,f){var b=new Array();var c=Constants.muEarth;var e=Math.sqrt((k[0]*k[0])+(k[1]*k[1])+(k[2]*k[2]));b[0]=k[3];b[1]=k[4];b[2]=k[5];b[3]=-c*k[0]/(e*e*e);b[4]=-c*k[1]/(e*e*e);b[5]=-c*k[2]/(e*e*e);b[6]=0;b[7]=0;b[8]=0;return b},propagateOrbit:function(t,B,I,o){var k=CoordinateConversionTools.convertECIToKeplerian(t);if(B==0||isNaN(k.getEccentricity())){return t}else{if(k.getEccentricity()<=0.1){var S=k.getMeanAnomaly()+k.getMeanMotion()*B;var E=MathTools.toRadians(k.getArgOfPerigee());var N=MathTools.toRadians(k.getRaan());var C=MathTools.toRadians(k.getInclination());var F=k.getEccentricity();var J=Constants.muEarth;S=MathTools.toRadians(S);var c=S*0.95;var M=0.00001;for(var O=0;O<500;O++){var b=S-(c-F*Math.sin(c));if(Math.abs(b)>M){if(b>0){c=c+Math.abs(S-c)/2}else{if(b<0){c=c-Math.abs(S-c)/2}}}else{break}}var R=2*Math.atan(Math.sqrt((1+F)/(1-F))*Math.tan(c/2));var K=k.getSemimajorAxis()*(1-F*F);var H=k.getSemimajorAxis()*(1-F*Math.cos(c));var P=Math.sqrt(J*k.getSemimajorAxis()*(1-F*F));var D=H*(Math.cos(N)*Math.cos(E+R)-Math.sin(N)*Math.sin(E+R)*Math.cos(C));var A=H*(Math.sin(N)*Math.cos(E+R)+Math.cos(N)*Math.sin(E+R)*Math.cos(C));var v=H*Math.sin(C)*Math.sin(E+R);var G=((D*P*F)/(H*K))*Math.sin(R)-(P/H)*(Math.cos(N)*Math.sin(E+R)+Math.sin(N)*Math.cos(E+R)*Math.cos(C));var L=((A*P*F)/(H*K))*Math.sin(R)-(P/H)*(Math.sin(N)*Math.sin(E+R)-Math.cos(N)*Math.cos(E+R)*Math.cos(C));var Q=((v*P*F)/(H*K))*Math.sin(R)+(P/H)*(Math.sin(C)*Math.cos(E+R));var u=new ECICoordinates();u.setX(D);u.setY(A);u.setZ(v);u.setVX(G);u.setVY(L);u.setVZ(Q);u.setAX(0);u.setAY(0);u.setAZ(0);return u}else{var n=new Array();n[0]=t.x;n[1]=t.y;n[2]=t.z;n[3]=t.vx;n[4]=t.vy;n[5]=t.vz;n[6]=t.ax;n[7]=t.ay;n[8]=t.az;var m=this.rungeKuttaFehlbergIntegrator(n,B,I,o);var e=new ECICoordinates(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8]);return e}}}};var a=new Array();var i=0;for(i=0;i<3;i++){a[i]=new Array()}var Constants={radiusEarth:6378.1363,muEarth:398600.4418,eccEarthSphere:0.081819221456};var CoordinateConversionTools={convertCurrentEpochToJulianDate:function(k){var e=0;var h=k.getYear()+1900;var m=k.getMonth();var c=k.getDate();var b=k.getHours();var n=k.getMinutes();var f=k.getSeconds();e=367*h-(7*(h+((m+9)/12))/4)+(275*m/9)+(c)+1721013.5+((f/60+n)/60+b)/24;return e},convertTimeToGMST:function(f){var e=this.convertCurrentEpochToJulianDate(f);var c=(e-2451545)/36525;var b=67310.54841+(876600*3600+8640184.812866)*c+0.093104*c*c-(0.0000062)*c*c*c;var h=Math.floor(b/86400);b=b-h*86400;b=b/240;if(b<0){b=b+360}return b},convertLLAtoECEF:function(p){var o=MathTools.toRadians(p.getLatitude());var c=MathTools.toRadians(p.getLongitude());var e=Constants.radiusEarth;var v=Constants.eccEarthSphere;var f=Math.sin(o);var m=p.getAltitude();var h=e/Math.sqrt(1-v*v*f*f);var b=e*(1-v*v)/Math.sqrt(1-v*v*f*f);var u=(h+m)*(Math.cos(o)*Math.cos(c));var t=(h+m)*(Math.cos(o)*Math.sin(c));var n=(b+m)*(Math.sin(o));var k=new ECEFCoordinates(u,t,n,0,0,0,0,0,0);return k},convertECEFtoLLA:function(b){var p=new LLAcoordinates();var x=b.getX();var w=b.getY();var v=b.getZ();var t=Constants.eccEarthSphere;var z=Constants.radiusEarth;var E=Math.sqrt((x*x)+(w*w));var o=w/E;var h=x/E;var k=Math.atan(o/h);var u=k;var f=v/E;var D=Math.atan(f);var A=1e-8;var C=0;var m=D;var y=2000;var B;var e;var n=0;while(Math.abs(m-y)>A){y=m;B=Math.sin(y);C=z/Math.sqrt(1-(t*t*B*B));e=(v+C*t*t*B)/E;m=Math.atan(e);n++;if(n>500){m=0;y=0}}if(u<-Math.PI){u=u+2*Math.PI}if(u>Math.PI){u=u-2*Math.PI}p.setLatitude(MathTools.toDegrees(m));p.setLongitude(MathTools.toDegrees(u));p.setAltitude(E/Math.cos(m)-C);return p},convertECItoECEF:function(k,f){var c=new ECEFcoordinates();eciPos=new Array();eciPos[0]=k.getX();eciPos[1]=k.getY();eciPos[2]=k.getZ();var b=MathTools.rot3(f,eciPos);c.setX(b[0]);c.setY(b[1]);c.setZ(b[2]);var e=new Array();e[0]=k.getVX();e[1]=k.getVY();e[2]=k.getVZ();b=MathTools.rot3(f,e);c.setVx(b[0]);c.setVy(b[1]);c.setVz(b[2]);var h=new Array();h[0]=k.getAx();h[1]=k.getAy();h[2]=k.getAz();b=MathTools.rot3(f,h);c.setAx(b[0]);c.setAy(b[1]);c.setAz(b[2]);return c},convertECEFtoECI:function(c,f){var k=new ECICoordinates();var m=new Array();m[0]=c.getX();m[1]=c.getY();m[2]=c.getZ();var b=MathTools.rot3(-f,m);k.setX(b[0]);k.setY(b[1]);k.setZ(b[2]);var e=new Array();e[0]=c.getVX();e[1]=c.getVY();e[2]=c.getVZ();b=MathTools.rot3(-f,e);k.setVX(b[0]);k.setVY(b[1]);k.setVZ(b[2]);var h=new Array();h[0]=c.getAX();h[1]=c.getAY();h[2]=c.getAZ();b=MathTools.rot3(-f,h);k.setAX(b[0]);k.setAY(b[1]);k.setAZ(b[2]);return k},convertECItoLLA:function(e,c){var b=convertECItoECEF(e,c);return convertECEFtoLLA(b)},convertLLAtoECI:function(c,e){var b=this.convertLLAtoECEF(c);return this.convertECEFtoECI(b,e)},convertKeplerianToECI:function(f){var A=new ECIcoordinates();var v=f.getSemimajorAxis();var o=f.getEccentricity();var b=v*(1-o*o);var u=f.getTrueAnomaly();var h=Math.cos(Math.toRadians(u));var k=Math.sin(Math.toRadians(u));var z=b*h/(1+o*h);var t=b*k/(1+o*h);var m=0;var x=new Array();x[0]=z;x[1]=t;x[2]=m;var w=new Array();w=MathTools.rot3(-f.getArgOfPerigee(),x);w=MathTools.rot1(-f.getInclination(),w);w=MathTools.rot3(-f.getRaan(),w);A.setX(w[0]);A.setY(w[1]);A.setZ(w[2]);var n=-Math.sqrt(Constants.muEarth/b)*k;var c=Math.sqrt(Constants.muEarth/b)*(o+h);var y=0;x[0]=n;x[1]=c;x[2]=y;w=MathTools.rot3(-f.getArgOfPerigee(),x);w=MathTools.rot1(-f.getInclination(),w);w=MathTools.rot3(-f.getRaan(),w);A.setVx(w[0]);A.setVy(w[1]);A.setVz(w[2]);return A},convertECIToKeplerian:function(w){var M=new KeplerianCoordinates();var B=new Array();B[0]=w.x;B[1]=w.y;B[2]=w.z;var y=new Array();y[0]=w.vx;y[1]=w.vy;y[2]=w.vz;var K=MathTools.cross(B,y);var C=MathTools.magnitude(K);var f=MathTools.magnitude(B);var H=MathTools.magnitude(y);var b=new Array();b[0]=0;b[1]=0;b[2]=1;var E=new Array();E=MathTools.cross(b,K);var I=H*H-Constants.muEarth/f;var G=MathTools.dotMultiply(B,y);var O=new Array();var J=0;for(J=0;J<3;J++){O[J]=(1/Constants.muEarth)*(I*B[J]-G*y[J])}var k=MathTools.magnitude(O);var L=H*H/2-Constants.muEarth/f;var D=0;var P=0;if(k==1){P=Infinity;D=C*C/Constants.muEarth}else{P=-Constants.muEarth/(2*L);D=P*(1-k*k)}var x=MathTools.toDegrees(Math.acos(K[2]/C));var t=MathTools.toDegrees(Math.acos(E[0]/MathTools.magnitude(E)));if(E[1]<0){t=360-t}var m=MathTools.toDegrees(Math.acos(MathTools.dotMultiply(E,O)/(MathTools.magnitude(E)*k)));if(O[2]<0){m=360-m}var F=MathTools.dotMultiply(O,B)/(k*f);if(F>1){F=1}var Q=MathTools.toDegrees(Math.acos(F));if(MathTools.dotMultiply(y,B)<0){Q=360-Q}if(isNaN(t)){t=0.00001}if(isNaN(m)){m=0.00001}M.setSemimajorAxis(P);M.setEccentricity(k);M.setTrueAnomaly(Q);M.setRaan(t);M.setInclination(x);M.setMeanMotion(MathTools.toDegrees(Math.sqrt(Constants.muEarth/(P*P*P))));M.setArgOfPerigee(m);var z=Math.sin(MathTools.toRadians(Q));var o=Math.cos(MathTools.toRadians(Q));var A=((z*Math.sqrt(1-k*k))/(1+k*o));var u=((k+o)/(1+k*o));var c=Math.atan2(A,u);var N=c-k*A;N=MathTools.toDegrees(N);M.setMeanAnomaly(N);return M},buildRotationMatrixToConvertECItoRSW:function(h){var k=h.getKepler();var e=k.getTrueAnomaly();var b=k.getArgOfPerigee();var m=k.getInclination();var c=k.getRaan();var n=new Array(3);var f=0;for(var f=0;f<3;f++){n[f]=new Array(3)}n=MathTools.buildRotationMatrix3(c);n=MathTools.multiply(MathTools.buildRotationMatrix1(m),n);n=MathTools.multiply(MathTools.buildRotationMatrix3(b),n);n=MathTools.multiply(MathTools.buildRotationMatrix3(e),n);return n},convertTargetECIToSatelliteRSW:function(o,k){var f=new RSWcoordinates();var h=o.getKepler();var b=o.getEci();var m=h.getTrueAnomaly();var p=h.getArgOfPerigee();var c=h.getInclination();var n=h.getRaan();var e=new Array();e[0]=k.getX()-b.getX();e[1]=k.getY()-b.getY();e[2]=k.getZ()-b.getZ();e=MathTools.rot3(n,e);e=MathTools.rot1(c,e);e=MathTools.rot3(p,e);e=MathTools.rot3(m,e);f.setRadial(e[0]);f.setAlongTrack(e[1]);f.setCrossTrack(e[2]);return f},convertRSWToECI:function(m,f){var p=new ECIcoordinates();var h=m.getKepler();var k=h.getTrueAnomaly();var o=h.getArgOfPerigee();var c=h.getInclination();var n=h.getRaan();var b=new Array();b[0]=f.getRadial();b[1]=f.getAlongTrack();b[2]=f.getCrossTrack();var e=new Array();e=MathTools.rot3(-k,b);e=MathTools.rot3(-o,e);e=MathTools.rot1(-c,e);e=MathTools.rot3(-n,e);p.setX(e[0]);p.setY(e[1]);p.setZ(e[2]);return p},getSunPositionECIAtCurrentTime:function(h){var k=convertCurrentEpochToJulianDate(h);var b=(k-2451545)/36525;var c=280.4606184+36000.77005361*b;var m=357.5277233+35999.05034*b;var f=c+1.914666471*Math.sin(Math.toRadians(m))+0.019994643*Math.sin(2*Math.toRadians(m));var t=1.000140612-0.016708617*Math.cos(Math.toRadians(m))-0.000139589*Math.cos(2*Math.toRadians(m));var n=23.439291-0.0130042*b;var p=149597870;var o=new ECIcoordinates();o.setX(t*Math.cos(Math.toRadians(f))*p);o.setY(t*Math.cos(Math.toRadians(n))*Math.sin(Math.toRadians(f))*p);o.setZ(t*Math.sin(Math.toRadians(n))*Math.sin(Math.toRadians(f))*p);return o}};var CoordinateFunctionHelper={updateKeplerianAnglesUsingTrueAnomaly:function(e){var b=Math.toRadians(trueAnomaly);var f=Math.sin(b)*Math.sqrt(1-e.eccentricity*e.eccentricity)/(1+e.eccentricity*Math.cos(b));var c=(e.eccentricity+Math.cos(b))/(1+e.eccentricity*Math.cos(b));e.eccentricAnomaly=Math.toDegrees(Math.atan2(f,c));e.meanAnomaly=Math.toDegrees(Math.toRadians(e.eccentricAnomaly)-e.eccentricity*f)},setKeplerianTrueAnomaly:function(b,c){b.trueAnomaly=c;updateAnglesUsingTrueAnomaly(b)}};function ECEFCoordinates(n,k,f,m,e,b,h,c,o){this.x=n?n:0,this.y=k?k:0,this.z=f?f:0,this.vx=m?m:0,this.vy=e?e:0,this.vz=b?b:0,this.ax=h?h:0,this.ay=c?c:0,this.az=o?o:0;this.getX=function(){return this.x};this.setX=function(p){this.x=p};this.getY=function(){return this.y};this.setY=function(p){this.y=p};this.getZ=function(){return this.z};this.setZ=function(p){this.z=p};this.getVX=function(){return this.vx};this.setVX=function(p){this.vx=p};this.getVY=function(){return this.vy};this.setVY=function(p){this.vy=p};this.getVZ=function(){return this.vz};this.setVZ=function(p){this.vz=p};this.getAX=function(){return this.ax};this.setAX=function(p){this.ax=p};this.getAY=function(){return this.ay};this.setAY=function(p){this.ay=p};this.getAZ=function(){return this.az};this.setAZ=function(p){this.az=p}}function ECICoordinates(n,k,f,m,e,b,h,c,o){this.x=n?n:0,this.y=k?k:0,this.z=f?f:0,this.vx=m?m:0,this.vy=e?e:0,this.vz=b?b:0,this.ax=h?h:0,this.ay=c?c:0,this.az=o?o:0;this.getX=function(){return this.x};this.setX=function(p){this.x=p};this.getY=function(){return this.y};this.setY=function(p){this.y=p};this.getZ=function(){return this.z};this.setZ=function(p){this.z=p};this.getVX=function(){return this.vx};this.setVX=function(p){this.vx=p};this.getVY=function(){return this.vy};this.setVY=function(p){this.vy=p};this.getVZ=function(){return this.vz};this.setVZ=function(p){this.vz=p};this.getAX=function(){return this.ax};this.setAX=function(p){this.ax=p};this.getAY=function(){return this.ay};this.setAY=function(p){this.ay=p};this.getAZ=function(){return this.az};this.setAZ=function(p){this.az=p}}function KeplerianCoordinates(k,m,f,h,b,c,e,o,n){this.semimajorAxis=k?k:0,this.meanAnomaly=m?m:0,this.eccentricAnomaly=m?m:0,this.trueAnomaly=h?h:0,this.inclination=b?b:0,this.eccentricity=c?c:0,this.raan=e?e:0,this.argOfPerigee=o?o:0,this.meanMotion=n?n:0;this.getSemimajorAxis=function(){return this.semimajorAxis};this.getMeanAnomaly=function(){return this.meanAnomaly};this.getEccentricAnomaly=function(){return this.eccentricAnomaly};this.getTrueAnomaly=function(){return this.trueAnomaly};this.getInclination=function(){return this.inclination};this.getEccentricity=function(){return this.eccentricity};this.getRaan=function(){return this.raan};this.getArgOfPerigee=function(){return this.argOfPerigee};this.getMeanMotion=function(){return this.meanMotion};this.setSemimajorAxis=function(p){this.semimajorAxis=p};this.setMeanAnomaly=function(p){this.meanAnomaly=p};this.setEccentricAnomaly=function(p){this.eccentricAnomaly=p};this.setTrueAnomaly=function(p){this.trueAnomaly=p};this.setInclination=function(p){this.inclination=p};this.setEccentricity=function(p){this.eccentricity=p};this.setRaan=function(p){this.raan=p};this.setArgOfPerigee=function(p){this.argOfPerigee=p};this.setMeanMotion=function(p){this.meanMotion=p}}function LLACoordinates(c,e,b){this.latitude=c?c:0,this.longitude=e?e:0,this.altitude=b?b:0;this.getAltitude=function(){return this.altitude};this.setAltitude=function(f){this.altitude=f};this.getLatitude=function(){return this.latitude};this.setLatitude=function(f){this.latitude=f};this.getLongitude=function(){return this.longitude};this.setLongitude=function(f){this.longitude=f}}var MathTools={scalarMultiply:function(c,e){var h=c.length;var b=new Array();for(var f=0;f<h;f++){b[f]=c[f]*e}return b},dotMultiply:function(b,h){if(b.length!=h.length){return 0}else{var f=b.length;var e=0;for(var c=0;c<f;c++){e+=(b[c]*h[c])}return e}},angleBetweenTwoVectors:function(b,k){var h=0;var f=magnitude(b);var e=magnitude(k);var c=dotMultiply(b,k);h=Math.toDegrees(Math.acos(c/(f*e)));return h},magnitude:function(b){var c=0;c=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);return c},cross:function(c,e){var b=new Array();b[0]=c[1]*e[2]-e[1]*c[2];b[1]=-(c[0]*e[2]-e[0]*c[2]);b[2]=c[0]*e[1]-e[0]*c[1];return b},rot1:function(c,e){c=MathTools.toRadians(c);var b=new Array();b[0]=e[0];b[1]=Math.cos(c)*e[1]+Math.sin(c)*e[2];b[2]=-Math.sin(c)*e[1]+Math.cos(c)*e[2];return b},rot2:function(c,e){c=MathTools.toRadians(c);var b=new Array();b[0]=Math.cos(c)*e[0]-Math.sin(c)*e[2];b[1]=e[1];b[2]=Math.sin(c)*e[0]+Math.cos(c)*e[2];return b},rot3:function(c,e){c=MathTools.toRadians(c);var b=new Array();b[0]=Math.cos(c)*e[0]+Math.sin(c)*e[1];b[1]=-Math.sin(c)*e[0]+Math.cos(c)*e[1];b[2]=e[2];return b},toRadians:function(b){return b*Math.PI/180},toDegrees:function(b){return b*180/Math.PI},buildRotationMatrix1:function(c){c=Math.toRadians(c);var b=new Array();var e=0;for(e=0;e<3;e++){b[e]=new Array()}b[0][0]=1;b[0][1]=0;b[0][2]=0;b[1][0]=0;b[1][1]=Math.cos(c);b[1][2]=-Math.sin(c);b[2][0]=0;b[2][1]=Math.sin(c);b[2][2]=Math.cos(c);return b},buildRotationMatrix2:function(c){c=Math.toRadians(c);var b=new Array();var e=0;for(e=0;e<3;e++){b[e]=new Array()}b[0][0]=Math.cos(c);b[0][1]=0;b[0][2]=Math.sin(c);b[1][0]=0;b[1][1]=1;b[1][2]=0;b[2][0]=-Math.sin(c);b[2][1]=0;b[2][2]=Math.cos(c);return b},buildRotationMatrix3:function(c){c=Math.toRadians(c);var b=new Array();var e=0;for(e=0;e<3;e++){b[e]=new Array()}b[0][0]=Math.cos(c);b[0][1]=-Math.sin(c);b[0][2]=0;b[1][0]=Math.sin(c);b[1][1]=Math.cos(c);b[1][2]=0;b[2][0]=0;b[2][1]=0;b[2][2]=1;return b},ones:function(f){var b=new Array();var e=0;var c=0;for(e=0;e<f;e++){result[e]=new Array(f)}for(e=0;e<f;e++){for(c=0;c<f;c++){if(e!=c){b[e][c]=0}else{b[e][c]=1}}}return b},zeros:function(f){var b=new Array(f);var e=0;var c=0;for(e=0;e<f;e++){result[e]=new Array(f)}for(e=0;e<f;e++){for(c=0;c<f;c++){b[e][c]=0}}return b},zeros:function(h,f){var b=new Array(h);var e=0;var c=0;for(e=0;e<h;e++){result[e]=new Array(f)}for(e=0;e<h;e++){for(c=0;c<f;c++){b[e][c]=0}}return b},multiply1dBy2d:function(o,k){var b=o.length;var n=k.length;var m=k[0].length;if(b!=n){return null}var h=new Array(m);for(var f=0;f<m;f++){var c=0;for(var e=0;e<b;e++){c=c+o[e]*k[e][f]}h[f]=c}return h},multiply2dBy1d:function(o,n){var m=o.length;var f=o[0].length;var b=n.length;if(f!=b){return null}var k=new Array(m);for(var h=0;h<m;h++){var c=0;for(var e=0;e<b;e++){c=c+o[h][e]*n[e]}k[h]=c}return k},multiplyDoubleBy2d:function(f,b){var n=b.length;var k=b[0].length;var m=new Array(n);var e=0;var c=0;for(e=0;e<n;e++){m[e]=new Array(k)}for(e=0;e<n;e++){for(c=0;c<k;c++){if(b[e][c]==0){m[e][c]=0}else{m[e][c]=f*b[e][c]}}}return m},multiply2dBy2d:function(u,o){var c=u.length;var b=u[0].length;var t=o.length;var p=o[0].length;if(b!=t){return null}var n=new Array(c);var m=0;var h=0;for(m=0;m<c;m++){result[m]=new Array(p)}for(m=0;m<c;m++){for(h=0;h<p;h++){var e=0;var f=0;for(f=0;f<t;f++){e=e+u[m][f]*o[f][h]}n[m][h]=e}}return n},transposeMatrix:function(b){var f=b.length;var c=b[0].length;var k=new Array(c);var h=0;var e=0;for(h=0;h<c;h++){k[h]=new Array(f)}for(h=0;h<f;h++){for(e=0;e<c;e++){k[e][h]=b[h][e]}}return k},add1dTo1d:function(b,k){var c=b.length;var h=k.length;if(c!=h){return null}var f=new Array(c);var e=0;for(e=0;e<c;e++){f[e]=b[e]+k[e]}return f},add2dTo2d:function(o,k){var c=o.length;var b=o[0].length;var n=k.length;var m=k[0].length;if((c!=n)||(b!=m)){return null}var h=new Array(c);var f=0;var e=0;for(f=0;f<c;f++){h[f]=new Array(b)}for(f=0;f<c;f++){for(e=0;e<b;e++){h[f][e]=o[f][e]+k[f][e]}}return h},subtract2dMinus2d:function(o,k){var c=o.length;var b=o[0].length;var n=k.length;var m=k[0].length;if((c!=n)||(b!=m)){return null}var h=new Array(c);var f=0;var e=0;for(f=0;f<c;f++){h[f]=new Array(b)}for(f=0;f<c;f++){for(e=0;e<b;e++){h[f][e]=o[f][e]-k[f][e]}}return h},subtract1dMinus1d:function(b,k){var c=b.length;var h=k.length;if(c!=h){return null}var f=new Array(c);var e=0;for(e=0;e<c;e++){f[e]=b[e]-k[e]}return f}};function Quaternion(){this.w=xVal?xVal:0,this.x=xVal?xVal:0,this.y=yVal?yVal:0,this.z=zVal?zVal:0,this.q=new Array(4);this.updateQ=function(){this.q[0]=this.w;this.q[1]=this.x;this.q[2]=this.y;this.q[3]=this.z};this.getQ=function(){return q};this.setQ=function(b){this.w=b[0];this.x=b[1];this.y=b[2];this.z=b[3];this.q=b};this.getW=function(){return this.w};this.setW=function(b){this.w=b;updateQ()};this.getX=function(){return this.x};this.setX=function(b){this.x=b;updateQ()};this.getY=function(){return this.y};this.setY=function(b){this.y=b;updateQ()};this.getZ=function(){return this.z};this.setZ=function(b){this.z=b;updateQ()};this.isZero=function(){var c=true;var b=0;for(b=0;b<4;b++){if(this.q[b]!=null){if(this.q[b]!=0){c=false;break}}}return c}}var QuaternionMath={multiplyQuaternions:function(n,m){if(n.isZero()){return m}else{if(m.isZero()){return n}else{var k=n.getW();var c=n.getX();var p=n.getY();var f=n.getZ();var h=m.getW();var b=m.getX();var o=m.getY();var e=m.getZ();var t=new Quaternion();t.setW(k*h-c*b-p*o-f*e);t.setX(k*b+c*h+p*e-f*o);t.setY(k*o+p*h+f*b-c*e);t.setZ(k*e+f*h+c*o-p*b);return t}}},applyQuaternionRotation:function(n,e){var o=n.getW();var m=n.getX();var k=n.getY();var h=n.getZ();var c=new Array(3);var f=0;for(f=0;f<3;f++){c[f]=new Array(3)}c[0][0]=2*o*o-1+2*m*m;c[0][1]=2*m*k+2*o*h;c[0][2]=2*m*h-2*o*k;c[1][0]=2*m*k-2*o*h;c[1][1]=2*o*o-1+2*k*k;c[1][2]=2*k*h+2*o*m;c[2][0]=2*m*h+2*o*k;c[2][1]=2*k*h-2*o*m;c[2][2]=2*o*o-1+2*h*h;var b=MathTools.multiply(c,e);return b},getEulerAngles:function(b){var o=b.getW();var m=b.getX();var k=b.getY();var h=b.getZ();var n=Math.atan2((2*(o*m+k*h)),(1-2*(m*m+k*k)));var c=Math.asin(2*(o*k-h*m));var f=Math.atan2((2*(o*h+m*k)),(1-2*(k*k+h*h)));var e=new Array(3);e[0]=Math.toDegrees(n);e[1]=Math.toDegrees(c);e[2]=Math.toDegrees(f);return e},convertRotationMatrixToQuaternion:function(h){var c=new Quaternion();var o=h[0][0];var n=h[0][1];var k=h[0][2];var f=h[1][0];var e=h[1][1];var b=h[1][2];var u=h[2][0];var t=h[2][1];var p=h[2][2];c.setW(0.5*Math.sqrt(o+e+p+1));c.setX((b-t)/(4*c.getW()));c.setY((u-k)/(4*c.getW()));c.setZ((n-f)/(4*c.getW()));return c}};function RSWCoordinates(){radial=0,alongTrack=0,crossTrack=0}var SimulationObject={name:"",eciCoords:ECICoordinates,ecefCoords:ECEFCoordinates,keplerCoords:KeplerianCoordinates,llaCoords:LLACoordinates,sensorList:new Array(),getEcefCoordinates:function(){return ecefCoords},setEcefCoordinates:function(b){ecefCoords=b},getEciCoordinates:function(){return eciCoords},setEciCoordinates:function(b){eciCoords=b},getKeplerianCoordinates:function(){return keplerCoords},setKeplerianCoordinates:function(b){kepler=b},getLlaCoordinates:function(){return llaCoords},setLlaCoordinates:function(b){lla=b},getName:function(){return name},setName:function(b){this.name=b},getSensors:function(){return sensors},setSensors:function(b){sensorList=b},propagateState:function(k,f,c){eciCoords=OrbitPropagator.propagateOrbit(eci,k,f,c);keplerCoords=CoordinateConversionTools.convertECIToKeplerian(eci);var h=(c.getTime()+(k*1000));var b=new Date(h);var e=CoordinateConversionTools.convertTimeToGMST(b);ecefCoords=CoordinateConversionTools.convertECItoECEF(eci,e);llaCoords=CoordinateConversionTools.convertECItoLLA(eci,e)}};var SSI=SSI||{};SSI.Universe=function(w,c){var n=new SSI.UniverseController(w);var e=new SSI.Core3D(c);var v=new SSI.ObjectLibrary();var f=w.currentUniverseTime;var b=1;var u=function(){};var o=1000;var h;var p=this;v.setObject("default_geometry",new THREE.Geometry());v.setObject("default_material",new THREE.MeshFaceMaterial());function m(x){if(u!=null){u(x)}}function k(){n.addGraphicsObject({id:"simState",objectName:"simState",update:function(x){if(x!=null){f.setTime(f.getTime()+b*x)}},draw:function(){}})}function t(){var y=this;var x={};x.currentUniverseTime=new Date(f);m(x);h=setTimeout(function(){t()},o)}this.play=function(x){if(x.startTime!=undefined){f=new Date(x.startTime)}if(x.playbackSpeed!=undefined){b=x.playbackSpeed}if(x!=undefined){u=x.stateChangedCallback}t();n.play()};this.pause=function(){clearTimeout(h);n.pause()};this.setPlaybackSpeed=function(x){b=x};this.setCurrentUniverseTime=function(x){f=new Date(x);n.updateOnce()};this.getCurrentUniverseTime=function(){return f};this.addJsonGeometryModel=function(z,x,y){if(z!=undefined){v.addGeometryObjectFromUrl(z,x,y)}else{y()}};this.addObject=function(x){n.addGraphicsObject(x)};this.draw=function(z,y,x){e.draw(z,y,x)};this.unDraw=function(x){e.removeObject(x)};this.setObjectInLibrary=function(y,x){v.setObject(y,x)};this.getObjectFromLibraryById=function(y,x){v.getObjectById(y,x)};this.removeObject=function(x){n.removeGraphicsObject(x);e.removeObject(x)};this.snapToObject=function(z){var x=e.getObjectPosition(z);if(x!=undefined){var y=new THREE.Vector3();y.copy(x);y.multiplyScalar(1.4);e.moveCameraTo(y)}else{}};this.removeAll=function(){e.removeAllObjects();n.removeAllGraphicsObjects()};this.getGraphicsObjects=function(){return n.getGraphicsObjects()};this.updateObject=function(z,y,x){};this.showObject=function(y,x){e.showObject(y,x)};this.setup=function(){k()};this.setup()};